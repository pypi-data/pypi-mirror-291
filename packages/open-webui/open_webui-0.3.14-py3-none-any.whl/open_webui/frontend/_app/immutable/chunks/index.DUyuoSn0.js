import"./sha256.CRlV3BEV.js";import{g as I}from"./index.C3wY5Iyc.js";let m;const F=new Uint8Array(16);function D(){if(!m&&(m=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!m))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(F)}const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function C(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}const S=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),w={randomUUID:S};function E(e,t,n){if(w.randomUUID&&!t&&!e)return w.randomUUID();e=e||{};const s=e.random||(e.rng||D)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,C(s)}const T=e=>([/(\$\$\s[\s\S]*?\s\$\$)/g,/(\\\[[\s\S]*?\\\])/g,/(\\begin\{[a-z]+\}[\s\S]*?\\end\{[a-z]+\})/g].forEach(n=>{e=e.replace(n,s=>s.replace(/\s*\n\s*/g," ").trim())}),e),N=(e,t,n)=>{const s=/{{char}}/gi,r=/{{user}}/gi,o=/{{VIDEO_FILE_ID_([a-f0-9-]+)}}/gi,l=/{{HTML_FILE_ID_([a-f0-9-]+)}}/gi;return t!=null&&(e=e.replace(s,t)),n!=null&&(e=e.replace(r,n)),e=e.replace(o,(i,c)=>`<video src="${`${I}/api/v1/files/${c}/content`}" controls></video>`),e=e.replace(l,(i,c)=>`<iframe src="${`${I}/api/v1/files/${c}/content`}" width="100%" frameborder="0" onload="this.style.height=(this.contentWindow.document.body.scrollHeight+20)+'px';"></iframe>`),e},z=e=>e.replace(/<\|[a-z]*$/,"").replace(/<\|[a-z]+\|$/,"").replace(/<$/,"").replaceAll(/<\|[a-z]+\|>/g," ").replaceAll("<","&lt;").replaceAll(">","&gt;").trim(),L=e=>(e=T(e),e.trim()),P=e=>e.replaceAll("&lt;","<").replaceAll("&gt;",">");function B(e){return new DOMParser().parseFromString(e,"text/html").documentElement.textContent}const H=e=>{let t="";return new TransformStream({transform(n,s){t+=n;const r=t.split(e);r.slice(0,-1).forEach(o=>s.enqueue(o)),t=r[r.length-1]},flush(n){t&&n.enqueue(t)}})},O=e=>{const t={messages:{},currentId:null};let n=null,s=null;for(const r of e)s=E(),n!==null&&(t.messages[n].childrenIds=[...t.messages[n].childrenIds,s]),t.messages[s]={...r,id:s,parentId:n,childrenIds:[]},n=s;return t.currentId=s,t},U=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");e.height=1,e.width=1;const n=new ImageData(e.width,e.height),s=n.data;for(let o=0;o<n.data.length;o+=1)o%4!==3?s[o]=Math.floor(256*Math.random()):s[o]=255;t.putImageData(n,0,0);const r=t.getImageData(0,0,e.width,e.height).data;for(let o=0;o<r.length;o+=1)if(r[o]!==s[o])return console.log("canvasPixelTest: Wrong canvas pixel RGB value detected:",r[o],"at:",o,"expected:",s[o]),console.log("canvasPixelTest: Canvas blocking or spoofing is likely"),!1;return!0},V=e=>{const t=document.createElement("canvas"),n=t.getContext("2d");if(t.width=100,t.height=100,!U())return console.log("generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image."),"/user.png";n.fillStyle="#F39C12",n.fillRect(0,0,t.width,t.height),n.fillStyle="#FFFFFF",n.font="40px Helvetica",n.textAlign="center",n.textBaseline="middle";const s=e.trim(),r=s.length>0?s[0]+(s.split(" ").length>1?s[s.lastIndexOf(" ")+1]:""):"";return n.fillText(r.toUpperCase(),t.width/2,t.height/2),t.toDataURL()},W=async e=>{let t=!1;if(!navigator.clipboard){const n=document.createElement("textarea");n.value=e,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();try{const r=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+r),t=!0}catch(s){console.error("Fallback: Oops, unable to copy",s)}return document.body.removeChild(n),t}return t=await navigator.clipboard.writeText(e).then(()=>(console.log("Async: Copying to clipboard was successful!"),!0)).catch(n=>(console.error("Async: Could not copy text: ",n),!1)),t},Y=(e,t)=>t==="0.0.0"?!1:t.localeCompare(e,void 0,{numeric:!0,sensitivity:"case",caseFirst:"upper"})<0,j=e=>{const t=/\[([^\]]+)\]/g,n=[];let s;for(;(s=t.exec(e))!==null;)n.push({word:s[1],startIndex:s.index,endIndex:t.lastIndex-1});return n},q=e=>{const t=e.split(" "),n=t.findIndex(r=>r.startsWith("#"));return n!==-1&&t.splice(n,1),t.join(" ")},G=e=>e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-"),J=e=>"mapping"in e[0]?"openai":"webui",K=async(e=!1)=>{const t=await new Promise((r,o)=>{navigator.geolocation.getCurrentPosition(r,o)}).catch(r=>{throw console.error("Error getting user location:",r),r});if(!t)return"Location not available";const{latitude:n,longitude:s}=t.coords;return e?{latitude:n,longitude:s}:`${n.toFixed(3)}, ${s.toFixed(3)} (lat, long)`},b=e=>{var i,c,u,d,f,y,x,v;const t=e.mapping,n=[];let s="",r=null;for(let p in t){const g=t[p];s=p;try{if(n.length==0&&(g.message==null||((i=g.message.content.parts)==null?void 0:i[0])==""&&g.message.content.text==null))continue;{const h={id:p,parentId:r,childrenIds:g.children||[],role:((u=(c=g.message)==null?void 0:c.author)==null?void 0:u.role)!=="user"?"assistant":"user",content:((y=(f=(d=g.message)==null?void 0:d.content)==null?void 0:f.parts)==null?void 0:y[0])||((v=(x=g.message)==null?void 0:x.content)==null?void 0:v.text)||"",model:"gpt-3.5-turbo",done:!0,context:null};n.push(h),r=s}}catch(h){console.log("Error with",g,`
Error:`,h)}}let o={};return n.forEach(p=>o[p.id]=p),{history:{currentId:s,messages:o},models:["gpt-3.5-turbo"],messages:n,options:{},timestamp:e.create_time,title:e.title??"New Chat"}},R=e=>{const t=e.messages;if(t.length===0||t[t.length-1].childrenIds.length!==0||t[0].parentId!==null)return!1;for(let r of t)if(typeof r.content!="string")return!1;return!0},Q=e=>{const t=[];let n=0;for(let s of e){const r=b(s);R(r)?t.push({id:s.id,user_id:"",title:s.title,chat:r,timestamp:s.timestamp}):n++}return console.log(n,"Conversations could not be imported"),t},X=e=>{let t;try{t=new URL(e)}catch{return!1}return t.protocol==="http:"||t.protocol==="https:"},M=e=>{const t=/[\uD800-\uDBFF][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g;return e.replace(t,"")},$=e=>e.replace(/(\*)(.*?)\1/g,"").replace(/(```)(.*?)\1/gs,""),A=e=>{const t=/```[\s\S]*?```/g;let n=[],s=0;e=e.replace(t,o=>{let l=`\0${s}\0`;return n[s++]=o,l});let r=e.split(new RegExp("(?<=[.!?])\\s+"));return r=r.map(o=>o.replace(/\u0000(\d+)\u0000/g,(l,i)=>n[i])),r.map(o=>$(M(o.trim()))).filter(o=>o)},Z=e=>A(e).reduce((t,n)=>{const s=t.length-1;if(s>=0){const r=t[s];r.split(/\s+/).length<2?t[s]=r+" "+n:t.push(n)}else t.push(n);return t},[]),ee=(e,t)=>new File([e],t,{type:e.type}),te=(e,t,n)=>{const s=new Date,r=s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0"),o=s.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0});return e=e.replace("{{CURRENT_DATETIME}}",`${r} ${o}`),e=e.replace("{{CURRENT_DATE}}",r),e=e.replace("{{CURRENT_TIME}}",o),t&&(e=e.replace("{{USER_NAME}}",t)),n&&(e=e.replace("{{USER_LOCATION}}",n)),e},ne=e=>{const t=Math.floor(e/1e9%60),n=Math.floor(e/6e10%60),s=Math.floor(e/36e11%24),r=[];return t>=0&&r.push(`${t}s`),n>0&&r.push(`${n}m`),s>0&&r.push(`${s}h`),r.reverse().join(" ")},se=e=>{const t=new Date,n=new Date(e*1e3),r=(t.getTime()-n.getTime())/(1e3*3600*24),o=t.getDate(),l=t.getMonth(),i=t.getFullYear(),c=n.getDate(),u=n.getMonth(),d=n.getFullYear();return i===d&&l===u&&o===c?"Today":i===d&&l===u&&o-c===1?"Yesterday":r<=7?"Previous 7 days":r<=30?"Previous 30 days":i===d?n.toLocaleString("default",{month:"long"}):n.getFullYear().toString()},re=e=>{const t={};let n=!1,s=!1;const r=/^\s*([a-z_]+):\s*(.*)\s*$/i,o=e.split(`
`);if(o[0].trim()!=='"""')return{};n=!0;for(let l=1;l<o.length;l++){const i=o[l];if(i.includes('"""')&&n){s=!0;break}if(n&&!s){const c=r.exec(i);if(c){const[,u,d]=c;t[u.trim()]=d.trim()}}}return t},oe=(e,t,n)=>{const s=e.map(o=>o.code),r=t.map(o=>s.find(l=>l.startsWith(o))).find(Boolean);return console.log(s,t,r,n),r||n};export{A,ne as B,O as a,se as b,Y as c,K as d,re as e,z as f,V as g,W as h,ee as i,U as j,J as k,Q as l,j as m,X as n,Z as o,te as p,oe as q,q as r,H as s,G as t,C as u,E as v,B as w,P as x,N as y,L as z};
//# sourceMappingURL=index.DUyuoSn0.js.map

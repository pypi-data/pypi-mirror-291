APM 支付（Android）| 结账支付 | 支付宝文档
======================

[![ 图片 1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![ 图片 2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fapm_android)

[返回首页](../../)

结账支付

[概述](/docs/ac/cashierpay/overview)

接收支付

SDK 集成

[APM 支付（Web/WAP）](/docs/ac/cashierpay/apm_ww)

[APM 支付（Android）](/docs/ac/cashierpay/apm_android)

[APM 支付（iOS）](/docs/ac/cashierpay/apm_ios)

[卡支付（Web/WAP）](/docs/ac/cashierpay/wwcard)

[卡支付（Android）](/docs/ac/cashierpay/adcard)

[卡片支付(iOS)](/docs/ac/cashierpay/ioscard)

仅API集成

支付后操作

支付方式

其他资源

高级功能

[预前台解决方案API](/docs/ac/cashierpay/prefront)

[先买后付API](/docs/ac/cashierpay/bnpl)

[卡片存储API](/docs/ac/cashierpay/cv)

[卡片存储SDK](/docs/ac/cashierpay/cvsdk)

[卡片支付功能API/SDK](/docs/ac/cashierpay/mf)

APM支付(Android)
======================

2024-05-28 09:40

Antom SDK是一个预构建的UI组件，简化了集成Antom支付服务的过程。这个组件提供了一种简单快捷的方式来集成Antom支持的所有支付方式，包括信用卡、数字钱包、银行转账、在线银行等。

SDK组件能够自动适应买家的设备和位置，根据支付方式的特性执行信息收集、重定向、应用切换、显示二维码等任务。这样，您可以在您的网站或应用上轻松提供全面的支付解决方案，节省构建每个支付界面和流程所需的时间和资源。

用户体验
==========

以下是用户在应用中支付的流程示例：

![图3：image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1711090669407-35a293db-8e04-4e37-ad9a-625be59590a5.png)

支付流程
==========

每种支付方式的流程包括以下步骤：

![图4：333.webp](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713522463146-936e5fb8-537c-40af-bb7c-4a71020aeebb.webp)

1.  **买家进入结账页面。**

1.  **创建**[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)**请求**  
    买家选择支付方式并提交订单后，您可以调用[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口来获取支付会话。
2.  **调用客户端SDK**  
    在客户端，通过支付会话调用SDK。SDK会根据支付方式的特性处理信息收集、重定向、应用调用、二维码显示、验证等流程。
3.  **获取支付结果**  
    通过以下两种方法之一获取支付结果：

    *   异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中设置_paymentNotifyUrl_，以指定接收异步通知的地址。支付成功或超时时，Antom会使用[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)向您发送异步通知。
    *   同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口来检查支付状态。

集成步骤
==========

开始集成，按照以下步骤操作：

1.  创建支付会话
2.  创建并调用SDK
3.  获取支付结果

步骤1: 服务器端创建支付会话
--------------------------------------------

当买家选择使用蚂蚁金服提供的支付方式时，您需要收集关键信息，如支付请求ID、订单金额、支付方式、订单描述、支付重定向URL和支付结果通知URL，然后调用**createPaymentSession** API 创建支付会话，并将支付会话返回给客户端。

蚂蚁金服为多种语言提供了服务器端API库。以下代码以Java为例，您需要安装Java 6或更高版本。

### 安装API库

您可以在[GitHub](https://github.com/alipay/global-open-sdk-java)上找到最新版本。

```xml
<dependency>
    <groupId>com.alipay.global.sdk</groupId>
    <artifactId>global-open-sdk-java</artifactId>
    <version>2.0.21</version>
</dependency>
```

### 初始化请求实例

创建一个单例资源，以向蚂蚁金服发起请求。

```java
String merchantPrivateKey = "YOUR PRIVATE KEY";
String alipayPublicKey = "ALIPAY PUBLIC KEY";
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
                                                               merchantPrivateKey, alipayPublicKey);
```

### 创建支付会话

创建支付会话包括以下参数：

| **参数名** | **是否必填** | **描述** |
| --- | --- | --- |
| productCode | ✅ | 固定值为`CASHIER_PAYMENT`。 |
| paymentRequestId | ✅ | 商家生成的唯一ID，每次发起支付时需新生成一个ID。 |
| paymentAmount | ✅ | 支付金额，应根据订单货币的最小单位设置，例如CNY为分，KRW为元。 |
| paymentMethod | ✅ | 支付方式枚举。 |
| paymentRedirectUrl | ✅ | 商家的支付结果页面，根据服务器端结果，不是固定的成功页面。 |
| order | ✅ | 订单信息，包括订单金额、订单ID和商家侧的订单描述。 |
| paymentNotifyUrl |  | 支付结果通知地址，可以通过接口传递或通过门户设置固定值。 |
| settlementStrategy |  | 支付的结算货币，如果业务已签署多个结算货币，需要在接口中指定。 |

创建支付会话的基本参数如上所述，完整参数和某些支付方式的额外要求请参考[**创建支付会话（结账支付）**](https://global.alipay.com/docs/ac/ams/session_cashier)**。**

#### 调用createPaymentSession API的示例代码

以下示例代码展示了如何调用**createPaymentSession** API：

```java
AlipayPaymentSessionRequest alipayPaymentSessionRequest = new AlipayPaymentSessionRequest();
alipayPaymentSessionRequest.setClientId(CLIENT_ID);
alipayPaymentSessionRequest.setPath("/ams/sandbox/api/v1/payments/createPaymentSession");
alipayPaymentSessionRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);

// 替换为你的paymentRequestId
alipayPaymentSessionRequest.setPaymentRequestId("paymentRequestId01");
// 设置金额
Amount amount = new Amount();
amount.setCurrency("MYR");
amount.setValue("4200");
alipayPaymentSessionRequest.setPaymentAmount(amount);

// 设置支付方式
PaymentMethod paymentMethod = new PaymentMethod();
paymentMethod.setPaymentMethodType("ONLINEBANKING_FPX");
alipayPaymentSessionRequest.setPaymentMethod(paymentMethod);

// 设置订单信息
Order order = new Order();
order.setReferenceOrderId("referenceOrderId01");
order.setOrderDescription("antom sdk测试订单");
order.setOrderAmount(amount);
Buyer buyer = new Buyer();
buyer.setReferenceBuyerId("yourBuyerId");
order.setBuyer(buyer);
order.setOrderAmount(amount);
alipayPaymentSessionRequest.setOrder(order);

// 替换为你的重定向URL
alipayPaymentSessionRequest.setPaymentRedirectUrl("https://www.yourMerchantWeb.com");
alipayPaymentSessionRequest.setPaymentNotifyUrl("https://www.yourNotifyUrl");

AlipayPaymentSessionResponse alipayPaymentSessionResponse = null;
try {
    alipayPaymentSessionResponse = defaultAlipayClient.execute(alipayPaymentSessionRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```

以下代码展示了请求消息的示例：

```json
{
  "paymentNotifyUrl": "https://www.yourNotifyUrl",
  "paymentRequestId": "paymentRequestId01",
  "paymentAmount": {
    "currency": "MYR",
    "value": "4200"
  },
  "productCode": "CASHIER_PAYMENT",
  "paymentRedirectUrl": "https://www.yourMerchantWeb.com",
  "paymentMethod": {
    "paymentMethodType": "ONLINEBANKING_FPX"
  },
  "order": {
    "orderAmount": {
      "currency": "MYR",
      "value": "4200"
    },
    "referenceOrderId": "referenceOrderId01",
    "orderDescription": "antom sdk测试订单",
    "buyer": {
      "referenceBuyerId": "yourBuyerId"
    }
  }
}
```

以下代码展示了响应的示例，其中包含以下参数：

*   `paymentSessionData`：返回给前端的支付会话数据
*   `paymentSessionExpiryTime`：支付会话的过期时间

```json
{
  "paymentSessionData": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
  "paymentSessionExpiryTime": "2023-04-06T03:28:49Z",
  "paymentSessionId": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```

### 常见问题

#### 请求中可以使用中文字符吗？

请注意，请求中的字段，包括_paymentRequestId_、_referenceOrderId_、_orderDescription_和_goods_，不应使用中文字符，以避免与QRIS和Mastercard等不兼容的支付方式。

#### 如何设置支付结果通知地址？

蚂蚁金服会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)接口发送支付结果。您可以在**createPaymentSession** API 中通过_paymentNotifyUrl_ 参数指定此地址。如果每个支付的地址相同，您也可以在蚂蚁金服控制台上进行配置。如果您已经配置了地址并在API中设置了参数，蚂蚁金服将使用API中设置的地址。

步骤2：创建并调用SDK 客户端
---------------------------------------------

蚂蚁金服的Antom SDK是一个用于处理支付流程的组件。通过调用`createPaymentSession` API来创建支付会话，以收集信息、在应用间切换以及根据指定的支付方式显示二维码。

当买家在页面上选择支付方式后，需要创建并初始化SDK。

### 安装

版本要求：目标至少为Android 4.4（API级别19）或更高。

要集成SDK包，请参考[集成SDK包](https://global.alipay.com/docs/ac/antom_sdk/android_en)。

### 初始化SDK

使用`AMSCashierPayment`创建SDK实例，并指定基本配置。创建配置对象包括以下方法：

| **方法名** | **必需** | **描述** |
| --- | --- | --- |
| *setLocale* |  | 用于传入语言信息。有效值如下，根据支付方式的地区选择传递的值。如果传递其他值，将默认使用本地语言：* `en_US`：英语 * `pt_BR`：葡萄牙语 * `ko_KR`：韩语 * `es_ES`：西班牙语 * `ms_MY`：马来语 * `in_ID`：印度尼西亚语 * `tl_PH`：他加禄语 * `th_TH`：泰语 * `vi_VN`：越南语 * `fr_FR`：法语 * `nl_NL`：荷兰语 * `it_IT`：意大利语 * `de_DE`：德语 * `zh_CN`：简体中文 * `zh_HK`：繁体中文 |

| *setOption* |  | 用于指定是否使用默认加载模式和沙箱环境。有效值包括：* `"sandbox", "true"`：沙箱环境 * `"sandbox", "false"`：生产环境 * `"showLoading", "true"`：使用默认加载模式。 * `"showLoading", "false"`：不使用默认加载模式。 |

| *setOnCheckoutListener* |  | 创建**OnCheckoutListener** API的实例，用于后续流程中的事件处理。API包括以下方法：* `onEventCallback`：必需。用于监控结账页面上的支付事件的回调函数，返回`eventCode`和`eventResult`。 |

以下示例代码展示了如何初始化SDK：

```java
AMSCashierPaymentConfiguration configuration = new AMSCashierPaymentConfiguration();
configuration.setLocale(new Locale("en", "US"));
// 指定showLoading为true（默认值）以使用默认加载模式。设置为false以根据onEventCallback自定义加载动画。
configuration.setOption("showLoading", "true");
configuration.setOption("showLoading", "true");
// 设置沙箱环境。如果不设置，将默认使用生产环境。
configuration.setOption("sandbox", "true");
// 设置用于监控结账页面支付事件的回调。
configuration.setOnCheckoutListener(new OnCheckoutListener() {
    @Override
    public void onEventCallback(String eventCode, AMSEventResult eventResult) {
        Log.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());
    }
});
// 初始化AMSCashierPayment。
AMSCashierPayment checkout = new AMSCashierPayment.Builder(activity, configuration).build();
```

### 调用SDK

调用`createComponent`方法：

| **参数名** | **必需** | **描述** |
| --- | --- | --- |
| *sessionData* | ✅ | 使用*sessionData*参数创建配置对象：将通过`createpaymentSession (Checkout Payment)` API响应中获取的完整`paymentSessionData`参数传递给*sessionData*参数。 |

在以下情况下调用`onDestroy`方法释放SDK组件资源：

*   当买家离开支付页面时，释放`createPaymentSession`中创建的组件资源。
*   当买家发起多次支付时，释放前一次`createPaymentSession`中创建的组件资源。

以下示例代码展示了如何调用SDK：

```java
checkout.createComponent(activity, sessionData);
    
// 释放SDK组件资源
checkout.onDestroy();
```

### 显示支付结果

您可以使用支付组件处理需要重定向（异步支付）和不需要重定向（同步支付）的支付方法。

#### 重定向支付

某些支付方式的支付过程需要离开原始网页，跳转到机构页面完成支付，例如网银支付方式。在这种情况下，买家完成支付后会被重定向到您在 **createPaymentSession** API 中提供的 _paymentRedirectUrl_。您可以通过主动查询获取支付结果，并在该URL中向买家展示。

#### 非跳转支付

对于不涉及跳转的支付，支付结果将通过 `onEventCallback` 函数返回。这里的支付结果仅用于前端展示，最终订单状态以服务器端为准。您需要通过 `onEventCallback` 结果数据中的信息，为每个支付结果定制您想要的处理流程。

以下是 `onEventCallback` 返回的支付结果可能的事件代码。

| **事件代码** | **消息** | **解决方案** |
| --- | --- | --- |
| SDK\_PAYMENT\_SUCCESSFUL | 支付成功。 | 建议将买家重定向到支付结果页面。 |
| SDK\_PAYMENT\_PROCESSING | 支付处理中。 | 建议检查 `onEventCallback` 结果数据中的 *paymentResultCode* 以获取详细信息。根据提供的信息引导买家重试支付。 |
| SDK\_PAYMENT\_FAIL | 支付失败。 | 建议检查 `onEventCallback` 结果数据中的 *paymentResultCode* 以获取详细信息。根据提供的信息引导买家重试支付。 |
| SDK\_PAYMENT\_CANCEL | 买家未提交订单就退出了支付页面。 | 如果 *paymentSessionData* 在有效期内，可以重新调用 SDK；如果已过期，需要重新请求 *paymentSessionData*。 |
| SDK\_PAYMENT\_ERROR | 支付状态异常。 | 建议检查 `onEventCallback` 结果数据中的 *paymentResultCode* 以获取详细信息。根据提供的信息引导买家重试支付。 |

以下示例代码展示了如何处理 `onEventCallback`：

```javascript
// 假设 onEventCallback 已经绑定到适当的事件处理函数
function onEventCallback(eventCode, eventData) {
  switch (eventCode) {
    case 'SDK_PAYMENT_SUCCESSFUL':
      // 处理支付成功的情况
      break;
    case 'SDK_PAYMENT_PROCESSING':
      // 处理支付处理中的情况
      break;
    case 'SDK_PAYMENT_FAIL':
      // 处理支付失败的情况
      break;
    case 'SDK_PAYMENT_CANCEL':
      // 处理支付取消的情况
      break;
    case 'SDK_PAYMENT_ERROR':
      // 处理支付异常的情况
      break;
    default:
      // 处理未知情况
  }
}
```

请根据实际业务需求，将上述代码中的注释替换为相应的处理逻辑。

```java
@Override
public void onEventCallback(String eventCode, AMSEventResult eventResult) {
    AlipayLog.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());

    if (!TextUtils.isEmpty(eventCode)) {
        if ("SDK_PAYMENT_SUCCESSFUL".equals(eventCode)) {
            // 支付成功。将买家重定向到支付结果页面。
        } else if ("SDK_PAYMENT_PROCESSING".equals(eventCode)) {
            // 支付处理中。根据提供的信息引导买家重试支付。
        } else if ("SDK_PAYMENT_FAIL".equals(eventCode)) {
            // 支付失败。根据提供的信息引导买家重试支付。
        } else if ("SDK_PAYMENT_CANCEL".equals(eventCode)) {
            // 引导买家重试支付。
        } else if ("SDK_PAYMENT_ERROR".equals(eventCode)) {
            // 支付状态异常。根据提供的信息引导买家重试支付。
        } else if ("SDK_END_OF_LOADING".equals(eventCode)) {
            // 结束自定义加载动画。
        }
    }
}

### 第3步：获取支付结果 - 服务器端

买家完成支付或支付超时后，Antom会通过服务器交互将相应的支付结果发送给您。您可以使用以下方法之一获取支付结果：

*   接收异步通知
*   查询结果

#### 接收异步通知

当支付达到成功或失败的最终状态时，Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API向在**createPaymentSession** API中指定的_支付通知URL_发送异步通知。收到Antom的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。
```

Antom 允许您在 **createPaymentSession** API 的 `_paymentNotifyUrl_` 参数中指定通知URL。如果每个支付的URL都相同，您也可以在Antom控制台上进行配置。

以下是一个通知请求的示例：

```
{
  "notifyType": "PAYMENT_RESULT",
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "success"
  },
  "paymentRequestId": "paymentRequestId01",
  "paymentId": "2020010123456789XXXX",
  "paymentAmount": {
    "value": "4200",
    "currency": "MYR"
  },
  "paymentCreateTime": "2020-01-01T12:01:00+08:30",
  "paymentTime": "2020-01-01T12:01:01+08:30"
}
```

如何验证通知的签名并做出响应，请参阅[使用SDK对请求签名和验证签名](https://global.alipay.com/docs/ac/ams/signature_sdk)。

#### 常见问题

##### 何时会发送通知？

这取决于支付是否完成：

*   支付成功后，Antom 通常会在3到5秒内发送异步通知。对于像场外交易（OTC）这样的支付方式，通知可能会稍有延迟。
*   如果支付未完成，Antom 需要先关闭订单，然后才能发送异步通知。不同支付方式关闭订单所需的时间会有所不同，通常默认为14分钟。

##### 异步通知会被重新发送吗？

如果您收到蚂蚁金服的异步通知，您需要按照[样例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果未按要求响应异步通知，或者由于网络原因通知未送达，系统会在24小时内自动重试发送，最多重试8次，或者直到收到正确响应为止。重试发送的间隔时间依次为：0分钟、2分钟、10分钟、10分钟、1小时、2小时、6小时和15小时。

##### 是否需要在响应中添加数字签名？

如果您收到蚂蚁金服的异步通知，您需要按照[样例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)格式返回响应，但不需要在响应中添加数字签名。

### 如何理解关键字段的含义？

*   `_result_`: 订单的支付结果。
*   `_paymentRequestId_`: 商户生成的支付请求ID，用于查询、取消和对账。
*   `_paymentId_`: 蚂蚁金服生成的支付订单ID，用于退款和对账。
*   `_paymentAmount_`: 如需金额对账，可使用此字段。

### 查询结果

可以通过调用 **inquiryPayment** API 来查询订单的结果。

| **参数名称** | **必需** | **描述** |
| --- | --- | --- |
| *paymentRequestId* |  | 商户生成的支付请求ID。 |

以上参数不完整，完整参数列表及特定支付方式的额外要求请参考 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档。

以下示例代码展示了如何调用 **inquiryPayment** API：

```java
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
                                                           merchantPrivateKey, alipayPublicKey);

AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/sandbox/api/v1/payments/inquiryPayment");
alipayPayQueryRequest.setPaymentRequstId("paymentRequestId01");

AlipayPayQueryResponse alipayPayQueryResponse;
try {
    alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```

以下是一个请求消息的示例：

```json
// 请求消息示例代码
```

```json
{
  "paymentRequestId": "paymentRequestId01"
}
```

以下代码展示了响应消息的示例：

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "成功"
  },
  "paymentStatus": "SUCCESS",
  "paymentRequestId": "paymentRequestId01",
  "paymentId": "2019060811401080010018882020035XXXX",
  "paymentAmount": {
    "value": "4200",
    "currency": "MYR"
  },
  "paymentCreateTime": "2019-06-01T12:01:01+08:30",
  "paymentTime": "2019-06-01T12:01:01+08:30",
  "transactions": null
}
```

#### 常见问题解答 (FAQs)

##### 如何理解以下关键字段的含义？

*   `_result_`: API 调用的结果。它仅表示 **inquiryPayment** API 调用的结果。订单结果应根据 `_paymentStatus_` 来确定。`SUCCESS` 和 `FAIL` 表示最终结果，而 `PROCESSING` 表示交易仍在进行中。
*   `_paymentAmount_`: 金额验证。如果需要进行金额验证，可以使用此字段。

##### 应该多久发起一次查询？

建议以每2秒一次的轮询间隔发起查询，直到获取到最终的支付结果或收到异步支付通知为止。

### 示例代码

前端完整示例代码：

```java
AMSCashierPaymentConfiguration configuration = new AMSCashierPaymentConfiguration();
configuration.setLocale(new Locale("en", "US"));
// 设置 showLoading 为 true（默认值）以使用默认加载模式。设置为 false 可根据 onEventCallback 自定义加载动画。
configuration.setOption("showLoading", "true");
// 设置沙盒环境。如果不设置，将默认使用生产环境。
configuration.setOption("sandbox", "true");
// 设置监听结账页面支付事件的回调。
configuration.setOnCheckoutListener(new OnCheckoutListener() {
    @Override
    public void onEventCallback(String eventCode, AMSEventResult eventResult) {
        AlipayLog.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());

        if (!TextUtils.isEmpty(eventCode)) {
            if ("SDK_PAYMENT_SUCCESSFUL".equals(eventCode)) {
                // 支付成功。将买家重定向到支付结果页面。
            } else if ("SDK_PAYMENT_PROCESSING".equals(eventCode)) {
                // 支付处理中。根据提供的信息引导买家重试支付。
            } else if ("SDK_PAYMENT_FAIL".equals(eventCode)) {
                // 支付失败。根据提供的信息引导买家重试支付。
            }else if ("SDK_PAYMENT_CANCEL".equals(eventCode)) {
                // 引导买家重试支付。
            } else if ("SDK_PAYMENT_ERROR".equals(eventCode)) {
                // 支付状态异常。根据提供的信息引导买家重试支付。
            } else if ("SDK_END_OF_LOADING".equals(eventCode)) {
                // 结束自定义加载动画。
            }
        }
    }
});
// 初始化 AMSCashierPayment。
AMSCashierPayment checkout = new AMSCashierPayment.Builder(activity, configuration).build();

checkout.createComponent(activity, sessionData);

checkout.onDestroy();
```

### 事件代码

您可能会看到两种类型的事件代码：

*   状态码：在组件运行时生命周期中由 `onEventCallback` 返回。
*   错误码：在组件初始化阶段由 `onEventCallback` 或 `onError` 返回。



| **类型** | **代码** | **描述** | **进一步操作** |
| --- | --- | --- | --- |
| 状态码 | SDK\_START\_OF\_LOADING | 在创建支付组件时开始播放加载动画。 | 无需进一步操作。 |
| SDK\_END\_OF\_LOADING | 在创建支付组件时加载动画结束。 | 无需进一步操作。 |
| 错误码 | SDK\_INTERNAL\_ERROR | SDK 内部错误发生。 | 联系蚂蚁技术支持解决此问题。 |
| SDK\_CREATEPAYMENT\_PARAMETER\_ERROR | 传递给 `createComponent` 方法的参数不正确。 | 确保参数传递正确并重新发送请求。 |
| SDK\_CALL\_URL\_ERROR | 表示以下情况之一：* 商家页面重定向执行失败。* 在 **createpaymentSession (收银台支付)** 请求中的 `paymentRedirectUrl` 参数未传递或传递错误。 | 联系蚂蚁技术支持解决此问题。 |
| SDK\_INTEGRATION\_ERROR | 未找到依赖项。 | 确保正确添加依赖项并重试集成过程。 |



要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。

![图片 5](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 6](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面是否有帮助？

#### 本页面内容

[用户体验](#BkD7T "用户体验")

[支付流程](#eLZVd "支付流程")

[集成步骤](#QLFGi "集成步骤")

[步骤 1：创建支付会话](#zhBSk "步骤 1：创建支付会话")

[安装 API 库](#d3kyo "安装 API 库")

[初始化请求实例](#WLui0 "初始化请求实例")

创建支付会话<a id="Cwfah"></a>

调用createPaymentSession API的示例代码<a id="3L7zQ"></a>

常见问题解答<a id="niSqk"></a>

1. 请求中可以使用中文字符吗？<a id="Xz79a"></a>
2. 如何设置支付结果通知地址？<a id="9JAyd"></a>

步骤2：创建并调用SDK<a id="db6T7"></a>

1. 安装<a id="JmurT"></a>
2. 初始化SDK<a id="KQO5X"></a>
3. 调用SDK<a id="OXd8h"></a>
4. 显示支付结果<a id="9tXGT"></a>
5. 重定向支付<a id="bj20g"></a>
6. 非重定向支付<a id="NG8h1"></a>

步骤3：获取支付结果<a id="Mo7TZ"></a>

1. 接收异步通知<a id="WDV7j"></a>

常见问题解答<a id="V1F5v"></a>

[查询结果](#pCGDb "查询结果")

[常见问题解答](#tkpZO "常见问题解答")

[示例代码](#OV6gg "示例代码")

[事件代码](#OlIKO "事件代码")
集成指南 | 通用参考 | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fgr%2Fintegration)  
[返回首页](../../)

通用参考
--------

[API 规范](/docs/ac/gr/apispec)  
[数字签名](/docs/ac/gr/globalgs)  
[数字签名（新）](/docs/ac/gr/signature)  
[错误代码](/docs/ac/gr/error_code)  
[入门指南](/docs/ac/gr/get-start)  
[术语表](/docs/ac/gr/glossary)  
[退款](/docs/ac/gr/refund)  
[集成指南](/docs/ac/gr/integration)  
[版本更新日志](/docs/ac/gr/release_notes)  
[交易状态](/docs/ac/gr/trade_status)  
[API幂等性](/docs/ac/gr/idempotency)  
[支付宝标识](/docs/ac/gr/logo)  

集成指南
========

2021-02-26 07:01

1.  概览
==========

本文档旨在帮助您理解支付宝产品集成的各个阶段、在集成过程中需要采取的行动，以及每个阶段可用的支持和工具。通过本文档中的信息，您还可以预测每个阶段所需的资源、工作和人力。

**注意：** 本文档不适用于新版本产品，如（新）条码支付。

2.  主要阶段
==========

本章介绍集成阶段、每个阶段的行动以及可用的支持和工具。支付宝产品集成包括四个阶段：

1.  预集成
2.  集成
3.  上线
4.  上线后
注意：
1. 集成阶段的某些任务，如获取集成资源和准备密钥，可以独立进行，不受预集成阶段进度的影响。
2. 翻译要简洁明了。

以下是集成过程及可用工具和支持的说明：

![图3: 6.png](https://cdn.nlark.com/yuque/0/2020/png/561635/1588928237281-b4900cfc-c85d-46ed-a649-a5b0018f171a.png)

1. 集成过程
如果您有任何问题，可以联系支付宝业务开发人员（BD）或技术支持（[overseas_support@service.alibaba.com](mailto:overseas_support@service.alibaba.com)）寻求帮助。

2.1 预集成
在集成支付宝产品之前，首先了解产品并定义集成项目，然后签署必要的合同并完成支付宝的入驻。

表1 列出了预集成阶段的行动和支持：

![图4: 表1.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/561635/1588928237645-aeca61a7-4f34-4ba2-be3b-39fa90eb162e.jpeg)

表1. 预集成阶段

2.2 集成
要集成支付宝产品，首先配置系统并调用API，然后在沙箱环境中测试集成，最后通过测试用例验证集成质量。

表2 列出了集成阶段的行动和支持：

![图5: 表2.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/561635/1588928237849-a7a5a3bb-1c38-4cdc-9622-a28090589ec4.jpeg)

表2. 集成阶段

2.3 上线
集成完成后，将系统迁移到生产环境并进行线上测试。如果测试通过，产品即可正式上线。

表3 列出了上线阶段的行动和支持：

![图6: 表3.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/561635/1588928237977-557f8ac7-0863-44cd-839a-8d0baf124c03.jpeg)

表3. 上线阶段

2.4 上线后
上线后，进行持续的监控和维护，确保产品的稳定运行，并根据需要进行优化和更新。
在产品上线后，进行监控和支持以确保产品维护和优化。
表4 列出了上线后阶段的行动和支持：

|阶段| 行动和支持|
|---|---|
|1| 与蚂蚁金服联系，获取产品和解决方案信息，讨论业务意图并确定合作细节。|
|2| 签署协议，开始与蚂蚁金服的合作。|
|3| 与蚂蚁金服团队进行产品集成前的沟通，明确需求和流程。|
|4| 完成商户系统用户体验、系统集成流程等文档的编制。|
|5| 进行系统集成和测试，确保与蚂蚁金服产品的顺利对接。|
|6| 上线后监控产品性能，处理任何问题并进行必要的优化。|
|7| 提供用户支持，解决客户在使用过程中遇到的问题。|
|8| 定期评估和更新合作，以适应市场变化和业务需求。|

3. 集成前阶段
--------------

在集成前阶段，需联系支付宝了解产品和解决方案，并讨论业务目标和合作细节，然后签署协议加入支付宝平台。

3.1 启动和发现
----------------

在启动和发现阶段，完成以下步骤：

1. 访问[支付宝全球网站](https://global.alipay.com/open/index.htm)，点击**注册**以创建企业账户。详细步骤见[创建商户账户](https://global.alipay.com/doc/transactionqrcode/sandbox#creating-an-alipay-merchant-account)。
2. 提供公司信息并上传资质证明文件进行审核。
3. 提供业务和技术环境以及商户资源的相关信息。
4. 通过[支付宝全球网站](https://global.alipay.com/open/index.htm)上的信息和文档，或咨询支付宝支持，了解支付宝产品和解决方案。
5. 与支付宝讨论并确定业务机会。

3.2 项目定义
----------------

为产品集成项目定义需要完成的工作：

1. 选择要使用的支付宝产品，并准备业务和技术资源以进行集成和签约。
2. 签署保密协议（如适用），讨论产品实施细节，评估资源投入。
3. 编制商户系统用户体验、系统集成流程等文档。  

3.3 签约和入驻
-----------------
在开始集成支付宝产品之前，请完成以下步骤以加入支付宝：

1. 仔细阅读您的支付宝商务代表提供的必要合作协议，并签署合同以继续后续步骤。
2. 与技术支持规划集成时间表：
   * 确定集成所需的时间和人员。
   * 与支付宝共同制定沙箱联合测试计划。
   * 与支付宝一起定义预发布测试计划和（如果适用）金丝雀发布计划。  

4. 集成阶段
------------

要集成支付宝产品，首先配置系统并调用API，然后在沙箱环境中测试集成，最后使用支付宝提供的工具完成集成验收。

4.1 执行集成
----------------

集成过程中，配置沙箱环境和调用API是必不可少的步骤。根据产品，支付宝可能会提供SDK或示例代码。对于店内支付产品，您还可以根据特定集成文档中的说明优化错误处理能力。详细信息请参阅特定产品文档。
### 4.1.1 获取集成资源  
获取集成所需的资源，如集成文档、[沙箱应用](https://global.alipay.com/doc/tool/sandbox#sandbox-app) 和 [沙箱账户](https://global.alipay.com/doc/tool/sandbox#test-account-infromation)。根据产品，可能还会提供SDK和示例代码。要获取集成文档，请访问 [开发者文档](https://global.alipay.com/open/doc.htm) 页面。要获取沙箱应用和沙箱账户，请访问 [沙箱门户](https://isandbox.alipaydev.com/user/intlAccountDetails.htm)。  
有关沙箱的更多信息，请参阅 [沙箱](https://global.alipay.com/doc/tool/sandbox)。有关SDK和示例代码的更多信息，请参阅具体产品的文档。
### 4.1.2 系统配置  
系统配置包括准备密钥和配置沙箱环境。具体如下：

*   **准备密钥**。为了生成数字签名，需要一对密钥来对数据进行签名和验证。你可以准备RSA密钥对、DSA密钥对或MD5密钥来生成和验证数字签名。
    *   如果你能够独立准备密钥，详情请参考[准备密钥](https://global.alipay.com/doc/gr/globalgs#preparing-keys)。
    *   你也可以使用[支付宝API工具](https://gw.alipayobjects.com/os/basement_prod/8f8c96b8-eeb4-4290-a3ff-37f3f72b9652.zip)来生成密钥。具体步骤参见[密钥对生成](https://global.alipay.com/doc/tool/key_pair#key-pair-generation)。
*   **配置沙箱环境**。使用商家账户登录[沙箱门户](https://isandbox.alipaydev.com/user/intlAccountDetails.htm)，然后在调用API之前配置沙箱网关、密钥和账户信息。详情请参阅[沙箱](https://global.alipay.com/doc/tool/sandbox)。
*   （可选）为沙箱买家账户充值。登录[沙箱门户](https://isandbox.alipaydev.com/user/intlAccountDetails.htm)，进入**沙箱账户** > **买家**，然后点击**充值**。
### 4.1.3 调用API
为了集成产品，支付宝要求在产品集成文档中列出的所有API都必须实现。调用API包括以下步骤：

1. 构建并签名请求
2. 将请求发送给支付宝
3. 验证响应

根据你调用的API，你可能需要验证异步通知和同步通知。

如果返回错误代码，可以查看具体的API文档以获取更多信息。你也可以使用[iDiagnose](https://global.alipay.com/doc/tool/idiagnose)工具来定位某些错误的原因，如`INVALID_PARAMETER`和`ILLEGAL_SIGN`。

关于如何签名请求、如何验证响应以及API请求和响应示例的更多信息，请参阅具体产品文档中的集成部分或数字签名部分。

**注意：**
你必须实现二级商户管理功能，以便在支付宝系统中注册和管理商户，否则你的商户将无法正常开展业务。
### 4.1.4 错误处理的实现  
支付宝返回的错误代码可以分为业务错误代码和超时或系统错误代码。在集成过程中，需要设计处理超时或系统错误的机制，并遵循处理业务错误代码的指导。更多详情，请参阅特定产品文档中的错误处理部分。  

4.2 功能测试
------------  
在沙箱环境中测试产品功能，确保您的系统能与支付宝产品正确配合工作。通常，需要测试以下功能：  
*   支付功能。
*   退款和取消功能。
*   对账功能。
*   二级商户管理功能  

在**沙箱账户** > **买家**标签下，可以通过点击**充值**为买家测试账户添加资金。关于沙箱环境的更多信息，请参阅[沙箱](https://global.alipay.com/doc/tool/sandbox)获取详细信息。  

您还可以测试所集成产品的其他功能。关于这些功能的详细信息，请参阅特定产品文档。  

4.3 集成验收
------------  
完成以下步骤以确保集成质量：  
1.  使用iValidate测试用例在沙箱环境中测试集成功能。必须完成与相关产品相关的所有测试用例。更多关于iValidate的信息，请参阅[iValidate](https://global.alipay.com/doc/tool/ivalidate)。您可以下载[附录](#dnua0)查看所有测试用例。
2.  根据合同/项目要求向支付宝提交验收报告。支付宝审核并批准报告后，您将收到成功集成的证书。
3.  对于店内支付产品，使用模拟服务帮助您测试和优化错误处理能力。详情请参阅[服务模拟](https://global.alipay.com/doc/tool/mocking)。
4. 对于其他错误情况或场景，您必须与支付宝GMM（Global Merchant Management）定义责任范围、流程和文档模板等。
5. 上线
==========

5.1 上线准备和测试
--------------------------
在上线前完成以下步骤：
1. 将网关、PID、密钥和其他必要数据切换到生产环境的配置。
2. 准备密钥：
   * 如果使用RSA密钥，与支付宝交换公钥。联系[技术支持](mailto:Technical Support)，提供您的PID和公钥信息。支付宝会据此进行配置，并提供支付宝的公钥。
   * 如果使用MD5密钥，按照[MD5签名类型](https://global.alipay.com/doc/gr/globalgs#md5-sign-type)的步骤获取MD5密钥。
3. （仅限店内产品）与技术支持协调灰度发布计划。
4. 在生产环境中完成主要流程的测试。

5.2 灰度发布
------------------
对于店内支付产品，与支付宝BD（Business Development）和技术支持协调，在选定的店铺进行试点项目，以测试产品性能。

支付宝、店铺和您都需要提供试点项目报告，然后支付宝和您将根据这些报告分析产品性能。

5.3 正式上线
-------------------
切换到生产环境并正式发布产品。

6. 上线后
==========
在产品正式上线后，使用iMonitor进行性能监控。iMonitor提供关键指标的实时数据和日期回放，并可根据自定义规则自动发送警报给您。

如需了解更多关于iMonitor的信息，请联系技术支持（[overseas_support@service.alibaba.com](mailto:overseas_support@service.alibaba.com)）。

附录
==========
[tech_integration_test_cases.xlsx](https://yuque.antfin-inc.com/attachments/lark/0/2019/xlsx/99656/1563353267808-6715a341-7193-4fa4-919a-15590163fff6.xlsx)  
要查看文档的最新更新，请访问[版本说明](https://global.alipay.com/docs/releasenotes)。  
![图片8](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片9](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

#### 本页面是否有帮助？  

#### 本页面内容  

[1. 概览](#NOIDO "1. 概览")  
[2. 主要阶段](#1JJTw "2. 主要阶段")  
[2.1 预集成](#HjV1f "2.1 预集成")  
[2.2 集成](#xqUmh "2.2 集成")  
[2.3 上线](#PbRPW "2.3 上线")  
[2.4 上线后](#zDXEA "2.4 上线后")  
[3. 预集成阶段](#ASaqf "3. 预集成阶段")  
[3.1 启动与发现](#ADi8I "3.1 启动与发现")  
[3.2 项目定义](#3xnY8 "3.2 项目定义")  
[3.3 签约与入驻](#AYZ4Z "3.3 签约与入驻")  
[4. 集成阶段](#tY5aS "4. 集成阶段")  
[4.1 执行集成](#wPy7U "4.1 执行集成")  
[4.1.1 获取集成资源](#QVVdH "4.1.1 获取集成资源")  
[4.1.2 系统配置](#ZaW8X "4.1.2 系统配置")  
[4.1.3 调用API](#A46w1 "4.1.3 调用API")  
[4.1.4 实现错误处理](#iojbn "4.1.4 实现错误处理")  
[4.2 功能测试](#iGGhl "4.2 功能测试")  
[4.3 集成验收](#qfPfN "4.3 集成验收")  
[5. 上线](#jV3D8 "5. 上线")  
[5.1 上线准备与测试](#Q9iDY "5.1 上线准备与测试")  
[5.2 渐进式发布](#wrzVn "5.2 渐进式发布")  
[5.3 正式发布](#pdL3s "5.3 正式发布")  
[6. 上线后](#lI1as "6. 上线后")  
[附录](#dnua0 "附录")
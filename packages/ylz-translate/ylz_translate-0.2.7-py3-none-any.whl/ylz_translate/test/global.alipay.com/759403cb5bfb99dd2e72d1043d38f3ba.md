Bank-related and wallet payments | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fnoncard_payment)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf)

Bank-related and wallet payments
================================

2023-12-28 08:32

This integration guide applies to the following payment methods excluding cards:

*   Alipay+ payment method
*   Wallet
*   Mobile banking app
*   Bank transfer
*   Online banking

Prerequisites
=============

Before you begin, you must complete the following tasks:

*   Register in Alipay Developer Center.
*   Set your keys.
*   Test in the sandbox environment.

For details, refer to the [Alipay integration guide](https://global.alipay.com/docs/integration).

User experience
===============

The following figures show the user journey of paying on a shopping website:

Web

WAP

App

![Image 3: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673426444201-40b38646-358d-4baf-a0c2-9b8c185f175d.png)

Figure 1. User experience for Web

1.  After a user confirms order information, the user clicks **Place Order** to go to the payment method page.
2.  The user chooses a payment method, and clicks **Confirm payment** to be redirected to an intermediate page of the payment method.
3.  On the intermediate page, the user can pay by logging in to their account or by scanning the on-screen QR code.
4.  After the user completes the payment, they are redirected to the payment result page.

**Note**: Apart from redirecting the user to the pre-built intermediate page of the payment method, you can also redirect the user to a custom checkout page where a better user experience is provided. For more information about how to implement the custom page, see [Custom checkout solution](https://global.alipay.com/docs/ac/cashierpay/custom_checkout?version=v1.37).

![Image 4: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673429429762-cadb251c-1dfe-4018-bbed-0007c5b5d326.png)

Figure 1. User experience for WAP

1.  After a user confirms order information, the user clicks **Place Order** to go to the payment method page.
2.  The user chooses a payment method, and clicks **Pay** to invoke the payment method app or be redirected to the mobile page of the app.
3.  The user can pay in the app or by following the instructions on the mobile page.
4.  After the user completes the payment, the user is redirected to the payment result page.

**Note**: Apart from redirecting the user to the pre-built intermediate page of the payment method, you can also redirect the user to a custom checkout page where a better user experience is provided. For more information about how to implement the custom page, see [Custom checkout solution](https://global.alipay.com/docs/ac/cashierpay/custom_checkout).

![Image 5: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673428498387-0a88b3c7-99e6-47c2-a439-82a4225ae214.png)

Figure 1. User experience for App

1.  After a user confirms order information, the user clicks **Place Order** to go to the payment method page.
2.  The user chooses a payment method, and clicks **Pay** to continue the payment process.
3.  You can initiate a payment process by invoking the payment method app or its Wap page. In the payment method app or on the app page, the user verifies their identity and enters their payment password to complete the payment.
4.  After the user completes the payment, the user is redirected to the payment result page.

**Note**: Apart from redirecting the user to the pre-built intermediate page of the payment method, you can also redirect the user to a custom checkout page where a better user experience is provided. For more information about how to implement the custom page, see [Custom checkout solution](https://global.alipay.com/docs/ac/cashierpay/custom_checkout).

Integration process
===================

During the integration process, you need to focus efforts on developing the payment method page. This page serves the following purposes:

*   **Display available payment methods**: Payment methods are sorted according to payment information such as payment amount and the user's region.
*   **Manage payment status**: This page displays a payment countdown and monitors payment status to determine whether to redirect the user.
*   **Redirect the user to check out**: Redirect the user to a checkout page by using a payment continuation URL provided by Alipay.
*   **Receive payment callback (optional)**: Receive the payment callback by monitoring the invocation of the page or by using a lifecycle function. Then you can redirect the user to the payment result page according to the payment status.

Step 1：Obtain and display available payment methods
---------------------------------------------------

### 1\. Obtain payment methods

You can call the [**consult**](https://global.alipay.com/docs/ac/ams/consult) API to obtain a list of payment methods:

Web

WAP

App

![Image 6: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1663905287349-64d473e2-9b72-4f15-9434-cf4b806d98f3.png)

Figure 2. Consult payment methods for Web

![Image 7: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1663905376929-dab12d28-da6e-4bcd-8d0f-a50b2dbe0d58.png)

Figure 2. Consult payment methods for WAP

![Image 8: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1663905595170-0d6c539f-a06d-4980-aa58-7cedcf955f27.png)

Figure 2. Consult payment methods for apps

You need to specify the following parameters in your request:



| **Request parameter** | **Required or not** | **Description** |
| --- | --- | --- |
| paymentAmount | REQUIRED | The transaction currency and amount. |
| env | REQUIRED | The type of the client that is used for the payment, such as a desktop browser, a mobile browser, or a mobile application. |
| allowedPspRegions | OPTIONAL | Countries or regions. This parameter is used to filter the payment methods. |
| userRegion | OPTIONAL | The region in which the user is located. This parameter is used to sort the returned payment methods. |



Table 1. Request parameters of the **consult** API

After you send the request, Alipay returns the following parameters to notify you of the necessary information about the payment methods:



| **Response parameter** | **Description** |
| --- | --- |
| paymentOptions.paymentMethodType | Payment methods that are specified in your contract. |
| paymentOptions.enabled | Indicates whether the payment method is available. |
| paymentOptions.logo | The logo of the payment method. |
| paymentOptions.promoNames | The promotion information of the payment method. |
| paymentOptions.paymentMethodCategory | The payment method type. |
| paymentOptions.disableReason | Indicates the reason why the payment method is unavailable. This parameter is returned when *paymentOptions.enabled* is `false`. |



Table 2. Response parameters of the **consult** API

A long list of payment methods on the checkout page impacts the user experience. The _paymentMethodCategory_ is used to categorize the payment methods and display them on the checkout page. See the following table for details:



| **Parameter** | **Payment method type** | **Description** |
| --- | --- | --- |
| paymentMethodCategory | ALIPAY\_PLUS | Alipay+ payment methods. |
| WALLET | E-wallets. |
| BANK\_TRANSFER | Bank transfer. It allows users to pay in a bank app or at a counter with a reference code. |
| ONLINE\_BANKING | Online banking. It allows users to pay on a bank website after they pass identity verification. |
| MOBILE\_BANKING\_APP | Mobile banking app. It allows users to pay in a bank app after they pass identity verification. This value is not returned if *terminalType* is `WEB`. |



Table 3. Description of paymentMethodCategory

### 2\. Filter payment methods

Before you display the payment methods that are obtained from Alipay, we recommend you filter the payment methods by the following conditions to avoid payment failure:

*   **Whether the payment method is available**: Call the [**consult**](https://global.alipay.com/docs/ac/ams/consult) API or contact Alipay Technical Support to learn the available payment methods.
*   **Minimum payment amount**: For the minimum payment amount of each payment method, contact Alipay Technical Support.
*   **Maximum payment amount**: For the maximum payment amount of each payment method, contact Alipay Technical Support. It is subject to the payment limit set by a user. Even if the maximum payment amount of a payment method is not reached, the payment may fail due to the user's settings.

> **Note**: We recommend not displaying or greying out unavailable payment methods.

### 3\. Display payment methods

To avoid displaying a long list of payment methods, we recommend you use a multi-level menu to deliver a better experience. Specifically, you can fold the payment methods in a menu of payment method types. After a payment method type is clicked or tapped, the corresponding payment methods are displayed. Meanwhile, to improve the payment success rate, you can also sort the payment methods by payment success rate, promotion events, and user preference.

For Alipay+ payment methods, you must display the Alipay+ Partner logo in one of the following ways. Ensure each of the payment method names and logos is used correctly:

Web

WAP

App

![Image 9: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673513837096-8a2e36cc-4774-403e-a39f-625d8f6c5a91.png)

Figure 3. Display of payment methods for Web

![Image 10: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673514050377-54840abc-5c4d-4b5d-b92b-cd1d3e2573f2.png)

Figure 3. Display of payment methods for WAP

![Image 11: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673514050377-54840abc-5c4d-4b5d-b92b-cd1d3e2573f2.png)

Figure 3. Display of payment methods for App

### 4\. Collect or display extra information

For several payment methods, extra information from users is needed for a payment or some information about a payment method needs to be displayed. We recommend you collect the extra information from users or display the needed information about the payment method to reduce redirections and thus improve the payment success rate. The details are shown as follows:

*   **Collect additional information from users**: Some payment methods need extra information for a payment. You can provide an input box on your page to collect the information and pass the information to Alipay by calling the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API. If you do not provide the input box, Alipay provides an extra page to collect the information.

> **Note**: You must pass the collected information to Alipay through the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to prevent Alipay from collecting the information again.

*   **Display additional information about the payment method**: For some payment methods, you can display the supported banks on your payment method selection page for users to choose from. If you do not display the bank options, the user is redirected to the page of a specific payment method to choose an available bank after the user chooses the payment method on your payment method selection page.

The following table shows the payment methods that require additional information and the corresponding user experience of the default and the recommended plan:



| **Payment method** | **BLIK** | **Przelewy24** | **iDEAL** | **Mercado Pago (Brazil)** | **Mercado Pago (Brazil, Mexico, Chile, Peru)** |
| --- | --- | --- | --- | --- | --- |
| **Parameter** | blikCode, clientIp, userAgent | payerEmail | bankIdentifierCode | cpf | payerEmail |
| **Parameter description** | Six-digit dynamic PIN code, IP address, used to indicate the user's device environment**Note**:* When you collect *blikCode*, collect the information of *clientIp* and *userAgent* together. * The IP address cannot be set to the local IP. | The user's email | The bank's identifier code | The tax ID of the Brazilian individual taxpayer | The payer's email address |
| **Request sample** | Request sample for *blikCode*:"paymentMethod": {"paymentMethodType": "BLIK","paymentMethodMetaData": {"blikCode": "123456"}}Request sample for *clientIP* and *userAgent*:"env": {"terminalType": "WEB","clientIp": "1.178.216.0","userAgent": "Mozilla/5.0"} | "paymentMethod": {"paymentMethodType": "P24","paymentMethodMetaData": {"payerEmail": "123456@alipay.com"}} | "paymentMethod": {"paymentMethodType": "IDEAL","paymentMethodMetaData": {"bankIdentifierCode": "ABNANL2A"}} | "paymentMethod": {"paymentMethodType": "MERCADOPAGO\_BR","paymentMethodMetaData": {"cpf": "0298765XXXX"}} | "paymentMethod": {"paymentMethodType": "MERCADOPAGO\_MX","paymentMethodMetaData": {"payerEmail": "email@example.com"}} |
| **User experience (default plan)** | Alipay collects BLIK's dynamic code:image | Alipay collects the user's email:image | iDEAL displays specific banks:image | Mercado Pago collects the user's cpf information:image | Mercado Pago collects the user's email:image |
| **User experience (Recommended plan)** | You collect BLIK's dynamic code:image | You collect the user's email:image | You display specific banks:image | You collect the user's cpf information:image | You collect the user's email:image |



Table 4. Parameter description and user experience of collecting or displaying extra information

Step 2: Obtain a payment continuation URL and invoke the payment process
------------------------------------------------------------------------

### 1\. Intercept an invalid payment

To avoid a repeated payment or an expired payment, we recommend that you verify the status and validity period of the payment after the user clicks or taps **Pay**.

Web

WAP

App

![Image 22: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1677222520472-bfe8a69c-9973-42ac-a46a-ae17eb7f4aac.png)

Figure 4. Payment status verification for Web

![Image 23: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1677222684761-e192acd3-35a9-4c19-8796-c469ff0f5170.png)

Figure 4. Payment status verification for WAP

![Image 24: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1677222768201-6bf027dc-5182-4392-8083-2d51a9e59002.png)

Figure 4. Payment status verification for App

To intercept an expired payment, you can set the payment expiry time by specifying the _paymentExpiryTime_ parameter in the payment request. If a user pays after the payment expiry time, an error is reported or the payment is refunded. Setting the payment expiry time also avoids repeated payments which might occur when the user pays long after they are redirected to the payment method page.

The time offset of a server can also lead to a repeated payment. We recommend that you determine the payment status of the order after the user pays. If the order is paid before, you can call the [**cancel**](https://global.alipay.com/docs/ac/ams/paymentc_online) API to cancel the payment or call the [**refund**](https://global.alipay.com/docs/ac/ams/refund_online) API to initiate a full refund to the user, and prompt the user accordingly.

### 2\. Send a payment request and obtain a payment continuation URL

After the user clicks or taps **Confirm payment**, your client requests a payment continuation URL from your server, and then your server calls the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to obtain a payment continuation URL and returns it to your client. Before the payment continuation URL is obtained after the request is sent, grey out the **Confirm payment** button in case of repeated operations triggered by the user.

The payment might fail when your client requests the payment continuation URL from your server. In this case, your server can call the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to reinitiate the payment request with a new _paymentRequestId._ However, the retried request might fail again due to network issues. We recommend that you set the expiry time of the request to prevent the user from waiting and allow the user to pay again after your server fails to obtain the payment continuation URL. Follow the workflow shown in the following figure:

Web

WAP

App

![Image 25: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673852829776-a868180c-6f42-4ee7-a881-a37ae56d4fbd.png)

Figure 5. Obtain a payment continuation URL for Web

![Image 26: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673852574668-e6643b67-1980-46b2-af21-1bf9951a9630.png)

Figure 5. Obtain a payment continuation URL for WAP

![Image 27: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673853211722-f0dc8646-c643-4359-aeea-6411b69ebc9b.png)

Figure 5. Obtain a payment continuation URL for App

You need to specify the following parameters in your request. For details, see the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API:



| **Parameter name** | **Description** |
| --- | --- |
| paymentRequestId | The unique identifier that marks a request. |
| env | Specify *terminalType* depending on the client type:* Web: Specify *terminalType* as WEB. * WAP: Specify *terminalType* as WAP and specify *osType*. * App: Specify *terminalType* as APP and specify *osType*. |
| referenceOrderId/paymentRequestId | *referenceOrderId* generally refers to an order ID, and *paymentRequestId* generally refers to a transaction ID. Alipay allows one order ID corresponding to multiple transaction IDs. You can also establish a one to one correspondence between them. |
| paymentRedirectUrl | Web: Pass in a desktop website redirection URL.WAP: Pass in a web URL redirection URL.App: Pass in a deep linking URL. |
| paymentNotifyUrl | Specify *paymentNotifyUrl* as an HTTPS URL. |



Table 5. Key request parameters of the pay API

### 3\. Invoke the payment process

Alipay returns the following URLs according to the value of _terminalType_ that you specify in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API:

*   normalUrl
*   orderCodeForm
*   schemeUrl
*   applinkUrl

For the types of URLs returned for different terminals, see [URLs for payment redirection](https://global.alipay.com/docs/ac/cashierpay/urls). For URLs that are used to invoke the payment process in an app, see [URLs for mobile payment](https://global.alipay.com/docs/ac/cashierpay/redirection).

Alipay returns the following parameters for invoking the payment process:

Web

WAP

App



| **Response parameter** | **Description** | **Usage** |
| --- | --- | --- |
| normalUrl | Mobile payment continuation URL | A mobile payment continuation URL. The user is redirected to the web URL or opens the URL in a new tab to complete the payment. |
| orderCodeForm.codeDetails.codeValue | Payment code value | A payment QR code or payment password. For several payment methods, you can display the QR code or password on your own page instead of redirecting the user to the checkout page provided by a payment method. This reduces the times of redirection and thus improves the payment experience. |



Table 6. Response parameters for invoking the payment process

For payments with different payment methods, we recommend that you use _codeValue_ in the following ways:



| **Payment method** | **codeValue** | **Handling** |
| --- | --- | --- |
| AlipayHK, TrueMoney, Touch 'n Go, AlipayCN, GCash, KaKaoPay, Rabbit LINE Pay, Akulaku PayLater, Dolfin, GrabPay, Naver Pay | QR code (*displayType* = `SMALLIMAGE`/`MIDDLEIMAGE`/`BIGIMAGE`) | You can display the QR code on your page without redirecting the user to the checkout page of a payment method. |
| Bank transfer payment methods | * Payment password (*displayType* = `TEXT`) * QR code (*displayType* = `SMALLIMAGE`/`MIDDLEIMAGE`/`BIGIMAGE`) | You can display the QR code, payment password, or both (if both are returned) on your page without redirecting the user to the checkout page of a payment method. |



Table 7. Handling of _codeValue_ for different payment methods

For payments initiated on a desktop website, you need to redirect the user to the redirection URL or open the URL in a new tab.

![Image 28: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673869978097-1d7592dc-9377-4eae-bccc-60a6bdbb8663.png)

Figure 6. Checkout experience of desktop website payment

**Notes**:

*   When you invoke the payment process, use the try-catch statement to capture errors and prompt users accordingly. Perform integrity acceptance before your integration project goes live.
*   The redirection URL of several payment methods can only be opened once. If you fail to invoke the checkout page, resend the request with a new _paymentRequestId_ to obtain the redirection URL and invoke the page again.
*   For bank transfer payment methods and several wallet payment methods, you can redirect the user to the checkout page via _normalURL_ according to the general practice. Or you can also display the QR code and payment password that are obtained through _codeValue_ on your page.



| **Response parameter** | **Description** | **Usage** |
| --- | --- | --- |
| normalUrl | Mobile payment continuation URL | A mobile payment continuation URL. The user is redirected to the web URL or open it in a new tab to complete a payment. |
| appUrl | An App Link or Universal Link. It can be loaded as a web URL in WebView. | Can invoke a payment method app as well as be opened as a web URL. |
| schemeUrl | Deep link | Used to invoke a payment method app. This type of URL is provided by mobile banking app payment methods. |



Table 6. Response parameters for invoking the payment process

To ensure the payment process can be invoked, we recommend that you open the URLs as follows:

copy

    //You can code as follows to redirect users to a URL.
    window.location.href = URL;
    //You can code as follows to invoke an app.
    if (response.schemeUrl) {
      window.location.href = response.schemeUrl;
    } else if (response.applinkUrl) {
      window.location.href = response.applinkUrl;
    }

For payments initiated on a web URL, you need to redirect the user to the redirection URL or open the URL in a new tab.

![Image 29: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673937799239-fa70e328-566b-4ec3-8615-b631f652999d.png)

Figure 6. Checkout experience of mobile website payment

**Notes**:

*   When you invoke the payment process, use the try-catch statement to capture errors and prompt users accordingly. Perform integrity acceptance before your integration project goes live.
*   The redirection URL of several payment methods can be opened only once. If you fail to invoke the checkout page, resend the request with a new _paymentRequestId_ to obtain the redirection URL and invoke the page again.
*   For bank transfer payment methods and several wallet payment methods, you can redirect the user to the checkout page via _normalURL_ according to the general practice. Or you can also display the QR code and payment password that are obtained through _codeValue_ on your page.



| **Response parameter** | **Description** | **Usage** |
| --- | --- | --- |
| appIdentifier | The package name of a payment method. | Used to determine whether the payment method app is installed for a payment in an app instead of showing a resolve ambiguity dialog box. |
| applinkUrl | An App Link or Universal Link. It can be loaded as a web URL in WebView. | Used to invoke a payment method app as well as be opened as a web URL. |
| schemeUrl | Deep link | Used to invoke a payment method app for users to complete a payment. |
| normalUrl | Mobile payment continuation URL | A mobile payment continuation URL for users to complete a payment. |



Table 6. Response parameters for invoking the payment process

For payments in an app, be familiar with the following three ways of handling the URLs returned by Alipay:



| **Handling** | **Description** |
| --- | --- |
| Invoke a payment method app for a payment | You can invoke the payment method app from your app for a payment. |
| Load the URL in WebView for a payment | You can load the URL on your app by using WebView for a payment. |
| Load the URL in a default browser for a payment | You can redirect users to a web URL from your app for a payment. |



Table 7. The handling of URLs for payments in an app

Some payment methods such as bank payment methods support payment on a web URL only, while other payment methods support payment in a payment method app only. Therefore, the payment scenarios fall into the following five types:

![Image 30: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673941800566-511286f2-e4b5-4677-9e41-28915f455e77.png)

Figure 6. User experience of mobile application payment

*   **Payment method app payment**: After a user chooses a payment method, they pay in the payment method app that is invoked via _schemeURL_ or _applinkURL_.
*   **Web URL payment in WebView**: After a user chooses a payment method, they pay on the web URL in your app that is loaded in WebView via _normalUrl_ or _applinkUrl_.
*   **Payment method app payment in WebView**: After a user chooses a payment method, they are redirected to an intermediate page in your app first, and then pay in the payment method app that is invoked via _normalUrl_ or _applinkUrl_.
*   **Web URL payment in a default browser**: After a user chooses a payment method, they pay on the web URL that is loaded in a default browser via _normalUrl_ or _applinkUrl_.
*   **Payment method app payment in a default browser**: After a user chooses a payment method, they are redirected to an intermediate page in a default browser first, and then pay in the payment method app that is invoked via _normalUrl_ or _applinkUrl_.

We recommend that you configure your routing for different payment methods in advance or perform the routing based on the payment methods in actual use, the returned URLs, and the client that is used to open the URLs:

![Image 31: image](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673947321273-d7cc838a-3420-4993-ba6a-bccd28d4a4d0.png)

![Image 32: image](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673948488869-8c1f9c33-91bd-4578-964e-ecf0e8cabbd3.png)

Figure 7. Payment process invocation plan

> **Notes**:
> 
> *   When you invoke the payment process, use the try-catch statement to capture errors and prompt users accordingly. Perform integrity acceptance before your integration project goes live.
> *   The payment continuation URL of several payment methods can be opened only once. If you fail to invoke the checkout page, resend the request with a new _paymentRequestId_ to obtain the payment continuation URL and invoke the page again.

Step 3: Obtain the payment result
---------------------------------

### 1\. Redirect to your result page

You can set the payment continuation URL by specifying _paymentRedirectUrl_ in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API.

*   For payments initiated in a desktop browser, we recommend that you pass in a web URL URL.
*   For payments initiated in a mobile browser, we recommend that you pass in a deep link.
*   For payments initiated in an app, you must pass in a deep link.

For payments initiated in a desktop browser, after a user completes a payment, they are redirected to the Alipay's payment result page first and then is redirected to the payment continuation URL after a short countdown. For payments initiated on a mobile device, after a user completes a payment, they are redirected to the homepage of the payment method.

> **Notes**: Due to network issues or users' maloperation, the redirection can fail.
> 
> *   For payments initiated in a desktop or mobile browser, if the web URL is opened in a new tab, we recommend that you monitor the payment status on your page to deliver a smooth payment process.
> *   For payments initiated in an app, if the web URL is loaded in a default browser, the payment might fail depending on the phone model used for the payment. In this case, the browser shows a dialog box to ask the user whether to invoke your app, and the user may tap **No** and manually open your app. Therefore, we recommend that you monitor the invocation of the payment result page and the user action of manually opening your app.

For payments initiated in different clients, after the user completes the payment, the user is redirected in the following ways:

Web

WAP

APP

![Image 33: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1674010269547-28fca833-5202-4f55-be2b-7ddee9896858.png)

Figure 8. Redirection to the payment result page

![Image 34: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1674013279182-cf0b108a-0ab3-4c57-995f-95486525cd29.png)

Figure 8. Redirection to the payment result page

![Image 35: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1674015138313-1f3aa718-d923-4f8b-98c0-ad8450a06679.png)

Figure 8. Redirection to the payment result page

### 2\. Obtain an asynchronous notification

Apart from learning the payment result from the redirection to the payment result page, you can also set the asynchronous notification address by specifying _paymentNotifyUrl_ in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API. When the payment is completed or times out, Alipay sends an asynchronous notification to the address through the [**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API.

When you receive the notification from Alipay, you must return a response by following the [code sample](https://global.alipay.com/docs/ac/cashierpay/notifications#JtjSl). If you do not return the response to Alipay or the response is not received by Alipay due to network issues, Alipay automatically resends the asynchronous notification within 24 hours for up to eight times or until the correct response is received. The sending intervals are as follows: 0s, 2 min, 10 min, 10 min, 1 h, 2 h, 6 h, and 15 h.

> **Notes**:
> 
> *   Usually, when a payment is successful, Alipay sends you an asynchronous notification of payment success immediately. When a payment fails, Alipay sends you an asynchronous notification of payment failure after the payment order is closed. The default order expiry time is 14 minutes after the payment is initiated.
> *   For the Sofort payment method, when a user finishes a payment, the payment status changes to `PENDING` first and Alipay sends you an asynchronous notification of payment processing through _paymentNotifyUrl_. After Sofort confirms the payment result (which usually takes 1-3 days, 7 days maximum), the payment status changes to `SUCCESS` or `FAIL` and Alipay sends you an asynchronous notification of payment success or failure through _paymentNotifyUrl_ again.
> *   For bank transfer payment methods based in Thailand, the default order expiry time is 48 hours after the payment is initiated. Therefore, when a payment fails, Alipay sends an asynchronous notification to you 48 hours after the payment is initiated at the latest.
> *   For the Mercado Pago payment method in Brazil, Mexico, Chile, and Peru, the default order expiry time is seven days after the payment is initiated. Therefore, when a payment fails, Alipay sends an asynchronous notification to you seven days after the payment is initiated at the latest.
> *   For the LINE Pay payment method in Japan, the default order expiry time is 20 minutes after the payment is initiated. Therefore, when a payment fails, Alipay sends an asynchronous notification to you 20 minutes after the payment is initiated at the latest.
> *   For the Pay-easy and Konbini payment method in Japan, the default order expiry time is seven days after the payment is initiated. Therefore, when a payment fails, Alipay sends an asynchronous notification to you seven days after the payment is initiated at the latest.

### 3\. Inquire about the payment status

The asynchronous notification and the synchronous redirection can both fail to be received or implemented. The causes are described in the following table:



|  | **Cause** | | **Handling** |
| --- | --- | --- | --- |
| **Asynchronous notification** | The notification cannot be received due to network issues. | | Alipay automatically resends the notification. |
| **Synchronous redirection** | Web/WAP | App |  |
| * The redirection fails due to network issues. * A user manually closes the browser after the user completes a payment. | * A payment method does not support redirection. * A payment method app or your app crashes. * A dialog box is displayed to ask the user whether to open an app, and the user taps **No**. * After the user completes a payment, the user manually closes the app or has the app run in the background. |



Table 8. The causes of failing to obtain the payment result

We recommend that you inquire about the payment status by calling the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API. You can use the API in the following scenarios:

Web & WAP

App

**Before the payment result page is invoked**: When the payment is initiated on the payment method page, you can automatically trigger calling the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API for subsequent redirection.

**When the user inquires about the payment result**: When the user clicks or taps **I have paid** or a button with the same meaning on your page, you can call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment status.

**When the payment expires**: When the payment reaches the expiry time, you can call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment status.

**Before the payment result page is invoked** **and when a user manually opens your app**: When the payment is initiated on the payment method app or page, you can automatically trigger calling the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API for subsequent redirection.

**When the user inquires about the payment result**: When the user taps **I have paid** or the button with the same meaning on your app, you can call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment status.

**When the payment expires**: When the payment reaches the expiry time, you can call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment status.

In the response returned through the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API, _paymentStatus_ indicates the payment status. See the following table for details:



| **paymentStatus** | **Type** | **Description** | **Handling** |
| --- | --- | --- | --- |
| SUCCESS | Final status | The payment is successful. | You can display a payment success page. |
| PROCESSING | Intermediate status | The payment is being processed. | You can allow the user to continue to pay. |
| PENDING | Intermediate status | The user completes a payment and waits for the payment method provider to confirm the payment status. | You can prompt the user that the payment needs to be confirmed by the payment method provider. |
| FAIL | Final status | The user has not paid or the payment fails. | You can allow the user to continue to pay or close the payment order. |
| CANCELLED | Final status | The payment is canceled by you. | You can allow the user to continue to pay or close the payment order. |



Table 9. Details of paymentStatus

For details about the payment status, see [Payment status description](https://global.alipay.com/docs/ac/cashierpay/payment_status_desc).

We recommend that you maintain the payment status in your server and your client proceeds with the payment process based on the information provided by your server. The processing logic is shown in the following figure:

Web

WAP

APP

![Image 36: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1674041174636-e77aa0ef-58d6-4bde-b289-512d82e3d9a3.png)

Figure 9. Processing logic according to payment status

![Image 37: 25aaed494904e91da72ddd8639353c50.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1683705066430-8a719a33-98b4-417a-a8e1-708e1597e5ce.png)

Figure 9. Processing logic according to payment status

![Image 38: Bank-related and wallet payments](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1674042049985-dcfff237-a2e8-4a59-9019-2e9e70aa4c12.png)

Figure 9. Processing logic according to payment status

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 39](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 40](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Prerequisites](#cXNt1 "Prerequisites")

[User experience](#wZXRY "User experience")

[Integration process](#L8XEk "Integration process")

[Step 1：Obtain and display available payment methods](#GJ2Qc "Step 1：Obtain and display available payment methods")

[1\. Obtain payment methods](#ngWo9 "1. Obtain payment methods")

[2\. Filter payment methods](#rFruV "2. Filter payment methods")

[3\. Display payment methods](#pIZTg "3. Display payment methods")

[4\. Collect or display extra information](#fCDj2 "4. Collect or display extra information")

[Step 2: Obtain a payment continuation URL and invoke the payment process](#pQMWG "Step 2: Obtain a payment continuation URL and invoke the payment process")

[1\. Intercept an invalid payment](#Wa6Yv "1. Intercept an invalid payment")

[2\. Send a payment request and obtain a payment continuation URL](#bErZl "2. Send a payment request and obtain a payment continuation URL")

[3\. Invoke the payment process](#ZwWoR "3. Invoke the payment process")

[Step 3: Obtain the payment result](#roPla "Step 3: Obtain the payment result")

[1\. Redirect to your result page](#JSbng "1. Redirect to your result page")

[2\. Obtain an asynchronous notification](#VxgM5 "2. Obtain an asynchronous notification")

[3\. Inquire about the payment status](#F3p9N "3. Inquire about the payment status")
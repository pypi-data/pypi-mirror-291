iOS | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fbank_ios)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf)

iOS
===

In this topic, you'll learn how to integrate the bank SDK into an iOS client so that you can payment cashier pages in a mobile application.

Prerequisites

Before integrating the SDK, ensure that you have completed the following tasks:

*   Install Xcode 12 or a higher version.
*   Use iOS 11 or a higher version.
*   The SDK security extension package does not support simulator compilation. Please integrate the SDK on a real device.

Key integration steps

Integrate the SDK by following these steps:

1

Integrate the SDK package

Client side

To integrate the SDK package, please refer to [Integrate the SDK Package](https://global.alipay.com/docs/ac/antom_sdk/ios_en).

2

Display available payment methods

Client side

After you have obtained available payment methods by contacting Alipay Technical Support, you can display the payment methods in the following modes:

*   Single bank mode: Display the payment methods by bank.
*   Bank type mode: Display the payment method by bank type, such as mobile banking app, online banking, and bank transfer.
*   Bank country mode: Display the payment methods by bank country, such as Thailand and Indonesia.

Please refer to [User experience](https://global.alipay.com/docs/ac/cashierpay/bank_sdk#7WPiN) for three types of payment method display.

**Note**: In the bank type mode, payment methods cannot be displayed under the mobile banking app type on web clients.

3

Create an SDK instance by using the `AMSCashierPayment` method:

Client side

1.  Create an instance for cashier pages. The instance contains the following parameter:
    *   _configuration_: A required object belonging to the _AMSCashierPaymentConfiguration_ type. The object must contain all configuration parameters.
2.  Create the `AMSCashierPaymentConfiguration` class, which must contain the following parameters:
    *   _locale_: An optional string belonging to the _NSString_ type, which is used by the merchant client to identify the language of the buyer's browser. Specify this parameter to ensure that the SDK displays pages in the correct language. The valid values are as follows. If any other values are passed, English will be used as the default language.
        *   `en_US`: English
        *   `in_ID`: Indonesian
        *   `th_TH`: Thai
    *   _options_: An optional parameter belonging to the _NSDictionary_ type. It is used to specify whether to use the default loading pattern and the sandbox environment. Valid values are:
        *   `"sandbox", "true"`: Sandbox environment
        *   `"sandbox", "false"`: Production enviroment
        *   `"showLoading", "true"`: Use the default loading pattern.
        *   `"showLoading", "false"`: Do not use the default loading pattern.
3.  Create an instance of the **AMSPaymentProtocol** interface used for handling corresponding events in subsequent processes. It contains the following method:
    *   ​`onEventCallback`: A callback function that monitors payment events on the checkout page, returning _eventCode_ and _eventResult_.
4.  Create an instance of the **AMSLoggerProtocol** interface used to manage log output. It contains the following method:
    *   ​`logWithName`: A callback function that is used to output logs by default.

Create an SDK instance:

Objective-C

1

2

3

4

5

6

7

8

9

10

@interface

    AMSCashierPaymentConfigurat

    ion : NSObject

/// Current language

@property (nonatomic, copy)

    NSString \*locale;

@property (nonatomic, copy)

    AMSCheckoutEnv envType;

@end

@property (nonatomic, strong)

    AMSCashierPaymentConfigurat

    ion \*configuration;

\- (instancetype)init

    :(AMSConfiguration

    \*)configuration;

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Create a configuration object:

Objective-C

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

#import <AMSComponent

    /AMSComponent-Swift.h>

AMSCashierPaymentConfiguration

    \*componentConfig \=

    \[AMSCashierPaymentConfigura

    tion new\];

componentConfig.locale \=

    @"en\_US";

// Specify options to use the

    sandbox environment. If it

    is left empty, the

    production environment is

    used by default.

NSDictionary \*options \=

    @{@"showLoading": @"true",

    @"sandbox": @"true"};

componentConfig.options \=

    options;

\[\[AMSCashierPayment shared\]

    initConfiguration

    :componentConfig\];

\[AMSCashierPayment shared\]

    .paymentDelegate \= self;

\[AMSCashierPayment shared\]

    .loggerDelegate \= self;

\[\[AMSCashierPayment shared\]

    createComponent

    :paymentSessionData\];

#pragma AMSPaymentProtocol

\- (void)onEventCallback

    :(NSString \*)eventCode

    eventResult:(AMSEventResult

    \*)eventResult

{

NSLog(@"eventCode%@

       eventResult%@",

       eventCode, eventResult);

}

#pragma AMSLogProtocol

\- (void)logWithName:(NSString

    \*)name parameter

    :(NSDictionary<NSString

    \*,id\> \*)parameter

{

NSLog(@"name%@ parameter%@",

       name, parameter);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

4

Send a **createPaymentSession (Checkout Payment)** request to the Alipay server.

Server side

After the user selects the payment method and your client detects the payment button click event, your server sends a [**createPaymentSession (Checkout Payment)**](https://global.alipay.com/docs/ac/ams/session_cashier) request. Get the paymentSesssionData value from the createPaymentSession response and use it in Step 5.

Pass the following parameters in your **createPaymentSession (Checkout Payment)** request:

*   paymentRequestId: The unique ID assigned by a merchant to identify a payment request.
    
*   productCode: Represents the payment product that is being used. The value is fixed as `AGREEMENT_PAYMENT` .
    
*   paymentNotifyUrl: The URL that is used to receive the payment result notification.
    
*   paymentRedirectUrl: The merchant page URL that the user is redirected to after the payment is completed.
*   paymentAmount: The payment amount that the merchant requests to receive in the order currency.
*   order.orderAmount: The order amount on the merchant's part. During sales promotion, the _orderAmount_ value may differ from the _paymentAmount_ value.
*   order.orderDescription: The order description.
*   order.referenceOrderId: The order ID on the merchant's side. Alipay suggests using one _referenceOrderId_ for multiple _paymentRequestId_s when there are multiple payment requests for a single order.
*   paymentMethod.paymentMethodType: Specify it as `BANK.`
*   paymentMethod.paymentMethodMetaData：
    *   To display payment methods in the single bank mode, specify _bankName_ as a bank name.
    *   To display payment methods in the bank type mode, specify _paymentMethodCaregory_ as a payment method type. Valid values are `BANK_TRANSFER`, `MOBILE_BANKING_APP`, and `ONLINE_BANKING`.
    *   To display payment methods in the bank country mode, specify _paymentMethodRegion_ as a country. Valid values are `TH` and `ID`.

Single bank mode

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

{

"order": {

"orderAmount": {

"currency": "THB",

"value": "160"

},

"orderDescription":

            "Cappuccino #grande

            (Mika's coffee shop

            )",

"referenceOrderId":

            "ORDER\_202308031652

            57496"

},

"paymentAmount": {

"currency": "THB",

"value": "160"

},

"paymentMethod": {

"paymentMethodType":

            "BANK",

"paymentMethodMetaData"

            : "{\\"bankName\\"

            :\\"Siam Commerical

            Bank\\"}"

},

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"paymentNotifyUrl": "https

        ://kademo.intlalipay.cn

        /payments

        /notifySuccess",

"paymentRedirectUrl":

        "https://kademo

        .intlalipay.cn/melitigo

        /Test\_114.html",

"paymentRequestId":

        "PAY\_20230804165257508"

        ,

"productCode":

        "CASHIER\_PAYMENT"

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Bank type mode

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

{

"order": {

"orderAmount": {

"currency": "THB",

"value": "160"

},

"orderDescription":

            "Cappuccino #grande

            (Mika's coffee shop

            )",

"referenceOrderId":

            "ORDER\_202308031652

            57496"

},

"paymentAmount": {

"currency": "THB",

"value": "160"

},

"paymentMethod": {

"paymentMethodType":

            "BANK",

"paymentMethodMetaData"

            :

            "{\\"paymentMethodCa

            regory\\"

            :\\"BANK\_TRANSFER\\"}

            "

},

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"paymentNotifyUrl": "https

        ://kademo.intlalipay.cn

        /payments

        /notifySuccess",

"paymentRedirectUrl":

        "https://kademo

        .intlalipay.cn/melitigo

        /Test\_114.html",

"paymentRequestId":

        "PAY\_20230804165257508"

        ,

"productCode":

        "CASHIER\_PAYMENT"

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Bank country mode

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

{

"order": {

"orderAmount": {

"currency": "THB",

"value": "160"

},

"orderDescription":

            "Cappuccino #grande

            (Mika's coffee shop

            )",

"referenceOrderId":

            "ORDER\_202308031652

            57496"

},

"paymentAmount": {

"currency": "THB",

"value": "160"

},

"paymentMethod": {

"paymentMethodType":

            "BANK",

"paymentMethodMetaData"

            :

            "{\\"paymentMethodRe

            gion\\":\\"TH\\"}"

},

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"paymentNotifyUrl": "https

        ://kademo.intlalipay.cn

        /payments

        /notifySuccess",

"paymentRedirectUrl":

        "https://kademo

        .intlalipay.cn/melitigo

        /Test\_114.html",

"paymentRequestId":

        "PAY\_20230804165257508"

        ,

"productCode":

        "CASHIER\_PAYMENT"

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

5

Render the payment pages

Client side

Use the `createComponent()` method in the configuration object.

1.  Create a configuration object by using the _sessionData_ parameter: Pass the _paymentSessionData_ value obtained in Step 4 to the _sessionData_ parameter of the `createComponent` method.
2.  Call the `createComponent()` method to initialize the SDK.

Call the `onDestroy()` method to free SDK component resources in the following situations:

*   When the user exits the checkout page, free the component resources created in the **createPaymentSession.**
*   When the user initiates multiple payments, free the component resources created in the previous **createPaymentSession.**

Use the createComponent method

Objective-C

1

2

3

4

\[\[AMSCashierPayment shared\]

    createComponent:sessionData\]

    ;

//Free SDK component resources

\[\[AMSCashierPayment shared\]

    onDestroy\];

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

6

Obtain a payment result

Server side

When the payment reaches a final status of success or failure, Alipay sends an asynchronous notification through the [**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API to _paymentNotifyUrl_ that you pass through the [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) API. When you receive the notification from Alipay, you must return a response as instructed in [Requirements](https://global.alipay.com/docs/ac/ams/paymentrn_online). You can also obtain the payment result by calling the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API.

Event codes

The SDK provides the following status codes:

*   `SDK_START_OF_LOADING`: The loading animation starts to play during the payment component creation.
    
*   `SDK_END_OF_LOADING`: The loading animation ends during the payment component creation.
    

The SDK provides the following error codes:

*   `SDK_INTERNAL_ERROR`: The internal error of the SDK occurs. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_CREATEPAYMENT_PARAMETER_ERROR`: The parameters passed into the `AMSCashierPayment` method are incorrect. Ensure the parameters are passed correctly and send a new request.
    
*   `SDK_CALL_URL_ERROR`: The payment method client failed to be revoked. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_INTEGRATION_ERROR`: Dependencies are not found. Ensure that the dependencies are added correctly and retry the integration process.
    

#### Is this page helpful?

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)
通知 | 扫码绑定 | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg) ![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fscantopay_en%2Fnotification)  
[返回首页](../../)  
扫码绑定  
[概述](/docs/ac/scantopay_en/overview)  
集成指南  
支付后  
[取消](/docs/ac/scantopay_en/cancel_cn)  
[退款](/docs/ac/scantopay_en/refund)  
[通知](/docs/ac/scantopay_en/notification)  
[对账](/docs/ac/scantopay_en/settle_reconcile)  
通知
===============

2024-04-07 10:59  
了解如何集成支付宝提供的通知接口。

功能
========

以下表格列出了支持的产品和这些通知的描述：

| **通知接口** | **收银台支付** | **自动扣款** | **便捷支付** | **扫码绑定** | **用户出示模式支付** | **订单码支付** | **入口码支付** | **描述** |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [notifyAuthorization](https://global.alipay.com/docs/ac/ams/notifyauth) | ❌ | ✔️ | ✔️ | ✔️ | ❌ | ❌ | ❌ | 当授权成功或授权取消成功时，向您发送授权结果。参数 *authorizationNotifyType* 指示授权通知的类型。* `AUTHCODE_CREATED`: 表示授权成功。* `TOKEN_CANCELED`: 表示授权已取消。 |
| [notifyPayment](https://global.alipay.com/docs/ac/ams/paymentrn_online) | 支持 | 支持 | 支持 | 支持 | 支持 | 支持 | 支持 | 当支付处理达到成功或失败的最终状态时，将支付结果发送给您。参数 `result.resultStatus` 表示支付结果。* `S`: 当 `notifyType` 为 `PAYMENT_RESULT` 时，表示支付成功；当 `notifyType` 为 `PAYMENT_PENDING` 时，表示支付处理中。* `F`: 表示支付失败。 |
| [notifyCapture](https://global.alipay.com/docs/ac/ams/notify_capture) | 支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 当扣款处理达到成功或失败的最终状态时，将扣款结果发送给您。参数 `result.resultStatus` 表示扣款结果。* `S`: 表示扣款成功。* `F`: 表示扣款失败。 |
| [notifyDispute](https://global.alipay.com/docs/ac/ams/notify_dispute) | 支持 | 支持 | 支持 | 支持 | 不支持 | 不支持 | 不支持 | 向您发送争议信息。参数 `disputeNotificationType` 表示争议通知类型。* `DISPUTE_CREATED`: 表示创建了争议。* `DISPUTE_JUDGED`: 表示争议已裁决。 |
| [notifyRefund](https://global.alipay.com/docs/ac/ams/notify_refund) | 支持 | 支持 | 支持 | 支持 | 不支持 | 不支持 | 不支持 | 当退款处理达到成功或失败的最终状态时，将退款结果发送给您。参数 `refundstatus` 表示退款结果。* `S`: 表示退款成功。* `F`: 表示退款失败。 |
**表 1. 通知功能**

**配置接收地址**
----------------

您可以通过接口或Antom仪表板为每个通知配置接收地址。如果同时使用两种方式指定地址，API中配置的URL优先。

| **通知接口** | **通过API配置** | **在Antom仪表板中配置** |
| --- | --- | --- |
| [notifyAuthorization](https://global.alipay.com/docs/ac/ams/notifyauth) | - | 在蚂蚁开放平台仪表盘的**集成设置**选项卡中编辑**通知URL**： ![图1. 在蚂蚁开放平台仪表盘配置接收地址](https://i.imgur.com/placeholder.png) |
| [notifyPayment](https://global.alipay.com/docs/ac/ams/paymentrn_online) | 在[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API中指定*paymentNotifyUrl*字段。 |
| [notifyCapture](https://global.alipay.com/docs/ac/ams/notify_capture) | 在[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API中指定*paymentNotifyUrl*字段。 |
| [notifyDispute](https://global.alipay.com/docs/ac/ams/notify_dispute) | - |
| [notifyRefund](https://global.alipay.com/docs/ac/ams/notify_refund) | 在[**refund**](https://global.alipay.com/docs/ac/ams/refund_online) API中指定*refundNotifyUrl*字段。 |
  
**表2. 接收地址配置**

**处理通知**
------------

1. **验证签名**
   支付宝发送的结果通知是经过签名的。建议验证签名，确认通知是否来自支付宝。可以自行验证签名，或者使用支付宝SDK。

   如果要自行验证签名，请参考[请求签名和验证签名](https://global.alipay.com/docs/ac/ams/digital_signature#x6Le8)。若使用支付宝SDK，需在提供的[SDKs](https://global.alipay.com/docs/sdks)中的`SignatureTool.verify`方法中指定相应参数的值：
   ```java
   boolean isSuccess = SignatureTool.verify(httpMethod, path, clientId, rspTimeStr, rspBody, signature, alipayPublicKey);
   ```
   其中，_signature_ 的值来自通知的头部。以下是一个示例的通知头部：
   ```http
   // 示例通知头
   ```
   
请注意，上述代码示例中的`httpMethod`、`path`、`clientId`、`rspTimeStr`、`rspBody`、`signature`和`alipayPublicKey`需要替换为实际接收到的参数值。
"Content-Type": "application/json", "Request-Time": "2019-07-12T12:08:56+05:30", "client-id": "T_111222333", "Signature": "algorithm=RSA256,keyVersion=1,signature=jTOHqknjk%2fnDjEn8lfg%2beNODdoh2eHGJV%2blvrKaDwP782WxJ7ro49giqUu23MUM8sFVVNvhg32qHS3sd4O6uf5kAVLqztqNOPJFZcjw141EVi1vrs%2bIB4vU0%2fK%2f8z2GyWUByh2lHOWFsp%2b5QKCclXp%2bjacYqWYUur5IVbuebR1LoD5IiJ7u7J9qYriFxodkxmIAJYJyJs7mks2FWHh2YePLj3K%2f4B65idy7RBKqY1NN1XcvqnbQmlfCH8CIv75bg%2fr9sGmPE5a%2bYgL8N9Q41buGwMSq1IcNsbceMbyPhw5Z5HnJ7tPz12fvdSi0cEicPikDthQ2EQFmtpntXcAc%2fHA%3d%3d"

2. 返回接收确认消息
-----------------------

在验证签名并确认通知来自支付宝后，你需要向支付宝返回一个接收确认消息，以告知支付宝通知已成功接收。**返回接收确认消息的过程不需要数字签名。**

以下是你发送给支付宝的消息头示例：
```
"Content-Type": "application/json", "response-time": "2019-07-12T12:08:56+05:30", "client-id": "T_111222333",
```

以下是你发送给支付宝的消息体示例：
```
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "success"
  }
}
```

如果由于操作或网络问题没有向支付宝返回此类消息，支付宝将在24小时内自动重试异步通知，最多重试七次，直到收到正确的响应。发送间隔如下：0秒，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。

> **注意：** 记录从支付宝接收到的已处理的支付请求通知，并妥善处理幂等性，以避免对单个请求进行多次处理。

要查看文档的最新更新，请访问[版本发布说明](https://global.alipay.com/docs/releasenotes)。
请注意，由于Markdown格式的限制，图片无法直接翻译，但以下是文档文字部分的中文翻译：

---

### 图片 4  
### 图片 5  
@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

#### 这个页面有帮助吗？  

#### 在此页面上  
[功能](#wOOIg "功能")  
[配置接收地址](#CjFP8 "配置接收地址")  
[处理通知](#JtjSl "处理通知")  
[1. 验证签名](#CQeW3 "1. 验证签名")  
[2. 返回接收确认消息](#vQK5A "2. 返回接收确认消息")  

---

请注意，上述翻译是基于提供的Markdown文本，图片内容未知，因此未包含在翻译中。如果图片包含重要信息，请提供图片的文字描述或内容以供翻译。
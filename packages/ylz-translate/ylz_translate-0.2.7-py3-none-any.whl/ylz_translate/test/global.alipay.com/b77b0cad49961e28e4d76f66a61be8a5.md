Quickstart | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fquickstart)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf)

Quickstart
==========

This quickstart guides you through the integration process of Cashier Payment using Alipay+ APIs.

Set up the server

Server-side

(Optional) Add dependency

If you use the [JAR file](https://global.alipay.com/docs/sdks) provided by Alipay+, add the dependency to your project.

Add Maven dependency:

XML

1

2

3

4

5

<dependency>

<groupId>com.alipay.global.sdk

      </groupId>

<artifactId>global-open-sdk

      \-java</artifactId>

<version>2.0.11</version>

</dependency>

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Configure requests

To configure requests, obtain the following information first:

*   Log in to [Alipay+ Dashboard](https://dashboard.alipay.com/). Go to **Developers** > **Quickstart**, find **Integration resources**, and get the following details:

*   *   Gateway domain name
    *   Client ID
    *   API keys: You need to generate keys yourself. For more information about how to generate or replace keys, see [API key configuration](https://global.alipay.com/docs/ac/ref/key_config).

*   API path: Get the path for a specific API in [Alipay APIs](https://global.alipay.com/docs/ac/ams/api).

Then configure the obtained gateway domain name, Client ID, API keys, and API path to your API request.

**Note**: If you use the JAR file provided by Alipay+, you can use the codes directly without additional processing. If you prefer to sign a request and verify the signature by yourself, see [Sign a request and verify the signature](https://global.alipay.com/docs/ac/ams/digital_signature).

Set up a HTTPS request:

Java

1

2

3

4

5

6

7

8

String domain \= "DOMAIN"

String merchantPrivateKey \=

    "YOUR PRIVATE KEY";

String alipayPublicKey \= "ALIPAY

    PUBLIC KEY"

AlipayClient defaultAlipayClient

    \= new DefaultAlipayClient

    (domain, merchantPrivateKey,

    alipayPublicKey);

AlipayPayRequest

    alipayPayRequest \= new

    AlipayPayRequest();

alipayPayRequest.setClientId

    (CLIENT\_ID);

alipayPayRequest.setPath

    (API\_PATH);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Create a checkout page

Client-side

Create a checkout page on your client to display the goods ID, order information, available payment methods, the payment button, and other payment information.

Add payment methods

Add payment methods on your checkout page:

*   Name: Refer to [Payment methods](https://global.alipay.com/docs/ac/ref/payment_method#xm58z) to check the correct payment method names.
*   Logo: Use [Brand asset](https://global.alipay.com/docs/ac/ref/brandasset) to obtain payment method logos.

**Note**: For Alipay+ payment methods, you must display the Alipay+ Partner logo as in the picture.

Display of Alipay+ payment methods:

![Image 3: Quickstart](https://mdn.alipayobjects.com/huamei_qg1e8t/afts/img/A*IqCYRK88mIYAAAAAAAAAAAAADsKHAQ/original)

Initiate a payment

Server-side

When initiating a [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) request, you need to pass in the following URLs:

*   _paymentRedirectUrl_: Your payment result page URL. Alipay+ redirects the buyer to this URL after the payment is completed. Pass in the required redirect URL types for different client-side terminals:

*   *   Web: Pass in a PC website redirect URL.
    *   WAP: Pass in a web URL redirect URL.
    *   App: Pass in a deep link URL.

*   _paymentNotifyUrl_: Alipay+ sends the payment and capture results to this URL after the payment and capture reaches a final status. Specify _paymentNotifyUrl_ as an HTTPS URL and make sure that the URL can receive notifications.

After the buyer clicks the payment button, initiate the **pay** request using the _alipayPayRequest_ object created in the Configure requests step.

Refer to samples in the code editor according to the following different payment types:

*   **Non-card payment**: includes payments of the following payment method categories:

*   *   Alipay+
    *   Wallet
    *   Online banking
    *   Bank transfer
    *   Mobile banking app

*   **Card Payment (hosted payment page mode)**: In this mode, Alipay+ provides a page for collecting card payment information. If the buyer chooses to save the card on the page, Alipay+ stores the buyer's card information and generates a corresponding card token (_cardToken_). You can use the card token for future payments.
*   **Card Payment (server-to-server mode)**: This mode requires that you are PCI-qualified.

Additionally, for card payments, when sending a **pay** request, you can also choose whether to use [value-added features](https://global.alipay.com/docs/ac/cashierpay/value_added) according to your business needs.

For specific payment requirements of different payment methods, see the **pay** API.

Order information:

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

// set order Info

Order order \= new Order();

// replace with your orderId

String orderId \= UUID.randomUUID

    ().toString();

order.setReferenceOrderId(orderId);

order.setOrderDescription("Test

    Order");

order.setOrderAmount(amount);

Buyer buyer \= new Buyer();

buyer.setReferenceBuyerId("Your

    Buyer Id");

order.setBuyer(buyer);

order.setOrderAmount(amount);

alipayPayRequest.setOrder(order);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Environment information:

Java

1

2

3

4

5

6

// set env Info

Env env \= new Env();

env.setTerminalType("WEB");

env.setClientIp("YOUR CUSTOMER IP");

alipayPayRequest.setEnv(env);

order.setEnv(env);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Payment information:

Non-card

Card (hosted payment page mode)

Card (server-to-server mode)

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

// set amount

Amount amount \= new Amount();

amount.setCurrency("BRL");

amount.setValue("4200");

alipayPayRequest.setPaymentAmount

    (amount);

//set settlement currency

SettlementStrategy

    settlementStrategy \= new

    SettlementStrategy();

settlementStrategy

    .setSettlementCurrency("USD");

alipayPayRequest

    .setSettlementStrategy

    (settlementStrategy);

// replace with your

    paymentRequestId

String paymentRequestId \= UUID

    .randomUUID().toString();

alipayPayRequest

    .setPaymentRequestId

    (paymentRequestId);

// set paymentMethod

PaymentMethod paymentMethod \= new

    PaymentMethod();

paymentMethod.setPaymentMethodType

    ("GCASH");

alipayPayRequest.setPaymentMethod

    (paymentMethod);

// set productcode

alipayPayRequest.setProductCode

    ("CASHIER\_PAYMENT");

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Card information (server-to-server mode):

Java

1

2

3

4

5

6

7

8

9

10

11

12

//if merchant collect card info,

    set card info in this

    paymentMethodMetaData

Map<String, Object\>

    paymentMethodMetaData \= new

    HashMap<String, Object\>();

paymentMethodMetaData.put("cardNo",

    "0255187751531899");

paymentMethodMetaData.put("cvv",

    "712");

paymentMethodMetaData.put

    ("expiryMonth", "06");

paymentMethodMetaData.put

    ("expiryYear", "28");

paymentMethodMetaData.put

    ("tokenize", false);

JSONObject cardholderName \= new

    JSONObject();

cardholderName.put("firstName",

    "Alan");

cardholderName.put("lastName",

    "Wallex");

paymentMethodMetaData.put

    ("cardholderName",

    cardholderName);

paymentMethod

    .setPaymentMethodMetaData

    (paymentMethodMetaData);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Card authorization (Card payments):

Java

1

2

3

// set authorization

paymentFactor.setAuthorization(true

    );

alipayPayRequest.setPaymentFactor

    (paymentFactor);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Payment redirect URL:

Java

1

2

// replace with your redirect url

alipayPayRequest

    .setPaymentRedirectUrl("http

    ://www.yourRedirectUrl.com");

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Payment notification URL:

Java

1

2

// replace with your notify url

alipayPayRequest.setPaymentNotifyUrl

    ("http://www.yourNotifyUrl.com"

    );

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Signing a request:

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

61

private String genSignValue(String

    httpMethod, String path, String

    clientId, String requestTime,

    String reqBody) throws

    AlipayApiException {

String signatureValue;

try {

String reqContent \=

            httpMethod + " " + path

            + "\\n" + clientId + "."

            + timeString

+ "." + content;

signatureValue \= encode

            (signWithSHA256RSA

            (reqContent,

            merchantPrivateKey),

            DEFAULT\_CHARSET);

} catch(Exception e) {

throw new

            AlipayApiException(e);

}

return signatureValue;

}

/\*\*

\* Generate base64 encoded

     signature using the sender's

     private key

\*

\* @param reqContent: the

     original content to be signed

     by the sender

\* @param strPrivateKey: the

     private key which should be

     base64 encoded

\* @return

\* @throws Exception

\*/

private static String

    signWithSHA256RSA(String

    reqContent, String

    strPrivateKey) throws Exception

    {

Signature privateSignature \=

        Signature.getInstance

        (SHA256WITHRSA);

privateSignature.initSign

        (getPrivateKeyFromBase64Str

        ing(strPrivateKey));

privateSignature.update

        (reqContent.getBytes

        (DEFAULT\_CHARSET));

byte\[\] s \= privateSignature

        .sign();

return base64Encryptor

        .encodeToString(s);

}

/\*\*

\* URL encode

\* @param originalStr

\* @param characterEncoding

\* @return

\* @throws

     UnsupportedEncodingException

\*/

private static String encode(String

    originalStr,

String

                 characterEncoding)

                 throws

                 UnsupportedEncodin

                 gException {

return URLEncoder.encode

        (originalStr,

        characterEncoding);

}

/\*\*

\* Generate required headers

\* @param requestTime

\* @param clientId

\* @param keyVersion

\* @param signatureValue

\* @return

\*/

private Map<String,String\>

    buildBaseHeader(String

    requestTime, String clientId,

    Integer keyVersion, String

    signatureValue) {

Map<String, String\> header \=

        new HashMap<String, String

        \>();

header.put("Content-Type",

        "application/json; charset

        \=UTF-8");

header.put("Request-Time",

        requestTime);

header.put("client-id",

        clientId);

if(keyVersion \== null) {

keyVersion \=

            DEFULT\_KEY\_VERSION;

}

String signatureHeader \=

        "algorithm=RSA256

        ,keyVersion=" + keyVersion

        + ",signature=" +

        signatureValue;

header.put(Signature,

        signatureHeader);

return header;

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Handle the payment result

Client-side & Server-side

pay response (Client-side)

When receiving the **pay** response from Alipay+, handle the payment result according to the value of _result.resultStatus_:

*   _result.resultStatus_\=`S`: indicates that the payment was successful. Display the buyer the payment success result.
*   _result.resultStatus_\=`F`: indicates that the payment failed. Display the buyer the payment failure result.
*   _result.resultStatus_\=`U`: indicates that the payment is in process. Redirect the buyer to the URL returned by Alipay+.

Handle the redirect URL

When the value of _result.resultStatus_ is `U`, at least one of the following URLs is returned:

*   _normalUrl_: The URL of an HTTPS address, used to redirect the buyer to the website page of the payment method on the same browser page of your website. Note that this URL may include a button to invoke the payment method App.
*   _schemeUrl_: The scheme URL that is used to open a payment method app.
*   _applinkUrl_: The Android App Link or iOS Universal Link that is used for redirection in the payment process.

Handle the URLs based on different terminal types (Web, WAP, and App) and operating systems (iOS and Android).

Web: The buyer places an order on your PC website.

JavaScript

1

2

3

if (serverResponse.normalUrl) {

window.open(serverResponse

    .normalUrl, '\_blank');

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

WAP: The buyer places an order on your mobile browser website.

JavaScript

1

2

3

4

5

6

7

if (serverResponse.applinkUrl) {

window.location.href \=

      serverResponse.applinkUrl;

} else if (serverResponse

    .normalUrl) {

window.location.href \=

      serverResponse.normalUrl;

} else if (serverResponse

    .redirectActionForm

    .redirectUrl) {

window.location.href \=

      serverResponse

      .redirectActionForm

      .redirectUrl;

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

App (iOS): The buyer places an order from your App on iOS.

Objective-C

1

2

3

4

5

if (\[\[\[UIDevice currentDevice\]

    systemVersion\] floatValue\]

    \>= 10.0) {

\[\[UIApplication

        sharedApplication\]

        openURL:\[NSURL

        URLWithString:Url\]

        options:@{}

        completionHandler:nil\];

}else{

\[\[UIApplication

        sharedApplication\]

        openURL:\[NSURL

        URLWithString:Url\]\];

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

App (Android): The buyer places an order from your App on Android.

Java

1

2

3

4

5

6

7

8

try {

Intent intent \= new Intent

      (Intent.ACTION\_VIEW, Uri

      .parse(Url));

intent.addFlags(Intent

      .FLAG\_ACTIVITY\_NEW\_TASK);

// use the startActivity

      function to redirect to

      the wallet app

startActivity(intent);

} catch (Exception e) {

e.printStackTrace();

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Asynchronous notification (Server-side)

Alipay+ sends you an asynchronous notification when the payment reaches a final status of success or failure. Make sure that _paymentNotifyUrl_ that you provide through the **pay** API can receive notifications.

When you receive the payment result notification, follow the steps below to handle it:

1.  Verify the notification.
2.  Update your order status.
3.  Send a notification response to Alipay+ following the fixed format shown in the code editor. You do not need to sign the response.

Verifying the notification:

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

private boolean checkRspSign

    (String httpMethod, String

    path, String clientId,

    String responseTime, String

    rspBody, String

    rspSignValue) throws

    AlipayApiException {

try {

String rspContent \=

            httpMethod + " " +

            path + "\\n" +

            clientId + "." +

            timeString

+ "." + content;

return

            verifySignatureWith

            SHA256RSA

            (rspContent, decode

            (signature,

            DEFAULT\_CHARSET),

            alipayPublicKey);

} catch (Exception e) {

throw new

            AlipayApiException

            (e);

}

}

/\*\*

\* Verify if the received

     signature is correctly

     generated with the

     sender's public key

\*

\* @param rspContent: the

     original content signed by

     the sender and to be

     verified by the receiver.

\* @param signature: the

     signature generated by the

     sender

\* @param strPk: the

     public key string-base64

     encoded

\* @return

\* @throws Exception

\*/

private static boolean

    verifySignatureWithSHA256RS

    A(String rspContent, String

    signature, String strPk)

    throws Exception {

PublicKey publicKey \=

        getPublicKeyFromBase64S

        tring(strPk);

Signature publicSignature \=

        Signature.getInstance

        (SHA256WITHRSA);

publicSignature.initVerify

        (publicKey);

publicSignature.update

        (rspContent.getBytes

        (DEFAULT\_CHARSET));

byte\[\] signatureBytes \=

        base64Encryptor.decode

        (signature);

return publicSignature

        .verify(signatureBytes

        );

}

/\*\*

\* URL decode

\* @param originalStr

\* @param characterEncoding

\* @return

\* @throws

     UnsupportedEncodingExcepti

     on

\*/

private static String decode

    (String originalStr,

               String

               characterEncodin

               g) throws

               UnsupportedEncod

               ingException {

return URLDecoder.decode

        (originalStr,

        characterEncoding);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Notification response:

JSON

1

2

3

4

5

6

7

{

"result": {

"resultCode": "SUCCESS",

"resultStatus": "S",

"resultMessage": "Success"

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Handle the capture result notification

Server-side

Alipay+ automatically captures funds for you after the buyer completes the card authorization payment. When the capture reaches a final status of success or failure, Alipay+ sends an asynchronous notification to you. Make sure that _paymentNotifyUrl_ that you provide through the **pay** API can receive notifications.

When you receive the capture result notification, follow the steps below to handle it:

1.  Verify the notification.
2.  Update your order status.
3.  Send a notification response to Alipay+ following the fixed format shown in the code editor. You do not need to sign the response.

Verifying the notification:

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

private boolean checkRspSign

    (String httpMethod, String

    path, String clientId,

    String responseTime, String

    rspBody, String

    rspSignValue) throws

    AlipayApiException {

try {

String rspContent \=

            httpMethod + " " +

            path + "\\n" +

            clientId + "." +

            timeString

+ "." + content;

return

            verifySignatureWith

            SHA256RSA

            (rspContent, decode

            (signature,

            DEFAULT\_CHARSET),

            alipayPublicKey);

} catch (Exception e) {

throw new

            AlipayApiException

            (e);

}

}

/\*\*

\* Verify if the received

     signature is correctly

     generated with the

     sender's public key

\*

\* @param rspContent: the

     original content signed by

     the sender and to be

     verified by the receiver.

\* @param signature: the

     signature generated by the

     sender

\* @param strPk: the

     public key string-base64

     encoded

\* @return

\* @throws Exception

\*/

private static boolean

    verifySignatureWithSHA256RS

    A(String rspContent, String

    signature, String strPk)

    throws Exception {

PublicKey publicKey \=

        getPublicKeyFromBase64S

        tring(strPk);

Signature publicSignature \=

        Signature.getInstance

        (SHA256WITHRSA);

publicSignature.initVerify

        (publicKey);

publicSignature.update

        (rspContent.getBytes

        (DEFAULT\_CHARSET));

byte\[\] signatureBytes \=

        base64Encryptor.decode

        (signature);

return publicSignature

        .verify(signatureBytes

        );

}

/\*\*

\* URL decode

\* @param originalStr

\* @param characterEncoding

\* @return

\* @throws

     UnsupportedEncodingExcepti

     on

\*/

private static String decode

    (String originalStr,

               String

               characterEncodin

               g) throws

               UnsupportedEncod

               ingException {

return URLDecoder.decode

        (originalStr,

        characterEncoding);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Notification response:

JSON

1

2

3

4

5

6

7

{

"result": {

"resultCode": "SUCCESS",

"resultStatus": "S",

"resultMessage": "Success"

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

#### Is this page helpful?

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)
Accept payments | Order Code Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams_oc%2Facceptpayment)

[Go to Homepage](../../)

Order Code Payment

[Introduction](/docs/ac/ams_oc/introduction)

[Get started](/docs/ac/ams_oc/start)

[Accept payments](/docs/ac/ams_oc/acceptpayment)

[Post-payment services](/docs/ac/ams_oc/postpayment)

[Best practice](/docs/ac/ams_oc/bp)

Development

[API list](/docs/ac/ams_oc/apilist)

[Reconciliation](/docs/ac/ams_oc/reconcile)

Reference

[Release notes](/docs/ac/ams_oc/releasenotes)

[Legacy version](/docs/ac/ams_oc/legacyv)

Accept payments
===============

2023-06-29 10:32

To integrate with Alipay, you can use Alipay-provided open SDKs or call APIs on your own.

Use open SDKs
=============

Alipay Global Open SDK encapsulates the process of performing the integration, including the adding and validating of signatures for calling Alipay APIs. For more details, see [_Alipay SDK for Java_](https://github.com/alipay/ams-java-sdk), [_Alipay SDK for PHP_](https://github.com/alipay/global-open-sdk-php), [_Alipay SDK for Python_](https://github.com/alipay/global-open-sdk-python), and [_Alipay SDK for .Net_](https://github.com/alipay/global-open-sdk-dotnet).

API integration
===============

After integrating with the Alipay Order Code Payment product, payments can be accepted by asking the user to scan the order code. The following graphic shows the interaction flow of accepting the payment from a customer:

![Image 3: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1592969442054-8ced3a34-22c5-4cf3-bfb2-4f3afea2b05a.png)

Figure 1. Payment process of Order Code Payment product

The payment process consists of the following steps:

1.  The merchant sends a request to Alipay to ask for an order code generation.

1.1 Alipay returns the order code to the merchant.

1.2 Alipay notifies the payment result to the merchant. (After the customer completes the payment.)

1.3 The merchant sends Alipay an acknowledgement message to confirm that the payment notification is received.

2.  The merchant presents the order code to the customer.
3.  The customer opens the e-wallet and scans the order code. The merchant scans the wallet to initiate the payment.
4.  The customer confirms to pay.
5.  ISV sends the payment request to Alipay.

Initiate a payment request
--------------------------

Before you start integrating with Alipay's Order Code Payment product, go through the Development section to learn how to invoke interfaces in both the sandbox and production environments. Then proceed to complete the following steps:

### Step 1: Construct the request

The request that you need to construct is composed of four parts:

*   Request URL format: **https://open-sea-global.alipay.com****/ams/api/v1/payments/pay**
*   Method: **POST**
*   HTTP header: mainly contains fields such as _Client-Id_, _Signature_, _Encrypt_, _Content-Type_, _Request-Time_, and _Agent-Token_. 
*   HTTP body: contains the detailed business request information in the JSON format and the business request information needs to be signed. For more information, see the [**p**](https://global.alipay.com/doc/ams/upm)[**ay**](https://global.alipay.com/doc/ams/upm) interface. 

The following example shows an HTTP body of a request for an Order Code Payment:

copy

    {
      "productCode": "IN_STORE_PAYMENT",
      "paymentNotifyUrl": "http://xmock.inc.alipay.net/api/Ipay/globalSite/automtion/paymentNotify.htm",
      "paymentRequestId": "102775745075669",
      "paymentFactor": {
        "inStorePaymentScenario": "OrderCode"
      },
      "order": {
        "referenceOrderId": "102775745075669",
        "orderDescription": "Mi Band 3 Wrist Strap Metal Screwless Stainless Steel For Xiaomi Mi Band 3 ",
        "orderAmount": {
          "currency": "USD",
          "value": "10"
        },
        "merchant": {
          "referenceMerchantId": "seller231117459@login.com",
          "merchantName": "cup Hu",
          "merchantMCC": "1234",
          "store": {
            "referenceStoreId": "S0000000001",
            "storeName": "UGG-2",
            "storeMcc": "1405"
          }
        }
      },
      "paymentAmount": {
        "currency": "USD",
        "value": "10"
      },
      "paymentMethod": {
        "paymentMethodType": "CONNECT_WALLET"
      }
    }

**Notes**:

*   Specify _inStorePaymentScenario_ with _OrderCode_ in the payment interface for an Order Code Payment.
*   All transaction amount needs to be represented in the smallest unit of a currency. For example, when the currency code is USD, $5.99 is represented as 599. When the currency code is JPY, ￥599 is represented as 599. See [_ISO 4217 Currency Codes_](https://www.iso.org/iso-4217-currency-codes.html) for details.

### Step 2: Submit the payment request to Alipay

Submit the request you constructed as suggested in Step 1 to Alipay with the following gateway addresses:

*   **open-na.alipay.com**: for merchants in North America.
*   **open-sea.alipay.com**: for merchants in Asia.
*   **open-eu.alipay.com**: for merchants in Europe.

**Note:**

Stay open to the possibility that gateway addresses might change.

### Step 3: Handle the payment result

The payment result can be synchronous notification, asynchronous notification, or both.

To handle the payment result notifications, you must:

1.  Process the payment result response or notification by verifying the signature of the notification.
2.  Return a receipt acknowledgment message to Alipay. This step is only required for asynchronous notification.

#### Verify the signature of the notification

The notification Alipay sends to the merchant is signed. The merchant needs to verify the signature to confirm whether the notification is sent from Alipay.

The following example shows typical notification headers and bodies.

Notification header:

copy

    "Content-Type": "application/json",
    "Request-Time": "2019-07-12T12:08:56.253+05:30",
    "client-id": "T_111222333",
    "Signature": "algorithm=RSA256,keyVersion=1,signature=jTOHqknjk%2fnDjEn8lfg%2beNODdoh2eHGJV%2blvrKaDwP782WxJ7ro49giqUu23MUM8sFVVNvhg32qHS3sd4O6uf5kAVLqztqNOPJFZcjw141EVi1vrs%2bIB4vU0%2fK%2f8z2GyWUByh2lHOWFsp%2b5QKCclXp%2bjacYqWYUur5IVbuebR1LoD5IiJ7u7J9qYriFxodkxmIAJYJyJs7mks2FWHh2YePLj3K%2f4B65idy7RBKqY1NN1XcvqnbQmlfCH8CIv75bg%2fr9sGmPE5a%2bYgL8N9Q41buGwMSq1IcNsbceMbyPhw5Z5HnJ7tPz12fvdSi0cEicPikDthQ2EQFmtpntXcAc%2fHA%3d%3d"

Notification body (for a successful payment that succeeds)：

copy

    {
        "notifyType": "PAYMENT_RESULT",
        "result": {
            "resultCode": "SUCCESS",
            "resultStatus": "S",
            "resultMessage": "success"
        },
        "paymentRequestId": "pay_test_1106_0002", //The unique ID that is assigned by a merchant to identify a payment request.
        "paymentId": "20200101234567890132", //The unique ID that is assigned by Alipay to identify a payment.
        "paymentAmount": { //The payment amount that merchant requests to receive in the order currency. 
            "value": "8000",
            "currency": "EUR"
        },
        "paymentCreateTime": "2020-01-01T12:01:00+08:30", //The date and time when the payment is created
        "paymentTime": "2020-01-01T12:01:01+08:30" //The date and time when the payment reaches a final state of success or failure
    }

Notification body (for a failed payment):

copy

    {
     "notifyType":"PAYMENT_RESULT",
     "result": {
        "resultCode":"USER_BALANCE_NOT_ENOUGH",
        "resultStatus":"F",
        "resultMessage":"user balance not enough"
     },
     "paymentRequestId":"pay_test_1106_0002", 
     "paymentId":"20200101234567890132"
    }

Based on the above notification header and body, the content to be verified is as follows:

copy

    POST {Use your notification address, such as /merchant/notify}
    T_111222333.2019-07-12T12:08:56+05:30.{"notifyType":"PAYMENT_RESULT","result":{"resultCode":"SUCCESS","resultStatus":"S","resultMessage":"success"},"paymentRequestId":"pay_test_1106_0002","paymentId":"20200101234567890132","paymentAmount":{"value":"8000","currency":"EUR"},"actualPaymentAmount":{"value":"8000","currency":"EUR"},"paymentCreateTime":"2020-01-01T12:01:00+08:30","paymentTime":"2020-01-01T12:01:01+08:30"}

#### Receive notifications

You can use notifications to automate business processes. To process notifications, you must:

1.  **Configure the server address to receive notifications.**

Configure the server address to receive notifications from Alipay on the Alipay Developer Platform or in the payment interface.

2.  **Accept notifications and acknowledge the notification with a required response.**

To ensure that your server is properly accepting notifications, Alipay requires you to acknowledge every notification with a **success** response.

3.  **Apply your business logic.**

If you use HTTPS to receive notifications, server certificates must be configured according to the authentication requirements.

**Acknowledge the notification with required response**

After the customer payment succeeds, Alipay sends a payment result notification to the merchant. The address that is used to receive the notification is specified when sending the payment request. After receiving the notification, the merchant must return a receipt acknowledgment message to Alipay.

If you do not reply to this notification, Alipay considers that the notification is not received and continues to send the notification. The response (a receipt acknowledgment message) sent to Alipay does not need to be signed.

**Note:**

Only after receiving the Alipay payment success results notification, the payment can be considered successful and the merchant can proceed with the purchase process, for example, deliver goods. Do not solely rely on the payment results page to determine whether the payment succeeds. The customer might have closed the result page before the result arrived, or maliciously-tampered information might be presented on the result page.

The following samples illustrate the response header and body that Merchant sends to Alipay:

Response header:

copy

    "Content-Type": "application/json",
    "response-time": "2019-07-12T12:08:56+05:30",
    "client-id": "T_111222333",

Response body:

copy

    {
     "result": {
        "resultCode":"SUCCESS",
        "resultStatus":"S",
        "resultMessage":"success"
     }
    }

Exceptional case
----------------

The customer pays successfully, but the merchant does not receive the payment result notification.

In this case, the customer completes the payment and money is deducted. However, the merchant does not receive the payment result notification. Therefore, the transaction failed.

**Possible reasons:**

*   After the payment of the customer reaches the final payment status (payment success or payment failure), Alipay does not notify the merchant in time.
*   Alipay notified the merchant, but the merchant did not get the payment result due to network reasons.

**Actions：**

The merchant is suggested to call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri) interface to query the payment status before the transaction closing time. If a successful payment status is obtained, proceed with the transaction. If no clear payment status is returned, continue to retry the query request. If a failed payment status is obtained, or the transaction times out, call [**cancel**](https://global.alipay.com/doc/ams/paymentc) interface to cancel the transaction.

**Note:**

The transaction closing time is determined by one of the following ways:

*   If the payment is not completed in time after the checkout page is presented, the transaction is to be closed by default.
*   The merchant can set the closing time by using the _paymentExpireTime_ parameter in the [**pay**](https://global.alipay.com/doc/ams/oc) interface, and the merchant can also call the [**cancel**](https://global.alipay.com/doc/ams/paymentc) interface to close the unpaid transaction or cancel the paid transaction.
*   If the merchant does not specify the _paymentExpireTime_ parameter, the transaction closing time defaults to the contract agreement.

More information
================

[Post-payment services](https://global.alipay.com/docs/ac/ams_oc/postpayment)

[Settlement and reconciliation](https://global.alipay.com/docs/ac/ams_oc/settlmt_recon)

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Use open SDKs](#2uykJ "Use open SDKs")

[API integration](#JOjOe "API integration")

[Initiate a payment request](#PZQej "Initiate a payment request")

[Step 1: Construct the request](#r4Bqa "Step 1: Construct the request")

[Step 2: Submit the payment request to Alipay](#DGQAR "Step 2: Submit the payment request to Alipay")

[Step 3: Handle the payment result](#tKgM7 "Step 3: Handle the payment result")

[Verify the signature of the notification](#4jBZl "Verify the signature of the notification")

[Receive notifications](#3tgpv "Receive notifications")

[Exceptional case](#HNtS8 "Exceptional case")

[More information](#jQGAA "More information")
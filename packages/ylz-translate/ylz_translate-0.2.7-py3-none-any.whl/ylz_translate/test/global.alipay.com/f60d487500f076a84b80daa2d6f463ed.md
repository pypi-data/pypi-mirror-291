iOS | EasySafePay | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Feasypay_en%2Fios_en)

[Go to Homepage](../../)

EasySafePay

[Overview](/docs/ac/easypay_en/overview_en)

Accept payments

After payments

iOS
===

In this topic, you'll learn how to integrate the SDK into an iOS client so that you can render cashier pages in a mobile application. The integration process is the same for the seamless experience and the redirection experience.

Prerequisites

Before integrating the SDK, ensure that you have completed the following tasks:

*   Install Xcode 12 or a higher version.
*   Use iOS 11 or a higher version.

Key integration steps

For first-time payments and subsequent payments, integrate the SDK by following these steps:

1

Import the SDK package

Client side

To integrate the SDK package, please refer to [Integrate the SDK Package](https://global.alipay.com/docs/ac/antom_sdk/ios_en).

2

Display available payment methods

Client side

Use the [tool](https://global.alipay.com/docs/ac/ref/brandasset) to obtain available payment methods, customize their logos, and display them on your cashier pages.

For first-time payments, we recommend you display the names and logos of available payment methods. For subsequent payments, we recommend you display the names and logos of these payment methods as well as the desensitized buyer account.

![Image 3: iOS](https://mdn.alipayobjects.com/huamei_1vxa1o/afts/img/A*MgHwQL2O1NUAAAAAAAAAAAAADjeBAQ/original)

3

Create an SDK instance by using the `AMSEasyPay` method:

Client side

*   Create an instance for cashier pages. The instance contains the following parameter:
    *   _configuration_: A required object belonging to the _AMSEasyPayConfiguration_ type. The object must contain all configuration parameters.
*   Create the `AMSEasyPayConfiguration` class, which must contain the following parameters:
    *   _locale_: An optional string, which is used by the merchant client to identify the language of the buyer's browser. Specify this parameter to ensure that the SDK displays pages in the correct language. The valid values are as follows. If any other values are passed, English will be used as the default language.
        *   `en_US`: English
        *   `in_ID`: Indonesian
        *   `th_TH`: Thai
        *   `ms_MY`: Malaysian
        *   `tl_PH`: Filipino
        *   `ko_KR`: Korean
        *   `vi_VN`: Vietnamese
        *   ​`zh_HK`: Traditional Chinese (Hong Kong, China)
    *   _options_: An optional parameter belonging to the _NSDictionary_ type. It is used to specify whether to use the default loading pattern and the sandbox environment. Valid values are:
        *   `"sandbox", "true"`: Sandbox environment
        *   `"sandbox", "false"`: Production enviroment
        *   `"showLoading", "true"`: Use the default loading pattern.
        *   `"showLoading", "false"`: Do not use the default loading pattern.
*   Create an instance of the **AMSPaymentProtocol** interface used for handling corresponding events in subsequent processes. It contains the following method:
    *   ​`onEventCallback`: A callback function that monitors payment events on the checkout page, returning _eventCode_ and _eventResult_.
*   Create an instance of the **AMSLoggerProtocol** interface used to manage log output. It contains the following method:
    *   ​`logWithName`: A callback function used to output logs by default.

Create an SDK instance:

Objective-C

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

#import <AMSComponent

    /AMSComponent-Swift.h>

AMSEasyPayConfiguration

    \*componentConfig \=

    \[AMSEasyPayConfiguration

    new\];

componentConfig.locale \=

    @"en\_US";

// Specify options to use the

    sandbox environment. If it

    is left empty, the

    production environment is

    used by default.

NSDictionary \*options \=

    @{@"showLoading": @"true",

    @"sandbox": @"true"};

componentConfig.options \=

    options;

\[\[AMSEasyPay shared\]

    initConfiguration

    :componentConfig\];

\[AMSEasyPay shared\]

    .paymentDelegate \= self;

\[AMSEasyPay shared\]

    .loggerDelegate \= self;

\[\[AMSEasyPay shared\]

    createComponent

    :paymentSessionData\];

#pragma AMSPaymentProtocol

\- (void)onEventCallback

    :(NSString \*)eventCode

    eventResult:(AMSEventResult

    \*)eventResult

{

NSLog(@"eventCode%@

        eventResult%@",

        eventCode, eventResult

        );

}

#pragma AMSLogProtocol

\- (void)logWithName:(NSString

    \*)name parameter

    :(NSDictionary<NSString

    \*,id\> \*)parameter

{

NSLog(@"name%@ parameter%@"

        , name, parameter);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

4

Send a [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) request to the Alipay server.

Server side

After the user selects the payment method and your client detects the payment button click event, your server sends a [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) request. Get the paymentSesssionData value from the createPaymentSession response and use it in Step 5.

For the first-time payment or subsequent payments, you need to specify different parameters when calling the **createPaymentSession** API:

**The first-time payment**

*   _paymentRedirectUrl_: The URL of the merchant result page. We recommend that you pass in a scheme URL or H5-scheme URL.
*   _authState_: The unique ID generated by the merchant to initiate an EasySafePay authorization. Specify this parameter to obtain an access token for future password-free payments.
*   _paymentNotifyUrl_: The URL that is used to receive the payment result notification. It must be an HTTPS URL.
*   _paymentSessionExpiryTime_: The date and time when the payment session expires. It defaults to 1 hour and must not exceed 1 hour. The value follows the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) standard format. For example, "2019-11-27T12:01:01+08:00".
*   _userLoginId_: The login ID that the user used to register in the wallet. The login ID can be the user's email address or phone number.
*   _order.buyer.referenceBuyerId/buyerPhoneNo/buyerEmail_: Pass in the buyer information for Alipay to provide risk control policies. Pass in one of the three parameters: _referenceBuyerId_, _buyerPhoneNo_, and _buyerEmail._

**The subsequent payments**

*   _paymentMethod.paymentMethodId_: Pass in _accessToken_ that you obtain from the **notifyAuthorization** API for the first-time payment.
*   _paymentRedirectUrl_: The URL of the merchant result page. We recommend that you pass in a scheme URL or H5-scheme URL.
*   _paymentNotifyUrl_: The URL that is used to receive the payment result notification. It must be an HTTPS URL.
*   _paymentSessionExpiryTime_: The date and time when the payment session expires. It defaults to 1 hour and must not exceed 1 hour. The value follows the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) standard format. For example, "2019-11-27T12:01:01+08:00".
*   _order.buyer.referenceBuyerId/buyerPhoneNo/buyerEmail_: Pass in the buyer information for Alipay to provide risk control policies. Pass in one of the three parameters: _referenceBuyerId_, _buyerPhoneNo_, and _buyerEmail._

First-time payment

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

{

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"productCode":

        "AGREEMENT\_PAYMENT",

"productScene": "EASY\_PAY",

"paymentNotifyUrl": "https

        ://www.yourNotifyUrl",

"paymentRequestId":

        "paymentRequestId001",

"paymentRedirectUrl":

        "https://www

        .yourMerchantWeb.com",

"paymentMethod": {

"paymentMethodType":

            "ALIPAY\_CN"

},

"agreementInfo": {

"authState":

            "authState001",

"userLoginId"

            :"userLoginId001"

},

"paymentAmount": {

"currency": "CNY",

"value": "100"

},

"order": {

"orderAmount": {

"currency": "CNY",

"value": "100"

},

"referenceOrderId":

            "referenceOrderId00

            1",

"orderDescription":

            "orderDescription00

            1",

"buyer":{

"referenceBuyerId"

              :"referenceBuyerI

              d001"

}

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Subsequent payment

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

{

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"productCode":

        "AGREEMENT\_PAYMENT",

"productScene": "EASY\_PAY",

"paymentNotifyUrl": "https

        ://www.yourNotifyUrl",

"paymentRequestId":

        "paymentRequestId002",

"paymentRedirectUrl":

        "https://www

        .yourMerchantWeb.com",

"paymentMethod": {

"paymentMethodId": "

            \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

            \*\*\*\*\*\*\*\*\*\*",

"paymentMethodType":

            "ALIPAY\_CN"

},

"paymentAmount": {

"currency": "CNY",

"value": "30000"

},

"order": {

"orderAmount": {

"currency": "CNY",

"value": "30000"

},

"referenceOrderId":

            "referenceOrderId00

            2",

"orderDescription":

            "orderDescription00

            2",

"buyer":{

"referenceBuyerId"

              :"referenceBuyerI

              d002"

}

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

5

Render the payment pages

Client side

Use the `createComponent` method in the configuration object.

1.  Create a configuration object by using the _sessionData_ parameter: Pass the _paymentSessionData_ value obtained in Step 4 to the _sessionData_ parameter of the `createComponent` method.
2.  Call the `createComponent()` method to initialize the SDK.

Call the `onDestroy()` method to free SDK component resources in the following situations:

*   When the user exits the checkout page, free the component resources created in the **createPaymentSession**.
*   When the user initiates multiple payments, free the component resources created in the previous **createPaymentSession**.

Use the createComponent method

Objective-C

1

2

3

4

\[\[AMSEasyPay shared\]

    createComponent:sessionData\]

    ;

//Free SDK components resources

\[\[AMSEasyPay shared\] onDestroy\];

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

6

Obtain an authorization result or a payment result

Server side

Regardless of a seamless experience or a redirection experience, you can obtain an authorization result and a payment result for first-time payments, and a payment result only for subsequent payments:

*   **Obtain an authorization result**  
    When the authorization is successful, Alipay sends you the asynchronous notification through the [**notifyAuthorization**](https://global.alipay.com/docs/ac/ams/notifyauth) notification. When you receive the notification, you must return a response as instructed in [Requirements](https://global.alipay.com/docs/ac/ams/paymentrn_online). Meanwhile, you must update the authorization status of the buyer in your system and display the buyer's desensitized account obtained from the notification on your authorization management page.
*   **Obtain a payment result**  
    When the payment reaches a final status of success or failure, Alipay sends an asynchronous notification through the [**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API to _paymentNotifyUrl_ that you pass through the [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) API. When you receive the notification from Alipay, you must return a response as instructed in [Requirements](https://global.alipay.com/docs/ac/ams/paymentrn_online).

**Note**: If you call the **[inquiryPayment](https://global.alipay.com/docs/ac/ams/paymentri_online)** API and the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API after the buyer abandons the payment, you might receive a response indicating that the order does not exist, and you might not receive an asynchronous notification of the payment failure as well. We recommend that you take the following actions:

For orders that you have actively closed:

*   If you receive a payment success notification from Alipay, no further action is needed.
*   If you receive a notification from Alipay with an unknown order status, call the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API to cancel the corresponding order.

For duplicate payments (one merchant order corresponds to multiple Alipay orders), if you have received multiple payment success notifications for Alipay orders, keep only one Alipay order with a successful result and cancel the rest of the Alipay orders by using the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API.

Event codes

The SDK provides the following status codes:

*   `SDK_START_OF_LOADING`: The loading animation starts to play during the payment component creation.
    
*   `SDK_END_OF_LOADING`: The loading animation ends during the payment component creation.
    
*   `SDK_PAYMENT_CANCEL`: The user cancels the payment on the account confirmation page or the large transaction confirmation page.
    

The SDK provides the following error codes:

*   `SDK_INTERNAL_ERROR`: The internal error of the SDK occurs. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_CREATEPAYMENT_PARAMETER_ERROR`: The parameters passed into the `AMSEasyPay` method are incorrect. Ensure the parameters are passed correctly and send a new request.
    
*   `SDK_CALL_URL_ERROR`: The payment method client failed to be revoked. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_INTEGRATION_ERROR`: Dependencies are not found. Ensure that the dependencies are added correctly and retry the integration process.
    

#### Is this page helpful?

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)
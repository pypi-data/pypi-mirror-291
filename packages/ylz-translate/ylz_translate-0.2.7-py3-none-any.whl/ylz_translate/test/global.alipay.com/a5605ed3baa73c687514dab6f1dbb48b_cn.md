iValidate | 服务与工具 | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)](/docs/)
[![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Ftool%2Fivalidate)  
[返回首页](../../)

服务与工具
----------

[沙箱环境](/docs/ac/tool/sandbox)  
[服务模拟](/docs/ac/tool/mocking)  
[iDiagnose](/docs/ac/tool/idiagnose)  
[iValidate](/docs/ac/tool/ivalidate)  
[密钥对生成与验证](/docs/ac/tool/key_pair)  
[小程序](/docs/ac/tool/miniapp)  

iValidate
---------

2020-10-16 20:56

什么是iValidate
----------------

iValidate是支付宝沙箱提供的一项功能，用于帮助检查您的集成过程的正确性，提升集成效率。通过对您在沙箱环境中调用API的日志进行分析，iValidate可以自动诊断您的集成是否满足支付宝的建议要求。

目前，iValidate支持以下**iValidate**场景。运行iValidate，可以检查您的系统是否正确处理了相应的场景。
### 店内支付  
#### 条形码支付  
案例-001 直接支付  
这是最常见的支付场景，通过扫描顾客的支付码，无需验证顾客的支付密码即可完成支付。通过运行iValidate测试，可以检查您的系统是否能正确处理无密码的支付。  
案例-002 24位条形码支付  
在处理支付时，部分支付宝用户可能会展示24位的条形码。通过运行iValidate测试，可以检查您的系统是否能正确处理24位的条形码支付。  
案例-003 密码验证支付  
有时支付宝用户可能需要输入密码来完成支付。通过运行iValidate测试，可以检查您的系统是否能正确处理需要密码的支付。  
案例-004 支付超时  
当支付宝用户在输入密码完成支付时选择不继续，支付可能会超时。这个测试案例用于检查您的系统是否能正确处理支付超时的情况。  
案例-005 支付失败，返回`SYSTEM_ERROR`  
当支付请求出错时，会返回`SYSTEM_ERROR`。这个测试案例用于检查系统是否能按照支付宝推荐的最佳实践处理`SYSTEM_ERROR`。  
案例-006 支付超时  
由于网络不佳或支付宝系统错误，支付请求可能会超时。这个测试案例用于检查系统是否能按照支付宝推荐的最佳实践处理超时错误。  
案例-007 多次尝试后取消成功  
如果取消操作失败，商家必须持续调用CANCEL直到取消成功。这个测试案例模拟了多次尝试后最终取消成功的情景。  
案例-008 多次尝试后取消失败
当取消操作失败时，商家必须持续调用CANCEL，直到收到超过3次的FAIL响应，或者在10秒内连续取消请求失败。如果取消仍然失败，必须通知相关责任人。在生产环境中，应联系技术支持以确认交易状态并解决问题。

案例-009：多次尝试后查询成功
当查询失败时，商家必须持续调用QUERY，直到查询成功。这个测试案例模拟了多次尝试后最终取消成功的情况。

案例-010：多次尝试后查询失败
当查询失败时，商家必须持续调用QUERY，直到收到超过3次的FAIL响应，或者在10秒内连续请求失败。如果查询仍然失败，必须通知相关责任人。在生产环境中，应联系技术支持以确认交易状态并解决问题。

#### 商家二维码

案例-001：支付成功后的异步通知处理
支付宝在支付成功后向商家发送异步通知。收到通知后，异步通知页面（`notify_url`）必须打印"success"（不带引号）。这个测试案例检查商家系统是否能正确处理异步通知。

#### 交易二维码

案例-001：成功支付
这个测试案例验证商家系统在顾客扫描交易二维码并成功支付的场景下，是否能正确处理交易。

案例-002：取消支付
这个测试案例验证商家系统在生成交易二维码但顾客未支付的情况下，是否能正确处理交易。

案例-003：交易二维码刷新
这个测试案例检查商家系统在交易二维码被刷新后，是否能正确处理新的交易请求。
此测试用例旨在验证商家系统在客户付款前，电子收款机（ECR）刷新交易二维码时，是否能正确处理交易。  
案例-004：多次尝试后取消成功  
当取消操作失败时，商家必须持续调用CANCEL，直到取消成功。这个测试案例模拟了多次尝试后最终取消成功的情景。  
案例-005：多次尝试后取消失败  
当取消失败时，商家必须持续调用CANCEL，直到收到超过3次的失败响应，或在超过10秒的时间内取消请求持续失败。如果取消仍然失败，必须通知相关人员问题的存在。在生产环境中，应联系技术支持以确认交易状态并处理问题。  

#### 第三方二维码（创建接口）  
案例-001：成功支付  
此测试用例用于验证商家系统在调用第三方商家二维码支付解决方案的创建接口后，当客户成功支付时，是否能正确处理交易。  
案例-002：已取消支付  
此测试用例用于验证商家系统在调用第三方商家二维码支付解决方案的创建接口后，当客户未能支付时，是否能正确处理交易。  
案例-003：多次尝试后取消成功  
当取消失败时，商家必须持续调用CANCEL，直到取消成功。这个测试案例模拟了多次尝试后最终取消成功的情景。  
案例-004：多次尝试后取消失败
当取消操作失败时，商家必须持续调用CANCEL接口，直到收到超过3次的失败响应，或者在10秒内取消请求持续失败。如果取消仍然失败，必须通知负责人问题的存在。在生产环境中，应联系技术支持以确认交易状态并处理问题。

#### 第三方二维码（预创建接口）

Case-001 成功支付  
这个测试用例旨在验证商家系统在调用第三方商家二维码支付解决方案的创建接口后，能否在顾客成功支付时正确处理交易。

Case-002 支付取消  
这个测试用例旨在验证商家系统在调用第三方商家二维码支付解决方案的创建接口后，能否在顾客支付失败时正确处理交易。

Case-003 多次尝试后取消成功  
当取消失败时，商家必须持续调用CANCEL，直到取消成功。这个测试用例模拟了多次尝试后最终取消成功的情况。

Case-004 多次尝试后取消失败  
当取消失败时，商家必须持续调用CANCEL，直到收到超过3次的失败响应，或在10秒内取消请求持续失败。如果取消仍然失败，必须通知负责人问题，并在生产环境中联系技术支持以确认交易状态并解决问题。
### 在线支付  
#### 网站支付  
案例-001 支付成功  
此测试案例旨在检查传递给 `create_forex_trade` 接口的参数是否符合金融监管要求。  
#### 手机网页支付  
案例-001 支付成功  
此测试案例旨在检查传递给 `create_forex_trade_wap` 接口的参数是否符合金融监管要求。  
#### 应用支付  
案例-001 支付成功  
此测试案例旨在检查传递给 `mobile.securitypay.pay` 接口的参数是否符合金融监管要求。  
如何使用 iValidate  
----------------  
在使用 iValidate 之前，您必须拥有一个支付宝商户账户。如果没有，可以访问 [支付宝门户](https://global.alipay.com/) 进行注册。要使用 iValidate 功能，详情请参考 [iValidate 指南](https://global.alipay.com/doc/tool/ivalidate)。  
以下视频解释了如何创建支付宝商户账户：  
iValidate 指南  
---------------  
目前，支付宝沙箱提供了 5 个测试场景。请按照以下逐步指南进行操作：

每个场景中使用 iValidate 的流程类似。我们以条码支付中的案例-001 直接支付为例进行说明。  
**场景描述**  
此测试案例适用于通过扫描客户的支付码并由扫描器完成支付，无需验证客户支付密码的场景。收银终端显示支付成功状态，且支付凭证（如有）能够成功打印。  
**集成测试目标**  
实现集成测试，以检查您的系统是否满足以下两个条件：  
1. 交易在支付宝服务器上的状态为 `TRADE_SUCCESS`。  
2. 请求消息中传递了 `store_id` 和 `secondary_merchant_id` 参数。  
**集成测试步骤**
1. 请保持复选框未选中，以确认已关闭密码验证开关，然后点击**下一步**。![](https://cdn.nlark.com/yuque/0/2020/png/561635/1588927004401-3eff0fdc-911d-4ac6-b915-ab10b17aed6c.png)  
2. 从您的收银终端创建支付请求，使用扫描器扫描测试买家账户的支付码，并成功完成支付。  
3. 确保收银终端上显示的支付状态为成功，如果有的话，支付收据可以正确打印，然后点击**下一步**。![](https://cdn.nlark.com/yuque/0/2020/png/561635/1588927004607-21f82f10-81f8-41ca-983c-fe9c17390389.png)  
4. 填写交易的`partner_trans_id`，然后点击**检查**。iValidate函数将分析并检查您的交易请求和数据状态。![](https://cdn.nlark.com/yuque/0/2020/png/561635/1588927005017-7917a976-d8c3-4cab-b4ab-2355d75c1c7f.png)  
5. iValidate函数收集相关数据，进行相应的计算，最终给出测试结果。
   a. 如果结果为**案例通过**，这意味着您的集成系统满足了集成测试目标。![](https://cdn.nlark.com/yuque/0/2020/png/561635/1588927005200-481761d0-e23d-40e2-bf98-6d72c748fd2a.png)  
   b. 如果**实际结果**为**未找到**，请参考屏幕上的**建议**进行相应修改。![](https://cdn.nlark.com/yuque/0/2020/png/561635/1588927005574-7510deb6-a027-4885-bf74-10b6492a5365.png)  
要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。  
![](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)
@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  
#### 本页面是否有帮助？  
#### 在此页面上  
[什么是iValidate](#9CECD "什么是iValidate")  
[店内支付](#YFOnY "店内支付")  
[条形码支付](#wkrLn "条形码支付")  
[商家二维码支付](#8kFZg "商家二维码支付")  
[交易二维码支付](#KbmIl "交易二维码支付")  
[第三方二维码（创建接口）](#02SBF "第三方二维码（创建接口）")  
[第三方二维码（预创建接口）](#BciKU "第三方二维码（预创建接口）")  
[在线支付](#1unil "在线支付")  
[网站支付](#I2Jh6 "网站支付")  
[Wap支付](#BiRn8 "Wap支付")  
[应用支付](#qRNDI "应用支付")  
[如何使用iValidate](#z87vb "如何使用iValidate")  
[iValidate使用指南](#vamRI "iValidate使用指南")
授权支付 | 结账支付 | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg) ![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fapi)  
[返回首页](../../)

结账支付
[概览](/docs/ac/cashierpay/overview)  
接收支付  
支付后操作  
支付方式  
其他资源  
高级功能  
[预前端解决方案API](/docs/ac/cashierpay/prefront)  
[先买后付API](/docs/ac/cashierpay/bnpl)  
[卡存储API](/docs/ac/cashierpay/cv)  
[卡存储SDK](/docs/ac/cashierpay/cvsdk)  
[卡支付功能API/SDK](/docs/ac/cashierpay/mf)  

授权支付
=====================  
2024-04-03 02:01  
API集成介绍如何通过API发起授权支付。  

发起授权支付请求
====================================  
当买家点击支付按钮后，您需要调用[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 来发起卡支付的授权。请按照以下指示操作：

1.  买家点击支付后，应禁用支付按钮，直到收到API结果，以防止用户重复操作。
2.  您可以通过以下两种方式收集卡信息并发起授权支付：

    *   **服务器到服务器模式**：此模式要求您符合PCI资格。
    *   **托管支付页面模式**：此模式不需要您符合PCI资格。
*   根据您的业务需求，您也可以选择使用[更多功能](https://global.alipay.com/docs/ac/card_en/features_en)来发起授权支付。
*   在发起授权支付时，您可以选择自动扣款或手动扣款模式。默认模式为自动扣款。
*   **自动扣款**：当满足以下任一条件时，蚂蚁金服会在授权成功后立即自动扣款：
    *   在**pay** API中，您将_paymentFactor.captureMode_的值设置为`AUTOMATIC`。
    *   在**pay** API中，您未设置_paymentFactor.captureMode_的值，或者没有传递此参数。
*   **手动扣款**：在授权成功后，您需要通过调用[**capture**](https://global.alipay.com/docs/ac/ams/capture) API来手动发起资金扣款。在**pay** API中，您必须将_paymentFactor.captureMode_的值设置为`MANUAL`。
**服务器到服务器模式**
----------------------
服务器到服务器的支付模式允许您通过从您的服务器向蚂蚁金服服务器发送请求来处理交易。在该集成模式下，您需要提供所有用户信息，包括卡支付信息。
### 集成前提条件
服务器到服务器的集成模式要求您已通过PCI资格认证。根据业务需求，提供以下材料完成验证：

1. 如果您预计年信用卡交易量将超过600万，需填写并提交[PCI 合规性确认书（AoC）](https://docs-prv.pcisecuritystandards.org/PCI%20DSS/Reporting%20Template%20or%20Form/PCI-DSS-v4-0-ROC-AOC-Merchants-r1.pdf)文件进行验证。
2. 如果您预计年信用卡交易量将低于600万，需填写并提交[PCI DSS 自我评估问卷（SAQs）](https://docs-prv.pcisecuritystandards.org/SAQ%20\(Assessment\)/SAQ/PCI-DSS-v4-0-SAQ-D-Merchant-r1.pdf)文件进行验证。

有关PCI DSS合规性要求的更多信息，请参阅[PCI DSS 标准](https://www.pcisecuritystandards.org/)。
### 集成步骤  
在服务器到服务器模式下，按照以下步骤完成授权支付：  
1.  当买家选择汽车支付方式后，显示买家的卡片信息收集页面（此页面由您开发）。在这个过程中，您需要收集用户的卡片信息、环境信息和订单信息。
2.  调用**pay** API 以请求授权支付。
3.  处理**pay** API 的响应。响应中可能包含授权支付的结果。有关如何处理响应的更多信息，请参阅[获取授权结果](#mBm6Q)。
4.  向买家显示授权支付的结果。  
![图片 3: 6@3x.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685426473121-3319f210-229e-494b-8f0c-1c64595cf133.png)  
图1. 授权支付的交互过程（服务器到服务器模式）
### 用户体验  
首次支付（网页版）  
首次支付（应用程序版）  
已保存卡片支付（网页版）  
已保存卡片支付（应用程序版）  

![图片4: 1.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429197523-9c7fb7f1-e1e6-4e0e-b83e-96fcc7c7166f.png)  
![图片5: 2.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429205246-0114b15a-c473-48f4-9a60-2d54d36c9d15.png)  
![图片6: 3.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429174133-3555ff5d-3709-4ac6-9a83-9e86e9f0806f.png)  
![图片7: 4.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429181502-d631e27d-fabd-40fc-b23d-011917e459cc.png)  

请注意，这些图片似乎展示的是支付流程的不同阶段，但没有具体的上下文说明。在蚂蚁金服的环境中，这些可能代表用户在使用支付宝或其他相关金融服务时进行支付的界面截图。例如，首次支付可能涉及用户输入支付信息，而保存的卡片支付则可能是一个快速支付选项，用户无需每次都输入卡片详情。
### API 调用
在调用 [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 时，需要提供以下信息：

| **卡片信息** | **环境信息：用于提高支付成功率** | **订单信息：用于降低支付拒绝和卡片盗用率** |
| --- | --- | --- |
| cardNo<br>cvv<br>expiryYear<br>expiryMonth<br>cardholderName<br>billingAddress... | browserInfo<br>clientIp<br>terminalType | goods<br>shipping<br>buyer |

表1. 需要收集的卡片信息

在调用 **pay** API 时，还可以根据业务需求选择使用以下功能：

*   **启用3D验证**：在 **pay** API 中设置 _is3DSAuthentication_ 参数，以确定交易是否通过3D Secure进行验证。
*   **智能挽救交易**：如果发卡行要求，自动对非3D Secure交易发起3D Secure验证，以挽救失败的交易。通过在 **pay** API 中设置 _enableAuthenticationUpgrade_ 参数启用此功能。
*   **增值风险控制服务**：Antom 提供交易级别的升级风险控制服务，根据交易的风险级别智能决定风险控制策略。
*   **地址验证系统（AVS）服务**：此服务验证提供的账单地址是否与发卡行记录中的持卡人地址匹配。AVS 有助于防止欺诈交易。
*   **存储卡片信息**：在首次支付时获取买家同意存储卡片信息，以便下次支付时无需再次输入卡片信息。
*   **商户发起交易（MIT）**：在用户参与的情况下发起计划或非计划的交易。
*   **指定卡品牌**：对于双品牌卡支付，指定授权时使用的卡品牌或地区。
*   **商家插件(MPI)**: 如果买家在支付前通过第三方认证机构完成了3D Secure验证，调用**pay** API时需传递3D Secure验证结果。此功能仅在您收集了买家的卡信息时可用。
*   **分期付款**: 在支付时，买家可以选择分期付款方式，每期按约定还款。买家完成首期付款后，蚂蚁金服将根据合同中指定的结算周期结算全单金额。
  
  更多功能的使用详情，请参阅[更多特性](https://global.alipay.com/docs/ac/card_en/features_en)。
  
  **pay** API 的请求示例：
  
  ```
  {
    "env": {
      "browserInfo": {
        "acceptHeader": "*/*",
        "javaEnabled": true,
        "javaScriptEnabled": true,
        "language": "zh_CN",
        "userAgent": "Chrome/100"
      },
      "terminalType": "APP",
      "clientIp": "112.80.248.78",
      "deviceId": "eYOIkvFpZzztgO0Yu6USdprBQZCWxDhiUAHCiK8K/cH9mT6wMaMOzAKe",
      "osType": "IOS",
      "deviceLanguage": "zh_CN",
      "colorDepth": 48,
      "screenHeight": 768,
      "screenWidth": 1024,
      "timeZoneOffset": 1
    },
    "order": {
      "orderAmount": {
        "currency": "EUR",
        "value": "30000"
      },
      "orderDescription": "Cappuccino #grande (Mika's coffee shop)",
      "referenceOrderId": "ORDER_20221114141714891",
      "goods": [
        {
          "referenceGoodsId": "383382011_SGAMZ-904520356",
          "goodsName": "[3 盒] 星巴克卡布奇诺牛奶咖啡胶囊/咖啡胶囊，由Nescafe Dolce Gusto提供",
          "goodsUrl": "https://www.lazada.sg/products/3-boxes-starbucks-cappuccino-milk-coffee-pods-coffee-capsules-by-nescafe-dolce-gusto-i383382011-s904520356.html?clickTrackInfo=undefined&search=1&source=search&spm=a2o42.searchlist.list.3",
          "goodsCategory": "数字商品/数字礼券/食品饮料",
          "goodsUnitAmount": {
            "currency": "EUR",
            "value": "30000"
          },
          "goodsQuantity": "10"
        }
      ],
      "shipping": {
        "shippingName": {
          "firstName": "Dehua",
```
"lastName": "刘",
"fullName": "刘德华·斯科",
"middleName": "斯科"
},
"shippingAddress": {
"zipCode": "310000",
"address2": "西湖",
"city": "杭州",
"address1": "武昌路",
"state": "浙江",
"region": "中国"
},
"shippingCarrier": "FedEx",
"shippingPhoneNo": "12345678912",
"shipToEmail": "test@gmail.com"
},
"buyer": {
"referenceBuyerId": "test12345678",
"buyerPhoneNo": "12345678912",
"buyerEmail": "alipay@alipay.com",
"buyerName": {
"firstName": "德华",
"lastName": "刘",
"fullName": "刘德华·斯科",
"middleName": "斯科"
}
}
},
"paymentAmount": {
"currency": "EUR",
"value": "30000"
},
"paymentMethod": {
"paymentMethodType": "CARD",
"paymentMethodMetaData": {
"isCardOnFile": false,
"enableAuthenticationUpgrade": true,
"is3DSAuthentication": false,
"cvv": "850",
"cardholderName": {
"firstName": "Tom",
"lastName": "Jay"
},
"expiryMonth": "12",
"billingAddress": {
"zipCode": "310000",
"address2": "西湖",
"city": "杭州",
"address1": "武昌路",
"state": "浙江",
"region": "中国"
},
"expiryYear": "29",
"cardNo": "4117347806156383"
}
},
"settlementStrategy": {
"settlementCurrency": "EUR"
},
"paymentNotifyUrl": "https://www.alipay.com/notify",
"paymentRedirectUrl": "https://www.alipay.com",
"paymentRequestId": "PAY_20221114141714891",
"productCode": "CASHIER_PAYMENT",
"paymentFactor": {
"isAuthorization": true
}
}  
**托管支付页面模式**
------------------------
托管支付页面模式保护您免受PCI-DSS合规性的限制，因为敏感信息（如卡号和密码）不会通过您的服务器传输，因此不需要PCI资格。在这种模式下，蚂蚁金服提供支付信息收集页面，收集支付信息，然后将这些信息存储为卡令牌（_cardToken_），以便于后续支付。
蚂蚁金服为韩国信用卡产品提供了发行商认证和非认证卡支付类型。大多数韩国信用卡的支付产品和非认证支付遵循通用的卡支付流程。然而，韩国信用卡的发行商认证支付场景涉及额外的步骤。根据您想要集成的卡类型，选择合适的集成流程。
### 集成步骤  
一般信用卡支付场景  
韩国卡片发卡行认证场景  
在托管支付页面模式下，按照以下步骤完成授权支付：  
1.  买家选择信用卡支付方式并去支付。
2.  调用**pay** API 提交授权支付请求。API 请求中不包含卡片信息。
3.  Antom 收到 API 调用请求后，返回一个卡片信息收集页面，供买家输入卡片信息。
4.  前端打开一个中间页面，显示卡片信息收集页面给买家。
5.  买家输入完整的支付信息后，Antom 验证支付信息。验证成功后，Antom 使用存储为令牌（_cardToken_）的支付信息处理 API 调用，并向卡片发卡行提交授权支付请求。
6.  处理**pay** API 的响应。响应中可能包含授权支付的结果。有关如何处理响应的更多信息，请参阅[获取授权结果](#mBm6Q)。
7.  向买家显示授权支付的结果。  
![Image 8: 7@3x.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685426496290-aa944a21-9cb2-4f1a-8672-abe46260eddb.png)  
.SENDPAYREQUEST，不包括卡片信息  
显示卡片信息收集页面  
商户客户端  
1.  买家选择卡片并去支付  
商户服务器  
5.  买家输入卡片信息  
信息收集页面  
7.  显示支付结果  
6.  返回支付结果  
3.  返回卡片信息页面URL  
支付宝  
图2. 授权支付的交互过程（一般信用卡支付场景）  
在这个场景中，按照以下步骤发起并完成授权支付：  
1.  买家选择商品并去支付。
2.  调用**consult** API 获取可用的支付方式和卡片品牌。（可选）
3. 显示可用的支付方式。（可选）
4. 买家选择特定的卡品牌并点击支付按钮。
5. 调用**pay** API，提交授权支付请求。（包含卡品牌信息）
6. 蚂蚁金服收到API调用请求后，返回指定卡品牌支付页面。
7. 前端打开一个中间页面，向买家展示支付页面。
8. 买家完成支付后，会重定向到商家页面。您可以通过异步通知获取相应的授权支付结果，或通过**inquiryPayment** API 查询授权结果。
![图2：image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712027500635-9fe91dc2-a532-4c71-8fc7-c24f5eac27c7.png)  
图2. 授权支付的交互过程（韩国卡片发卡行验证场景）
### 用户体验  
以下是一般信用卡支付场景中的用户体验流程。  
**首次支付（Web）**  
**首次支付（App）**  
**已保存卡片支付（Web）**  
**已保存卡片支付（App）**  
![图片10: 11.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429337825-325dcb70-347f-4378-a387-8b3854408f4f.png)  
![图片11: 22.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429349262-4768c667-9bdc-4106-8a5b-5b25f0bb1be9.png)  
![图片12: 33.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429356894-19d2eb56-1bae-4a31-bf27-c8df21ac37fd.png)  
![图片13: 44.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685429363815-9bbfc950-6e21-4ea4-84ea-9800b3019c7d.png)  
对于韩国卡片的发卡行认证用户体验，参见[发卡行认证支付](https://global.alipay.com/docs/ac/antomop/koreancards#8PDSz)。
### API 调用
#### 通用信用卡支付场景
#### 韩国卡发卡行认证场景
调用 [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 时，需要提供以下信息：
| **环境信息：提高支付成功率** | **订单信息：降低支付拒绝和卡片盗用率** |
| --- | --- |
| terminalType | goodsshippingbuyer |

#### 需要收集的信息
调用 **pay** API 时，还可以根据业务需求选择使用以下功能：
*   **启用 3D 认证**：在 **pay** API 中设置 _is3DSAuthentication_ 参数，以确定交易是否通过 3D Secure 进行认证。
*   **智能挽救交易**：如果发卡行要求，自动对非 3D Secure 交易发起 3D Secure 认证，以挽救失败的交易。通过在 **pay** API 中设置 _enableAuthenticationUpgrate_ 参数启用此功能。
*   **增值风险控制服务**：Antom 提供交易级别的升级风险控制服务，根据交易的风险级别智能决定风险控制策略。
*   **地址验证系统 (AVS) 服务**：此服务验证提供的账单地址是否与发卡行记录中的持卡人地址匹配。AVS 有助于防止欺诈交易。
*   **存储卡信息**：在首次支付时获取买家同意存储卡信息，以便下次支付时无需再次输入卡信息。
*   **商家发起的交易 (MIT)**：在没有用户参与的情况下发起计划或非计划的交易。
*   **分期付款**: 在支付时，买家可以选择分期付款方式，每期按固定周期进行还款。买家完成首期付款后，Antom会根据合同中指定的结算周期结算全单金额。
有关如何使用更多功能的详细信息，请参阅[更多功能](https://global.alipay.com/docs/ac/card_en/features_en)。
**pay** API 的请求示例:
```
{
"env": {
"terminalType": "APP",
"clientIp": "112.80.248.78",
"deviceId": "eYOIkvFpZzztgO0Yu6USdprBQZCWxDhiUAHCiK8K/cH9mT6wMaMOzAKe",
"osType": "IOS",
"deviceLanguage": "zh_CN"
},
"order": {
"orderAmount": {
"currency": "EUR",
"value": "30000"
},
"orderDescription": "Cappuccino #grande (Mika's coffee shop)",
"referenceOrderId": "ORDER_20221114141714891",
"goods": [
{
"referenceGoodsId": "383382011_SGAMZ-904520356",
"goodsName": "[3 Boxes] Starbucks Cappuccino Milk Coffee Pods / Coffee Capsules by Nescafe Dolce Gusto",
"goodsUrl": "https://www.lazada.sg/products/3-boxes-starbucks-cappuccino-milk-coffee-pods-coffee-capsules-by-nescafe-dolce-gusto-i383382011-s904520356.html?clickTrackInfo=undefined&search=1&source=search&spm=a2o42.searchlist.list.3",
"goodsCategory": "Digital Goods/Digital Vouchers/Food and Beverages",
"goodsUnitAmount": {
"currency": "EUR",
"value": "30000"
},
"goodsQuantity": "10"
}
],
"shipping": {
"shippingName": {
"firstName": "Dehua",
"lastName": "Liu",
"fullName": "Dehua Skr Liu",
"middleName": "Skr"
},
"shippingAddress": {
"zipCode": "310000",
"address2": "Xihu",
"city": "Hangzhou",
"address1": "Wuchang road",
"state": "Zhejiang",
"region": "CN"
},
"shippingCarrier": "FedEx",
"shippingPhoneNo": "12345678912",
"shipToEmail": "test@gmail.com"
},
"buyer": {
"referenceBuyerId": "test12345678",
"buyerPhoneNo": "12345678912",
"buyerEmail": "alipay@alipay.com",
"buyerName": {
"firstName": "Dehua",
"lastName": "Liu",
"fullName": "Dehua Skr Liu",
```

请注意，这个示例中的内容是关于一个支付请求的，包括了订单金额、商品详情、收货人信息和买家信息等。请求中使用了欧元作为货币单位，并且提到了一个具体的商品，即星巴克Cappuccino咖啡胶囊。此外，还包含了收货地址、运输方式（FedEx）以及买家的联系方式等信息。
"requireIssuerAuthentication": true //Require issuer authentication
}
},
"settlementStrategy": {
"settlementCurrency": "KRW"
},
"paymentNotifyUrl": "https://www.example.com/notify",
"paymentRedirectUrl": "https://www.example.com/redirect",
"paymentRequestId": "PAY_20221114141714891",
"productCode": "CASHIER_PAYMENT",
"paymentFactor": {
"isAuthorization": true
}
}
}

在买家首次使用卡支付并保存卡片后，后续支付时需要通过**pay** API 的 `paymentMethod.paymentMethodId` 参数传递获取到的 `_cardToken` 信息。_cardToken_ 可以通过以下方式获取：

1.  接收异步通知（**notifyPayment**）：_cardToken_ 在通知中的 `cardInfo` 对象里。
2.  调用 **inquiryPayment** API：_cardToken_ 在 **inquiryPayment** API 返回的 `cardInfo` 对象中。

调用 **pay** API 时，需要在支付请求中指定以下信息：

1.  设置 `selectedCardBrand` 参数为具体的卡品牌，可参考 [卡品牌列表](https://global.alipay.com/docs/ac/ref/payment_method#ZfyuE)。
2.  设置 `requireIssuerAuthentication` 参数为 `true`。

**pay** API 的请求示例：

```json
{
  "order": {
    "orderAmount": {
      "currency": "KRW",
      "value": "30000"
    },
    "orderDescription": "Cappuccino #grande (Mika's coffee shop)",
    "referenceOrderId": "ORDER_20221114141714891",
    "buyer": {
      "buyerEmail": "alipay@alipay.com",
      "referenceBuyerId": "test12345678"
    }
  },
  "env": {
    "terminalType": "WEB",
    "clientIp": "112.80.248.78",
    "deviceId": "eYOIkvFpZzztgO0Yu6USdprBQZCWxDhiUAHCiK8K/cH9mT6wMaMOzAKe",
    "deviceLanguage": "zh_CN"
  },
  "paymentAmount": {
    "currency": "KRW",
    "value": "30000"
  },
  "paymentMethod": {
    "paymentMethodType": "CARD",
    "paymentMethodMetaData": {
      "selectedCardBrand": "SAMSUNG", // 指定卡品牌
      "requireIssuerAuthentication": true // 需要发卡行认证
    }
  },
  "settlementStrategy": {
    "settlementCurrency": "KRW"
  },
  "paymentNotifyUrl": "https://www.example.com/notify",
  "paymentRedirectUrl": "https://www.example.com/redirect",
  "paymentRequestId": "PAY_20221114141714891",
  "productCode": "CASHIER_PAYMENT",
  "paymentFactor": {
    "isAuthorization": true
  }
}
```
设置发行方认证
----------------

```json
{
  "requireIssuerAuthentication": true, // 指定需要发行方认证的支付
}
```

结算策略
------------

```json
"settlementStrategy": {
  "settlementCurrency": "USD" // 结算货币为美元
},
```

支付通知和重定向URL
-----------------------

```json
"paymentNotifyUrl": "https://www.alipay.com/notify", // 支付通知URL
"paymentRedirectUrl": "https://www.alipay.com", // 支付重定向URL
"paymentRequestId": "PAY_20221114141714891", // 支付请求ID
"productCode": "CASHIER_PAYMENT", // 产品代码，例如：收银台支付
"paymentFactor": {
  "isAuthorization": true, // 是否为授权支付
  "captureMode": "MANUAL" // 如果指定，将为手动授权，否则为自动授权
}
```

获取授权结果
================

调用**pay** API后，Antom返回响应中的_resultStatus_参数值表示交易的授权支付结果。

![Image 14: 8@3x.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1685426516848-d4229e66-2523-4b51-a83a-438825104fe8.png)

图3. 响应中_resultStatus_的描述

-   `S` (_resultStatus_): 授权支付成功。
-   `F` (_resultStatus_): 授权支付失败。可以更改_paymentRequestID_并重新发起支付请求。
-   `U` (_resultStatus_) 和 `PAYMENT_IN_PROCESS` (_resultCode_): 授权支付进行中，买家需要被重定向到_normalUrl_参数指定的URL完成授权支付。可以通过异步通知获取授权支付结果或通过**inquiryPayment**查询。
-   无响应: 可以更改_paymentRequestID_或使用原始请求ID重试支付请求。

**注意事项**:

-   在一般信用卡支付场景中，**pay** API返回的_resultStatus_参数值只能为`F`或`U`。
-   在韩国卡片的发行方认证场景中，**pay** API返回的_resultStatus_参数值可能为`F`、`U`或无响应。
以下代码示例展示了调用**支付** API 后可能收到的响应。响应可能包括成功授权支付、失败授权支付或正在进行授权支付的重定向 URL 的信息：

**成功授权支付**
```json
{
  "paymentAmount": {
    "currency": "EUR",
    "value": "1314"
  },
  "paymentCreateTime": "2021-11-12T01:27:50-08:00",
  "paymentId": "20211112194010800100188570271832381",
  "paymentRequestId": "PAY_20211112172747856",
  "paymentResultInfo": {
    "avsResultRaw": "A",
    "cvvResultRaw": "Y",
    "networkTransactionId": "sampleNetworkTransactionId123456"
  },
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```

**失败授权支付**
```json
{
  "paymentAmount": {
    "currency": "EUR",
    "value": "1314"
  },
  "paymentCreateTime": "2021-11-12T01:27:50-08:00",
  "paymentId": "20211112194010800100188570271832381",
  "paymentRequestId": "PAY_20211112172747856",
  "paymentResultInfo": {
    "avsResultRaw": "A",
    "cvvResultRaw": "Y",
    "networkTransactionId": "sampleNetworkTransactionId123456"
  },
  "result": {
    "resultCode": "ACCESS_DENIED",
    "resultMessage": "Access is denied.",
    "resultStatus": "F"
  }
}
```

**正在进行的授权支付（重定向 URL）**
```json
{
  "normalUrl": "https://pgw-ui.2c2p.com/payment/4.1/ant/#/token/kSAops9Zwhos8hSTSeLTUchuUa9%2bFg0EHv0XtS%2bTyCt8%2f1qy%2fDZCW88dV9FH3Yh8pEobKvOj%2fsh6nbH95mDRORzWy%2bsBbFh541I7QzVolYBEzeYnLiTC6lP2hjCAwadc",
  "paymentActionForm": "{\"method\":\"GET\",\"paymentActionFormType\":\"RedirectActionForm\",\"redirectUrl\":\"https://api.tosspayments.com/v1/payments/01OAv2P6yqLlDJaYngro1AWJ1bKaDn3ezGdRpXxKN7BQMEk4/checkout\"}",
  "paymentAmount": {
    "currency": "KRW",
    "value": "30000"
  },
  "paymentCreateTime": "2024-03-18T19:44:15-07:00",
  "paymentId": "2020010123456789XXXX",
  "paymentRequestId": "PAY_20211112172747856",
  "paymentResultInfo": {
    "avsResultRaw": "",
    "cvvResultRaw": "",
    "threeDSResult": {
      "cavv": "",
      "eci": ""
    }
  },
  "redirectActionForm": {
    // ...
  }
}
```

请注意，最后一个示例中的 `redirectActionForm` 字段表示需要重定向到指定 URL 进行后续支付操作。
"方法": "GET",
"重定向URL": "https://pgw-ui.2c2p.com/payment/4.1/ant/#/token/kSAops9Zwhos8hSTSeLTUchuUa9%2bFg0EHv0XtS%2bTyCt8%2f1qy%2fDZCW88dV9FH3Yh8pEobKvOj%2fsh6nbH95mDRORzWy%2bsBbFh541I7QzVolYBEzeYnLiTC6lP2hjCAwadc"
},
"结果": {
"结果代码": "PAYMENT_IN_PROCESS",
"结果信息": "支付处理中",
"结果状态": "U"
}
}  
当支付完成后，Antom（可能是笔误，应为蚂蚁金服）会向您发送异步通知，您也可以通过[**查询支付**](https://global.alipay.com/docs/ac/ams/paymentri_online)API获取授权支付的结果。  
**接收异步通知**  
您可以通过接收Antom发送的异步通知来获取授权结果。在能够接收异步通知之前，您必须设置一个通知地址。当最终的授权状态确定（即，授权成功或失败）时，Antom会通过[**支付通知**](https://global.alipay.com/docs/ac/ams/paymentrn_online)发送异步通知。收到通知后，您必须按照[要求](https://global.alipay.com/docs/ac/ams/paymentrn_online#Responseparameters)返回响应。否则，Antom会重发通知，直到收到正确的响应。  
**查询授权结果**  
由于网络问题，异步通知可能无法送达或延迟。因此，我们建议您主动通过**查询支付**API查询交易状态。您可以在以下场景设置主动查询：  
*   **在支付结果页面调用前**：当在支付方式页面发起支付时，您可以自动触发调用**查询支付**API以进行后续重定向。
*   **当用户查询支付结果时**：当用户在您的页面上点击或触摸“我已经支付”或具有相同含义的按钮时，您可以调用**inquiryPayment** API 来检查支付状态。
*   **当支付过期时**：当支付达到过期时间，您可以调用**inquiryPayment** API 来检查支付状态。
异步通知和**inquiryPayment** API 返回的响应包含授权支付结果以及如下的关键信息：
| **API** | **授权结果** | **AVS 信息** | **CVV 信息** | **3DS 认证信息** |
| --- | --- | --- | --- | --- |
| notifyPayment | resultStatus | avsResultRaw | cvvResultRaw | threeDSResult（仅适用于 3DS 认证授权） |
| inquiryPayment | paymentStatus | avsResultRaw | cvvResultRaw | threeDSResult（仅适用于 3DS 认证授权） |

**图 3. 授权结果的关键信息**

> **注意**：在韩国卡片的发卡方认证和非认证支付场景中，从异步通知和主动查询获取的响应不包含 3D 认证信息。

以下代码示例展示了在一般信用卡支付场景中**notifyPayment**和**inquiryPayment**返回的结果：

```json
notifyPayment (3D)
notifyPayment (非 3D)
inquiryPayment (3D)
inquiryPayment (非 3D)
```

```json
{
  "notifyType": "PAYMENT_RESULT",
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "success"
  },
  "paymentRequestId": "2020010123456789XXXX",
  "paymentId": "2020010123456789XXXX",
  "paymentAmount": {
    "value": "8000",
    "currency": "EUR"
  },
  "paymentCreateTime": "2020-01-01T12:01:00+08:30",
  "paymentTime": "2020-01-01T12:01:01+08:30",
  "paymentResultInfo": {
    "avsResultRaw": "A",
    "cvvResultRaw": "Y",
    "networkTransactionId": "sampleNetworkTransactionId123456",
    "threeDSResult": {
      "eci": "02",
      "threeDSVersion": "2.2.0",
```

请注意，以上代码示例仅展示了 JSON 结构，实际的 API 调用会包含完整的 HTTP 请求和响应。
"卡验证值"（CAVV）："cavvSample",
"发卡行交易ID"（DS Transaction ID）："sample_dsTranasctionId"
}
}
}
复制
{
"通知类型"（notifyType）："PAYMENT_RESULT",
"结果"（result）：{
"结果代码"（resultCode）："SUCCESS",
"结果状态"（resultStatus）："S",
"结果消息"（resultMessage）："成功"
},
"支付请求ID"（paymentRequestId）："2020010123456789XXXX",
"支付ID"（paymentId）："2020010123456789XXXX",
"支付金额"（paymentAmount）：{
"值"（value）："8000",
"货币"（currency）："EUR"
},
"支付创建时间"（paymentCreateTime）："2020-01-01T12:01:00+08:30",
"支付时间"（paymentTime）："2020-01-01T12:01:01+08:30",
"支付结果信息"（paymentResultInfo）：{
"AVS原始结果"（avsResultRaw）："A",
"CVV原始结果"（cvvResultRaw）："Y",
"网络交易ID"（networkTransactionId）："sampleNetworkTransactionId123456"
}
}
复制
{
"结果"（result）：{
"结果代码"（resultCode）："SUCCESS",
"结果状态"（resultStatus）："S",
"结果消息"（resultMessage）："成功"
},
"支付状态"（paymentStatus）："SUCCESS",
"支付请求ID"（paymentRequestId）："pay_1089760038715669_10277574507XXXX",
"支付ID"（paymentId）："2019060811401080010018882020035XXXX",
"支付金额"（paymentAmount）：{
"值"（value）："500",
"货币"（currency）："USD"
},
"支付创建时间"（paymentCreateTime）："2019-06-01T12:01:01+08:30",
"支付时间"（paymentTime）："2019-06-01T12:01:01+08:30",
"支付结果信息"（paymentResultInfo）：{
"AVS原始结果"（avsResultRaw）："A",
"CVV原始结果"（cvvResultRaw）："Y",
"网络交易ID"（networkTransactionId）："sampleNetworkTransactionId123456",
"3DS结果"（threeDSResult）：{
"eci"："02",
"3DS版本"（threeDSVersion）："2.2.0",
"卡验证值"（caav）："cavvSample",
"发卡行交易ID"（dsTransactionId）："sample_dsTranasctionId"
}
}
}
复制
{
"结果"（result）：{
"结果代码"（resultCode）："SUCCESS",
"结果状态"（resultStatus）："S",
"结果消息"（resultMessage）："成功"
},
"支付状态"（paymentStatus）："SUCCESS",
"支付请求ID"（paymentRequestId）："pay_1089760038715669_10277574507XXXX",
"支付ID"（paymentId）："2019060811401080010018882020035XXXX",
"支付金额"（paymentAmount）：{
"值"（value）："500",
"货币"（currency）："USD"
},
"支付创建时间"（paymentCreateTime）："2019-06-01T12:01:01+08:30",
"支付时间"（paymentTime）："2019-06-01T12:01:01+08:30",
"支付结果信息"（paymentResultInfo）：{
"AVS原始结果"（avsResultRaw）："A",
"CVV原始结果"（cvvResultRaw）："Y",
"网络交易ID"（networkTransactionId）："sampleNetworkTransactionId123456"
}
}
复制
以下代码示例展示了在韩国卡片发行方身份验证场景中，**notifyPayment** 和 **inquiryPayment** 返回的结果：
notifyPayment
inquiryPayment
复制
{
"实际支付金额"（actualPaymentAmount）：{
"货币"（currency）："KRW",
"值"（value）："120"
},
"卡片信息"（cardInfo）：{
"avsResultRaw": "",
"cvvResultRaw": "",
"paymentMethodRegion": "KR",
"threeDSResult": {
"cavv": "",
"eci": ""
}
},
"notifyType": "PAYMENT_RESULT",
"paymentAmount": {
"currency": "KRW",
"value": "120"
},
"paymentCreateTime": "2024-03-18T19:35:39-07:00",
"paymentId": "2020010123456789XXXX",
"paymentRequestId": "2020010123456789XXXX",
"paymentResultInfo": {
"avsResultRaw": "",
"cvvResultRaw": "",
"paymentMethodRegion": "KR",
"threeDSResult": {
"cavv": "",
"eci": ""
}
},
"paymentTime": "2024-03-18T19:36:54-07:00",
"result": {
"resultCode": "SUCCESS",
"resultMessage": "成功。",
"resultStatus": "S"
}
}  
复制  
{
"authExpiryTime": "2024-03-25T19:36:54-07:00",
"cardInfo": {},
"paymentAmount": {
"currency": "KRW",
"value": "120"
},
"paymentId": "2020010123456789XXXX",
"paymentMethodType": "CARD",
"paymentRedirectUrl": "https://www.alipay.com",
"paymentRequestId": "2020010123456789XXXX",
"paymentResultCode": "SUCCESS",
"paymentResultInfo": {
"avsResultRaw": "",
"cvvResultRaw": "",
"paymentMethodRegion": "KR",
"threeDSResult": {
"cavv": "",
"eci": ""
}
},
"paymentResultMessage": "成功",
"paymentStatus": "SUCCESS",
"paymentTime": "2024-03-18T19:36:54-07:00",
"result": {
"resultCode": "SUCCESS",
"resultMessage": "成功。",
"resultStatus": "S"
}
}]  
要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。  
![图片15](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![图片16](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  
#### 这个页面有帮助吗？  
#### 本页内容  
[请求授权支付](#wVcjz "请求授权支付")  
[服务器到服务器模式](#b1QeJ "服务器到服务器模式")  
[集成前提条件](#xAr7O "集成前提条件")  
[集成步骤](#V35Dm "集成步骤")
用户体验
------------

API调用
------------

托管支付页面模式
------------------

集成步骤
------------

用户体验
------------

API调用
------------

获取授权结果
-----------------
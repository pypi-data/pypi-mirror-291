概览 | 产品API | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Fapi_fund)

[返回首页](../../)

产品API
-------

[支付宝API](/docs/ac/ams/api)

[概览](/docs/ac/ams/api_fund)

[幂等性](/docs/ac/ams/idempotency)

[消息编码](/docs/ac/ams/me)

[请求签名与签名验证](/docs/ac/ams/digital_signature)

[API变更历史](/docs/ac/ams/changehistory)

在线支付
--------

店内支付
--------

概述
========

2024年5月13日 07:36

支付宝的在线和店内支付产品提供一组API，允许与支付宝集成。您可以使用`POST`方法发送HTTPS请求并接收相应响应。

以下部分介绍了[消息结构](#tLLkc)和端到端[消息传输工作流程](#4DTQ1)。

版本管理
==========

当前API版本为`v1`。版本在URL中指定，例如`https://{域名}/ams/api/v1/payments/pay`。

环境
===========

您可以根据所在地区选择以下列出的域名之一。建议使用加速域名以实现更快地访问支付宝。如果在设置加速域名时遇到问题，请联系支付宝技术支持。

| **地区** | **普通域名** | **加速域名（推荐）** |
| --- | --- | --- |
| 北美 | <https://open-na.alipay.com> | <https://open-na-global.alipay.com> |
| 亚洲 | <https://open-sea.alipay.com> | <https://open-sea-global.alipay.com> |
| 欧洲 | <https://open-eu.alipay.com>（仅限店内支付） | <https://open-de-global.alipay.com> |
表1. 地区域名

消息结构
========

在进行任何支付之前，了解支付宝API的工作原理以及请求和响应的结构非常重要。本节将介绍您的系统与支付宝之间在线消息的一般信息，如消息结构和消息传输工作流程。消息指的是请求消息或响应消息。

请求结构
---------

以下图示展示了请求消息的结构：

![图片 3: 1675842578786-11a67339-2e94-4bae-9955-15ac8cbcd3c1.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1698201692215-d6848f32-110a-4c25-a930-0deff8bed9cf.png)

图1. 请求结构
### URL
请求的URL为 `https://{域名}/ams/api/{版本}/{端点}`，其结构如下：

*   **域名**：是由钱包后端分配的标准[域名](https://global.alipay.com/docs/ac/ams/api#call)。
*   **版本**：是API的版本，例如 `v1` 或 `v2`。
*   **端点**：是接口的具体路径，例如 `/v1/payments/pay`。

一个接口可以通过其端点唯一标识。例如，`/v1/payments/pay` 与 `/v2/payments/pay` 是不同的接口。
### HTTPS 方法  
POST
### 请求头  
请求头主要包含以下字段。
**注意**：字段名称不区分大小写。  
| **头字段** | **必需** | **代码示例** |
| --- | --- | --- |
| 签名 | 是 | `signature: algorithm=RSA256, keyVersion=1, signature=****` |
| Content-Type | 否 | `Content-Type: application/json; charset=UTF-8` |
| client-id | 是 | `client-id: ****` |
| request-time | 是 | `request-time: 1685599933871` |
| agent-token | 否 | `agent-token: ****` |  
表2. 请求头  
每个头字段的详细信息如下所述。  
#### 签名（必需）  
_signature_ 包含以逗号(,)分隔的键值对。每个键值对是一个等式，由键和用等号(=)连接的值组成。关于如何生成签名的详细信息，请参阅[生成签名](https://global.alipay.com/docs/ac/ams/digital_signature#gNWs0)部分。  
可配置以下键：  
*   **algorithm**：指定用于生成签名的数字签名算法。支持RSA256。
*   **keyVersion**：指定用于生成或验证签名的密钥版本。默认情况下，值为与_Client-Id_关联的最新密钥版本。
*   **signature**：包含请求的签名值。  
示例：  
```markdown
Signature: algorithm=RSA256, keyVersion=1,
signature=KEhXthj4bJ801Hqw8kaLvEKc0Rii8KsNUazw7kZgjxyGSPuOZ48058UVJUkkR21iD9JkHBGR
rWiHPae8ZRPuBagh2H3qu7fxY5GxVDWayJUhUYkr9m%2FOW4UQVmXaQ9yn%2Fw2dCtzwAW0htPHYrKMyrT
pMk%2BfDDmRflA%2FAMJhQ71yeyhufIA2PCJV8%2FCMOa46303A0WHhH0YPJ9%2FI0UeLVMWlJ1XcBo3Jr
bRFvcowQwt0lP1XkoPmSLGpBevDE8%2FQ9WnxjPNDfrHnKgV2fp0hpMKVXNM%2BrLHNyMv3MkHg9iTMOD%
2FFYDAwSd%2B6%2FEOFo9UbdlKcmodJwjKlQoxZZIzmF8w%3D%3D
```  
#### Content-Type（可选）
**内容类型（Content-Type）** 指示请求主体的媒体类型，如 [RFC2616](https://datatracker.ietf.org/doc/html/rfc2616) 中定义的。其中，_charset_ 用于生成/验证签名。
例如：
```
Content-Type: application/json; charset=UTF-8
```
#### 客户端ID（client-id） - 必需

_client-id_ 用于标识客户端，并与用于签名的密钥相关联。获取客户端ID的详细信息，请参阅 [Antom仪表板](https://global.alipay.com/docs/dashboard_en)。

#### 请求时间（request-time） - 必需

_request-time_ 指定请求发送的时间戳。此字段的值必须精确到毫秒。使用以下编程语言方法获取时间戳：

*   Java: `System.currentTimeMillis()`
*   Python: `round(time.time() * 1000)`
*   .Net: `DateTimeOffset.UtcNow.ToUnixTimeMilliseconds()`
*   PHP: `round(microtime(true) * 1000)`

例如：
```
request-time: 1685599933871
```
#### 代理令牌（agent-token） - 可选

_agent-token_ 是支付宝为授权ISV调用API而颁发的代理令牌。当处理由ISV发起的API请求时，支付宝会验证_agent-token_ 的值是否有效。

**注意事项：**

*   从Antom仪表板获取此参数的值。
*   目前，Antom仪表板自动生成的_agent-token_ 是一个48位的字符串，而此参数的最大长度为128位。
### 请求体  
请求体包含以JSON格式的详细请求信息。请求体中的字段根据服务的不同而变化。更多详细信息，请参阅特定API规范的说明。  

响应结构
------------------
以下图表展示了响应结构：  
![图片4: 图像](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1675842622240-a4c513d4-908b-4384-b038-3f016f88612e.png)  
图2. 响应结构
### 响应头  
响应头包含有关响应的信息，主要包含以下字段。  
**注意**：字段名称不区分大小写。  
| **头字段** | **必需** | **代码示例** |
| --- | --- | --- |
| 签名 | 是 | `signature: algorithm=RSA256, keyVersion=1, signature=****` |
| Content-Type | 否 | `Content-Type: application/json; charset=UTF-8` |
| client-id | 是 | `client-id: ****` |
| response-time | 是 | `response-time: 2019-04-04T12:08:56+05:30` |  
表3. 响应头  
每个头字段的详细信息如下所述。  
#### 签名（必需）  
_signature_ 包含以逗号(,)分隔的键值对。每个键值对是一个等式，由键和用等号(=)连接的值组成。关于如何生成签名的详细信息，请参阅[生成签名](https://global.alipay.com/docs/ac/ams/digital_signature#gNWs0)部分。  
可配置以下键：  
*   **algorithm**：指定用于生成签名的数字签名算法。支持RSA256。
*   **keyVersion**：指定用于生成或验证签名的密钥版本。默认情况下，值为与_client-id_关联的最新密钥版本。
*   **signature**：包含请求的签名值。  
示例：  
```markdown
Signature: algorithm=RSA256, keyVersion=1,
signature=KEhXthj4bJ801Hqw8kaLvEKc0Rii8KsNUazw7kZgjxyGSPuOZ48058UVJUkkR21iD9JkHBGR
rWiHPae8ZRPuBagh2H3qu7fxY5GxVDWayJUhUYkr9m%2FOW4UQVmXaQ9yn%2Fw2dCtzwAW0htPHYrKMyrT
pMk%2BfDDmRflA%2FAMJhQ71yeyhufIA2PCJV8%2FCMOa46303A0WHhH0YPJ9%2FI0UeLVMWlJ1XcBo3Jr
bRFvcowQwt0lP1XkoPmSLGpBevDE8%2FQ9WnxjPNDfrHnKgV2fp0hpMKVXNM%2BrLHNyMv3MkHg9iTMOD%
2FFYDAwSd%2B6%2FEOFo9UbdlKcmodJwjKlQoxZZIzmF8w%3D%3D
```  
#### Content-Type（可选）
`Content-Type` 指示请求正文的媒体类型，如 [RFC2616](https://datatracker.ietf.org/doc/html/rfc2616) 所定义。其中，`charset` 用于生成/验证签名。
例如：
```yaml
Content-Type: application/json; charset=UTF-8
```
#### client-id 必需

`client-id` 用于标识客户端，并与用于签名的密钥相关联。关于如何获取客户端 ID 的详细信息，请参阅 [Antom 控制台](https://global.alipay.com/docs/dashboard_en#Ozw86)。

#### Response-time 必需

`Response-time` 指定发送响应的时间，遵循 [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) 标准。

注意：此字段的时间精度必须精确到秒。
```yaml
response-time: 2019-04-04T14:08:56+05:30
```
### 响应体  
响应体包含对客户端的响应信息。这一部分的字段根据服务的不同而变化。但是，始终包含表示API调用结果的`result`字段。  
当结果状态（`resultStatus`）为失败时，结果代码（`resultCode`）为错误代码，结果消息（`resultMessage`）为错误消息，用于故障排查。有关如何解决错误的更多信息，请参阅特定API中的结果/错误代码部分。  
| **字段** | **数据类型** | **必需** | **描述** |
| --- | --- | --- | --- |
| resultStatus | 字符串 | 否 | 结果状态。有效值为：* `S`：成功 * `F`：失败 * `U`：未知 |
| resultCode | 字符串（64） | 否 | 结果代码 |
| resultMessage | 字符串（256） | 否 | 详细描述结果代码和状态的消息 |  
表4. 响应体  
消息传输工作流程
======================  
整个交互序列如下所示：  
![图像5：消息传输工作流程.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1625112891563-6fb47fb0-262b-4bc8-9ba5-5aa376faac8a.png)  
图3. 消息传输工作流程  
总体流程
------------  
按照以下总体流程调用API。
### 准备工作  
为了避免在响应中可能出现的错误，请考虑以下因素：  
*   为了避免在响应中可能出现的错误，了解[API幂等性](https://global.alipay.com/docs/ac/ams/idempotency)。
*   对包含特殊字符的请求进行编码。
### 1. 构建请求  
按照[请求结构](https://global.alipay.com/docs/ac/ams/api_fund#F18BS)构建请求，例如，在请求头中添加_client-Id_、_request-time_、_signature_等字段。  
为了确保消息传输的安全，构建请求时请执行以下安全措施：  
*   对请求消息进行签名。所有请求和响应都需要进行消息签名和签名验证。更多详情，请参阅[请求签名与签名验证](https://global.alipay.com/docs/ac/ams/digital_signature)。
*   对请求进行编码，以防止请求中包含的特殊字符可能导致的错误或歧义。具体信息，请参阅[消息编码](https://global.alipay.com/docs/ac/ams/me)。
### 2. 发送请求  
您可以通过您喜欢的平台或工具发送请求，例如，使用Postman或cURL命令。
### 3. 检查响应  
响应通常以JSON或XML格式返回。有关响应的详细信息，请参阅[响应结构](#aL4jO)部分。在接收到响应后，需要验证响应的签名。
### 4. 检查状态码  
响应数据根据服务的不同而变化，但总是包含表示 API 调用结果的 `result` 字段。如果发生错误，会返回一个错误响应，其中的 `result` 对象会显示错误代码和错误消息，以便您排查问题。  
要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。  
![图片 6](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 7](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

#### 这个页面有帮助吗？  

#### 本页内容  
[版本管理](#CrBl2 "版本管理")  
[环境](#Clzkg "环境")  
[消息结构](#tLLkc "消息结构")  
[请求结构](#F18BS "请求结构")  
[URL](#fXagV "URL")  
[HTTPS 方法](#dMgcH "HTTPS 方法")  
[请求头](#ML5ur "请求头")  
[签名](#3RxeL "签名")  
[Content-Type](#d8Mc5 "Content-Type")  
[client-id](#GMh3X "client-id")  
[request-time](#gMZMn "request-time")  
[agent-token](#sjPLz "agent-token")  
[请求体](#oNtxc "请求体")  
[响应结构](#aL4jO "响应结构")  
[响应头](#WWH90 "响应头")  
[签名](#xkB9Q "签名")  
[Content-Type](#tyqeW "Content-Type")  
[client-id](#QihCq "client-id")  
[响应时间](#xZUui "响应时间")  
[响应体](#eNUbf "响应体")  
[消息传输工作流程](#4DTQ1 "消息传输工作流程")  
[整体流程](#2tmDE "整体流程")  
[准备工作](#3ck4x "准备工作")  
[1. 构建请求](#NrdHS "1. 构建请求")  
[2. 发送请求](#GdgFY "2. 发送请求")  
[3. 检查响应](#UaWGd "3. 检查响应")  
[4. 检查状态码](#dqcPN "4. 检查状态码")
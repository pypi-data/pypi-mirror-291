数字签名 | 通用参考 | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fgr%2Fglobalgs)  
[返回首页](../../)

通用参考  
[API 规范](/docs/ac/gr/apispec)  
[数字签名](/docs/ac/gr/globalgs)  
[新数字签名](/docs/ac/gr/signature)  
[错误代码](/docs/ac/gr/error_code)  
[入门指南](/docs/ac/gr/get-start)  
[术语表](/docs/ac/gr/glossary)  
[退款](/docs/ac/gr/refund)  
[集成指南](/docs/ac/gr/integration)  
[版本更新日志](/docs/ac/gr/release_notes)  
[交易状态](/docs/ac/gr/trade_status)  
[API幂等性](/docs/ac/gr/idempotency)  
[支付宝标识](/docs/ac/gr/logo)  

数字签名
=================  
2021-02-26 07:01  
您可以参考本文档对全球API请求进行签名。但是，如果您已集成新版本的API，请参阅[新数字签名](https://global.alipay.com/doc/gr/signature)以获取详细信息。  

当您向支付宝发送请求时，必须对请求进行签名，以识别请求的发送者，并确保数据传输过程中请求未被篡改。

准备密钥
==============  
生成数字签名通常需要一个密钥来签署数据。下表列出了支持的签名类型：

| **产品** | **签名类型** |
| --- | --- |
| 在线支付 | 网页/手机支付：RSA、RSA2和MD5。应用内支付：仅RSA。报关：RSA和MD5。 |
| 店内支付 | RSA、RSA2和MD5 |  

MD5签名类型
-------------
MD5密钥是生成和验证MD5签名所必需的。MD5密钥是一个由英文字母和数字组成的32字节字符串。

要查看您的MD5密钥，请按照以下步骤操作：

1. 登录[Alipay Global Site](https://globalprod.alipay.com/order/myOrder.htm)。转到业务中心 -> 在线支付/店内支付产品 -> 查看密钥，然后点击“查看我的密钥”。
   ![图片3: 2.png](https://cdn.nlark.com/yuque/0/2020/png/561635/1588928235474-066257b9-4db4-4a3d-bf51-43ea3ddd65c7.png)
2. 输入您的支付密码，然后点击确认。如果您不知道支付密码，请联系全球商户业务支持 (global.service@alipay.com)。
   ![图片4: 数字签名](https://cdn.nlark.com/yuque/0/2020/png/561635/1588928235803-354672eb-78d1-4da2-b728-14505d80464a.png)
3. 检查您的MD5密钥。以下是一个MD5密钥的示例：
   ![图片5: 4.png](https://cdn.nlark.com/yuque/0/2020/png/561635/1588928235962-cea3ef6a-9c79-4a34-bb91-6ff08a4a8b1a.png)

RSA/RSA2签名类型
------------------

RSA/RSA2密钥对包括私钥和公钥。私钥用于生成签名，公钥用于验证签名。出于安全考虑，强烈推荐使用RSA2密钥。
### RSA2
支付宝提供了工具来帮助您生成和验证RSA2密钥。您还可以通过支付宝全球站点与支付宝交换RSA2公钥。

**密钥对生成**

使用支付宝API工具生成RSA2密钥对的步骤如下：

1.  下载[支付宝API工具](https://gw.alipayobjects.com/os/basement_prod/8f8c96b8-eeb4-4290-a3ff-37f3f72b9652.zip)。
2.  解压缩**AlipayApiTool.zip**。
3.  根据您的操作系统，执行Run\_Windows.bat（Windows）或Run\_Mac（Mac）。
4.  点击**新建**以生成密钥对。

您也可以使用OpenSSL生成RSA2密钥对。详细信息请参阅[RSA](#lwDno)部分。要生成RSA2密钥，将`OpenSSL> genrsa -out rsa_private_key.pem 1024`改为`OpenSSL> genrsa -out rsa_private_key.pem 2048`。

以下是一些RSA2密钥对的示例：

*   RSA2私钥
复制
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCMJzNJinprwqy72FuBtrBQwapilYbQ2R0W3q8vfxhdgUudQwaLcsTpGLAsv1LIiVsKBGwozb1PfyjV5HfAktCjkqdvjn+1+TzRnlTc23uvHK/Hsan0CuMDEb6fYepUN56wCoX5pbHDcwD0Y9IQX+v3AD7e/mf8E5/IYDfr0MZWxTBafCBKAK/IRQPRZ/KFTO61hr9/rfiW3Len6aYlvcp+DfdIR8R1orkn/CO4/l6yYrlPmj2YxB4oeve5OjYPq3FHnKOYRwl7gy84loqZi7O5BVtOv1ZDsHojtMRTtWf1redeeFWEwuqN2Ng4lRbT1cj/q+oADiFbWau5H1xD1X59AgMBAAECggEAbAjTmf6qu2JG8E2oy+ZdJwMCKhgE4fxaVgS1mbEowPsnpEPESb3gV6X2N6gLUhW/HYunLBTbtunYOnhwbvs85LnpYy6+9zD2Vsbrt4tgXe2I+i/TSBEUSItnG0jI7r4pDp4uA/BbhMOjmr9Pb9vg8nc3/4Cv+znNUxIISTiXis4p5BSYWg0EnhbiV1pjft1JX3jhcmT3snIYIYbJxdnHAVimG1V2ANAOpFc6wF5wIIP98zXfQ2/Cx9QbSLwBEjyqV0COnPsbs3EFDLgmE7GFKg4+DZu1wam3DtO8Fo5dL0vFAEfi8hAgG3b14OmgwL1Q5YjDh7wzMhpfn23LdQrO6QKBgQD7QpFR/183Bw0gphtLN/8/pu0qX5jrOpFgbKz2IYkopRLQPmWSYrhVtX0ThRtufefQ8rfqVJdOMySD0qrJQC7+jXNiOYwcItCYNBCSiO7LSWxfj3OSwtOkmkLsdyw5NEL/pdwHRX/oP5f+Q9jLbKsP6MwIjVnK+SHkMPgw4Cuh9wKBgQCOzA3kGUlf+BTjl/aVMcsIRYfFSl+dbCLoyDXUaHFq6QGZ43bHMFO5a6K2cvsgxviHVZkRK1lnvgGYzEN21TGG/MtTKMhxmv9E0vo0C20EBoqKW4xobvTud1weiAcm4eKjeMac8hajGXwvXUKivARK/Q/52cItWHMumxaQWZaGKwKBgQDNUpmUSz5Qpmd43aSCNDFWn59BODurRgIUrNoujDscRsD4AXVZSWjfSV77e5NuGF8+ZYobaKL4WVymiJnduaBtjcPTablwKJcTOcCtLk8NOmPgN0a3kJQI97JmsAAogueZJ72FB6s9a/JV6rWXjqa/anqJJpFRB4NFiSrYLegaAwKBgDnDFQNlryag5WJDAD3NjIFmDsuhkBfPvDdJdWzcarSCWGF1f4CHbfadMY536FmT4shruaUWUe4DEAZM6iVRi908uMqEvsAloIiohwkybgCo3LWm3p8H8w/bPGolQC9cRB84Ja8qxjlnf7JxGRlW0K28vA+nJELPepgpp/DwLFFNAoGAWwgluqqsBHzQBzQ5A+GqTaTSX4uWOSKj60Jfj/mglB3D3iNzE+y/2xJx8HNF0PYqGV5qhC5GTDSMA3nTN+NMLT6oGnF8wDAA1M5soWfQCMmRUWLDEyZTIGUHaqknhVCLeCPh+oKwcR0Uhof//8zYh6kWLjX8jaovYY0/N9XnPaw=  
*   RSA2公共密钥  
复制
**密钥对验证**

您可以通过执行以下步骤使用支付宝API工具验证您的密钥对：

1. 根据您的操作系统，运行`Run_Windows.bat`或`Run_Mac`。
2. 在相应字段中输入您的私钥和公钥。
3. 点击**验证**，检查私钥和公钥是否匹配。

**公钥交换**

要与支付宝交换RSA2公钥，请完成以下步骤：

1. 登录[支付宝全球网站](https://globalprod.alipay.com/order/myOrder.htm)，进入业务中心 -> 在线支付/店内支付产品。
2. 在“我的订单”标签页中，点击“查看密钥”。
3. 找到RSA2密钥信息，然后点击“编辑我的公钥”。
4. 在文本框中输入您的RSA2公钥，然后点击“保存”。
5. 点击“查看我的公钥”。
6. 输入您的支付密码，然后点击“确认”。

请注意，上述内容中的图片链接指向的是示例图片，用于说明操作流程，实际操作时请根据页面显示进行。
![图片 11: 数字签名](https://cdn.nlark.com/yuque/0/2020/png/561635/1588928235803-354672eb-78d1-4da2-b728-14505d80464a.png)  
接着，你可以查看你的公钥和支付宝的公钥。例如：  
![图片 12: {6B8F887E-43F6-4227-937B-A4999552AB43}_20200102151516.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/561635/1588928236681-33409932-ed05-410e-8561-d0d43a570d20.jpeg)  
**注意：**  
支付宝的公钥只有在你上传了你的公钥之后才会提供。
### RSA
RSA 密钥不再推荐使用，您需要自行生成RSA密钥对。并且，为了与支付宝交换RSA公钥，您必须联系支付宝技术支持。

**密钥对生成**
生成RSA密钥对可以使用多种工具。以下示例使用OpenSSL来说明生成过程：

1. 安装OpenSSL
   - 对于Linux系统，使用以下命令：
     ```
     sudo apt-get install openssl
     ```
   - 对于Windows系统，从[OpenSSL网站](https://www.openssl.org/source/)下载并安装OpenSSL。

2. 生成RSA密钥对
   - 对于Linux系统，使用以下命令：
     ```
     $ openssl
     OpenSSL> genrsa -out rsa_private_key.pem 1024  # 生成私钥
     OpenSSL> pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt  # 将私钥转换为PKCS8格式
     OpenSSL> rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem  # 生成公钥
     OpenSSL> exit
     ```
   - 对于Windows系统，使用以下命令：
     ```
     C:\Users\Hammer>cd C:\OpenSSL-Win32\bin  # 进入OpenSSL目录
     C:\OpenSSL-Win32\bin>openssl.exe  # 运行OpenSSL
     OpenSSL> genrsa -out rsa_private_key.pem 1024  # 生成私钥
     OpenSSL> pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt  # 将私钥转换为PKCS8格式
     OpenSSL> rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem  # 生成公钥
     OpenSSL> exit
     ```
完成后，您将在当前目录下看到两个文件：`rsa_private_key.pem` 和 `rsa_public_key.pem`，前者是私钥，后者是公钥。

**注意事项：**
- 对于Java开发者，需要从控制台输出的PKCS8私钥中删除头、尾、回车符和空格。
- 使用openssl创建私钥后，如果使用Java，需要将私钥转换为PKCS8格式；如果使用.NET或PHP，则无需转换为PKCS8格式。

以下是RSA密钥对的示例：
*   标准RSA私钥文件（PHP, .NET）  
复制  
```shell
-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQC+L0rfjLl3neHleNMOsYTW8r0QXZ5RVb2p/vvY3fJNNugvJ7lo4+fdBz
+LN4mDxTz4MTOhi5e2yeAqx+v3nKpNmPzC5LmDjhHZURhwbqFtIpZD51mOfno2c3MDwlrsV
i6mTypbNu4uaQzw/TOpwufSLWF7k6p2pLoVmmqJzQiD0QIDAQABAoGAakB1risquv9D4zX7
hCv9MTFwGyKSfpJOYhkIjwKAik7wrNeeqFEbisqv35FpjGq3Q1oJpGkem4pxaLVEyZOHONe
fZ9MGVChT/MNH5b0FJYWl392RZy8KCdq376Vt4gKVlABvaV1DkapL+nLh7LMo/bENudARs
xD55IGObMU19lkCQQDwHmzWPMHfc3kdY6AqiLrOss+MVIAhQqZOHhDe0aW2gZtwiWeYK1wB
/fRxJ5esk1sScOWgzvCN/oGJLhU3kipHAkEAysNoSdG2oWADxlIt4W9kUiiiqNgimHGMHPw
p4JMxupHMTm7D9XtGUIiDijZxunHv3kvktNfWj3Yji0661zHVJwJBAM8TDf077F4NsVc9AX
Vs8N0sq3xzqwQD/HPFzfq6hdR8tVY5yRMb4X7+SX4EDPORKKsgnYcur5lk8MUi7r072iUCQ
QC8xQvUne+fcdpRyrR4StJlQvucogwjTKMbYRBDygXkIlTJOIorgudFlrKP/HwJDoY4uQNl8
gQJb/1LdrKwIe7FAkBl0TNtfodGrDXBHwBgtN/t3pyi+sz7OpJdUklKE7zMSBuLd1E3O4JM
zvWP9wEE7JDb+brjgK4/cxxUHUTkk592
-----END RSA PRIVATE KEY-----
```
*   标准PKCS8格式的私钥文件（Java）  
复制  
```shell
-----BEGIN PRIVATE KEY-----
MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBAN0yqPkLXlnhM+2H/57aHsY
HaHXazr9pFQun907TMvmbR04wHChVsKVgGUF1hC0FN9hfeYT5v2SXg1WJSg2tSgk7F29Sps
F0I36oSLCIszxdu7ClO7c22mxEVuCjmYpJdqb6XweAZzv4Is661jXP4PdrCTHRdVTU5zR9x
UByiLSVAgMBAAECgYEAhznORRonHylm9oKaygEsqQGkYdBXbnsOS6busLi6xA+iovEUdbAV
IrTCG9t854z2HAgaISoRUKyztJoOtJfI1wJaQU+XL+U3JIh4jmNx/k5UzJijfvfpT7Cv3ue
MtqyAGBJrkLvXjiS7O5ylaCGuB0Qz711bWGkRrVoosPM3N6ECQQD8hVQUgnHEVHZYtvFqfc
oq2g/onPbSqyjdrRu35a7PvgDAZx69Mr/XggGNTgT3jJn7+2XmiGkHM1fd1Ob/3uAdAkEA4
D7aE3ZgXG/PQqlm3VbE/+4MvNl8xhjqOkByBOY2ZFfWKhlRziLEPSSAh16xEJ79WgY9iti+
guLRAMravGrs2QJBAOmKWYeaWKNNxiIoF7/4VDgrcpkcSf3uRB44UjFSn8kLnWBUPo6WV+x1
FQBdjqRviZ4NFGIP+KqrJnFHzNgJhVUCQFzCAukMDV4PLfeQJSmna8PFz2UKva8fvTutTry
yEYu+PauaX5laDjyQbc4RIEMU0Q29CRX3BA8WDYg7YPGRdTkCQQCG+pjU2FB17ZLuKRlKEd
tXNV6zQFTmFc1TKhlsDTtCkWs/xwkoCfZKstuV3Uc5J4BNJDkQOGm38pDRPcUDUh2/
-----END PRIVATE KEY-----
```
*   公钥文件  
复制
```markdown
-----BEGIN PUBLIC KEY----- 
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQWiDVZ7XYxa4CQsZoB3n7bfxLDkeGKjyQPt2FUtm4TWX9OYrd523iw6UUqnQ+Evfw88JgRnhyXadp+vnPKP7unormYQAfsM/CxzrfMoVdtwSiGtIJB4pfyRXjA+KL8nIa2hdQy5nLfgPVGZN4WidfUY/QpkddCVXnZ4bAUaQjXQIDAQAB 
-----END PUBLIC KEY-----  

**公钥交换**
联系全球商户技术支持（overseas_support@service.alibaba.com），提供您的PID和公钥信息。支付宝会据此进行配置，并提供给您支付宝的公钥。
在向支付宝上传您的公钥后，您可以在支付宝全球站点上以查看RSA2公钥相同的方式查看您的公钥和支付宝公钥。

**生成预签名字符串**
以下部分描述如何生成预签名字符串：
- 仅需签名的参数被使用，除了`sign`和`sign_type`。
- 无值的参数不需要传输，也不需要包含在要签名的数据中。
- 签名时，将字符转换为字节流所使用的字符集必须与`_input_charset`中指定的字符集一致。
- 如果传输了`_input_charset`参数，也必须包含在要签名的数据中。

对于以下参数数组：
```
key-----------------------value
total_fee-----------------0.01
trade_information---------{"business_type":"4","goods_info":"Macbook 12 inch M3 8G 256G SSD^1|Apple iPad Pro 11 inch^1","total_quantity":"2"}
_input_charset------------UTF-8
currency------------------USD
out_trade_no--------------out_trade_no_20200109_175140
partner-------------------2088021017666931
product_code--------------NEW_OVERSEAS_SELLER
service-------------------create_forex_trade
subject-------------------Mika's coffee shop
timeout_rule--------------12h
```
将数组中的所有值以"key=value"（不带引号）的格式组合起来，然后按照字母顺序用&符号连接起来。例如：
```
`_input_charset=UTF-8&currency=USD&out_trade_no=out_trade_no_20200109_175140&partner=2088021017666931&product_code=NEW_OVERSEAS_SELLER&service=create_forex_trade&subject=Mika's coffee shop&timeout_rule=12h&total_fee=0.01&trade_information={"business_type":"4","goods_info":"Macbook 12 inch M3 8G 256G SSD^1|Apple iPad Pro 11 inch^1","total_quantity":"2"}`

**注意：**
对于应用内支付，将所有数组值以 key="value"（带引号）的格式组合，并按照字母顺序用 `&` 符号连接。例如：

给定以下参数数组：

```
key-----------------------value
total_fee-----------------0.01
trade_information---------{"business_type":"4","goods_info":"Macbook 12 inch M3 8G 256G SSD^1|Apple iPad Pro 11 inch^1","total_quantity":"2"}
_input_charset------------UTF-8
appenv--------------------system=android^version=3.0.1.2
body----------------------test
currency------------------USD
forex_biz-----------------FP
out_trade_no--------------out_trade_no_20200109_175417
partner-------------------2088021017666931
payment_type--------------1
product_code--------------NEW_WAP_OVERSEAS_SELLER
seller_id-----------------2088021017666931
service-------------------mobile.securitypay.pay
subject-------------------Mika's coffee shop
```

处理后的预签名字符串为：

`_input_charset="UTF-8"&appenv="system=android^version=3.0.1.2"&body="test"&currency="USD"&forex_biz="FP"&out_trade_no="out_trade_no_20200109_175417"&partner="2088021017666931"&payment_type="1"&product_code="NEW_WAP_OVERSEAS_SELLER"&seller_id="2088021017666931"&service="mobile.securitypay.pay"&subject="Mika's coffee shop"&total_fee="0.01"&trade_information="{"business_type":"4","goods_info":"Macbook 12 inch M3 8G 256G SSD^1|Apple iPad Pro 11 inch^1","total_quantity":"2"}"`

**请求签名**
------------

**MD5 签名类型**
生成预签名字符串后，按照以下步骤生成签名：
1. 将MD5密钥添加到预签名字符串，生成新的字符串。
2. 使用MD5签名算法（通过MD5签名函数）计算新字符串。得到的32字节字符串即为签名，用作`sign`参数的值。
   
**RSA2/RSA签名类型**
------------------  
预签名字符串生成后，按照以下步骤生成签名：  
1. 使用RSA/RSA2算法和你的私钥生成签名。
2. 将签名编码为字符串。  
然后，将该字符串用作`sign`参数的值。
   
**验证签名**
=======================  
本节描述如何验证签名。  
**MD5签名类型**
-------------  
从支付宝系统接收到响应或通知的字符串后，类似于数据签名的步骤，将MD5密钥添加到字符串中生成新字符串。然后，使用MD5签名算法计算新字符串。生成32字节的签名结果字符串后，检查其是否与`sign`参数传递的值相等。如果相等，验证通过。  
**RSA2/RSA签名类型**
------------------  
收到响应或通知后，按照以下步骤验证签名：  
1. 按照[生成预签名字符串](https://global.alipay.com/doc/gr/globalgs#ew41c)的说明操作。
2. 使用RSA/RSA2算法计算消息摘要。
3. 使用RSA/RSA2公钥对签名（`sign`字段的值）进行解签，得到消息摘要。
4. 比较步骤2和步骤3得到的两个消息摘要。如果摘要相同，表明签名数据未被篡改。  
要查看文档的最新更新，请访问[版本说明](https://global.alipay.com/docs/releasenotes)。
图片13  
图片14  
@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

### 这个页面有帮助吗？

### 在这个页面上

#### 准备密钥
#### MD5签名类型
#### RSA/RSA2签名类型
#### RSA2
#### RSA
#### 生成预签名字符串
#### 签名请求
#### MD5签名类型
#### RSA2/RSA签名类型
#### 验证签名
#### MD5签名类型
#### RSA2/RSA签名类型
使用非信用卡支付方式 | 结账支付 | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg) ![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fnoncard_payment%3FpageVersion%3D3%26version%3Dv1.40)  
[返回首页](../../)

结账支付
[概述](/docs/ac/cashierpay/overview?version=v1.40&pageVersion=24)  
[支付方式](/docs/ac/cashierpay/payment_method?version=v1.40&pageVersion=2)  
集成指南
[使用非信用卡支付方式](/docs/ac/cashierpay/noncard_payment?version=v1.40&pageVersion=3)  
[自定义结账解决方案](/docs/ac/cashierpay/custom_checkout?version=v1.40)  
[支付方式集成方案](/docs/ac/cashierpay/payment_method_preposed?version=v1.40&pageVersion=2)  
[使用信用卡支付方式](/docs/ac/cashierpay/card_payment?version=v1.40&pageVersion=3)  
支付后
其他资源
使用非信用卡支付方式
======================

2023-02-28 09:14

本集成指南适用于以下不包含信用卡的支付方式：

*   支付宝+支付方式
*   钱包
*   手机银行应用
*   银行转账
*   网上银行

先决条件
==========

在开始之前，您需要完成以下任务：

*   在支付宝开发者中心注册。
*   设置您的密钥。
*   在沙箱环境中进行测试。

详情请参考[支付宝集成指南](https://global.alipay.com/docs/integration)。

用户体验
==========

以下图表展示了用户在购物网站上支付的流程：

**Web**  
**WAP**  
**App**
**图片 3：使用非卡支付方式支付**  
图1. Web端用户体验  
1. 用户确认订单信息后，点击**下单**进入支付方式页面。
2. 用户选择支付方式，然后点击**确认支付**，被重定向到支付方式的中间页面。
3. 在中间页面，用户可以通过登录账户或扫描屏幕上的二维码进行支付。
4. 用户完成支付后，会被重定向到支付结果页面。  
**注意**：除了将用户重定向到预建的支付方式中间页面，您还可以将用户重定向到自定义结账页面，以提供更好的用户体验。有关如何实现自定义页面的更多信息，请参阅[自定义结账解决方案](https://global.alipay.com/docs/ac/cashierpay/custom_checkout?version=v1.37)。  
**图片 4：使用非卡支付方式支付**  
图1. WAP端用户体验  
1. 用户确认订单信息后，点击**下单**进入支付方式页面。
2. 用户选择支付方式，然后点击**支付**，调起支付方式的应用或被重定向到应用的移动页面。
3. 用户可以在应用内支付或按照移动页面上的指示进行支付。
4. 用户完成支付后，会被重定向到支付结果页面。
**注意**: 除了将用户重定向到预建的支付方式中间页面，您还可以将用户重定向到一个自定义的结账页面，以提供更好的用户体验。有关如何实现自定义页面的更多信息，请参阅[自定义结账解决方案](https://global.alipay.com/docs/ac/cashierpay/custom_checkout)。  
![图片5：使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673428498387-0a88b3c7-99e6-47c2-a439-82a4225ae214.png?x-oss-process=image%2Fresize%2Cw_1220)  
图1. 应用程序用户体验  
1.  用户确认订单信息后，点击**下单**进入支付方式页面。
2.  用户选择支付方式，然后点击**支付**继续支付流程。
3.  您可以通过调用支付方式应用或其Wap页面来启动支付流程。在支付方式应用或应用页面上，用户验证身份并输入支付密码以完成支付。
4.  用户完成支付后，将被重定向到支付结果页面。  
**注意**: 除了将用户重定向到预建的支付方式中间页面，您还可以将用户重定向到一个自定义的结账页面，以提供更好的用户体验。有关如何实现自定义页面的更多信息，请参阅[自定义结账解决方案](https://global.alipay.com/docs/ac/cashierpay/custom_checkout)。  
集成过程
------------

在集成过程中，您需要专注于开发支付方式页面。此页面有以下功能：

*   **显示可用支付方式**: 根据支付金额和用户所在地区等支付信息对支付方式进行排序。
*   **管理支付状态**: 页面显示支付倒计时并监控支付状态，以决定是否重定向用户。
*   **引导用户进入支付页面**: 通过支付宝提供的重定向URL将用户引导到支付页面。
*   **接收支付回调（可选）**: 通过监听页面调用或使用生命周期函数接收支付回调。根据支付状态，可以将用户重定向到支付结果页面。
步骤1：获取并显示可用支付方式
----------------------------------
### 1. 获取支付方式  
您可以调用[**consult**](https://global.alipay.com/docs/ac/ams/consult) API 来获取支付方式列表：  
- 网页版
- 手机网页版
- 移动应用版

![图片6：不包含卡支付的支付方式](https://intranetproxy.alipay.com/skylark/lark/0/2022/png/39456634/1663905287349-64d473e2-9b72-4f15-9434-cf4b806d98f3.png?x-oss-process=image%2Fresize%2Cw_1586)  
图2. 网页版支付方式查询  
![图片7：不包含卡支付的支付方式](https://intranetproxy.alipay.com/skylark/lark/0/2022/png/39456634/1663905376929-dab12d28-da6e-4bcd-8d0f-a50b2dbe0d58.png?x-oss-process=image%2Fresize%2Cw_1586)  
图2. 手机网页版支付方式查询  
![图片8：不包含卡支付的支付方式](https://cdn.nlark.com/yuque/0/2022/png/12884741/1663905595170-0d6c539f-a06d-4980-aa58-7cedcf955f27.png)  
图2. 移动应用版支付方式查询  

在请求中，您需要指定以下参数：  
| **请求参数** | **是否必需** | **描述** |
| --- | --- | --- |
| paymentAmount | 必需 | 交易的货币和金额。 |
| env | 必需 | 支付所使用的客户端类型，如桌面浏览器、移动浏览器或移动应用。 |
| allowedPspRegions | 可选 | 国家或地区。此参数用于过滤支付方式。 |
| userRegion | 可选 | 用户所在地区。此参数用于对返回的支付方式进行排序。 |  
表1. **consult** API 的请求参数  

发送请求后，支付宝将返回以下参数，通知您支付方式的相关信息：  
| **响应参数** | **描述** |
| --- | --- |
| paymentOptions.paymentMethodType | 合同中指定的支付方式。 |
| paymentOptions.enabled | 表示支付方式是否可用。 |
| paymentOptions.logo | 支付方式的图标。 |
| paymentOptions.promoNames | 支付方式的促销信息。 |
| paymentOptions.paymentMethodCategory | 支付方式的类型。 |
| paymentOptions.disableReason | 显示支付方式不可用的原因。当*paymentOptions.enabled*为`false`时返回此参数。 |  
**咨询** API 的响应参数  
结账页面上支付方式过多会影响用户体验。_paymentMethodCategory_ 用于对支付方式进行分类并在结账页面上展示。详细信息如下表所示：  
| **参数** | **支付方式类型** | **描述** |
| --- | --- | --- |
| paymentMethodCategory | ALIPAY\_PLUS | 支付宝+支付方式。 |
| WALLET | 电子钱包。 |
| BANK\_TRANSFER | 银行转账。允许用户通过银行应用或柜台使用参考代码支付。 |
| ONLINE\_BANKING | 网上银行。用户通过身份验证后在银行网站上支付。 |
| MOBILE\_BANKING\_APP | 手机银行应用。用户通过身份验证后在银行应用中支付。如果*terminalType*为`WEB`，则不返回此值。 |  
**paymentMethodCategory** 的描述表
### 2. 过滤支付方式  
在显示从支付宝获取的支付方式之前，建议根据以下条件过滤支付方式，以避免支付失败：

*   **支付方式是否可用**：调用[**consult**](https://global.alipay.com/docs/ac/ams/consult) API 或联系支付宝技术支持，了解可用的支付方式。
*   **最低支付金额**：关于每种支付方式的最低支付金额，需联系支付宝技术支持获取。
*   **最高支付金额**：关于每种支付方式的最高支付金额，也需联系支付宝技术支持。这取决于用户设置的支付限额。即使支付方式的最高金额未达到，也可能因为用户的设置而导致支付失败。

> **注意**：建议不显示或灰显不可用的支付方式。
### 3. 显示支付方式  
为了提供更好的用户体验，避免列出长长的支付方式列表，我们建议您使用多级菜单来展示。具体来说，可以将支付方式折叠在支付类型菜单中。当用户点击或触摸支付类型后，显示相应的支付方式。同时，为了提高支付成功率，您还可以根据支付成功率、促销活动和用户偏好对支付方式进行排序。

对于Alipay+支付方式，您必须按照以下方式之一显示Alipay+合作伙伴的标识。确保每个支付方式的名称和标识都正确使用：

**Web**
![图片9：不包含卡支付的支付方式](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673513837096-8a2e36cc-4774-403e-a39f-625d8f6c5a91.png?x-oss-process=image%2Fresize%2Cw_1586)
**图3. Web端支付方式的显示**

**WAP**
![图片10：不包含卡支付的支付方式](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673514050377-54840abc-5c4d-4b5d-b92b-cd1d3e2573f2.png)
**图3. WAP端支付方式的显示**

**App**
![图片11：不包含卡支付的支付方式](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673514050377-54840abc-5c4d-4b5d-b92b-cd1d3e2573f2.png)
**图3. App端支付方式的显示**
### 4. 收集或显示额外信息  
对于某些支付方式，需要从用户那里获取额外信息以完成支付，或者需要显示关于支付方式的特定信息。建议您在页面上收集用户信息或显示支付方式所需信息，以减少重定向，从而提高支付成功率。详情如下：

*   **从用户收集额外信息**：BLIK 和 P24 支付需要额外信息。您可以在您的页面上提供一个输入框来收集这些信息，并通过调用 [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 将信息传递给支付宝。如果您不提供输入框，支付宝会提供一个额外的页面来收集信息。
**注意**：您必须通过 [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 传递收集到的信息，以防止支付宝再次收集这些信息。

*   **显示支付方式的额外信息**：对于 IDEAL，您可以在支付方式页面上显示 IDEAL 支持的具体银行，让用户进行选择。如果您不显示银行选项，用户在您的支付方式页面选择 IDEAL 后，会被重定向到 IDEAL 的页面来选择可用银行。

下表列出了需要额外信息的支付方式以及默认和推荐方案的用户体验：

| **支付方式** | **BLIK** | **Przelewy24** | **iDEAL** |
| --- | --- | --- | --- |
| **参数** | blikCode | payerEmail | bankIdentifierCode |
| **参数描述** | 六位动态PIN码 | 用户的电子邮件地址 | 银行的标识代码 |
| **请求示例** | "paymentMethod": {"paymentMethodType": "BLIK","paymentMethodMetaData": {"blikCode": "123456"}} | "paymentMethod": {"paymentMethodType": "P24","paymentMethodMetaData": {"payerEmail": "123456@alipay.com"}} | "paymentMethod": {"paymentMethodType": "IDEAL","paymentMethodMetaData": {"bankIdentifierCode": "ABNANL2A"}} |
| **用户体验（默认方案）** | 支付宝获取BLIK动态码：image | 支付宝获取用户邮箱：image | iDEAL显示特定银行：image |
| **用户体验（推荐方案）** | 您收集BLIK动态码：image | 您收集用户邮箱：image | 您显示特定银行：image |
**表4. 收集或显示额外信息的参数描述和用户体验**

步骤2：获取重定向URL并启动支付流程
--------------------------------------
### 1. 拦截无效支付  
为了避免重复支付或支付过期，建议用户点击或触摸“支付”后，验证支付的状态和有效期。  
**Web**  
**WAP**  
**App**  
![图片18：使用不包含卡的支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1677222520472-bfe8a69c-9973-42ac-a46a-ae17eb7f4aac.png?x-oss-process=image%2Fresize%2Cw_1586)  
图4. Web支付状态验证  
![图片19：使用不包含卡的支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1677222684761-e192acd3-35a9-4c19-8796-c469ff0f5170.png?x-oss-process=image%2Fresize%2Cw_1586)  
图4. WAP支付状态验证  
![图片20：使用不包含卡的支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1677222768201-6bf027dc-5182-4392-8083-2d51a9e59002.png?x-oss-process=image%2Fresize%2Cw_1586)  
图4. App支付状态验证  
为了拦截过期支付，您可以在支付请求中设置`paymentExpiryTime`参数来设定支付有效期。如果用户在支付有效期后支付，系统会报告错误或自动退款。设置支付有效期还可以防止用户在被重定向到支付页面后长时间未支付而可能导致的重复支付。  
服务器的时间偏移也可能导致重复支付。建议用户支付后，检查订单的支付状态。如果订单之前已经支付，您可以调用[**cancel**](https://global.alipay.com/docs/ac/ams/paymentc_online) API取消支付，或调用[**refund**](https://global.alipay.com/docs/ac/ams/refund_online) API向用户全额退款，并相应地提示用户。
### 2. 发起支付请求并获取重定向URL  
当用户点击或触摸“确认支付”后，您的客户端应向服务器请求一个重定向URL，然后服务器调用[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 获取重定向URL，并将其返回给客户端。在发送请求后，获取重定向URL之前，应将“确认支付”按钮灰显，以防止用户重复操作。

如果客户端在向服务器请求重定向URL时支付失败，服务器可以调用[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 使用新的_paymentRequestId_ 重新发起支付请求。然而，由于网络问题，重试请求可能再次失败。建议为请求设置过期时间，避免用户长时间等待，并允许在服务器无法获取重定向URL时用户重新尝试支付。遵循以下流程图：

Web:
![Image 21: 使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673852829776-a868180c-6f42-4ee7-a881-a37ae56d4fbd.png?x-oss-process=image%2Fresize%2Cw_1586)  
图5. 获取Web端重定向URL

WAP:
![Image 22: 使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673852574668-e6643b67-1980-46b2-af21-1bf9951a9630.png)  
图5. 获取WAP端重定向URL

App:
![Image 23: 使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673853211722-f0dc8646-c643-4359-aeea-6411b69ebc9b.png)  
图5. 获取App端重定向URL

在您的请求中，需要指定以下参数。详细信息请参阅[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 文档：

| **参数名称** | **描述** |
| --- | --- |
| paymentRequestId | 请求的唯一标识符。 |
| env | 根据客户端类型指定*terminalType*：* Web：将*terminalType*设为WEB。 * WAP：将*terminalType*设为WAP，并指定*osType*。 * App：将*terminalType*设为APP，并指定*osType*。 |
| referenceOrderId/paymentRequestId | *referenceOrderId*通常指订单ID，*paymentRequestId*通常指交易ID。支付宝允许一个订单ID对应多个交易ID，也可以建立一对一的对应关系。 |
| paymentRedirectUrl | Web：传入桌面网站重定向URL。 WAP：传入网页URL重定向URL。 App：传入深度链接URL。 |
| paymentNotifyUrl | 将*paymentNotifyUrl*设为HTTPS URL。 |
表5. pay API的关键请求参数
### 3. 调起支付流程  
在调用[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 时，根据指定的 _terminalType_ 值，支付宝会返回以下URLs：
*   normalUrl
*   orderCodeForm
*   schemeUrl
*   applinkUrl
*   redirectUrl  
不同终端类型的URL返回详情，请参考[支付重定向URL](https://global.alipay.com/docs/ac/cashierpay/payment_redirect)。  
支付宝调起支付流程时返回以下参数：
#### Web、WAP、App
| **响应参数** | **描述** | **使用方式** |
| --- | --- | --- |
| normalUrl | 移动重定向URL | 移动端重定向URL，用户会被重定向到网页URL或在新标签页中打开URL以完成支付。 |
| orderCodeForm.codeDetails.codeValue | 支付码值 | 支付二维码或支付密码。对于某些支付方式，可以在自己的页面上显示二维码或密码，而不是将用户重定向到支付方式提供的支付页面，减少重定向次数，提升支付体验。 |

**表6. 调起支付流程的响应参数**

对于使用不同支付方式的支付，建议如下使用 _codeValue_：
| **支付方式** | **codeValue** | **处理方式** |
| --- | --- | --- |
| AlipayHK, TrueMoney, Touch 'n Go, AlipayCN, GCash, KaKaoPay, Rabbit LINE Pay | 二维码 | 可在页面上显示二维码，无需将用户重定向到支付方式的支付页面。 |
| 银行转账支付方式 | 支付密码和二维码 | 可在页面上显示二维码和支付密码，无需将用户重定向到支付方式的支付页面。 |

**表7. 不同支付方式的_codeValue_处理**

对于在桌面网站上发起的支付，需要将用户重定向到重定向URL或在新标签页中打开URL。
![图片24：使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673869978097-1d7592dc-9377-4eae-bccc-60a6bdbb8663.png)  
图6. 桌面网站支付结账体验  
**注意事项**：  
1. 调用支付流程时，使用try-catch语句捕获错误，并向用户适当地显示提示。在集成项目上线前进行完整性验收。
2. 若干支付方式的重定向URL只能打开一次。如果调用结账页面失败，需使用新的_paymentRequestId_重新发送请求以获取重定向URL并再次调用页面。
3. 对于银行转账支付方式和某些钱包支付方式，您可以按照常规做法通过_normalURL_将用户重定向到结账页面。或者您也可以在您的页面上显示通过_codeValue_获取的二维码和支付密码。  

| **响应参数** | **描述** | **用法** |
| --- | --- | --- |
| normalUrl | 移动重定向URL | 用于移动设备的重定向URL，用户会被重定向到网页URL或在新标签页中打开以完成支付。 |
| appURLUrl | App Link或Universal Link，可在WebView中加载为网页URL | 可以唤起支付方式应用，也可作为网页URL打开。 |
| schemeUrl | 深度链接 | 用于唤起支付方式应用，此类URL由移动银行应用支付方式提供。 |  
表6. 调用支付流程的响应参数  
为了确保支付流程能够成功唤起，建议按照以下方式打开URL：  
```javascript
// 可以如下代码将用户重定向到URL。
window.location.href = URL;
// 可以如下代码唤起应用。
if (response.schemeUrl) {
  window.location.href = response.schemeUrl;
} else if (response.applinkUrl) {
  window.location.href = response.applinkUrl;
}
```
请注意，以上代码示例是假设您正在使用JavaScript进行网页开发。
对于在网页上发起的支付，您需要将用户重定向到重定向URL或在新标签页中打开URL。
![图25：使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673937799239-fa70e328-566b-4ec3-8615-b631f652999d.png?x-oss-process=image%2Fresize%2Cw_1634)
图6. 移动网站支付的结账体验
**注意事项**:

1. 调用支付流程时，使用try-catch语句捕获错误并适当地提示用户。在集成项目上线前进行完整性验收。
2. 某些支付方式的重定向URL只能打开一次。如果未能调起结账页面，使用新的_paymentRequestId_重新发送请求以获取重定向URL并再次调起页面。
3. 对于银行转账支付方式和某些钱包支付方式，您可以按照常规操作将用户重定向到结账页面通过_normalURL_。或者您也可以在您的页面上显示通过_codeValue_获取的二维码和支付密码。

| **响应参数** | **描述** | **用法** |
| --- | --- | --- |
| appIdentifier | 支付方式的包名。 | 用于判断支付方式应用是否已安装，以避免在应用内支付时出现选择歧义对话框。 |
| applinkUrl | App Link或Universal Link。可以在WebView中加载为网页URL。 | 用于调起支付方式应用，也可作为网页URL打开。 |
| schemeUrl | 深度链接 | 用于调起支付方式应用，让用户完成支付。 |
| normalUrl | 移动重定向URL | 用户完成支付的移动重定向URL。 |

表6. 调用支付流程的响应参数
对于应用内支付，需要了解处理支付宝返回URL的以下三种方式：

| **处理方式** | **描述** |
| --- | --- |

由于您是金融技术领域的专家，您可能已经知道，对于应用内支付，通常需要处理这些URL以确保支付流程的顺利进行。具体实现可能因平台（如Android或iOS）和集成方式而异，但这些基本概念是通用的。在处理这些URL时，您需要确保能够正确地启动支付应用或在应用内展示支付页面，以便用户完成交易。
| 调用支付方式应用进行支付 | 从您的应用中调用支付方式应用进行支付。 |
| 在WebView中加载URL进行支付 | 使用WebView在您的应用中加载URL进行支付。 |
| 在默认浏览器中加载URL进行支付 | 从您的应用重定向用户到网页URL进行支付。 |
**表7. 应用内支付URL处理**  
某些支付方式，如银行支付方式，仅支持在网页URL上支付，而其他支付方式仅支持在支付方式应用内支付。因此，支付场景分为以下五种类型：  
![图片26：使用不包含卡的支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1673941800566-511286f2-e4b5-4677-9e41-28915f455e77.png?x-oss-process=image%2Fresize%2Cw_1634)  
**图6. 移动应用支付用户体验**  
*   **支付方式应用支付**：用户选择支付方式后，通过_schemeURL_或_applinkURL_调用的支付方式应用内完成支付。
*   **WebView中的网页URL支付**：用户选择支付方式后，在您的应用中通过WebView加载的_normalUrl_或_applinkUrl_上的网页URL完成支付。
*   **WebView中的支付方式应用支付**：用户选择支付方式后，首先在您的应用中重定向到中间页面，然后通过_normalUrl_或_applinkUrl_调用支付方式应用完成支付。
*   **默认浏览器中的网页URL支付**：用户选择支付方式后，通过_normalUrl_或_applinkUrl_在默认浏览器加载的网页URL上完成支付。
*   **默认浏览器中的支付方式应用支付**：用户选择支付方式后，首先在默认浏览器中重定向到中间页面，然后通过_normalUrl_或_applinkUrl_调用支付方式应用完成支付。
我们建议您提前配置不同支付方式的路由，或者根据实际使用的支付方式、返回的URL以及用于打开URL的客户端进行路由设置：

![图27：图片](https://yuque.antfin.com/images/lark/0/2023/png/40556573/1673947321273-d7cc838a-3420-4993-ba6a-bccd28d4a4d0.png)
![图28：图片](https://yuque.antfin.com/images/lark/0/2023/png/40556573/1673948488869-8c1f9c33-91bd-4578-964e-ecf0e8cabbd3.png)
图7. 支付流程调用计划

**注意事项**：

1.  调用支付流程时，使用try-catch语句捕获错误并适当地提示用户。在集成项目上线前进行完整性验收。
2.  若干支付方式的重定向URL只能打开一次。如果调用支付页面失败，使用新的_paymentRequestId_重新发送请求以获取重定向URL，并再次调用页面。

步骤3：获取支付结果
### 1. 重定向到结果页面  
您可以通过在 [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 中设置 `_paymentRedirectUrl` 来设定重定向URL。  
*   对于在桌面浏览器中发起的支付，建议提供一个网页URL。
*   对于在移动浏览器中发起的支付，建议提供一个深度链接。
*   对于在应用中发起的支付，必须提供一个深度链接。  
对于在桌面浏览器中发起的支付，用户完成支付后，首先会被重定向到支付宝的支付结果页面，然后在短暂倒计时后重定向到指定的URL。对于在移动设备上发起的支付，用户完成支付后会被重定向到支付方式的首页。  

> **注意**：由于网络问题或用户操作不当，重定向可能会失败。
>
> *   对于在桌面或移动浏览器中发起的支付，如果网页URL在新标签页中打开，建议您在自己的页面上监控支付状态，以提供顺畅的支付体验。
> *   对于在应用中发起的支付，如果网页URL在默认浏览器中加载，支付可能会因手机型号而失败。此时，浏览器会弹出对话框询问用户是否启动您的应用，用户可能选择**否**并手动打开您的应用。因此，建议您监控支付结果页面的调用和用户手动打开应用的行为。  

在不同客户端发起的支付，用户完成支付后，将通过以下方式重定向：  
- 网页
- 移动网页（WAP）
- 应用  
![Image 29: 使用非卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1674010269547-28fca833-5202-4f55-be2b-7ddee9896858.png)  
图8. 重定向至支付结果页面
**图片 30：使用非信用卡支付方式支付**

**图 8. 跳转到支付结果页面**

**图片 31：使用非信用卡支付方式支付**

**图 8. 跳转到支付结果页面**

请注意，上述文本中的两个图都标记为图 8，这可能是重复或错误的。在原始文档中，它们可能应该被标记为不同的图号以区分两个不同的支付流程步骤。如果需要更准确的翻译或有其他相关文档的上下文，请提供更多信息。
### 2. 获取异步通知  
除了通过重定向到支付结果页面获取支付结果，您还可以在[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API 中设置异步通知地址（_paymentNotifyUrl_）。当支付完成或超时时，支付宝会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API 向该地址发送异步通知。  
收到支付宝的通知后，您必须按照[代码示例](https://global.alipay.com/docs/ac/cashierpay/notifications#JtjSl)返回响应。如果您没有向支付宝返回响应，或者由于网络问题支付宝未接收到响应，支付宝会在24小时内自动重试发送异步通知，最多重试8次，直到收到正确的响应。发送间隔如下：0秒，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。  

> **注意事项**：
>
> *   支付完成后，支付方式提供商会立即发送支付通知。支付失败时，支付方式提供商会在支付订单关闭后发送支付通知。默认订单过期时间为支付发起后14分钟。
> *   如果用户在支付完成时选择Sofort支付，支付状态会变为`PENDING`。Sofort确认支付结果（通常1-3天，最多7天）后，如果确认支付成功，支付状态将变为`SUCCESS`；如果确认支付失败，支付状态将变为`FAIL`。当支付状态变为`SUCCESS`或`FAIL`时，支付宝会通过_paymentNotifyUrl_发送异步通知。
> *   对于泰国银行转账支付方式，默认订单过期时间为48小时。因此，当支付
> * 若付款失败，最迟在付款发起后48小时内会收到同步通知。
### 3. 查询支付状态  
异步通知和同步重定向都可能无法接收到或执行成功。原因如下表所示：

|  | **原因** | | **处理** |
| --- | --- | --- | --- |
| **异步通知** | 由于网络问题无法接收到通知。 | | 支付宝会自动重发通知。 |
| **同步重定向** | Web/WAP | App |  |
| * 网络问题导致重定向失败。 * 用户完成支付后手动关闭浏览器。 | * 支付方式不支持重定向。 * 支付方式应用或你的应用崩溃。 * 弹出询问是否打开应用的对话框，用户点击**否**。 * 用户完成支付后手动关闭应用或应用在后台运行。 |

表8. 无法获取支付结果的原因

建议通过调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 来查询支付状态。以下是一些适用场景：

- Web & WAP
- App

**在调起支付结果页之前**：当在支付方式页面发起支付时，可以自动触发调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 以进行后续重定向。

**当用户查询支付结果**：当用户在你的页面上点击或触摸“我已经支付”或具有相同含义的按钮时，可以调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 来检查支付状态。

**当支付超时**：当支付达到超时时，可以调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 来检查支付状态。
**在调起支付结果页之前或用户手动打开您的应用时**: 当支付在支付方式的 app 或页面上发起时，您可以自动调用 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 以实现后续重定向。

**用户查询支付结果时**: 当用户在您的应用中点击“已支付”或具有相同含义的按钮时，您可以调用 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 来检查支付状态。

**支付超时时**: 当支付达到超时时间，您可以调用 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 来检查支付状态。

通过 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 返回的响应中，`paymentStatus` 字段表示支付状态。详细信息如下表所示：

| **paymentStatus** | **类型** | **描述** | **处理方式** |
| --- | --- | --- | --- |
| SUCCESS | 最终状态 | 支付成功。 | 可以显示支付成功页面。 |
| PROCESSING | 中间状态 | 支付正在处理中。 | 可以让用户继续支付。 |
| PENDING | 中间状态 | 用户完成支付，等待支付方式提供者确认支付状态。 | 可以提示用户支付状态需由支付方式提供者确认。 |
| FAIL | 最终状态 | 用户未支付或支付失败。 | 可以让用户继续支付或关闭支付订单。 |
| CANCELLED | 最终状态 | 支付被您取消。 | 可以让用户继续支付或关闭支付订单。 |

**表9. paymentStatus 的详细说明**

关于支付状态的详细描述，请参阅 [支付状态描述](https://global.alipay.com/docs/ac/cashierpay/payment_status_desc)。
我们建议您在服务器端维护支付状态，客户端根据服务器提供的信息进行支付流程。处理逻辑如下图所示：

**Web、WAP、App**

![图片32：使用非信用卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1674041174636-e77aa0ef-58d6-4bde-b289-512d82e3d9a3.png?x-oss-process=image%2Fresize%2Cw_1634)
**图9. 根据支付状态的处理逻辑**

![图片33：使用非信用卡支付方式支付](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/40556573/1674042049985-dcfff237-a2e8-4a59-9019-2e9e70aa4c12.png)
**图9. 根据支付状态的处理逻辑**

要查看文档的最新更新，请访问[版本说明](https://global.alipay.com/docs/releasenotes)。

![图片34](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片35](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面有帮助吗？

#### 本页内容

[前提条件](#cXNt1 "前提条件")  
[用户体验](#wZXRY "用户体验")  
[集成过程](#L8XEk "集成过程")  
[步骤1：获取并显示可用支付方式](#GJ2Qc "步骤1：获取并显示可用支付方式")  
[1. 获取支付方式](#ngWo9 "1. 获取支付方式")  
[2. 过滤支付方式](#rFruV "2. 过滤支付方式")  
[3. 显示支付方式](#pIZTg "3. 显示支付方式")  
[4. 收集或显示额外信息](#fCDj2 "4. 收集或显示额外信息")  
[步骤2：获取重定向URL并启动支付流程](#pQMWG "步骤2：获取重定向URL并启动支付流程")
1. **拦截无效支付**
   在这个步骤中，你需要设置机制来检测并阻止任何无效或不合法的支付请求，确保交易的安全性。

2. **发送支付请求并获取重定向URL**
   用户发起支付请求后，你的系统应与蚂蚁金服的接口交互，获取一个用于用户支付的重定向URL。这个URL将引导用户到支付页面完成交易。

3. **启动支付流程**
   用户被重定向到支付URL后，他们将进行支付操作。在这个阶段，蚂蚁金服处理支付细节，包括验证用户信息、处理支付请求等。

**步骤3：获取支付结果**
   
1. **重定向到结果页面**
   支付完成后，用户会被重定向回你的应用或网站上的一个结果页面，显示支付是否成功。

2. **接收异步通知**
   除了页面重定向，你的系统还应设置接收蚂蚁金服发送的异步通知，这些通知会确认支付状态，即使用户在支付后没有立即返回你的应用。

3. **查询支付状态**
   为了确保数据的准确性，你还可以主动通过API查询支付状态，以验证接收到的异步通知或用户页面显示的结果。这有助于处理任何可能的网络延迟或通信问题。
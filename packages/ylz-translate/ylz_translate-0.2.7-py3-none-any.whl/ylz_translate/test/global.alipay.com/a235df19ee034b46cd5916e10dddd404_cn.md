API 规范 | 通用参考 | 支付宝文档
===============

[![图片 1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片 2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fgr%2Fapispec)

[返回首页](../../)

通用参考
---------

[API 规范](/docs/ac/gr/apispec)

[数字签名](/docs/ac/gr/globalgs)

[数字签名（新）](/docs/ac/gr/signature)

[错误代码](/docs/ac/gr/error_code)

[开始使用](/docs/ac/gr/get-start)

[术语表](/docs/ac/gr/glossary)

[退款](/docs/ac/gr/refund)

[集成指南](/docs/ac/gr/integration)

[更新日志](/docs/ac/gr/release_notes)

[交易状态](/docs/ac/gr/trade_status)

[API幂等性](/docs/ac/gr/idempotency)

[支付宝标识](/docs/ac/gr/logo)

API 规范
=================

2021-02-26 07:01

简介
------------

支付宝 API 是基于 Web 的 API，包含请求和响应消息。
### 网关URL：
| 环境 | HTTPS请求URL |
| --- | --- |
| 生产环境 | [https://intlmapi.alipay.com/gateway.do](https://intlmapi.alipay.com/gateway.do) |
| 测试环境 | [https://mapi.alipaydev.com/gateway.do](https://mapi.alipaydev.com/gateway.do) |

### 请求与响应消息结构
以下示例展示了支付宝Web API的消息结构。

**API请求：**
将网关信息、参数及其值、签名类型和值用字符"&"连接，形成完整的URL地址。例如：
```text
https://mapi.alipaydev.com/gateway.do?_input_charset=UTF-8&service=create_forex_trade&partner=2088101122136***&out_trade_no=test201707180942***&subject=test123&body=test&currency=USD&total_fee=0.01&product_code=NEW_OVERSEAS_SELLER&notify_url=http://localhost:8080/create_forex_trade-JAVA-UTF-8-RSA/notify_url.jsp&return_url=http://localhost:8080/create_forex_trade-JAVA-UTF-8-RSA/return_url.jsp&sign_type=RSA&sign=H6WZp6aQqNkr5j%2BaclPlSz45L3udPBoXf8KS5CfHKaB1oWdDs8mte5TPy6GInJCpET0I9aSPc%2FlXqlTkVee64%2F01wyHumWQriMW7tB%2F0Rlko6jImL0QysX4y%2BsonxHs94t7wmUf9zAoAcLGZplnsn4n04u4eprBI%2B3SIqJDd82k%3D
```

**API响应：**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<alipay>
    <is_success>T</is_success>
    <request>
        <param name="_input_charset">UTF-8</param>
        <param name="currency">USD</param>
        <param name="buyer_identity_code">2013112012345678</param>
        <param name="identity_code_type">qrcode</param>
        <param name="mcc">4021</param>
        <param name="extend_info">{"licence":"123",name=”LG”}</param>
        <param name="partner_trans_id">2010121000000002</param>
        <param name="partner">2088102012343978</param>
        <param name="password">SJV88po0XvIptqWGM4rxP5EQ</param>
        <param name="memo">shopping</param>
        <param name="service">alipay.acquire.overseas.pay</param>
        <param name="sign">22904adafb1806178b410d2d5c9c02a3</param>
        <param name="sign_type">MD5</param>
    </request>
</alipay>
```

请注意，上述示例中的星号（***）用于隐藏敏感信息。实际操作中，这些值会根据具体交易和应用环境而变化。
**交易名称:** Belkin 手环类型  
**交易金额:** 39.25  
**交易创建时间:** 2013年11月20日15:30:59

**响应:**
**支付宝信息:**
**支付宝交易号:** 2011091703338463  
**合作伙伴交易号:** 201311221000000002  
**支付宝买家登录ID:** caoxxx@126.com  
**支付宝买家用户ID:** 2088102130896433  
**支付宝支付时间:** 2013年11月20日15:58:23  
**汇率:** 6.0939  
**交易金额:** 39.25  
**交易金额（人民币）:** 239.19  
**结果代码:** 成功

**签名:** 6fb8a322f15cfd0fcfe65301b10f6994  
**签名类型:** MD5

**注意:**
1. 请求和响应中的服务参数根据服务的不同而变化。具体信息请参阅特定接口的说明。
2. 对于GET请求和POST请求，如果请求参数的值包含特殊字符或中文字符，需要对请求URL中所有参数的值进行URL编码。
3. 对于POST请求，需要在网关URL中包含\_input\_charset字段。例如，如果请求参数值包含中文字符，网关URL为: <https://intlmapi.alipay.com/gateway.do?_input_charset=utf-8>

**数字签名:**
数字签名用于确保消息的真实性。调用API时，客户端和支付宝需要交换公钥。因此，每一方保留自己的私钥，并将公钥分享给对方。发送消息时，发送方使用其私钥对消息签名，接收方则使用发送方的公钥验证接收到的消息。签名消息的步骤如下:
1. 准备密钥
1. 获取MD5密钥
   使用您的用户ID登录[全球门户](https://global.alipay.com/)，查看技术服务页面以获取MD5密钥。

2. 获取RSA/DSA密钥
   从[OpenSSL网站](https://www.openssl.org/source/)下载并安装OpenSSL，然后生成密钥对。

3. 创建预签名字符串
   要创建预签名字符串，请遵循以下步骤：
   * 确定要签名的参数。
   除了"sign"和"sign_type"（在某些请求参数列表中也需要签名）之外，请求和响应参数列表中的所有参数都需要签名。
   * 按字母顺序排序参数。
   按照参数键值的第一个字符的ASCII码升序排序。对于第一个字符相同的参数，根据第二个字符进行排序。
   * 创建预签名字符串。
   将所有排序后的参数以"参数名=参数值"的格式组合，并用"&"字符连接，形成预签名字符串。

4. 签名请求
   生成预签名字符串后，执行以下步骤生成签名：
   * 使用RSA/DSA算法和商家私钥生成签名。
   * 将签名编码为字符串。
   * 将此字符串作为"sign"参数的值。

5. 异步或同步通知
   * 异步通知：如果在请求中设置了"notify_url"字段并指定了处理异步通知的目标URL，系统会使用POST方法向API调用者发送异步API响应。
   * 同步通知：如果在请求中设置了"return_url"字段并指定了处理同步通知的目标URL，系统会使用GET方法向API调用者发送同步API响应。
交易成功后，您可能会收到异步和同步两种响应。建议处理异步通知。您可以验证异步和同步通知，但这不是强制性的。

支付宝会在25小时内重试8次发送异步通知，直到接收方在响应中发送字符串“SUCCESS”（不带引号）以确认收到通知。支付宝的重试频率为：2分钟、10分钟、10分钟、1小时、2小时、6小时和15小时。
### 验证异步通知  
收到通知后，建议验证签名的真伪，以确保通知中的数据来自支付宝且在传输过程中未被修改。可以通过以下步骤验证通知：

#### MD5
1. 在开始验证通知内容之前，先确认通知发送方是否为支付宝。详细信息请参考[Notify_verify 方法](https://global.alipay.com/doc/global/notify_verify)。如果验证发送方为支付宝，Notify_verify 方法将返回 ResponseTxt==true。如果不是支付宝，则无需继续后续步骤。
2. 处理支付宝发送的通知内容，生成预签名字符串。
   a. 移除 `sign` 和 `sign_type` 字段。
   b. 将剩余字段按字母顺序从 A 到 Z 排序。
   c. 使用 "&" 符号连接所有数组值。
   以 create_forex_trade API 的异步响应数据为例：
   ```
   notify_id=5b89a773c60af059d96b1693dd3b3d6nc1&notify_type=trade_status_sync&sign=b34d89788d9012f77f5b74ac232145f5&trade_no=2018110922001332950500389138&total_fee=0.01&out_trade_no=test20181109153145&notify_time=2018-11-09 15:36:17&currency=USD&trade_status=TRADE_FINISHED&sign_type=MD5
   ```
   处理后，得到待签名的字符串：
   ```
   currency=USD&notify_id=5b89a773c60af059d96b1693dd3b3d6nc1&notify_time=2018-11-09 15:36:17&notify_type=trade_status_sync&out_trade_no=test20181109153145&total_fee=0.01&trade_no=2018110922001332950500389138&trade_status=TRADE_FINISHED
   ```
3. 获取 mysign 参数的值。
   a. 将 MD5 密钥添加到步骤 2 中得到的预签名字符串的末尾。
   b. 使用 MD5 加密函数加密包含预签名字符串和 MD5 密钥的字符串，生成的值赋给 mysign 参数。
4、验证mysign是否等于sign。如果在步骤3中获取的mysign值与支付宝返回的sign值相等，那么签名验证通过，你可以信任通知的内容。
#### RSA
1、在验证通知内容之前，首先要确保通知是由支付宝发送的。要验证通知的发送者，请参阅Notify_verify API的详细信息。如果通过Notify_verify方法确认发送者是支付宝，你会得到ResponseTxt==true的结果。如果发送者不是支付宝，无需继续以下步骤。
2、处理支付宝发送的通知内容，生成预签名字符串。
a、移除`sign`和`sign_type`字段，
b、将剩余字段按字母顺序从A到Z排序，
c、使用字符"&"连接所有数组值。
以create_forex_trade API的异步响应数据为例：
```
currency=USD&notify_id=5ac226e4cf7822d205cedcc252b54ebge1&notify_time=2017-08-16 15:24:12&notify_type=trade_status_sync&out_trade_no=test20170816150740&total_fee=0.01&trade_no=2017081621001003050502834160&trade_status=TRADE_FINISHED&sign_type=RSA&sign=NN2trlV3PKBjZN7KS4oE8PG8WkHFqXIvvQl32fJ2FO9J+HniSuvv36VYPWbARVmodnTvYVkFmR2FB9ioDX0iRTRRSCkz8+ox3ytrlRdRfaeGMSGBuHN6WP/tAHscBbNvjkzyshjTCoXO6MFFg92CR2K50DvtNNUerZa/mx4lA5I=
```
3、处理后，得到待签名的以下内容：
```
currency=USD&notify_id=5ac226e4cf7822d205cedcc252b54ebge1&notify_time=2017-08-16 15:24:12&notify_type=trade_status_sync&out_trade_no=test20170816150740&total_fee=0.01&trade_no=2017081621001003050502834160&trade_status=TRADE_FINISHED
```
4、使用Base64编码方案将签名参数（sign）编码为字节字符串。
5、使用RSA验证方法来验证签名。将预签名字符串、sign参数的值以及支付宝的公钥传递给RSA验证方法，以检查验证结果。有关RSA验证方法的更多信息，请参阅示例代码中的以下方法：
```java
public static boolean verify(String content, String sign, String ali_public_key, String input_charset)
```
要获取支付宝的公钥，请联系全球商户技术支持（overseas_support@service.alibaba.com）。
### 验证同步通知  
收到通知后，建议验证签名的真实性，以确保通知中的数据来自支付宝且在传输过程中未被修改。通过以下步骤，可以验证通知并信任其内容。  
#### MD5  
1、处理支付宝发送的通知内容，获取预签名字符串。  
a、移除`sign`和`sign_type`字段，  
b、按字母顺序（A到Z）对剩余字段排序，  
c、使用"&"字符连接所有数组值。  
**注意：**  
如果返回的通知是XML格式，返回的参数包含在节点中。可以将每个节点名称作为参数名，节点值作为参数值。以`create_forex_trade` API的同步响应数据为例：  
```  
out_trade_no=test20181109153145&total_fee=0.01&trade_status=TRADE_FINISHED&sign=32c532376eee9281fa4d424dd4a40e5b&trade_no=2018110922001332950500389138&currency=USD&sign_type=MD5  
```  
处理后，得到待签名的内容：  
```  
currency=USD&out_trade_no=test20181109153145&total_fee=0.01&trade_no=2018110922001332950500389138&trade_status=TRADE_FINISHED  
```  
2、获取`mysign`参数的值。  
a、将MD5密钥添加到步骤1中获取的预签名字符串的末尾。  
b、使用MD5加密函数加密由预签名字符串和MD5密钥组成的字符串，生成的值赋给`mysign`参数。  
3、验证`mysign`是否等于`sign`。如果步骤3中获取的`mysign`值与支付宝返回的`sign`值相等，签名验证通过，可以信任通知的内容。  
#### RSA  
1、处理支付宝发送的通知内容，获取预签名字符串。  
a、移除`sign`和`sign_type`字段，
b. 将剩余的字段按字母顺序从A到Z排序  
c. 使用字符"&"将所有数组值连接起来  
**注意：**  
如果返回的通知是XML格式，返回的参数包含在节点中。您可以将每个节点名称作为参数名称，节点值作为参数值。以创建外汇交易API的同步响应数据为例：  
复制  
currency=USD&out_trade_no=test20170816150740&trade_no=2017081621001003050502834160&total_fee=0.01&trade_status=TRADE_FINISHED&sign=cOb1oftUVcIQFNcep%2FiVuR0HHxkrXa8eYH1xuYkBFZ4bNz7rBcsptahYnDeImzmq%2FND7mIjshyYw0Kt%2BuvM4fG7UzJHmSQS0JhMcmfIls60Qmd6UYpoTNEWi5jY7P%2BIB%2BxLyjRDFZgfkRX3jDkEGbvwgzYpEqhS1bx%2FdHn1kh7Y%3D%20  
处理后，您将得到以下待签名内容：  
复制  
currency=USD&out_trade_no=test20170816150740&total_fee=0.01&trade_no=2017081621001003050502834160&trade_status=TRADE_FINISHED  
2. 使用Base64编码方案将签名参数（sign）编码为字节字符串。  
3. 使用RSA验证方法验证签名。将预签名字符串、sign参数的值和支付宝公钥传递给RSA验证方法以检查验证结果。有关RSA验证方法的更多信息，请参阅示例代码中的以下方法：  
复制  
public static boolean verify(String content, String sign, String ali_public_key, String input_charset)  
要获取支付宝公钥，请联系全球商户技术支持（overseas\_support@service.alibaba.com）。  
**使用限制**  
如果这里的接口描述和规范限制与特定API文档上的信息冲突，特定API文档上的信息优先。  
要查看文档的最新更新，请访问[版本说明](https://global.alipay.com/docs/releasenotes)。
请注意，由于Markdown格式的限制，图片无法直接翻译，但我会提供文字内容的翻译。以下是文档的中文翻译：

---

### 图片3和图片4（请查看原始文档以查看图片）

### 2024年支付宝 法律信息 [查看法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面有帮助吗？

#### 在这个页面上

#### [简介](#Introduction "简介")
#### [网关URL：](#c34ad516 "网关URL:")
#### [请求和响应消息结构](#cd033da8 "请求和响应消息结构")
#### [数字签名](#e05880f4 "数字签名")
#### [异步或同步通知](#985bc89d "异步或同步通知")
#### [验证异步通知](#nVECC "验证异步通知")
#### [MD5](#MD5 "MD5")
#### [RSA](#RSA "RSA")
#### [验证同步通知](#95fe3caf "验证同步通知")
#### [MD5](#q8ZnR "MD5")
#### [RSA](#qjMTB "RSA")

---

请注意，这里提供的翻译是基于原文档结构的简要翻译，具体的技术细节和说明需要参考原始文档以获取完整信息。
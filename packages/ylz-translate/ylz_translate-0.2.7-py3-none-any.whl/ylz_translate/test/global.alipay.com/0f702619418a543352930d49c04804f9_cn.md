信用卡支付(iOS) | 结账支付 | 支付宝文档
===============  
[![支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)  
[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fioscard)  
[返回首页](../../)  
结账支付  
[概览](/docs/ac/cashierpay/overview)  
接受支付  
SDK集成  
[APM支付（Web/WAP）](/docs/ac/cashierpay/apm_ww)  
[APM支付（Android）](/docs/ac/cashierpay/apm_android)  
[APM支付（iOS）](/docs/ac/cashierpay/apm_ios)  
[信用卡支付（Web/WAP）](/docs/ac/cashierpay/wwcard)  
[信用卡支付（Android）](/docs/ac/cashierpay/adcard)  
[信用卡支付（iOS）](/docs/ac/cashierpay/ioscard)  
仅API集成  
支付后操作  
支付方式  
其他资源  
高级功能  
[预前端解决方案API](/docs/ac/cashierpay/prefront)  
[先买后付API](/docs/ac/cashierpay/bnpl)  
[卡存储API](/docs/ac/cashierpay/cv)  
[卡存储SDK](/docs/ac/cashierpay/cvsdk)  
[卡支付功能API/SDK](/docs/ac/cashierpay/mf?pageVersion=7)  
信用卡支付（iOS）
===================  
2024-05-11 10:13  
Antom SDK 是一个预构建的UI组件，用于收集卡信息并为您处理3D验证流程。集成此组件不需要您具有PCI资格，适合那些希望委托Antom收集卡信息的情况。  
用户体验
===============  
以下图表展示了在应用程序中支付的用户流程：  
![Image 3: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1711338358204-54fb815f-6754-404f-a95a-6407e14573ce.png)  
支付流程
============  
对于每种支付方式，支付流程由以下步骤组成：  
![Image 4: 111卡.webp](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713521486080-190e455a-1bde-4081-bf79-568ea25a46fe.webp)  
1.  **用户进入结账页面。**  
1.  **创建** [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier) **请求**
在买家选择支付方式并提交订单后，您可以通过调用[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口获取支付会话。
2.  **调用客户端SDK**
在客户端，通过支付会话调用SDK。SDK将根据支付方式的特性处理信息收集、重定向、应用调用、二维码显示、验证等过程。
3.  **获取支付结果**
通过以下两种方法之一获取支付结果：  
1.  异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中指定_paymentNotifyUrl_，设置接收异步通知的地址。支付成功或过期时，Antom会使用[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)向您发送异步通知。
2.  同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口检查支付状态。  
5.  **获取扣款结果**
对于信用卡支付，您需要通过以下两种方法之一获取扣款结果：  
1.  异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中指定_paymentNotifyUrl_，设置接收异步通知的地址。当支付请求成功或过期时，Antom会使用[**notifyCapture**](https://global.alipay.com/docs/ac/ams/notify_capture)向您发送异步通知。
2.  同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口检查支付请求状态。  
集成步骤
=================  
通过以下步骤开始集成：  
1.  创建支付会话
2.  创建并调用SDK
3.  获取支付结果
4.  获取扣款结果  
步骤1：创建支付会话 服务器端
--------------------------------------------  
当买家选择由Antom提供的支付方式时，您需要收集支付请求ID、订单金额、支付方式、订单描述、支付重定向URL和支付结果通知URL等关键信息，调用**createPaymentSession** API创建支付会话，并将支付会话返回给客户端。  
Antom为多种语言提供了服务器端API库。以下代码以Java为例，您需要安装Java 6或更高版本。
### 安装API库
您可以在[GitHub](https://github.com/alipay/global-open-sdk-java)上找到最新版本。  
复制以下内容：  
```xml
<dependency>
    <groupId>com.alipay.global.sdk</groupId>
    <artifactId>global-open-sdk-java</artifactId>
    <version>2.0.21</version>
</dependency>
```

这段代码是用于Maven项目的依赖配置，将它添加到您的`pom.xml`文件中，即可引入蚂蚁金服的全球开放SDK Java版本2.0.21。
### 初始化请求实例  
创建一个单例资源以向Antom发起请求。  
复制  
```java
import com.alipay.global.api.AlipayClient;
import com.alipay.global.api.DefaultAlipayClient;

String merchantPrivateKey = "您的私钥";
String alipayPublicKey = "支付宝公钥";
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);
```

这里的代码是Java语言，用于初始化一个默认的AlipayClient实例，这是蚂蚁金服API调用的基础。`merchantPrivateKey`是商户的私钥，`alipayPublicKey`是支付宝的公钥，`EndPointConstants.SG`通常代表请求的服务器端点。这个实例将用于后续的支付或其他相关服务的调用。
### 创建支付会话  
创建支付会话包括以下参数：  
<table style="width:748px;outline:none;border-collapse:collapse;border:1px solid #D9E4F2" class="lake-table"><colgroup><col width="211" span="1"><col width="97" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>参数名称</strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>是否必需</strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>描述</strong></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>productCode</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">代表使用的支付产品，根据合同规定。对于结账支付，值固定为 <code>CASHIER_PAYMENT</code>。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRequestId</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">商家为识别支付请求分配的唯一ID。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentAmount</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">商家请求接收的订单货币中的支付金额。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentMethod</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">商家或收单方用来收取支付的方法。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRedirectUrl</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">支付完成后，买家被重定向到的商家页面URL。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>order</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>是</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">订单信息，如买家、商家、商品、金额、配送信息和购买环境。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentNotifyUrl</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">支付结果通知地址，可以通过接口传入，也可以通过门户设置为固定值。</p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>settlementStrategy</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">支付请求的结算策略。</p></td></tr></tbody></table>  
以上参数是创建支付会话的基本参数，对于完整的参数和某些支付方式的额外要求，请参考[**createPaymentSession (Checkout Payment)**](https://global.alipay.com/docs/ac/ams/session_cashier)**。**  
#### 调用createPaymentSession API 的示例代码  
以下示例代码展示了如何调用 **createPaymentSession** API：  
```java
AlipayPaymentSessionRequest alipayPaymentSessionRequest = new AlipayPaymentSessionRequest();
alipayPaymentSessionRequest.setClientId(CLIENT_ID);
alipayPaymentSessionRequest.setPath("/ams/sandbox/api/v1/payments/createPaymentSession");
alipayPaymentSessionRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);  
// 替换为你的paymentRequestId
alipayPaymentSessionRequest.setPaymentRequestId("paymentRequestId01");  
Amount amount = new Amount();
amount.setCurrency("SGD");
amount.setValue("4200");  
alipayPaymentSessionRequest.setPaymentAmount(amount);  
// 设置paymentMethod
PaymentMethod paymentMethod = new PaymentMethod();
paymentMethod.setPaymentMethodType("CARD");
alipayPaymentSessionRequest.setPaymentMethod(paymentMethod);  
// 设置paymentFactor
PaymentFactor paymentFactor = new PaymentFactor();
paymentFactor.setAuthorization(true);
alipayPaymentSessionRequest.setPaymentFactor(paymentFactor);  
// 设置订单信息
Order order = new Order();
order.setReferenceOrderId("referenceOrderId01");
order.setOrderDescription("antom sdk test order");
order.setOrderAmount(amount);
Buyer buyer = new Buyer();
buyer.setReferenceBuyerId("yourBuyerId");
order.setBuyer(buyer);
order.setOrderAmount(amount);
alipayPaymentSessionRequest.setOrder(order);  
// 替换为你的通知URL
alipayPaymentSessionRequest.setPaymentNotifyUrl("https://www.yourNotifyUrl");  
// 替换为你的重定向URL
alipayPaymentSessionRequest.setPaymentRedirectUrl("https://www.yourMerchantWeb.com");
AlipayPaymentSessionResponse alipayPaymentSessionResponse = null;  
try {
    alipayPaymentSessionResponse = defaultAlipayClient.execute(alipayPaymentSessionRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}  
```
以下代码展示了请求消息的示例：  
```json
{
  "order": {
    "buyer": {
      "referenceBuyerId": "yourBuyerId"
    },
    "orderAmount": {
      "currency": "SGD",
      "value": "4200"
    },
    "orderDescription": "antom sdk test order",
    "referenceOrderId": "referenceOrderId01"
  },
  "paymentAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "paymentFactor": {
    "isAuthorization": true
  },
  "paymentMethod": {
    "paymentMethodType": "CARD"
  },
  "paymentNotifyUrl": "https://www.yourNotifyUrl",
  "paymentRedirectUrl": "https://www.yourMerchantWeb.com",
  "paymentRequestId": "paymentRequestId01",
  "productCode": "CASHIER_PAYMENT"
}
```
以下代码展示了响应的示例，其中包含以下参数：
*   `paymentSessionData`: 用于返回前端的支付会话数据
*   `paymentSessionExpiryTime`: 支付会话的过期时间  
```json
{
  "paymentSessionData": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
  "paymentSessionExpiryTime": "2023-04-06T03:28:49Z",
  "paymentSessionId": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```
### 常见问题解答  
#### 请求中可以使用中文字符吗？  
请勿在请求的字段中使用中文字符，包括`paymentRequestId`、`referenceOrderId`、`orderDescription`和`goods`，以避免与QRIS和Mastercard等不兼容的支付方式。  
#### 如何设置支付结果通知地址？  
Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)将支付结果发送给您，您可以在`createPaymentSession` API中通过`paymentNotifyUrl`参数指定此地址。如果每个支付的通知地址相同，您也可以在Antom控制台中进行配置。如果您已经配置了地址并在API中设置了参数，Antom将使用API中设置的地址。  
步骤2：创建并调用SDK客户端
--------------------------------------------  
Antom SDK是一个用于处理支付流程的组件。通过创建支付会话，您可以启动SDK来收集信息、在应用间切换以及根据`createPaymentSession` API中指定的支付方式显示二维码。  
当买家在页面上选择支付方式后，您需要创建SDK并使用支付会话初始化它。
### 安装  
版本要求：  
*   安装Xcode 12或更高版本。
*   使用iOS 11或更高版本。  

要集成SDK包，请参考[集成SDK包](https://global.alipay.com/docs/ac/antom_sdk/ios_en)。
### 初始化SDK  
通过使用`AMSCashierPayment`创建SDK实例，并指定基础配置。创建`AMSCashierPaymentConfiguration`对象时需要以下参数：  

| 参数名称 | 是否必需 | 描述 |
| --- | --- | --- |
| `locale` | 否 | 用于传递语言信息。有效值如下，根据支付方法所在地区选择传递的值。如果传递其他值，默认使用本地语言： |
| `en_US` | 英语 |
| `pt_BR` | 葡萄牙语 |
| `ko_KR` | 韩语 |
| `es_ES` | 西班牙语 |
| `ms_MY` | 马来语 |
| `in_ID` | 印尼语 |
| `tl_PH` | 塔加洛语 |
| `th_TH` | 泰语 |
| `vi_VN` | 越南语 |
| `fr_FR` | 法语 |
| `nl_NL` | 荷兰语 |
| `it_IT` | 意大利语 |
| `de_DE` | 德语 |
| `zh_CN` | 简体中文 |
| `zh_HK` | 繁体中文 |

| `options` | 否 | 用于指定是否使用默认加载模式和沙箱环境。有效值包括： |
| `sandbox`, `"true"` | 沙箱环境 |
| `sandbox`, `"false"` | 生产环境 |
| `showLoading`, `"true"` | 使用默认加载模式 |
| `showLoading`, `"false"` | 不使用默认加载模式 |
| `notRedirectAfterComplete` | 可选，布尔类型，默认值为`false`，表示支付完成后会重定向回您的页面。值为空时同样适用。`true`表示支付完成后不重定向，需要使用客户事件代码来控制绑定卡片以完成后续流程。请注意，客户端返回的支付结果事件代码仅用作客户端页面重定向操作的参考，对于交易状态更新，请参考服务器的`notifyPayment`或`inquiryPayment` API返回的结果。 |
| `merchantAppointmentParam` | 可选，用于设置自定义功能的对象。 |

| `storedCard` | 可选，用于设置已存储卡片的自定义功能的对象。 |
| `needCVV` | 可选，布尔类型，默认值为`false`，表示买家在支付过程中不需要输入CVV。值为空时同样适用。`true`表示买家在支付过程中需要输入CVV。 |

### 实现AMSPaymentProtocol  
用于处理后续流程中相应事件。包含以下方法：  

| 方法 | 是否必需 | 描述 |
| --- | --- | --- |
| `onEventCallback` | 否 | 监听结账页面上的支付事件，返回`eventCode`和`eventResult`。 |

### 实现AMSLoggerProtocol  
用于管理日志输出。包含以下方法：  

| 方法 | 是否必需 | 描述 |
| --- | --- | --- |
| `logWithName` | 否 | 用于默认输出日志的回调函数。 |

以下示例代码展示了如何初始化SDK：  

```swift
// 引入AMSComponent库
#import <AMSComponent/AMSComponent-Swift.h>

// 创建配置对象
AMSCashierPaymentConfiguration *componentConfig = [AMSCashierPaymentConfiguration new];
componentConfig.locale = @"en_US";

// 设置显示加载（默认值为true，使用默认加载动画）。设置为false时，根据onEventCallback自定义加载动画。
// 设置沙箱环境。不设置则默认使用生产环境。
// 卡片支付场景需要CVV验证。
NSString *merchantAppointParam = @"{\n  \"storedCard\": {\n     \"needCVV\": true\n }\n}";

// 设置选项
NSDictionary *options = @{@"showLoading": @"true",
                         @"sandbox": @"true",
                         @"merchantAppointParam": merchantAppointParam,
                         @"notRedirectAfterComplete": @"true"};  // 设置支付完成后不跳转，由商户控制后续流程
componentConfig.options = options;

// 初始化配置
[[AMSCashierPayment shared] initConfiguration:componentConfig];

// 设置支付事件回调
[AMSCashierPayment shared].paymentDelegate = self;
[AMSCashierPayment shared].loggerDelegate = self;

// 服务器调用createPaymentSession API获取paymentSessionData。
```

请注意，这是一段假设使用Swift编写的代码，实际使用时请根据您的项目语言和库版本进行调整。
### 调用SDK  
调用`createComponent`方法：  
| 参数名称 | 是否必填 | 描述 |
| --- | --- | --- |
| sessionData | ✅ | 使用`sessionData`参数创建配置对象：将通过`createpaymentSession (Checkout Payment)` API响应中获取的完整`paymentSessionData`参数传递给`sessionData`参数。 |

在以下情况下调用`onDestroy`方法释放SDK组件资源：
1. 买家退出结账页面时，释放`createPaymentSession`中创建的组件资源。
2. 买家发起多次支付时，释放之前`createPaymentSession`中创建的组件资源。

以下示例代码展示了如何调用SDK：
```swift
[[AMSCashierPayment shared] createComponent:sessionData];
// 释放SDK组件资源
[[AMSCashierPayment shared] onDestroy];
```

请注意，这里的`AMSCashierPayment`是假设的类名，实际应替换为对应SDK的实际类名。
### 显示支付结果  
支付结果将通过`onEventCallback`函数返回。这里的支付结果仅用于前端显示，最终订单状态以服务器端为准。您需要通过`onEventCallback`返回结果中的数据自定义每个支付结果的处理流程。  
以下是`onEventCallback`返回的支付结果可能的事件代码：  

| 事件代码 | 消息 | 解决方案 |
| --- | --- | --- |
| SDK_PAYMENT_SUCCESSFUL | 支付成功。 | 建议将买家重定向到支付结果页面。 |
| SDK_PAYMENT_PROCESSING | 支付处理中。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情，根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_FAIL | 支付失败。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情，根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_CANCEL | 买家未提交订单退出支付页面。 | 在有效期内，可以使用`paymentSessionData`重新调用SDK；如果已过期，需要重新请求`paymentSessionData`。 |
| SDK_PAYMENT_ERROR | 支付状态异常。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情，根据提供的信息引导买家重试支付。 |

以下示例代码展示了如何处理`onEventCallback`：

```swift
// #import <AMSComponent/AMSComponent-Swift.h>
// #pragma AMSPaymentProtocol
- (void)onEventCallback:(NSString *)eventCode eventResult:(AMSEventResult *)eventResult {
    if ([eventCode isEqualToString:@"SDK_PAYMENT_SUCCESSFUL"]) {
        // 支付成功。将买家重定向到支付结果页面。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_PROCESSING"]) {
        // 支付处理中。根据提供的信息引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_FAIL"]) {
        // 支付失败。根据提供的信息引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_CANCEL"]) {
        // 引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_ERROR"]) {
        // 支付状态异常。根据提供的信息引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_FORM_VERIFICATION_FAILED"]) {
        // 如果表单提交失败，SDK会在元素收集页面显示表单错误代码。
    }
    NSLog(@"eventCode%@ eventResult%@", eventCode, eventResult);
}
```

### 步骤3：获取支付结果（服务器端）
-----------------------------------------

买家完成支付或支付超时后，Antom会通过服务器交互将相应的支付结果发送给您，您可以使用以下方法之一获取支付结果：

1. 接收异步通知
2. 查询结果
### **接收异步通知**  
当支付成功或失败并达到最终状态时，蚂蚁金服会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API 将异步通知发送到在 **createPaymentSession** API 中指定的 _paymentNotifyUrl_。收到蚂蚁金服的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。  
蚂蚁金服允许您在 **createPaymentSession** API 的 _paymentNotifyUrl_ 参数中指定URL。如果每个支付的URL相同，您也可以在蚂蚁金服控制台中进行配置。  
以下是一个通知请求的示例：  
```json
{
"notifyType": "PAYMENT_RESULT",
"result": {
"resultCode": "SUCCESS",
"resultStatus": "S",
"resultMessage": "success"
},
"paymentRequestId": "paymentRequestId01",
"paymentId": "2020010123456789XXXX",
"paymentAmount": {
"value": "4200",
"currency": "SGD"
},
"paymentCreateTime": "2020-01-01T12:01:00+08:30",
"paymentTime": "2020-01-01T12:01:01+08:30"
}
```
以下示例代码展示了如何验证通知的签名并做出响应：  
```java
@RequestMapping(path = "/payResult", method = RequestMethod.POST)
public ResponseEntity<AlipayResponse> paymentNotifyProcessor(HttpServletRequest request,
@RequestBody String body) {
// 从请求头中获取所需参数。
String requestTime = request.getHeader("request-time");
String clientId = request.getHeader("client-id");
String rawSignature = request.getHeader("signature");
String signature = "";  
// 从原始签名中获取有效部分
if(rawSignature==null||rawSignature.isEmpty()){
throw new RuntimeException("empty notify signature");
}else {
String[] parts = rawSignature.split("signature=");
if (parts.length > 1) {
signature = parts[1];
}
}  
// 验证支付结果通知的签名
boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
clientId, requestTime, body, signature,
ALIPAY_PUBLIC_KEY);
if (!verifyResult) {
throw new RuntimeException("Invalid notify signature");
}  
// 根据通知结果更新记录状态  
// 响应服务器，表示接受通知
Result result = new Result("SUCCESS", "success", ResultStatusType.S);
AlipayResponse response = new AlipayResponse();
response.setResult(result);
return ResponseEntity.ok().body(response);
}
```
#### 常见问题  
##### 何时会发送通知？  
这取决于支付是否完成：  
*   如果支付成功完成，蚂蚁金服通常会在3到5秒内发送异步通知。对于像柜台支付（OTC）这样的支付方式，通知可能会稍有延迟。
*   如果支付未完成，蚂蚁金服需要先关闭订单，然后才会发送异步通知。不同支付方式关闭订单所需的时间会有所不同，通常默认为14分钟。  
##### 通知会重新发送吗？  
如果您收到蚂蚁金服的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果您未按要求响应异步通知，或者由于网络原因通知未送达，通知将在24小时内自动重新发送，最多可重试8次，直到收到正确响应为止。重试间隔为：0分钟，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。  
##### 是否需要在响应中添加数字签名？  
如果您收到蚂蚁金服的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应，但不需要在您的响应中添加数字签名。  
##### 如何理解以下关键字段的含义？  
*   _result_：订单的支付结果。
*   _paymentRequestId_：商家生成的用于查询、取消和对账的支付请求ID。
*   _paymentId_：蚂蚁金服生成的用于退款和对账的支付订单ID。
*   _paymentAmount_：如果需要金额对账，可以使用此字段。
### **查询结果**
你可以调用**inquiryPayment** API 来查询订单的结果。  
<table style="width:748px;outline:none;border-collapse:collapse;border:1px solid #D9E4F2;" class="lake-table"><colgroup><col width="211" span="1"><col width="97" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:#D9E4F2;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>参数名称</strong></p></td><td style="background-color:#D9E4F2;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>是否必需</strong></p></td><td style="background-color:#D9E4F2;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>描述</strong></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRequestId</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">商家生成的支付请求ID。</p></td></tr></tbody></table>  
完整参数列表，请参考[inquiryPayment](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档，获取所有参数和特定支付方式的额外要求。  
以下代码示例展示了如何调用**inquiryPayment** API:  
```java
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);
AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/sandbox/api/v1/payments/inquiryPayment");  
alipayPayQueryRequest.setPaymentRequstId("paymentRequestId01");
AlipayPayQueryResponse alipayPayQueryResponse;
try {
    alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```  
以下代码展示了请求消息的示例:  
```json
{
"paymentRequestId": "paymentRequestId01"
}
```  
以下代码展示了响应消息的示例:  
```json
{
"result": {
"resultCode": "SUCCESS",
"resultStatus": "S",
"resultMessage": "Success"
},
"paymentStatus": "SUCCESS",
"paymentRequestId": "paymentRequestId01",
"paymentId": "2019060811401080010018882020035XXXX",
"paymentAmount": {
"value": "4200",
"currency": "SGD"
},
"paymentCreateTime": "2019-06-01T12:01:01+08:30",
"paymentTime": "2019-06-01T12:01:01+08:30",
"transactions": null
}
```  
#### 常见问题
##### 如何理解以下关键字段的含义？
*   _result_：API调用的结果。仅表示**inquiryPayment** API调用的结果。订单结果应基于_paymentStatus_来确定。`SUCCESS`和`FAIL`表示最终结果，而`PROCESSING`表示交易仍在进行中。
*   _paymentAmount_：金额验证。如果需要进行金额验证，可以使用此字段。  
##### 应该多频繁发起查询？
建议以2秒的间隔进行轮询查询，直到获取到最终的支付结果或收到异步支付通知为止。  
### **步骤4：获取扣款结果（服务器端）**
买家完成扣款或扣款超时后，蚂蚁金服会通过服务器交互将相应的扣款结果发送给你，你可以通过以下方式之一获取扣款结果：  
*   接收异步通知
*   查询结果
### **接收异步通知**  
当扣款达到成功或失败的最终状态时，Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API 向在 **createPaymentSession** API 中指定的 _paymentNotifyUrl_ 发送异步通知。收到Antom的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。

Antom允许您在 **createPaymentSession** API 的 _paymentNotifyUrl_ 参数中指定URL。如果每个支付的URL相同，您也可以在Antom控制台中进行配置。

以下是一个成功的扣款示例：

```json
{
  "captureAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "notifyType": "CAPTURE_RESULT",
  "captureId": "2022XXXXXXX",
  "captureRequestId": "captureRequestId01",
  "captureTime": "2022-11-10T00:34:52-08:00",
  "paymentId": "2022XXXXXXX",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```

以下是一个失败的扣款示例：

```json
{
  "captureAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "notifyType": "CAPTURE_RESULT",
  "captureId": "2022XXXXXXX",
  "captureRequestId": "captureRequestId01",
  "captureTime": "2022-11-10T00:34:52-08:00",
  "paymentId": "2022XXXXXXX",
  "result": {
    "resultCode": "PROCESS_FAIL",
    "resultMessage": "fail.",
    "resultStatus": "F"
  }
}
```

以下示例代码展示了如何验证通知的签名并做出响应：

```java
@RequestMapping(path = "/captureResult", method = RequestMethod.POST)
public ResponseEntity<AlipayResponse> captureNotifyProcessor(HttpServletRequest request,
    @RequestBody String body) {
  // 从请求头中获取所需参数。
  String requestTime = request.getHeader("request-time");
  String clientId = request.getHeader("client-id");
  String rawSignature = request.getHeader("signature");
  String signature = "";  

  // 从原始签名中获取有效部分
  if(rawSignature==null||rawSignature.isEmpty()){
    throw new RuntimeException("empty notify signature");
  } else {
    String[] parts = rawSignature.split("signature=");
    if (parts.length > 1) {
      signature = parts[1];
    }
  }  

  // 验证支付结果通知的签名
  boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
      clientId, requestTime, body, signature,
      ALIPAY_PUBLIC_KEY);
  if (!verifyResult) {
    throw new RuntimeException("Invalid notify signature");
  }  

  // 根据通知结果更新记录状态
  // 响应服务器我们已接受通知
  Result result = new Result("SUCCESS", "success", ResultStatusType.S);
  AlipayResponse response = new AlipayResponse();
  response.setResult(result);
  return ResponseEntity.ok().body(response);
}
```

#### 常见问题

##### 何时会发送通知？
这取决于支付是否完成：
* 如果支付成功完成，Antom通常会在3到5秒内发送异步通知。对于某些支付方式（如柜台支付），通知可能需要更长时间。
* 如果支付未完成，Antom需要先关闭订单，然后才会发送异步通知。不同支付方式关闭订单所需的时间会有所不同，通常默认为14分钟。

##### 异步通知会被重新发送吗？
如果您收到Antom的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果您未按要求响应异步通知，或者由于网络原因通知未送达，通知将在24小时内自动重新发送，最多可重试8次，或直到收到正确响应以终止发送。发送间隔为：0分钟，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。

##### 我需要在响应中添加数字签名吗？
如果您收到Antom的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应，但您不需要在响应中添加数字签名。

##### 如何理解以下关键字段的含义？
*   _result_：表示订单的扣款结果。
*   _notifyType_：notifyType 的值为 `CAPTURE_RESULT`。
*   _paymentRequestId_：您生成的支付请求号，用于查询、取消和对账。
*   _paymentId_：Antom 生成的支付订单ID，用于退款和对账。
*   _acquirerReferenceNo_：在新加坡和香港集成卡内支付服务的商家将在通知中收到特定的收单方编号。
### **查询订单结果**

您可以调用 **inquiryPayment** API 来查询订单的结果。

#### 参数说明

| 参数名       | 必填 | 描述                                                         |
| ------------ | ---- | ------------------------------------------------------------ |
| paymentRequestId | 是   | 商家生成的支付请求ID。 |

要查看完整的参数列表和特定支付方式的额外要求，请参考 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档。

#### 查询示例

```java
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);
AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/sandbox/api/v1/payments/inquiryPayment");
alipayPayQueryRequest.setPaymentRequestId("paymentRequestId01");  
AlipayPayQueryResponse alipayPayQueryResponse;
try {
    alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```

#### 捕获状态值

API 响应中的 _transactions_ 字段表示捕获状态：

| 参数名                 | 描述                                                         |
| ---------------------- | ------------------------------------------------------------ |
| transactions.transactionType | 值为 `CAPTURE`，表示捕获状态。 |
| transactions.transactionStatus | 捕获状态。 |
| transactions.transactionResult.resultStatus | 结果状态，如 `S` 代表成功，`F` 代表失败，`U` 代表处理中。 |
| transactions.transactionResult.resultCode | 结果代码，如 `SUCCESS` 或 `PROCESS_FAIL`。 |
| transactions.transactionResult.resultMessage | 结果信息，如 "success" 或 "General business failure. No retry." |

#### 成功捕获示例：

```json
{
  "transactions": [
    {
      "transactionType": "CAPTURE",
      "transactionStatus": "SUCCESS",
      "transactionRequestId": "test_test_test_XXXX",
      "transactionAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "transactionId": "2022XXXXXXXX",
      "transactionResult": {
        "resultStatus": "S",
        "resultCode": "SUCCESS",
        "resultMessage": "success"
      }
    }
  ]
}
```

#### 失败捕获示例：

```json
{
  "transactions": [
    {
      "transactionType": "CAPTURE",
      "transactionStatus": "FAIL",
      "transactionRequestId": "test_test_test_XXXX",
      "transactionAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "transactionTime": "2022-09-29T07:13:50-07:00",
      "transactionId": "2022XXXXXXXX",
      "transactionResult": {
        "resultStatus": "F",
        "resultCode": "PROCESS_FAIL",
        "resultMessage": "General business failure. No retry."
      }
    }
  ]
}
```

#### 处理中捕获示例：

```json
{
  "transactions": [
    {
      "transactionType": "CAPTURE",
      "transactionStatus": "PROCESSING",
      "transactionRequestId": "test_test_test_XXXX",
      "transactionAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "transactionId": "2022XXXXXXXX",
      "transactionResult": {
        "resultStatus": "U",
        "resultCode": "PAYMENT_IN_PROCESS",
        "resultMessage": "payment in process"
      }
    }
  ]
}
```

#### 常见问题

**Q1**：如何理解以下关键字段的含义？
- `result`：API 调用的结果，仅表示 **inquiryPayment** API 的调用结果。订单状态应基于 `paymentStatus` 来确定。`SUCCESS` 和 `FAIL` 表示最终结果，`PROCESSING` 表示交易仍在进行中。
- `paymentAmount`：如果需要金额验证，可以使用此字段。

**Q2**：我应该多久发起一次查询？
建议每2秒轮询一次，直到获取最终支付结果或收到异步支付通知。

#### 示例代码

```swift
// 导入组件库
#import <AMSComponent/AMSComponent-Swift.h>

// 步骤1：创建AMSConfiguration对象
AMSCashierPaymentConfiguration *componentConfig = [AMSCashierPaymentConfiguration new];
componentConfig.locale = @"en_US";

// 指定showLoading为true（默认值）使用默认加载模式，设置为false以自定义加载动画
// 设置沙箱环境，留空则默认使用生产环境
// 卡片支付场景需要CVV验证
NSString *merchantAppointParam = @"{\n  \"storedCard\": {\n     \"needCVV\": true\n }\n}";

// 设置沙箱环境，留空则默认使用生产环境
NSDictionary *options = @{@"showLoading": @"true",
                         @"sandbox": @"true",
                         @"merchantAppointParam": merchantAppointParam,
                         @"notRedirectAfterComplete": @"true"  // 设置支付完成后不跳转，由商户控制后续流程
                         };
componentConfig.options = options;
[[AMSCashierPayment shared] initConfiguration:componentConfig];

// 设置支付页面的支付事件回调
[AMSCashierPayment shared].paymentDelegate = self;
[AMSCashierPayment shared].loggerDelegate = self;

// 服务器调用createPaymentSession API获取paymentSessionData
// 步骤3：创建并渲染卡片组件
[[AMSCashierPayment shared] createComponent:paymentSessionData];

// 支付事件回调
- (void)onEventCallback:(NSString *)eventCode eventResult:(AMSEventResult *)eventResult
{
    if ([eventCode isEqualToString:@"SDK_PAYMENT_SUCCESSFUL"]) {
        // 支付成功。将买家重定向到支付结果页面。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_PROCESSING"]) {
        // 支付处理中。根据提供的信息引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_FAIL"]) {
        // 支付失败。根据提供的信息引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_CANCEL"]) {
        // 引导买家重试支付。
    } else if ([eventCode isEqualToString:@"SDK_PAYMENT_ERROR"]) {
        // 支付状态异常。根据提供的信息引导买家重试支付。
    }
    NSLog(@"eventCode%@ eventResult%@", eventCode, eventResult);
}

// 日志回调
- (void)logWithName:(NSString *)name parameter:(NSDictionary<NSString *,id> *)parameter
{
    NSLog(@"name%@ parameter%@", name, parameter);
}
```

#### 事件代码

您可能会看到两种类型的事件代码：

- 状态代码：在组件运行时生命周期中由 `onEventCallback` 返回。
- 错误代码：在组件初始化阶段由 `onEventCallback` 或 `onError` 返回。

| 类型   | 代码        | 描述                                                         | 进一步操作 |
| ------ | ----------- | ------------------------------------------------------------ | ---------- |
| 状态代码 | SDK_START_OF_LOADING | 支付组件创建期间开始播放加载动画。 | 无需进一步操作。 |
| 状态代码 | SDK_END_OF_LOADING | 支付组件创建期间加载动画结束。 | 无需进一步操作。 |
| 错误代码 | SDK_INTERNAL_ERROR | SDK 内部错误。 | 联系蚂蚁金服技术支持解决。 |
| 错误代码 | SDK_CREATEPAYMENT_PARAMETER_ERROR | `createComponent` 方法传入的参数不正确。 | 确保参数正确并重新发送请求。 |
| 错误代码 | SDK_CALL_URL_ERROR | 代表以下情况之一： <ul><li>未能执行到商户页面的重定向。</li><li>`paymentRedirectUrl` 参数未传递或传递错误。</li></ul> | 联系蚂蚁金服技术支持解决。 |
| 错误代码 | SDK_INTEGRATION_ERROR | 未找到依赖项。 | 确保正确添加依赖并重新进行集成。 |

要查看文档的最新更新，请访问 [版本更新日志](https://global.alipay.com/docs/releasenotes)。

**请注意**：以上内容是基于蚂蚁金服的支付服务和相关SDK的说明，可能需要根据实际的API文档和SDK文档进行调整。
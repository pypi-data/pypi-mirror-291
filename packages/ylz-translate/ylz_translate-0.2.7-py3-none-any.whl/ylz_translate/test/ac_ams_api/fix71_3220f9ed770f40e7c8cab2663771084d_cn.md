声明
----

2024-05-13 02:46

POST /v1/customs/declare

使用此API向海关传输信息。

结构
====

一条消息由头和正文组成。以下部分专注于正文结构。关于头部结构，请参阅：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着必须使用双引号（" "）包围字段值。例如：

*   如果字段的数据类型为Integer，其值为20，则设置为"20"。
*   如果字段的数据类型为Boolean，其值为true，则设置为"true"。

### 请求参数

显示全部

#### declarationRequestId 字符串  必需

商家为标识申报请求分配的唯一ID。每个申报请求号的长度范围为1到32位。

关于此字段的更多信息：

*   此字段是API幂等性字段。
*   最大长度：32个字符

#### paymentId 字符串  必需

支付宝分配的用于识别支付的唯一ID。

关于此字段的更多信息：

*   最大长度：64 个字符

#### declarationAmount Amount 对象 **必需**

累计交易申报金额，不能超过总交易金额。仅支持中国海关申报。默认货币为 `CNY`（人民币）。

注意：此字段可以从 **notifyPayment** 请求和 **inquiryPayment** 响应中的 `_customsDeclarationAmount` 字段获取。

显示子参数

#### customs CustomsInfo 对象 **必需**

海关信息

显示子参数

#### merchantCustomsInfo MerchantCustomsInfo 对象 **必需**

在海关系统中注册的商家信息。

显示子参数

#### splitOrder 布尔值 **必需**

商家可以决定订单是否拆分申报。如果此字段的值为`true`，则允许订单拆分。如果此字段的值为`false`，则不允许订单拆分。

#### suborderId 字符串

由商家分配的子订单ID。

注意事项：

*   当*splitOrder*为`true`时，需要指定此字段。在以下业务场景中，子订单ID作为订单ID在支付信息中传递给海关：
    *   支付包含多个商品，需要提交给不同的海关，或者海关要求按商品分别提交。
    *   在合并支付中，某些商品需要进行海关申报。
    *   其他需要拆分海关申报的情况。

*   在订单拆分后，确保这两个子订单的子订单ID与支付信息中的订单ID相同。否则，由于信息不一致，订单会被拒绝。

关于此字段的更多信息

*   最大长度：64 个字符

#### buyerCertificate 证书对象

购买者信息。

注意：

*   当需要验证买家信息时指定此字段。实际上，为了符合海关申报政策要求并便于支付宝核对买家信息，建议在此API中提供买家信息。虽然此字段是可选的，但建议填写，因为海关会随机检查买家信息，以减少订单被退回的风险。
*   如果未指定此字段，商家需要确保买家和付款人信息一致。一旦海关检测到不一致，申报将被拒绝。指定此字段可以降低订单被退回的风险。

显示子参数

### 响应参数

显示全部

#### result 结果对象 **必需**

请求的结果，包含状态和错误代码等信息。

注意：此字段并不表示申报结果。它仅表示**declare** API 是否调用成功。 

显示子参数

#### customsPaymentId 字符串

申报服务提供者向海关提供的支付ID。

注意：当 *result.resultCode* 为 `S` 时，此字段返回。

关于此字段的更多信息：

*   最大长度：64个字符

#### customsOrderId 字符串

申报服务提供者向海关提供的订单ID。

注意：当 *result.resultCode* 为 `S` 时，此字段返回。

关于此字段的更多信息：

*   最大长度：64个字符

#### identityCheckResult 字符串

身份检查结果。有效值为：

*   `CHECK_PASSED`：表示买方也是付款人。
*   `CHECK_NOT_PASSED`：表示买方不是付款人。

注意：当 *result.resultCode* 为 `S` 时，此字段返回。如果未返回此字段，则表示未检查买方的身份。

#### clearingChannel 字符串

清算机构。有效值包括：

*   `CUP`: 表示清算渠道为银联，例如，当用户使用银行卡支付时，可能会返回此值。
*   `NUCC`: 表示清算渠道为网联，例如，当用户使用银行卡支付时，可能会返回此值。
*   `OTHER`: 表示清算渠道为其他，例如，当用户使用花呗等信用产品时，会返回此值。

注意：此字段在以下两种情况下返回：

*   *resultCode* 为 `S`。 
*   返回了海关收据。 

#### clearingTransactionId 字符串

清算机构的序列号。

注意：此字段在以下两种情况下返回：

*   *resultCode* 为 `S`。
*   返回了海关收据。 

关于此字段的更多信息：

*   最大长度：64 个字符

#### customsProviderRegistrationId 字符串

海关系统中的注册号。

注意: 当满足以下两个条件时，此字段会被返回:

1.  *resultCode* 为 `S`。
2. 收到海关收据。

关于此字段的更多信息:

* 最大长度: 32 个字符

API 探索器

示例代码（在沙箱中运行）

### 请求

URL

北美地区

```text
https://open-na-global.alipay.com/ams/api/v1/customs/declare
```

请求体

```json
{
  "declarationAmount": {
    "currency": "CNY",
    "value": "100"
  },
  "merchantCustomsInfo": {
    "merchantCustomsName": "amsdemo",
    "merchantCustomsCode": "amsdemoskr"
  },
  "paymentId": "20211117194010800100188180203227785",
  "splitOrder": false,
  "customs": {
    "region": "CN",
    "customsCode": "ZONGSHU"
  },
  "declarationRequestId": "req123",
  "buyerCertificate": {
    "holderName": {
      "firstName": "f",
      "lastName": "l",
      "fullName": "cangxi.lj",
      "middleName": "m"
    },
    "certificateNo": "510502199504139527",
    "certificateType": "ID_CARD"
  }
}
```

### 响应

情况

成功

响应体

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "Success",
    "resultStatus": "S"
  },
  "customsPaymentId": "202103311108288854766XXXX",
  "customsOrderId": "202109612108270254713XXXX",
  "identityCheckResult": "CHECK_PASSED",
  "customsProviderRegistrationId": "ZF1402XXXX",
  "clearingChannel": "OTHER",
  "clearingTransactionId": "202103102200135488140026XXXX"
}
```

更多信息
------------

本节提供了关于此API的附加信息。

**海关代码**

下表显示了海关代码的详细信息：


| **海关名称** | **统一海关解决方案** | **海关代码** | **支付宝注册ID** |
| --- | --- | --- | --- |
| 海关总署 | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 河南保税物流中心 | 传输至ZHENGZHOU | ZHENGZHOU | 31222699S7 |
| 宁波海关 | 传输至NINGBO | NINGBO | 31222699S7 |
| 新郑综合保税区（机场） | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 天津海关 | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 上海海关 | 传输至SHANGHAI\_CBT | SHANGHAI\_CBT | 31222699S7 |
| 广州海关（机场） | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 广州海关（南沙） | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 广州海关（黄埔） | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 广州海关（沙田） | 传输至ZONGSHU | ZONGSHU | 31222699S7 |
| 杭州海关 | 传输至ZONGSHU | ZONGSHU | 31222699S7 |


 

**支付信息重传**

**declare** API可以重新触发，以便将支付数据发送给海关。在以下情况下使用重传：

*   海关系统中缺少支付数据。
*   前次申报数据包含错误信息。  

注意事项：

*   *declarationRequestId* 必须与原始请求相同，否则将被视为新的请求。
*   在重新传输中，仅能修改 *merchantCustomsCode*、*merchantCustomsName*、*customsPlace*、*declarationAmount*、suborderId 和 *buyer*。重新传输的 *declarationAmount* 不计入海关申报的总金额。

**重新传输条件**

在重新触发接口之前，请确保满足以下条件：

*   支付宝系统中存在与 *declarationRequestId* 相同的申报记录。
*   自上次调用以来已超过5分钟。（支付宝可能会根据实际情况调整此时间值。）
*   除了以下字段的值外，所有信息应保持不变：

*   *merchantCustomsCode*
*   *merchantCustomsName*
*   *customsPlace*
*   *declarationAmount*
*   *suborderId*
*   *buyerCertificate.holderName.fullName*
*   *buyerCertificate.certificateNo*

*   如果*declarationAmount*
    发生变化，新的申报金额不能超过原始的总交易金额。

**重传响应**

以下列出了不同情况下的响应：

*   如果不满足重传条件且没有任何参数值改变，返回幂等成功的响应。
*   如果不满足重传条件但有一个或多个参数值已改变，将返回错误代码`CONTEXT_INCONSISTENT`或其他错误代码。
*   如果满足重传条件且重传成功，返回值将与第一次成功传输时相同。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 海关申报成功。调用**inquiryDeclarationRequests**接口查询海关申报结果。 |
| ACCESS\_DENIED | F | 访问被拒绝 | 请咨询支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活 | 请咨询支付宝技术支持解决问题。 |
| CLIENT\_INVALID | F | 客户端ID无效。支付宝对客户端ID有限制。 | 检查客户端ID是否正确，或联系支付宝技术支持获取详细原因。 |
| DUPLICATED\_DECLARATIONS | F | 同一订单在同一海关只能申报一次。 | 检查是否已使用_paymentId_进行申报。使用不同的支付ID发起申报请求。 |
| INVALID\_CONTRACT | F | 合同中的参数值与当前交易不符。 | 检查合同中的参数值是否与当前交易匹配。如果匹配，请联系支付宝技术支持以解决问题。 |
| INVALID\_SIGNATURE | F | 签名验证失败。用于签名请求的私钥与Antom Dashboard的公钥不匹配。 | 检查用于签名请求的私钥是否与Antom Dashboard的公钥匹配。以下签名参考资料可能有用： |请注意，由于Markdown格式要求，原始文档中的空白行已保留，以确保格式正确。代码块中的JSON键未翻译，以遵循指示。翻译后的文本应保持语句通顺。<br>*   请求头中的[签名](https://global.alipay.com/docs/ac/ams/api_fund)字段<br>*   如何[计算签名](https://global.alipay.com/docs/ac/ams/digital_signature) |
| KEY\_NOT\_FOUND | F | 未找到支付宝或商家的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在Antom仪表盘上传私钥。 |
| MEDIA\_TYPE\_NOT\_ACCEPTABLE | F | 服务器不支持客户端可接受的媒体类型。 | 检查媒体类型是否正确，并使用支付宝接受的媒体类型。|
| MERCHANT\_NOT\_REGISTERED | F | 商家未注册。 | 请使用注册接口注册商家。如果调用注册接口失败，请联系支付宝技术支持。|
| METHOD\_NOT\_SUPPORTED | F | 服务器不支持请求的HTTP方法。仅支持POST方法。 | 确保HTTP方法为POST。 |
| NO\_INTERFACE\_DEF | F | 未定义接口。 | 请检查URL是否正确。请参考API文档中的端点。|
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 检查_paymentId_是否正确。如果正确，请联系支付宝技术支持以了解具体原因。|
| ORDER\_STATUS\_INVALID | F | 订单状态无效。交易正在进行中或交易失败。 | 检查订单状态并采取相应行动。如果交易正在进行中，请等待。如果交易失败，请不要发起申报。否则，请联系支付宝技术支持以了解具体原因。|
| PARAM\_ILLEGAL | F | 必需的参数未传递，或者存在非法参数。例如，非数字输入，无效的日期，或者参数的长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般性的业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| REPEAT\_REQ\_INCONSISTENT | F | 金额或货币与先前请求不一致。 | 使用唯一的*declarationRequestId*值重新发起海关申报。在重传场景中，确保满足重传条件部分的所有条件并进行重传。 |请确保上述翻译保留了原始Markdown格式，并且语句通顺。如果有任何问题，欢迎进一步询问。|
| RISK\_REJECT | F | 请求因风险控制被拒绝。 | 通知用户请求因风险控制失败而被拒绝。 |
| SYSTEM\_ERROR | F | 发生系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |
| TOTAL\_DECLARATION\_AMOUNT\_EXCEED | F | 总申报金额超过支付金额。 | 确认总申报金额是否超过支付金额。创建一个金额小于或等于支付金额的新申报，或联系支付宝技术支持。 |
| USER\_STATUS\_ABNORMAL | F | 用户在钱包端的状态异常。 | 联系支付宝技术支持了解具体原因。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果问题未解决，联系支付宝技术支持。 |
| 未知异常 | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

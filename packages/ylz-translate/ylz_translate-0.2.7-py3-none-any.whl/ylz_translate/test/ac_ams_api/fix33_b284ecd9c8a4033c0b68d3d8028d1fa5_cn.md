创建支付会话（结账支付）
=======================

2024-04-26 02:10

POST /v1/payments/createPaymentSession

**createPaymentSession** API 用于创建客户端SDK集成的支付会话。通过此API响应，支付宝返回加密的会话数据。您使用会话数据启动客户端SDK，SDK帮助您完成支付流程，整个支付过程中避免中间页面重定向。

结构
===

一条消息由头和体组成。以下部分专注于体的结构。头的结构见：
*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)
**注意**：除数组外，每个字段的数据类型均设置为字符串。这意味着字段值必须用双引号（" "）包围。例如：
*   如果字段的数据类型为Integer，其值为20，则设置为"20"。
*   如果字段的数据类型为Boolean，其值为true，则设置为"true"。
### 请求参数  
显示全部  
#### productCode 字符串  必填  
表示所使用的支付产品，根据合同规定。对于收银台支付，值固定为 `CASHIER_PAYMENT`。  
#### paymentRequestId 字符串  必填  
商家为识别支付请求分配的唯一ID。  
关于此字段的更多信息  
*   最大长度：64 个字符  
#### order Order 对象  必填  
订单信息，如买家、商家、商品、金额、配送信息和购买环境。此字段用于以下目的：  
*   在支付过程中，主要用于支付宝的风险控制或反洗钱。
*   支付完成后，用于购买跟踪和监管报告等记录和报告目的。  
显示子参数  
#### paymentAmount Amount 对象  必填  
商家在订单货币中请求收取的支付金额。  
显示子参数  
#### paymentFactor PaymentFactor 对象  
影响支付的因素。此字段用于指示支付场景。  
当 *paymentMethodType* 的值为 `CARD` 并且您集成客户端SDK时，指定此参数。  
显示子参数  
#### paymentMethod PaymentMethod 对象  必填  
商家或收单机构用于收取支付的支付方式。  
显示子参数  
#### paymentRedirectUrl URL  必填  
支付完成后，用户重定向到的商家页面URL。  
关于此字段的更多信息  
*   最大长度：2048 个字符  
#### paymentNotifyUrl URL  
用于接收支付结果通知的URL。
如果需要接收支付结果的异步通知，请设置此参数。您也可以在Alipay+控制台中设置结果通知的URL。如果请求和Alipay+控制台中都指定了URL，则请求中指定的值优先。  
关于此字段的更多信息  
*   最大长度：2048个字符  
#### settlementStrategy 结算策略对象 **必需**  
支付请求的结算策略。  
显示子参数  
#### enableInstallmentCollection 布尔值  
指示是否需要支付宝收集分期付款信息。如果需要支付宝收集分期信息，请设置此参数。有效值为：  
*   `true`：表示当用户的卡支持分期时，支付宝会收集分期信息。如果用户的卡不支持分期，则无法使用分期。
*   `false`：表示不需要支付宝收集分期信息。如果值为空或未指定此参数，情况相同。  
#### creditPayPlan 信用支付计划对象  
此支付的信用支付计划信息。  
当支付支持分期且在*paymentMethod.paymentMethodMetaData*中指定了与卡相关的信息时，需要设置此参数。  
显示子参数  
#### merchantRegion 商家经营地区 字符串  
商家经营业务的国家或地区。此参数遵循[ISO 3166国家代码](https://www.iso.org/obp/ui/#search)标准的2字母国家或地区代码。  
可能的值包括 `US`、`SG`、`HK`、`PK`、`JP`、`CN`、`BR`、`AU` 和 `MY`。  
当使用全球收单网关（GAGW）产品时，此参数是必需的。  
关于此字段的更多信息  
*   最大长度：2个字符  
#### env 环境对象  
订单创建时的环境信息。
当需要进行风险控制时，设置此参数有助于提高反洗钱和欺诈检测的准确性，以及提高支付成功率。  
显示子参数  
#### 支付会话过期时间 DateTime  
支付会话将在特定日期和时间后过期。默认过期时间为会话创建后1小时。例如，如果会话在2023-7-27T12:00:01+08:30创建，那么会话过期时间为2023-7-27T13:00:01+08:30。  
如果需要使用不同于默认时间的支付会话过期时间，请设置此参数。指定的过期时间必须在会话创建后0到1小时之间。  
关于此字段的更多信息：  
*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式，例如 "2019-11-27T12:01:01+08:00"。
### 响应参数  
显示全部  
#### result 结果对象 **必需**  
API调用的结果。  
显示子参数  
#### paymentSessionId 字符串 **必需**  
支付宝分配的用于标识支付会话的加密ID。  
关于此字段的更多信息：  
*   最大长度：64个字符  
#### paymentSessionData 字符串 **必需**  
加密的支付会话数据。将数据传递给前端以启动客户端SDK。  
关于此字段的更多信息：  
*   最大长度：4096个字符  
#### paymentSessionExpiryTime 日期时间 **必需**  
支付会话过期的具体日期和时间。  
关于此字段的更多信息：  
*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。  
API 探索器  
示例代码 在沙箱中运行
### 请求  
URL  
北美地区  
https://open-na-global.alipay.com/ams/api/v1/payments/createPaymentSession  

案例  
支付宝收集银行卡信息  

### 请求  
URL  
北美地区  
https://open-na-global.alipay.com/ams/api/v1/payments/createPaymentSession  

场景  
支付宝收集信用卡信息  

请求体  
```json
{
  "productCode": "CASHIER_PAYMENT",
  "paymentRequestId": "55bf93a6-71a1-4ca9-b014-53273bd674eb",
  "order": {
    "referenceOrderId": "926e1c32-4a6c-442e-b5ce-8ec5b902e18c",
    "orderDescription": "xxxxx",
    "orderAmount": {
      "currency": "BRL",
      "value": "100"
    },
    "buyer": {
      "referenceBuyerId": "yeiasdasda",
      "buyerPhoneNo": "134******71"
    }
  },
  "paymentAmount": {
    "currency": "BRL",
    "value": "100"
  },
  "paymentMethod": {
    "paymentMethodType": "CARD",
    "paymentMethodMetaData": {
      "paymentMethodRegion": "BR"
    }
  },
  "paymentRedirectUrl": "https://www.yourMerchantWeb.com",
  "paymentNotifyUrl": "https://www.yourNotifyUrl",
  "paymentFactor": {
    "isAuthorization": true
  },
  "env": {
    "clientIp": "112.80.248.78"
  },
  "settlementStrategy": {
    "settlementCurrency": "EUR"
  }
}
```

### 响应  
响应体  
```json
{
  "paymentSessionData": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
  "paymentSessionExpiryTime": "2023-04-06T03:28:49+08:00",
  "paymentSessionId": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```

### 更多信息
关于订单字段： 支付宝不会验证订单字段中的金额与支付请求中的金额是否一致。 订单信息也不适用于资金操作。 该字段主要用于风险控制、监管、监管报告和消费记录显示。 如果需要支付宝提供的风险控制功能，请使用 env 字段。

```json
{
 "order": {
 "referenceOrderId": "102775745075669",
 "orderDescription": "Mi Band 3 Wrist Strap Metal Screwless Stainless Steel For Xiaomi Mi Band 3 ",
 "orderAmount": {
 "value": "500",
 "currency": "USD"
        },
 "goods": [{
 "referenceGoodsId": "102775745075669",
 "goodsName": "xxx goods",
 "goodsUnitAmount": {
 "currency": "USD",
 "value": "498"
            },
 "goodsQuantity": "1"
        }],
 "shipping": {
 "shippingName": {
 "fullName": "Bob Day"
            },
 "shippingAddress": {
 "region": "US",
 "state": "California",
 "city": "San Mateo",
 "address1": "400 El Camino Real",
 "address2": "suit 107",
 "zipCode": "95014"
            },
 "shippingCarrier": "USPS",
 "shippingPhoneNo": "9093749555"
        },
 "buyer": {
 "referenceBuyerId": "bob@gmail.com",
 "buyerName": {
 "fullName": "Bob Day"
            },
 "buyerPhoneNo": "+86 18888888888",
 "buyerEmail": "bob@gmail.com"
        }
    }
} 
```

### 结果/错误代码  
| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 支付会话创建成功。无需进一步操作。 |
| PARAM\_ILLEGAL | F | 必需参数未传递，或存在非法参数。例如，非数字输入，无效日期，或参数长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生一般业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持解决问题。 |
| NO\_PAY\_OPTIONS | F | 无可用支付选项。 | 联系蚂蚁金服技术支持获取详细原因。 |
| CARD\_NOT\_SUPPORTED | F | 用于交易的卡片不支持。 | 使用其他卡片支付交易。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。 
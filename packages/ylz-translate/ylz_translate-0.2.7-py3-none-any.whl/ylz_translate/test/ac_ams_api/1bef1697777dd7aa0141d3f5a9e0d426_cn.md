退款 | 产品API | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_a52690f40beef33d7d37f1bda6f48c27.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_d70d46fd32b98952674df01c03131d87.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Frefund_online)

[返回首页](../../)

产品API

[支付宝API](/docs/ac/ams/api)

在线支付

授权

安全存储

支付

订阅

争议

退款

[退款](/docs/ac/ams/refund_online)

[通知退款](/docs/ac/ams/notify_refund)

[查询退款](/docs/ac/ams/ir_online)

声明

店内支付

退款
----

2024-04-10 03:24

POST /v1/payments/refund

使用此API针对成功支付发起退款，退款可以是全额或部分。只要总退款金额小于或等于原始交易金额，一个交易可以有多个退款。如果退款请求超出了合同中确定的退款窗口期，退款请求将被拒绝。

**注意**：如果退款请求超时或返回的_resultStatus_为U，可以使用相同的_refundRequestId_字段重试退款。_refundRequestId_字段设计为幂等的。

结构
====

一条消息由头部和主体组成。以下部分专注于主体结构。头部结构请参考：

*   [请求头部](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头部](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**: 除数组外，每个字段的数据类型均设置为字符串。这意味着字段值必须用双引号（" "）括起来。示例：

*   如果字段的数据类型为整数，其值为20，则设置为"20"。
*   如果字段的数据类型为布尔值，其值为true，则设置为"true"。

### 请求参数

显示全部

#### refundRequestId 字符串  必填

商家为识别退款请求而分配的唯一ID。

关于此字段的更多信息：

*   此字段是一个API幂等性字段。商家使用refundRequestId字段进行幂等性控制。对于具有相同refundRequestId值并达到最终状态（S或F）的支付请求，应返回相同的结果。
*   最大长度：64个字符

#### paymentId 字符串  必填

支付宝为原始支付分配的唯一ID，需要退款。

关于此字段的更多信息：

*   最大长度：64个字符

#### referenceRefundId 字符串

用于唯一标识一次退款的ID，由直接向客户提供服务或商品的商家分配。

注意：如果需要此值用于内部使用或对账，请指定此字段。

关于此字段的更多信息：

*   最大长度：64 个字符

#### refundAmount 金额对象 **必需**

商家发起的退款金额。

显示子参数

#### refundReason 字符串

退款原因。

注意：如果要向用户和支付方式提供退款原因，请指定此字段。

关于此字段的更多信息：

*   最大长度：256 个字符

#### refundNotifyUrl 字符串

用于接收退款结果通知的URL。该URL必须在请求中指定或在Antom仪表板中设置。

注意: 如果您希望接收退款结果的异步通知，请在此字段中指定。如果请求中和蚂蚁开放平台控制台都指定了退款通知URL，则请求中指定的值优先。

更多关于此字段的信息

*   最大长度：1024 个字符

### 响应参数

显示全部

#### result 结果对象 **必需**

表示此 API 调用是否成功。如果 API 调用成功，退款也成功。

显示子参数

#### refundRequestId 字符串 

商家为识别退款请求而分配的唯一 ID。

注意：此字段在退款成功（_result.resultStatus_ 的值为 `S`）时返回。

更多关于此字段的信息

*   最大长度：64 个字符

#### refundId 字符串 

支付宝为识别退款分配的唯一 ID。_refundId_ 与 _refundRequestId_ 之间存在一一对应关系。

注意：此字段在退款成功时返回（_result.resultStatus_ 的值为 `S`）。

#### paymentId 字符串

支付宝为原支付分配的唯一ID，即将被退款的支付。

注意：此字段在退款成功时返回（_result.resultStatus_ 的值为 `S`）。

更多关于此字段的信息：

*   最大长度：64 个字符

#### acquirerReferenceNo 字符串

非支付宝收单方为交易分配的唯一ID。

更多关于此字段的信息：

*   最大长度：64 个字符

#### refundAmount Amount 对象

付款人因本次退款而退还的金额。

注意：此字段在退款成功时返回（_result.resultStatus_ 的值为 `S`）。

显示子参数

#### refundTime 日期时间

退款成功、失败或未知状态的日期和时间。

更多关于此字段的信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### 总结算金额（grossSettlementAmount）Amount 对象

退款结算金额，等于退款金额乘以_settlementQuote_的值。当货币兑换预先确定且交易时汇率被锁定时，此字段将返回。

显示子参数

#### 结算汇率（settlementQuote）Quote 对象

结算货币与交易货币之间的汇率。当_grossSettlementAmount_返回时，此字段将返回。

显示子参数

API 探索器

示例代码在沙箱中运行

### 请求

URL

北美

https://open-na-global.alipay.com/ams/api/v1/payments/refund

请求体

复制

1

2

3

4

5

6

7

8

```json
{
  "paymentId": "20181129190741010007000000XXXX",
  "refundRequestId": "20181129190741020007000000XXXX",
  "refundAmount": {
    "value": "100",
    "currency": "USD"
  }
}
```

请注意，这里没有嵌套的Markdown语法，也没有JSON键需要翻译。文档已翻译成中文，保留了原始格式和空白行。

很抱歉，您似乎输入了一串无意义的希伯来字符。请您提供需要翻译的markdown格式文档，我将很乐意帮您翻译成中文。

### 响应

情况

成功

响应体

复制

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "成功"
  },
  "refundAmount": {
    "value": "100",
    "currency": "USD"
  },
  "refundTime": "2020-10-10T12:01:01+08:30",
  "paymentId": "20181129190741010007000000XXXX",
  "refundRequestId": "20181129190741020007000000XXXX",
  "refundId": "40181129190741020007000000XXXX"
}
```

此响应表示一个退款操作成功。其中：

- `resultCode`：退款结果代码，此处为 "SUCCESS"，表示成功。
- `resultStatus`：状态码，"S" 通常代表成功。
- `resultMessage`：成功信息，此处为 "成功"。
- `refundAmount`：退款金额，包含数值 "100" 和货币单位 "USD"。
- `refundTime`：退款时间，为 "2020-10-10" 的中午 12:01:01（北京时间）。
- `paymentId`：支付订单ID，示例值为 "20181129190741010007000000XXXX"。
- `refundRequestId`：退款请求ID，示例值为 "20181129190741020007000000XXXX"。
- `refundId`：退款ID，示例值为 "40181129190741020007000000XXXX"。

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

结果处理逻辑
--------------------

对于不同的请求结果，需要执行不同的操作。详细如下：

- **请求成功 (Request Success)**:
  - 如果请求成功，系统将执行以下步骤：
    - **数据处理 (Data Processing)**:
      - 解析返回的JSON数据。
      - 验证数据的完整性和准确性。
    - **业务逻辑 (Business Logic)**:
      - 根据返回的数据更新用户账户状态。
      - 如果涉及交易，更新交易记录。
    - **用户反馈 (User Feedback)**:
      - 显示成功消息给用户。
      - 更新用户界面以反映新状态。

- **请求失败 (Request Failure)**:
  - 如果请求失败，根据错误代码采取相应措施：
    - **网络错误 (Network Error)**:
      - 检查网络连接，提示用户网络问题。
      - 重试请求，最多尝试三次。
    - **服务器错误 (Server Error)**:
      - 显示错误信息，告知用户服务暂时不可用。
      - 记录错误日志，供后续分析。
    - **授权错误 (Authorization Error)**:
      - 通知用户登录或授权已过期。
      - 弹出重新登录或授权的界面。

- **超时 (Timeout)**:
  - 如果请求超时，可以：
    - 用户界面提示请求超时。
    - 询问用户是否要重新尝试。

- **异常情况 (Exceptional Cases)**:
  - 对于未预见的错误，执行以下操作：
    - **错误处理 (Error Handling)**:
      - 显示一般错误消息，避免暴露详细信息。
    - **日志记录 (Logging)**:
      - 记录详细的异常信息，便于排查问题。
    - **恢复机制 (Recovery Mechanism)**:
      - 尽可能恢复到稳定状态，如关闭不完整的操作。

请确保在处理每个结果时，都遵循安全和用户体验的最佳实践。

*   如果_result.resultStatus_的值为`S`，退款成功。
*   如果_result.resultStatus_的值为`F`，退款失败。通常，失败原因是退款窗口已过期（_result.resultCode_=`REFUND_WINDOW_EXCEED`）。如果仍需处理退款，需要人工干预。
*   如果_result.resultStatus_的值为`U`，结果未知。可能由于系统或网络问题导致处理失败。使用相同的_refundRequestId_重试，或使用**inquiryRefund** API查询退款结果。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 退款成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决问题。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不支持。 | 联系支付宝技术支持获取详细原因。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_MERCHANT\_STATUS | F | 商户状态异常，存在限制。 | 请咨询支付宝技术支持以获取详细原因。 |
| KEY\_NOT\_FOUND | F | 找不到支付宝或商户的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在Antom仪表盘上传私钥。 |
| MERCHANT\_BALANCE\_NOT\_ENOUGH | F | 商户余额不足。 | 等待商户余额充足后重新调用接口。重试时需要更改_refundRequestId_字段。 |
| MULTIPLE\_REFUNDS\_NOT\_SUPPORTED | F | 合同限制，不支持多次退款。 | 检查是否存在多次退款。请勿再调用退款接口。每次退款仅调用一次接口。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点信息。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| ORDER\_IS\_CLOSED | F | 您发起的请求具有与已存在交易相同的\_paymentRequestId\_, 且该交易已关闭。 | 使用新的\_paymentRequestId\_重新发起退款请求。 |

| ORDER\_NOT\_EXIST | F | 订单不存在。 | 检查\_paymentId\_是否正确。如果正确，请联系支付宝技术支持以获取具体原因。 |

| ORDER\_STATUS\_INVALID | F | 订单状态无效。交易正在进行中或交易已失败。 | 检查订单状态并采取相应措施。如果交易正在进行中，请等待。如果交易失败，请不要发起退款。联系支付宝技术支持以获取具体原因。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| PARAM\_ILLEGAL | F | 必需的参数未传递，或者存在非法参数。例如，非数字输入、无效日期，或者参数的长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般性的业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| REFUND\_AMOUNT\_EXCEED | F | 退款总额超过了支付金额。 | 确认退款总额是否超过支付金额。创建一个退款金额小于或等于支付金额的新退款，或者联系支付宝技术支持。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| REFUND\_WINDOW\_EXCEED | F | 退款日期超出了合同约定的退款期。 | 确认退款日期是否超过退款期限。检查合同中的退款期限，或联系支付宝技术支持获取具体的退款期限。 |

| REPEAT\_REQ\_INCONSISTENT | F | 金额或币种与之前的请求不一致。 | 确保所有请求字段相同，或使用新的\_paymentRequestId\_\_重新发起退款。 |

| SYSTEM\_ERROR | F | 发生了系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |

| REFUND\_IN\_PROCESS | U | 退款正在处理中。 | 等待异步通知或调用**查询退款**接口查询最终的退款状态。不要重试退款请求。 |

| 错误代码 | 类型 | 错误信息 | 解决方案 |
| --- | --- | --- | --- |
| REFUND\_NOT\_SUPPORTED | F | 该交易不支持退款。 | 检查交易状态和合同中的退款政策。如果交易成功且合同允许退款，请联系支付宝技术支持。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |
| PARTIAL\_REFUND\_NOT\_SUPPORTED | F | 该交易不支持部分退款。 | 进行全额退款或与买家联系进行线下退款。 |
| PAYMENT\_METHOD\_NOT\_SUPPORTED | F | 支付方式不支持已成功状态的交易取消或退款。 | 不要重试。联系支付宝技术支持获取更多信息。 |
| ORDER\_IS\_CANCELED | F | 交易已取消。 | 由于交易已被取消，无法退款。 |

|
| 未知异常 | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![图片 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面是否有帮助？
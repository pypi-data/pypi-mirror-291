取消 | 产品API | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_a52690f40beef33d7d37f1bda6f48c27.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_d70d46fd32b98952674df01c03131d87.svg)](/docs/zh-cn/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Fpaymentc)

[返回首页](../../)

产品API

[支付宝API](/docs/zh-cn/ac/ams/api)

在线支付

店内支付

支付

[支付（用户出示模式支付）](/docs/zh-cn/ac/ams/upm)

[支付（订单码支付）](/docs/zh-cn/ac/ams/oc)

[支付（入口码支付）](/docs/zh-cn/ac/ams/ec)

[支付通知](/docs/zh-cn/ac/ams/paymentrn)

[支付查询](/docs/zh-cn/ac/ams/paymentri)

[取消](/docs/zh-cn/ac/ams/paymentc)

退款

注册

取消
====

2023年11月9日 09:33

POST /v1/payments/cancel

使用**取消** API 可以在支付结果长时间未返回时取消支付，或者在授权完成后取消支付授权。

在调用此 API 之前需要注意几点：

要取消支付，您必须提供以下参数之一：

*   _paymentId_：要取消的原始支付请求的ID，由支付宝在商家发起原始支付时生成。
*   _paymentRequestId_：要取消的原始支付请求的ID。

结构
====

消息由头部和主体组成。以下部分专注于主体结构。头部结构请参阅：

*   [请求头部](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头部](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**: 将每个字段（不包括数组）的数据类型设置为字符串。这意味着字段值必须用双引号（" "）括起来。示例：

*   如果字段的数据类型是整数，其值为20，应设置为"20"。
*   如果字段的数据类型是布尔值，其值为true，应设置为"true"。

### 请求参数

#### paymentId 字符串

支付宝为识别一次支付分配的唯一ID。_paymentId_ 和 _paymentRequestId_ 不能都为null。_paymentId_ 和 _paymentRequestId_ 之间存在一对一的对应关系。

更多关于此字段的信息：

*   最大长度：64个字符

#### paymentRequestId 字符串

商家为识别支付请求分配的唯一ID。_paymentRequestId_ 和 _paymentId_ 不能都为null。如果同时提供了 _paymentRequestId_ 和 _paymentId_，_paymentId_ 优先。

更多关于此字段的信息：

*   最大长度：64个字符

### 响应参数

#### 结果 Result 对象 **必需**

请求结果包含状态和错误代码等信息。

显示子参数

#### paymentId 字符串 

支付宝为识别一次支付分配的唯一ID。

关于此字段的更多信息：

*   最大长度：64 个字符

#### paymentRequestId 字符串 

商家为识别支付请求分配的唯一ID。

关于此字段的更多信息：

*   最大长度：64 个字符

#### cancelTime 日期时间 

支付取消流程的实际执行完成时间，即支付取消成功的日期和时间。仅在取消成功时返回此参数。

关于此字段的更多信息：

*   值遵循 [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) 标准格式。例如，"2019-11-27T12:01:01+08:00"。

API 探索器

### 请求

URL

北美

# 取消支付请求

API地址: <httpsות://open-na-global.alipay.com/ams/api/v1/payments/cancel>

请求体

```json
{
  "paymentId": "2019061218401080010018882020035XXXX"
}
```

请注意:
1. 请勿遗漏任何内容，保持简洁明了。
2. 请确保包括所有嵌套的Markdown语法。
3. 禁止翻译JSON键名。
4. 保留所有空白行，以保持Markdown格式正确。
5. 检查翻译结果，确保语句通顺。

### 响应

响应体

Copy

1

2

3

4

5

6

7

8

9

10

```
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "成功"
  },
  "paymentRequestId": "pay_2089760038715669_20277574507XXXX",
  "paymentId": "2019061218401080010018882020035XXXX",
  "cancelTime": "2019-06-12T19:07:11+08:00"
}
```

请注意，JSON键未被翻译，以遵循您的要求。整个文档已翻译成中文，保留了原始markdown格式，并确保语句通顺。

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

结果处理逻辑
--------------------

对于不同的请求结果，需要执行不同的操作。详细如下：


* **请求成功（HTTP 200）**

    * 如果请求成功，解析返回的JSON数据。
    * 根据JSON中的`status`字段判断业务状态。
    * 如果`status`为`SUCCESS`，则处理成功业务逻辑。
    * 如果`status`为`ERROR`，检查`message`字段获取错误信息并进行错误处理。

* **请求失败（非200状态码）**

    * 如果HTTP响应状态码不是200，捕获异常。
    * 记录错误日志，包括HTTP状态码和服务器返回的任何错误信息。
    * 如果需要，尝试重试请求，但应限制重试次数以防止无限循环。

* **超时或网络问题**

    * 设置请求超时时间，如果超过该时间未收到响应，视为超时。
    * 超时后，执行错误处理，可能包括网络恢复逻辑或通知用户。
    * 可以选择稍后重新尝试请求。

* **用户认证失败**

    * 如果返回的JSON中包含认证错误信息，例如`auth_error`，提示用户重新登录。
    * 清除本地存储的认证凭据。
    * 重定向到登录页面。

* **数据解析错误**

    * 如果无法解析返回的JSON数据，记录详细的错误信息。
    * 显示用户友好的错误消息，如“服务器返回的数据格式不正确”。

* **其他错误**

    * 对于未预见的错误，记录详细的错误信息，包括堆栈跟踪。
    * 提供默认的错误处理，例如显示通用错误消息。

确保在所有情况下，都适当地处理错误并提供反馈，以保持良好的用户体验。

*   如果_result.resultStatus_的值为`S`，取消操作成功。
*   如果_result.resultStatus_的值为`F`，取消失败。请查看返回的错误代码并确定进一步的操作。
*   如果_result.resultStatus_的值为`U`，取消结果未知。使用相同的请求参数重试取消请求。
*   如果没有收到响应，使用相同的请求参数重试取消请求。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 订单已取消。商家需要将收据状态设置为取消。 |
| CANCEL_WINDOW_EXCEED | F | 取消日期超出支持取消的期限。期限在合同中约定。 | 交易无法再取消。针对该交易发起退款。 |
| CLIENT_INVALID | F | 客户端无效。 | 检查_clientId_是否正确。 |
| ORDER_NOT_EXIST | F | 订单不存在。 | 检查_paymentId_是否正确。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| ORDER\_STATUS\_INVALID | F | 由于订单状态无效，交易无法进一步处理。 | 检查交易的订单状态，或联系支付宝技术支持获取详细原因。 |

| MEDIA\_TYPE\_NOT\_ACCEPTABLE | F | 服务器不支持客户端可接受的媒体类型。 | 检查媒体类型是否正确。 |

| METHOD\_NOT\_SUPPORTED | F | 服务器不实现请求的HTTP方法。 | 检查HTTP方法是否正确。 |

| MERCHANT\_BALANCE\_NOT\_ENOUGH | F | 商户余额不足。 | 等待商户余额充足后，再调用接口。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 本页面是否有帮助？
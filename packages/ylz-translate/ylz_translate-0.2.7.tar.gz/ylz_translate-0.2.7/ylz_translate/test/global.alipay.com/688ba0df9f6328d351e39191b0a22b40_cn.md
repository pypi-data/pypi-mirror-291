整合指南 | EasySafePay | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg) ![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Feasypay_en%2Fsdk)  
[返回首页](../../)

EasySafePay  
[概述](/docs/ac/easypay_en/overview_en)  
接受支付  
支付后操作  
整合指南
=================  
2024-04-30 06:18  
本文档提供了如何集成EasySafePay以实现买家免密支付的指导。通过集成EasySafePay，您不再需要手动获取买家授权，定期刷新支付令牌，或处理不同客户端之间的重定向。

部署
==========

EasySafePay提供了两种支付流程，但集成过程相同。

支付流程
-------------

EasySafePay提供的两种支付流程根据买家是否被重定向到支付方式客户端进行区分：

*   **无缝体验**
*   **重定向体验**

**无缝支付体验**

无缝支付体验让买家免于被重定向到支付方式客户端。以下图形展示了首次支付和后续支付的无缝支付体验。

![图片3：350949baddc53268cbe4f2aba31a9e84.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1689323540360-7abb49a8-5363-4587-b2ea-2eda1f89c2c1.png)  
图1. 无缝体验的支付流程  

> **注意**：对于电脑网站的无缝支付，不支持未关联账户的首次支付。

**重定向支付体验**
重定向支付体验要求首次支付时，买家会被重定向到支付方式的客户端。以下图表展示了首次支付和后续支付的重定向支付体验。

![图片 4: redirection.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1688981866534-0c22462f-3d5c-4141-922c-83718335cd5a.png)  
图2. 重定向支付体验的支付流程  

前提条件
-------------

在集成SDK之前，请先熟悉[_集成指南_](https://global.alipay.com/docs/integration_guide_en)和[_API概览_](https://global.alipay.com/docs/ac/ams/api_fund)。这将帮助您了解如何集成服务器API以及调用API的注意事项。同时，请确保已完成以下任务：

1. 在[Antom仪表板](https://global.alipay.com/docs/dashboard_en)中获取客户端ID。
2. 在Antom仪表板中正确配置密钥。
3. 配置一个URL，用于接收授权结果和撤销授权结果的异步通知。详细信息请参阅[通知](https://global.alipay.com/docs/ac/cashierpay/notifications)。

实现步骤
--------------

在实现EasySafePay集成时，涉及两方：

1. 服务器端：您的服务器发送一个API调用来创建支付会话，并获取授权结果和支付结果。
2. 客户端：EasySafePay组件使用支付会话数据来管理获取支付账户授权和处理重定向等操作。

按照以下步骤完成集成：

1. 客户端**创建SDK实例**：
   在客户端创建支付方式页面并实现支付按钮点击事件的监控后，运行`AMSEasyPay`方法来创建SDK实例。
2. 服务器端**调用createPaymentSession API**：
1.  **买家选择支付方式**：
    买家选择支付方式后，您的服务器使用买家的订单信息向支付宝服务器发送一个[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay)请求。

2.  **首次支付时获取授权令牌**：
    对于后续支付，调用此API时，必须使用从[**notifyAuthorization**](https://global.alipay.com/docs/ac/ams/notifyauth)在首次支付时获取的令牌设置_paymentMethod.paymentMethodId_参数。

3.  **客户端调用SDK**：
    使用[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) API响应参数_paymentSessionData_运行`createComponent`方法来调用SDK。

4.  **买家关联账户并付款**：
    买家在授权页面上确认授权，并在身份验证通过后关联支付方式。

5.  **服务器端获取并展示授权结果（仅首次支付时）**：
    服务器通过[**notifyAuthorization**](https://global.alipay.com/docs/ac/ams/notifyauth)获取授权结果和用于未来支付的令牌。必须在支付结果页面上展示授权结果和支付结果。

6.  **服务器端获取并展示支付结果**：
    服务器通过接收异步通知[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)或调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API获取支付结果。必须在支付结果页面上展示支付结果。

要了解更多关于Web/WAP、Android或iOS客户端上EasySafePay集成的详细信息，请参阅以下主题：
*   [Web/Wap](https://global.alipay.com/docs/ac/easypay_en/webwap_en)
*   [Android](https://global.alipay.com/docs/ac/easypay_en/android_en)
*   [iOS](https://global.alipay.com/docs/ac/easypay_en/ios_en)  
要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。  
![图片 5](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 6](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  
#### 这个页面有帮助吗？  
#### 在此页面上  
[部署](#Rq8qK "部署")  
[支付流程](#gvnBp "支付流程")  
[先决条件](#gzjkF "先决条件")  
[实现步骤](#8ZT1Z "实现步骤")
概览 | 自动扣款 | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fautodebitpay%2Foverview)  
[返回首页](../../)  

自动扣款
[概览](/docs/ac/autodebitpay/overview)  
[用户体验](/docs/ac/autodebitpay/user_ex)  
开发
[最佳实践](/docs/ac/autodebitpay/best_practice)  
其他资源
概览
========

2023-08-08 07:41

> **注意**：这是自动扣款文档的最新版本。[**旧版本**](https://global.alipay.com/docs/ac/agreementpayment/intro)将不再更新，但会保留到2022年9月，之后将被弃用并从支付宝文档中移除。

自动扣款是一种允许商家预先授权从用户账户中扣除资金的支付解决方案。用户通过支付协议（如三方代扣协议）向商家授权。当用户在商家网站上购买商品时，商家可以使用授权令牌直接从用户账户中扣款。

用户体验
===============

授权过程可以通过网站、WAP页面或移动应用程序发起。以下视频展示了这些终端的授权体验。

要了解完整的用户授权体验以及查看商家与支付方式之间的示例流程，请参阅[用户体验](https://global.alipay.com/docs/ac/autodebitpay/user_ex)。

产品功能
=======================

自动扣款为您的业务提供以下功能：
获取用户授权  
自动扣款  
退款  
对账  

以下与用户授权相关的功能提供：

*   [创建accessToken](https://global.alipay.com/docs/ac/autodebitpay/create_accesstoken)：通过调用**咨询** API 获取_authUrl_ 地址，邀请用户在_authUrl_ 地址上进行授权。获得用户的授权后，使用_authCode_ 获取_accessToken_，并使用_accessToken_ 从用户账户中扣款。
*   [刷新accessToken](https://global.alipay.com/docs/ac/autodebitpay/refresh_accesstoken)：当_accessToken_ 即将过期时，可以使用[**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API 更新它。
*   [撤销accessToken](https://global.alipay.com/docs/ac/autodebitpay/revoke_accesstoken)：在必要时，通过调用[**revoke**](https://global.alipay.com/docs/ac/ams/authrevocation) API 可以使_accessToken_ 失效。
*   [接收授权通知](https://global.alipay.com/docs/ac/autodebitpay/notify_auth)：向支付宝提供一个授权通知URL，可以在用户成功完成或取消授权后接收支付宝发送的授权状态通知。

以下与自动扣款相关的功能提供：

*   [发起支付](https://global.alipay.com/docs/ac/autodebitpay/pay)：获取_accessToken_ 后，可以发起支付并自动从用户账户中扣款。
*   [查询支付结果](https://global.alipay.com/docs/ac/autodebitpay/inquire_payment)：通过[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 获取支付状态。
*   **接收支付通知**：提供一个URL以接收支付通知后，可以通过Alipay的[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) SPI获取支付状态的更新。
*   **取消交易**：在必要时，可以使用[**cancel**](https://global.alipay.com/docs/ac/ams/paymentc_online) API取消交易。T日的交易可以在T+1日00:15 UTC+8:00之前取消。
    *   **退款功能**：
        *   **发起退款**：可以通过[**refund**](https://global.alipay.com/docs/ac/ams/refund_online) API或通过Alipay全球商家门户进行退款。退款通常只能在初始支付后的12个月内进行，支持全额和部分退款。
        *   **查询退款结果**：除了等待退款响应，还可以主动调用[**inquiryRefund**](https://global.alipay.com/docs/ac/ams/ir_online) API查询退款结果。
*   **对账与结算**：完成支付或退款后，使用对账功能检查交易和结算详情。
*   **集成解决方案简介**：
    这部分提供了整个集成过程的一般步骤。阅读此主题开始Alipay的集成过程。
*   **合作流程**：
    要与Alipay合作并使用Alipay自动扣款产品，请遵循以下合作流程：
    1.  签订合同。
    2.  集成产品（设置、沙箱环境集成、上线及试点测试）。
3. 开始您的业务。
整合过程
-------------------

所有支付宝产品的通用整合流程包括以下阶段。有关每个阶段的详细配置信息，请参阅[集成指南](https://global.alipay.com/docs/integration)。

![图片3：整合流程.jpg](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1648003989966-9afa29c3-2048-46c5-9672-9d1ab1b1756f.jpeg)

图1. 整合流程

要在沙箱环境测试并上线，建议遵循以下步骤：

1. 阅读[最佳实践](https://global.alipay.com/docs/ac/autodebitpay/best_practice)，了解API交互逻辑，以提高整合效率并避免支付纠纷。所有为自动扣款提供的API和SPI在[APIs和SPIs](#e8pZl)部分列出。
2. 整合[产品功能](#H7dQN)中列出的功能。在使用API进行整合时，需要向相应的地址发送POST请求，HTTP请求中包含身份信息、签名和业务参数。支付宝接收到请求后，会验证请求的签名。如果签名验证通过，支付宝会返回相应的响应。当您的服务器接收到响应后，也需要验证响应的签名，以确认响应是否来自支付宝。如果签名验证通过，您可以在系统中采取进一步行动。以下主题将帮助您解决调用API时可能遇到的问题：

   * [API概述](https://global.alipay.com/docs/ac/ams/api_fund)
   * [幂等性](https://global.alipay.com/docs/ac/ams/idempotency)
   * [消息编码](https://global.alipay.com/docs/ac/ams/me)
   * [请求签名和验证签名](https://global.alipay.com/docs/ac/ams/digital_signature)
3. 使用[测试支付方式和账户](https://global.alipay.com/docs/ac/ref/testwallet)在沙箱环境中模拟真实场景。在沙箱环境中创建和调试应用程序时，请务必使用支付宝提供的[工具](https://global.alipay.com/docs/tools)来简化集成过程。
4. 完成上线任务后，使用真实支付方式的应用和正式账户进行试点测试。如果需要创建正式支付方式账户的帮助，可以联系支付宝技术支持。通过在生产环境中使用正式账户执行[生产测试用例](https://global.alipay.com/docs/ac/autodebitpay/testcases)，确保应用程序端到端运行顺畅。
### 接口与SPI
以下表格列出了用于自动扣款的API，可以通过向相应的端点发送带有正确地址格式的请求来调用这些API：

| **接口名称** | **端点** |
| --- | --- |
| 咨询 | [/v1/authorizations/consult](https://global.alipay.com/doc/ams/authconsult) |
| 申请令牌 | [/v1/authorizations/applyToken](https://global.alipay.com/doc/ams/accesstokenapp) |
| 取消授权 | [/v1/authorizations/revoke](https://global.alipay.com/doc/ams/authrevocation) |
| 支付 | [/v1/payments/pay](https://global.alipay.com/doc/ams/payment_agreement) |
| 查询支付 | [/v1/payments/inquiryPayment](https://global.alipay.com/doc/ams/paymentri_online) |
| 取消支付 | [/v1/payments/cancel](https://global.alipay.com/doc/ams/paymentc_online) |
| 退款 | [/v1/payments/refund](https://global.alipay.com/doc/ams/refund_online) |
| 查询退款 | [/v1/payments/inquiryRefund](https://global.alipay.com/docs/ac/ams/ir_online) |
| 宣报 | [/ams/api/v1/customs/declare](https://global.alipay.com/docs/ac/ams/declare) |
| 查询宣报请求 | [/ams/api/v1/customs/inquiryDeclarationRequests](https://global.alipay.com/docs/ac/ams/inquirydeclare) |
| 注册 | [/v1/merchants/registration](https://global.alipay.com/docs/ac/ams/registration_online) |
| 查询注册状态 | [/v1/merchants/inquiryRegistrationStatus](https://global.alipay.com/docs/ac/ams/irs_online) |
| 查询注册信息 | [/v1/merchants/inquiryRegistrationInfo](https://global.alipay.com/docs/ac/ams/iri_online) |
表1. 自动扣款API列表

以下表格列出了在自动扣款中使用的SPI。在您进行相应配置后，支付宝会使用这些SPI向您发送通知：

| **SPI名称** | **端点** |
| --- | --- |
| 支付通知 | [/v1/payments/notifyPayment](https://global.alipay.com/doc/ams/paymentrn_online) |

表2. 自动扣款SPI列表
| 通知授权 | [/v1/authorizations/notifyAuthorization](https://global.alipay.com/docs/ac/ams/notifyauth) |
| 通知注册状态 | [/v1/merchants/notifyRegistrationStatus](https://global.alipay.com/docs/ac/ams/nrs_online) |
表2. 自动扣款SPI列表
### SDKs
除了通过自定义编码进行API集成，您还可以通过[Alipay SDKs](https://global.alipay.com/docs/sdks)进行集成。Alipay SDKs提供了一种标准化的方法，帮助商家更快地构建软件应用程序。目前，提供了针对Java、Python和PHP的SDK，覆盖不同的功能范围：

*   Java SDK：支持与API解决方案相同的所有功能。
*   Python、PHP和.NET SDKs：仅支持API解决方案提供的一部分功能。下表显示了Python、PHP和.NET SDK当前支持的功能：

| 功能 | SDK集成 |
| --- | --- |
| 咨询 | ✅ |
| 获取令牌 | ✅ |
| 取消 | ✅ |
| 支付 | ✅ |
| 查询支付 | ✅ |
| 取消支付 | ✅ |
| 退款 | ✅ |
| 查询退款 |  |
| 申报 |  |
| 查询申报请求 |  |

表3. 每项功能支持的SDK集成

### 支持的支付方式
自动扣款支持以下支付方式：

| 支付方式 |
| --- |
| [Alipay](https://global.alipay.com/docs/ac/antomad/alipay) |
| [AlipayHK](https://global.alipay.com/docs/ac/antomad/alipayhk) |
| [bKash](https://global.alipay.com/docs/ac/antomad/bkash) |
| [Boost](https://global.alipay.com/docs/ac/antomad/boost) |
| [DANA](https://global.alipay.com/docs/ac/antomad/dana) |
| [Easypaisa](https://global.alipay.com/docs/ac/antomad/easypaisa) |
| [GCash](https://global.alipay.com/docs/ac/antomad/gcash) |
| [GrabPay](https://global.alipay.com/docs/ac/antomad/grabpay) |
| [KakaoPay](https://global.alipay.com/docs/ac/antomad/kakaopay) |
| [Krung Thai Bank](https://global.alipay.com/docs/ac/antomad/ktb) |
| [Maya](https://global.alipay.com/docs/ac/antomad/maya) |
| [NAVER Pay](https://global.alipay.com/docs/ac/antomad/naverpay) |
| [PayPay](https://global.alipay.com/docs/ac/antomad/paypay) |
| [Rabbit LINE Pay](https://global.alipay.com/docs/ac/antomad/rabbitlinepay) |
| 泰国暹罗商业银行 (Siam Commercial Bank) | [Touch'n Go](https://global.alipay.com/docs/ac/antomad/touchngo) | [TrueMoney](https://global.alipay.com/docs/ac/antomad/truemoney) | [Zalopay](https://global.alipay.com/docs/ac/antomad/zalopay) |
| --- | --- | --- | --- |

更多信息
==========

[用户体验](https://global.alipay.com/docs/ac/autodebitpay/user_ex)  
[最佳实践](https://global.alipay.com/docs/ac/autodebitpay/best_practice)  
要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。  
![图片 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
© 2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

#### 这个页面有帮助吗？

#### 本页面内容

[用户体验](#MQR41 "用户体验")  
[产品功能](#H7dQN "产品功能")  
[集成解决方案介绍](#aFbls "集成解决方案介绍")  
[合作流程](#GQGMv "合作流程")  
[集成流程](#a52pU "集成流程")  
[API 和 SPI](#YKiUL "API 和 SPI")  
[SDK](#7QXfW "SDK")  
[支持的支付方式](#xtvNz "支持的支付方式")  
[更多信息](#ueubN "更多信息")
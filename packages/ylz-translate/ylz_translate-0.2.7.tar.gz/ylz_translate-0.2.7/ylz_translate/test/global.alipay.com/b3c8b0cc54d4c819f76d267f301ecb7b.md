Card vaulting | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fcv)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf?pageVersion=7)

Card vaulting
=============

2024-05-11 10:13

This article guides you through the integration of a standalone card vaulting API to enable the ability for buyers to bind cards at any stage of the payment process. You can collect the buyer's card details and store in Antom. In subsequent transactions, you can use the _token_ parameter to initiate payments without collecting the buyer's card details again.

Payment flow
============

The following figure shows the integration steps of card vaulting:

![Image 3: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713413213279-838f65c4-9428-416b-94ee-319828ce18fb.png)

Integration steps
=================

Follow these steps to enable the ability for buyers to bind cards at any stage of the payment process:

1.  Initiate a card vaulting request
2.  Obtain the card vaulting result

Step 1: Initiate a card vaulting request
----------------------------------------

Antom offers server-side API libraries for various programming languages. The following code uses Java as an example. To utilize the Antom API in Java, ensure that you have Java 6 or a newer version installed on your system.

### Install an API library

Find the latest version on [GitHub](https://github.com/alipay/global-open-sdk-java).

copy

    <dependency>
      <groupId>com.alipay.global.sdk</groupId>
      <artifactId>global-open-sdk-java</artifactId>
      <version>2.0.21</version>
    </dependency>

### Initialize the request instance

copy

    String merchantPrivateKey = "YOUR PRIVATE KEY";
    String alipayPublicKey = "ALIPAY PUBLIC KEY"
    AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
                    merchantPrivateKey, alipayPublicKey);

### Create a request

Specify the following parameters in the request:

<table style="width:790px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="287" span="1"><col width="123" span="1"><col width="380" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="cdd94248494b1a143258ede58964bea5" id="ue38567b6" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">Parameter name</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="fc4378c2efa84b1eb04e42c9995fc770" id="uf08cd1d4" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">Is required?</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="cd7c879bfa395392f63028d2a4587ebf" id="u71019669" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">Description</span></strong></p></td></tr><tr style="height:37px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="884d440467c9d14771c525149ac05a46" id="ue12350bd" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentMethodDetail.card</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="92be1ae3833ff80499cb1390eca884f7" id="u7ebe6509" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3807b1a8bc639f491c830c632263d2d9" id="ufbb2ca1a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Pass in the card information that needs to be bound</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="2ac5c79ba9d3ecad33358e41623cb64a" id="u683387be" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">vaultingRequestId</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="81de6d606d9a323ed3d1ccbd771f88f5" id="u851e6c48" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="dba547d0c64145929faec883ccf396c5" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The unique ID generated by the merchant. Every time you initiate card vaulting, you must have a new ID.</p></td></tr><tr style="height:38px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="630aa41c3b0d9664db527e678b0e4cdc" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentMethodDetail.paymentMethod</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="fc15655b5ac00e8325c7114f934b1791" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1ba9e359a4bf04176509d9fb0e02709c" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The field is fixed to <code style="font-family:monospace;font-size:inherit;background-color:rgba(0, 0, 0, 0.06);padding:0px 2px;border:1px solid rgba(0, 0, 0, 0.08);border-radius:2px;line-height:inherit;overflow-wrap:break-word;text-indent:0px">CARD</code>.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="46a36509fde329d354c0bcf3da068d78" id="ub1cdbd1c" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">redirectUrl</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3945343973b35a3d164858b908c1d301" id="uab918c80" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c9755fa9c6f7c53b653e8ff734aba38f" id="u635539dd" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The merchant side binds the results page, which needs to be displayed based on the server side results.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="93357dfa08e94bb7f0ae73211a7b5c4c" id="u202c35dd" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">vaultingNotificationUrl</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="443f08059facec8b1d3f2a786542190f" id="u54f5b8c7" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>No</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="99f4af5096301944e4c10ef25c31f9f5" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The card vaulting result notification address, which can be specified via the API or set a fixed value in the portal.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="5e29190ef273380fd34310fcf03fafbb" id="u2c417148" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">env</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="7c1dc67e0e0372e9e21d98e24298c076" id="u959a4e54" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="7b86aa081a74d57575171ca5fa0095f9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The environment in which the buyer initiates a card vaulting request.</p></td></tr></tbody></table>

For more information about all parameters, refer to [**vault**](https://global.alipay.com/docs/ac/ams/vaulting_session) API.

The following sample code shows how to initiate a payment:

copy

          AlipayPayRequest alipayPayRequest = new AlipayPayRequest();
            alipayPayRequest.setClientId(CLIENT_ID);
            alipayPayRequest.setPath("/ams/api/v1/vaults/vaultPaymentMethod");
    
            // replace to your vaultingRequestId
            String vaultingRequestId = UUID.randomUUID().toString();
            alipayPayRequest.setPaymentRequestId(paymentRequestId);
    

### FAQs

#### How to set the value of _terminalType_?

If the buyer initiates a request from PC, the _terminalType_ needs to be specified as `WEB`.

#### How to set the result notification address？

Antom will send the payment result through the [**notifyVaulting**](https://global.alipay.com/docs/ac/ams/notify_vaulting).

#### How to deal with the co-badged card?

If the card entered by the buyer is a co-badged card, you need to specify the card brand to be bound via _paymentMethodDetail.card.selectedCardBrand_, and the subsequent _token_ payment will be debited for this card brand.

> **Note**: For co-badged cards in Europe, you need to give the buyer the right to choose the card brand to be bound.

Step 2: Obtain the card vaulting result
---------------------------------------

### Synchronous response

The return code of the card vaulting result is as follows:

copy

    {
      "paymentMethodDetail": {
        "card": {
          "brand": "VISA",
          "cardToken": "ALIPAY9CGwsAeMBug+G2dSKDV6AIsNKTxAFNkOMoj8Gxvt8h0eDUbd6nO5CwMFIjEFERWxCAo/b1OjVTvtl1zspyMGcg==",
          "maskedCardNo": "************8764"
        },
        "paymentMethodType": "CARD"
      },
      "vaultingRequestId": "123487889889",
      "result": {
        "resultCode": "SUCCESS",
        "resultMessage": "success.",
        "resultStatus": "S"
      }
    }

#### FAQs

##### How to specify the parameters in the field?

_resultStatus_ indicates the result of this card vaulting request: `S` indicates success, `F` indicates failure, `U` needs to redirect to normalUrl for 3D verification.

When the card vaulting is successful, the **vaultPaymentMethod** API will return these fields synchronously. Among them, _cardToken_ is used for token payment, _maskedCardNo_ is used to show the card number to customers, _brand_ is used to show the card brand to customers. You can store this information in association with the buyer ID on the merchant side.

##### Is there still an asynchronous notification after the successful card vaulting?

After the **vaultPaymentMethod** API returns `S` or `F`, you will receive a corresponding asynchronous notification.

### Asynchronous response

When the buyer completes the payment or the payment times out, you can get the vaulting result from an Antom asynchronous notifications or by inquiring about the vaulting result.

#### Asynchronous notification

When a card vaulting is completed or times out, Antom sends an asynchronous notification via [**notifyVaulting**](https://global.alipay.com/docs/ac/ams/notify_vaulting).

##### FAQs

###### When will the notification be sent?

After the payment is completed, Antom will send the asynchronous notification to you in 3~5s.

###### Will the asynchronous notification be re-sent?

If you receive an asynchronous notification from Antom, you are required to return the response in the [Sample code](https://global.alipay.com/docs/ac/cpnew/nf) format. If you do not respond to the asynchronous notification as required, or the asynchronous notification is not delivered due to network reasons, the notification will be automatically resent within 24 hours. The notification can be resent up to 8 times or until a correct response is received to terminate delivery. The sending intervals are as follows: 0 minutes, 2 minutes, 10 minutes, 10 minutes, 1 hour, 2 hours, 6 hours, and 15 hours.

###### Do I need to countersign the response?

If you receive an asynchronous notification from Antom, you are required to return the response in the Sample code format, but you do not need to countersign the response.

#### Inquire about the vaulting result

Call the [**inquireVaulting**](https://global.alipay.com/docs/ac/ams/inquire_vaulting) API to inquire about the vaulting result.

##### FAQs

###### How to use the key parameters returned for the card vaulting request?

The value of _resultStatus_ indicates the result of this card vaulting request:

*   `S`: indicates that the card vaulting succeeds. is successful.
*   `F`: indicates that the card vaulting is failed.
*   `U`: indicates that the buyer needs to be redirected to _normalUrl_ for 3D verification.

When the card vaulting is successful, the **vaultPaymentMethod** API will return these fields synchronously:

*   _cardToken:_ used for token payment,
*   _maskedCardNo:_ used to show the card number to customers,
*   _brand:_ used to show the card brand to customers. You can store this information in association with the buyer ID on the merchant side.

###### Is there still an asynchronous notification after the successful card vaulting?

After the **vaultPaymentMethod** API returns `S` or `F`, you will receive a corresponding asynchronous notification.

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Payment flow](#N7q25 "Payment flow")

[Integration steps](#nbBeY "Integration steps")

[Step 1: Initiate a card vaulting request](#P1Nao "Step 1: Initiate a card vaulting request")

[Install an API library](#TQwe2 "Install an API library")

[Initialize the request instance](#3HXct "Initialize the request instance")

[Create a request](#fNYHp "Create a request")

[FAQs](#5Vqv9 "FAQs")

[How to set the value of terminalType?](#Ei1Hy "How to set the value of terminalType?")

[How to set the result notification address？](#Gt9QT "How to set the result notification address？")

[How to deal with the co-badged card?](#jZ0O4 "How to deal with the co-badged card?")

[Step 2: Obtain the card vaulting result](#jIRdT "Step 2: Obtain the card vaulting result")

[Synchronous response](#GT4Y4 "Synchronous response")

[FAQs](#49Lhn "FAQs")

[Asynchronous response](#hZaFy "Asynchronous response")

[Asynchronous notification](#ZpNVg "Asynchronous notification")

[Inquire about the vaulting result](#p3Kn7 "Inquire about the vaulting result")
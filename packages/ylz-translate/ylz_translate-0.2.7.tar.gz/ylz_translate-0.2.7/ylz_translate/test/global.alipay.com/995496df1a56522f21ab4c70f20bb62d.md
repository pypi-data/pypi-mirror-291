iOS | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fios)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf)

iOS
===

In this topic, you'll learn how to integrate the card payment SDK into an iOS client so that you can render cashier pages in a mobile application.

Prerequisites

Before integrating the card payment SDK, familiarize yourself with the [_Integration guide_](https://global.alipay.com/docs/integration) and [_Overview_](https://global.alipay.com/docs/ac/ams/api_fund). This will enable you to understand the steps for integrating server APIs and notes for calling the APIs. Also, ensure that you have completed the following tasks:

*   Obtain a client ID in Antom Dashboard.
*   Properly configure keys in Antom Dashboard
*   Install Xcode 12 or a higher version.
*   Use iOS 11 or a higher version.
*   The SDK security extension package does not support simulator compilation. Please integrate the SDK on a real device.

Key integration steps

Integrate the card payment SDK by following these steps:

1

Integrate the SDK package

Client side

To integrate the SDK package, please refer to [Integrate the SDK Package](https://global.alipay.com/docs/ac/antom_sdk/ios_en).

2

Create an SDK instance by using the `AMSCashierPayment` method:

Client side

*   Create an instance for cashier pages. The instance contains the following parameter:
    *   _configuration_: A required object belonging to the _AMSCashierPaymentConfiguration_ type. The object must contain all configuration parameters.
*   Create the `AMSCashierPaymentConfiguration` class, which must contain the following parameters:
    *   _locale_: An optional parameter belonging to the NSString type. It is used by the merchant client to identify the browser language and pass in the language information. The SDK uses the information to provide cashier pages in the corresponding language. Valid values are listed as follows. If other values are passed, English is used by default:
        *   `en_US`: English
        *   `pt_BR`: Portuguese
        *   `ko_KR`: Korean
        *   `es_ES`: Spanish
    *   _options_: An optional parameter belonging to the _NSDictionary_ type. It is used to specify whether to use the default loading pattern and the sandbox environment. Valid values are:
        *   `"sandbox", "true"`: Sandbox environment
        *   `"sandbox", "false"`: Production enviroment
        *   `"showLoading", "true"`: Use the default loading pattern.
        *   `"showLoading", "false"`: Do not use the default loading pattern.
*   Create an instance of the **AMSPaymentProtocol** interface used for handling corresponding events in subsequent processes. It contains the following method:
    *   ​`onEventCallback`: A callback function that monitors payment events on the checkout page, returning _eventCode_ and _eventResult_.
*   Create an instance of the **AMSLoggerProtocol** interface, which is used to manage log output. It contains the following method:
    *   ​`logWithName`: A callback function used to output logs by default.

Create a configuration object:

Objective-C

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

#import <AMSComponent

    /AMSComponent-Swift.h>

AMSCashierPaymentConfiguration

    \*componentConfig \=

    \[AMSCashierPaymentConfigura

    tion new\];

componentConfig.locale \=

    @"en\_US";

// Specify options to use the

    sandbox environment. If it

    is left empty, the

    production environment is

    used by default.

NSDictionary \*options \=

    @{@"showLoading": @"true",

    @"sandbox": @"true"};

componentConfig.options \=

    options;

\[\[AMSCashierPayment shared\]

    initConfiguration

    :componentConfig\];

\[AMSCashierPayment shared\]

    .paymentDelegate \= self;

\[AMSCashierPayment shared\]

    .loggerDelegate \= self;

\[\[AMSCashierPayment shared\]

    createComponent

    :paymentSessionData\];

#pragma AMSPaymentProtocol

\- (void)onEventCallback

    :(NSString \*)eventCode

    eventResult:(AMSEventResult

    \*)eventResult

{

NSLog(@"eventCode%@

       eventResult%@",

       eventCode, eventResult);

}

#pragma AMSLogProtocol

\- (void)logWithName:(NSString

    \*)name parameter

    :(NSDictionary<NSString

    \*,id\> \*)parameter

{

NSLog(@"name%@ parameter%@",

       name, parameter);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

3

Send a **createPaymentSession (Checkout Payment)** request to the Alipay server.

Server side

After the buyer selects a card payment method for payment, your client starts monitoring the payment button click event. When your client detects that the payment button is clicked, your server needs to send a **[createpaymentSession (Checkout Payment)](http://global.alipay.com/docs/ac/ams/session_cashier)** request to the Alipay server. After you receive the response from the API call, use the value of the _paymentSessionData_ parameter to complete Step 4.

**Note**: In your **createpaymentSession (Checkout Payment)** request, specify _paymentRedirectUrl_ as the URL Scheme that you provide to redirect buyers to the payment result page upon payment completion.

The following sample for calling the createPaymentSession API includes mandatory parameters and several optional parameters.

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

{

"order": {

"buyer": {

"buyerName": {

"firstName": "\*\*\*\*\*",

"fullName": "D\*\*\*u",

"lastName": "Liu",

"middleName": "Skr"

},

"buyerRegistrationTime":

          "2022-01-01T09:30:00

          +08:00",

"referenceBuyerId": "tony

          .c"

},

"goods": \[{

"goodsBrand": "AMSDM",

"goodsCategory": "card

          /ssr/adc",

"goodsName": "Goods No.1"

          ,

"goodsQuantity": "1",

"goodsSkuName": "SKU1",

"goodsUnitAmount": {

"currency": "USD",

"value": "10000"

},

"goodsUrl": "HangZhou

          LeiFenTa",

"referenceGoodsId":

          "amsdm\_good\_tony\_c\_20

          230227\_095825\_922"

}\],

"orderAmount": {

"currency": "BRL",

"value": "2129"

},

"orderDescription":

        "AMSDM\_GIFT",

"referenceOrderId":

        "amsdmorder\_tony\_c\_2023

        0227\_095825\_921"

},

"paymentAmount": {

"currency": "BRL",

"value": "2129"

},

"paymentFactor": {

"isAuthorization": true

},

"paymentMethod": {

"paymentMethodType": "CARD"

        ,

"paymentMethodMetaData":{

"paymentMethodRegion"

            :"BR"

}

},

"paymentNotifyUrl": "https

      ://www.google.com.sg",

"paymentRedirectUrl": "https

      ://www.baidu.com",

"paymentRequestId":

      "amsdmpayk\_tony\_c\_2023022

      7\_095825\_920\_532",

"productCode":

      "CASHIER\_PAYMENT",

"settlementStrategy": {

"settlementCurrency": "USD"

},

"enableInstallmentCollection"

      :"true"

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

The response sample of the API call is shown as follows:

JSON

1

2

3

4

5

6

7

8

9

10

{

"paymentSessionData":

      "UNvjVWnWPXJA4BgW

      +vfjsQj7PbOraafHY19X

      +6EqMz6Kvvmsdk

      +akdLvoShW5avHX8e8J15P8uN

      VEf/PcCMyXg==&&SG&&111",

"paymentSessionExpiryTime":

      "2023-04-06T03:28:49Z",

"paymentSessionId":

      "UNvjVWnWPXJA4BgW

      +vfjsQj7PbOraafHY19X

      +6EqMz6Ikyj9FPVUOpv

      +DjiIZqMe",

"result": {

"resultCode": "SUCCESS",

"resultMessage": "success."

        ,

"resultStatus": "S"

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

4

Create a component for collecting payment factors by using the `createComponent` method in the instantiated object

Client side

*   Create a configuration object by using the _sessionData_ parameter: Pass the complete data in the _paymentSessionData_ parameter obtained in the response through the **createpaymentSession** API to the _sessionData_ parameter.
*   Call the `createComponent()` method to create a component for collecting payment factors.
*   Call the `onDestroy()` method to free SDK component resources in the following situations:
    *   When the user exits the checkout page, free the component resources created in the **createPaymentSession.**
    *   When the user initiates multiple payments, free the component resources created in the previous **createPaymentSession.**

Use the createComponent() method:

Objective-C

1

2

3

4

\[\[AMSCashierPayment shared\]

    createComponent:sessionData\]

    ;

//Free SDK component resources

\[\[AMSCashierPayment shared\]

    onDestroy\];

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Reference

Event codes

The SDK provides the following status codes:

*   `SDK_START_OF_LOADING`: The loading animation starts to play during the payment component creation.
    
*   `SDK_END_OF_LOADING`: The loading animation ends during the payment component creation.
    

The SDK provides the following error codes:

*   `SDK_INTERNAL_ERROR`: The internal error of the SDK occurs. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_CREATEPAYMENT_PARAMETER_ERROR`: The parameters passed into the `createComponent` method are incorrect. Ensure the parameters are passed correctly and send a new request.
    
*   `SDK_CALL_URL_ERROR`: Represents one of the following cases:
    
    *   The redirection to the merchant page failed to be executed.
    *   The parameter _paymentRedirectUrl_ in your **createpaymentSession (Cashier Payment)** request is not passed or passed incorrectly.
*   `SDK_INTEGRATION_ERROR`: Dependencies are not found. Ensure that the dependencies are added correctly and retry the integration process.
    

Code sample in key steps

The following code sample shows the key steps during integration. The sample does not include the code used for calling the **createpaymentSession (Cashier Payment)** API.

Objective-C

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

#import <AMSComponent

    /AMSComponent-Swift.h>

// Step 1: Create an

    AMSConfiguration object.

AMSCashierPaymentConfiguration

    \*componentConfig \=

    \[AMSCashierPaymentConfigura

    tion new\];

componentConfig.locale \=

    @"en\_US";

// Set the environment. If it

    is left empty, the

    production environment is

    used by default.

NSDictionary \*options \=

    @{@"showLoading": @"true",

    @"sandbox": @"true"};

componentConfig.options \=

    options;

\[\[AMSCashierPayment shared\]

    setConfiguration

    :componentConfig\];

// Set the callback used to

    monitor payment events on

    the cashier page.

\[AMSCashierPayment shared\]

    .paymentDelegate \= self;

\[AMSCashierPayment shared\]

    .loggerDelegate \= self;

// Step 2: Your server calls

    the createPaymentSession

    API and obtains

    paymentSessionData

// Step 3: Create and render

    the card component

\[\[AMSCashierPayment shared\]

    createComponent

    :paymentSessionData\];

#pragma AMSPaymentProtocol

\- (void)onEventCallback

    :(NSString \*)eventCode

    eventResult:(AMSEventResult

    \*)eventResult

{

NSLog(@"eventCode%@

       eventResult%@",

       eventCode, eventResult);

}

#pragma AMSLogProtocol

\- (void)logWithName:(NSString

    \*)name parameter

    :(NSDictionary<NSString

    \*,id\> \*)parameter

{

NSLog(@"name%@ parameter%@"

        , name, parameter);

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

#### Is this page helpful?

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)
沙箱 | 开发参考 | 支付宝文档
===============

[![支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fref%2Fsandbox)  
[返回首页](../../)

开发参考
--------

[沙箱](/docs/ac/ref/sandbox)  
[如何测试银行卡支付](/docs/ac/ref/card)  
[如何测试支付宝+支付方式](/docs/ac/ref/wallet)  
[如何测试其他支付方式](/docs/ac/ref/other)  
[测试钱包](/docs/ac/ref/testwallet)  
[测试资源](/docs/ac/ref/test_resource)  
[集成模式](/docs/ac/ref/oy9921)  
[安全文件传输](/docs/ac/ref/xgcpey)  

常见问题
--------

蚂蚁通仪表盘
工具
其他参考
[商户类别码（MCC）](/docs/ac/ref/mcccodes)  
[Amount对象使用规则](/docs/ac/ref/cc)  
[支付方式](/docs/ac/ref/payment_method)  
[风险管理方法](/docs/ac/ref/risk_methods)  
[品牌资产](/docs/ac/ref/brandasset)  

沙箱
=======

2024-05-17 09:12
如何使用沙箱
==================

沙箱提供了一个测试环境，用于模拟支付，确保应用与蚂蚁通产品的无缝集成。本主题将指导您有效地使用沙箱。

开始前
------------

在沙箱中测试之前，请完成以下步骤：

1. 登录[蚂蚁通仪表盘](https://dashboard.alipay.com/global-payments/home)，切换到测试模式，进入 **开发者** > **快速入门** > **集成资源和工具**，然后选择 **集成资源** 获取沙箱客户端ID、域名和公钥。
2. 下载测试钱包应用。参考[测试钱包](https://global.alipay.com/docs/ac/ref/testwallet)的指南。

在沙箱中测试
--------------

在沙箱中，提供了多种方式模拟API调用，您可以多次调用每个API。如果您提供相应信息，API调用之间是相互关联的。例如，您首先调用 **pay** API 来发起支付。然后，您可以调用 **refund** API，通过指定 _paymentId_ 来发起退款。沙箱环境中将提供支付和相关退款的信息。

此外，当您在沙箱中调用 **pay** 或 **consult** API 时，沙箱还会模拟不同终端类型（如WEB、WAP和APP）商户端与支付方式端之间的重定向过程。
### 支付与自动扣款测试  
要测试支付与自动扣款，您可以使用提供的测试指南来模拟各种支付方式的支付和存储卡过程。沙箱环境还可以通过[错误场景模拟工具](https://global.alipay.com/docs/ac/ref/error_scenario_sim_en)模拟所有错误代码，包括罕见的生产环境场景。这使开发者在测试期间能够处理一致的系统逻辑。

#### 支付方式测试  
<table style="width:750px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="375" span="1"><col width="375" span="1"></colgroup><tbody><tr style="height:35px"><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u5e38379c" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>支付方式</strong></p></td><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="ufc14f04f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>测试指南</strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="ufa54ac3b" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#DDFip" target="_blank">信用卡</a></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="ufc14f04f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/ref/card" target="_blank">如何测试信用卡支付</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u5ae4f836" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#mt4eB" target="_blank">Alipay+ 支付方式</a></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="abde6b160fb24a68d83732a502b36762" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/ref/wallet" target="_blank">如何测试Alipay+支付方式</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="udb44aa33" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#IK789" target="_blank">钱包</a></p></td><td rowspan="5" style="text-align:left;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u30e1bf6428095c3458b453702bf56175" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/ref/other" target="_blank">如何测试其他支付方式</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u6b33740d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#KSRbI" target="_blank">手机银行应用</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u30211878" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#bR1hN" target="_blank">银行转账</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u19a329ab" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#llC45" target="_blank">在线银行</a></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p id="u9073ffbc" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><a href="https://global.alipay.com/docs/ac/cashierpay/pay_type#FwduU" target="_blank">柜台支付</a></p></td></tr></tbody></table>  

#### 模拟错误场景  
错误场景模拟提供不同API结果的模拟，并返回集成测试所需的特定响应。详细信息请参考[错误场景模拟](https://global.alipay.com/docs/ac/ref/error_scenario_sim_en)。
### 订阅支付
在沙箱环境中，您可以创建、更新和取消订阅计划。沙箱会自动加速订阅扣款周期，以方便您的验证过程。下表说明了其工作原理。

| periodRule.periodType | periodRule.periodCount | 沙箱加速间隔（分钟） | 加速频率 |
| --- | --- | --- | --- |
| DAY | 31 | 3 | 每12次 |
| DAY | 93 | 3 | 每12次 |
| DAY | 366 | 3 | 每12次 |
| WEEK | 1 | 3 | 每12次 |
| MONTH | 1 | 3 | 每12次 |
| MONTH | 3 | 15 | 每12次 |
| MONTH | 6 | 30 | 每12次 |
| YEAR | 1 | 60 | 每12次 |

例如，创建一个为期31天的订阅计划：

```json
{
  "subscriptionRequestId": "REQUEST_20240409141836419",
  "subscriptionDescription": "Subscription test",
  "paymentMethodType": "GCASH",
  "env": {
    "osType": "ANDROID",
    "terminalType": "APP"
  },
  "orderInfo": {
    "orderAmount": {
      "currency": "PHP",
      "value": "100"
    }
  },
  "paymentAmount": {
    "currency": "PHP",
    "value": "100"
  },
  "periodRule": {
    "periodCount": 31,
    "periodType": "DAY"
  },
  "settlementStrategy": {
    "settlementCurrency": "USD"
  },
  "subscriptionStartTime": "2024-04-09T14:18:36+08:00",
  "subscriptionEndTime": "2074-04-09T14:18:36+08:00",
  "subscriptionExpiryTime": "2024-04-09T14:48:36+08:00",
  "subscriptionNotificationUrl": "https://www.baidu.com",
  "subscriptionRedirectUrl": "https://alipay.com/subscriptionNotify",
  "paymentNotificationUrl": "https://alipay.com/subscriptionPayNotify"
}
```

按照[如何测试Alipay+支付方式](https://global.alipay.com/docs/ac/ref/wallet)的说明在沙箱中完成存档过程，然后您将每3分钟收到一次扣款通知。第13次扣款后，加速周期停止。加速周期内的最后一次扣款通知如下：

```json
{
  "paymentAmount": {
    "currency": "PHP",
    "value": "100"
  },
  "paymentCreateTime": "2024-04-08T23:59:00-07:00",
  "paymentId": "202404091940108001001886J0299059200",
  "paymentTime": "2024-04-08T23:59:03-07:00",
  "periodEndTime": "2025-05-16T23:18:36-07:00",
  "periodStartTime": "2025-04-15T23:18:36-07:00",
  "phaseNo": "13",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success",
    "resultStatus": "S"
  },
  "subscriptionId": "202404091900000000000009D0000004046",
  "subscriptionRequestId": "REQUEST_20240409141836419",
  "subscriptionNo": "13"
}
```

![Image 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![Image 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

**@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)**

#### 这个页面有帮助吗？

#### 本页内容

- [如何使用沙箱](#p9X19 "如何使用沙箱")
- [开始之前](#xh0P0 "开始之前")
- [在沙箱中测试](#hgYcM "在沙箱中测试")
- [对于结账支付/自动扣款](#A3VRp "对于结账支付/自动扣款")
- [测试支付方式](#IyR8b "测试支付方式")
- [模拟错误场景](#nijOn "模拟错误场景")
- [对于订阅支付](#RcC5W "对于订阅支付")
iOS | 结账支付 | 支付宝文档
===============

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)](/docs/)
[![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fbank_ios)
[返回首页](../../)

结账支付
[概述](/docs/ac/cashierpay/overview)
接受支付
支付后操作
支付方式
其他资源
高级功能
[预前端解决方案API](/docs/ac/cashierpay/prefront)
[先买后付API](/docs/ac/cashierpay/bnpl)
[卡存储API](/docs/ac/cashierpay/cv)
[卡存储SDK](/docs/ac/cashierpay/cvsdk)
[卡支付功能API/SDK](/docs/ac/cashierpay/mf)

iOS
===

在这个主题中，您将学习如何在iOS客户端集成银行SDK，以便在移动应用中展示支付收银页面。

前提条件
在集成SDK之前，请确保已完成以下任务：

1. 安装Xcode 12或更高版本。
2. 使用iOS 11或更高版本。
3. SDK安全扩展包不支持模拟器编译。请在真实设备上集成SDK。

关键集成步骤
按照以下步骤集成SDK：

1. 集成SDK包
   客户端
   请参考[Integrate the SDK Package](https://global.alipay.com/docs/ac/antom_sdk/ios_en)来集成SDK包。

2. 显示可用支付方式
   客户端
   在通过联系支付宝技术支持获取可用支付方式后，您可以通过以下模式显示支付方式：

   * 单银行模式：按银行显示支付方式。
*   银行类型模式：按银行类型展示支付方式，如手机银行应用、网上银行和银行转账。
*   银行国家模式：按银行国家展示支付方式，如泰国和印度尼西亚。  
请参考[用户体验](https://global.alipay.com/docs/ac/cashierpay/bank_sdk#7WPiN)了解三种支付方式显示类型。  
**注意**：在银行类型模式下，网页客户端无法在手机银行应用类型下显示支付方式。  
3  
使用`AMSCashierPayment`方法创建SDK实例：  
客户端  
1.  创建收银台页面的实例。实例包含以下参数：
*   _configuration_：必需的 _AMSCashierPaymentConfiguration_ 类型的对象。该对象必须包含所有配置参数。
2.  创建`AMSCashierPaymentConfiguration`类，其中必须包含以下参数：
*   _locale_：可选的 _NSString_ 类型的字符串，用于商户客户端识别买家浏览器的语言。设置此参数以确保SDK以正确的语言显示页面。有效值如下。如果传递其他值，将默认使用英语。
*   `en_US`：英语
*   `in_ID`：印度尼西亚语
*   `th_TH`：泰语
*   _options_：可选的 _NSDictionary_ 类型的参数。用于指定是否使用默认加载样式和沙盒环境。有效值如下：
*   `"sandbox", "true"`：沙盒环境
*   `"sandbox", "false"`：生产环境
*   `"showLoading", "true"`：使用默认加载样式。
*   `"showLoading", "false"`：不使用默认加载样式。
3.  创建**AMSPaymentProtocol**接口的实例，用于后续流程中处理相应的事件。包含以下方法：
*   `onEventCallback`: 一个回调函数，用于监控结账页面上的支付事件，返回 _eventCode_ 和 _eventResult_。

4. 创建一个实现**AMSLoggerProtocol**接口的实例，用于管理日志输出。包含以下方法：
*   `logWithName`: 一个默认用于输出日志的回调函数。

创建SDK实例：  
Objective-C  
```objc
@interface AMSCashierPaymentConfiguration : NSObject
/// 当前语言
@property (nonatomic, copy) NSString *locale;
@property (nonatomic, copy) AMSCheckoutEnv envType;
@end

@property (nonatomic, strong) AMSCashierPaymentConfiguration *configuration;

- (instancetype)initWithConfiguration:(AMSConfiguration *)configuration;
```
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

创建配置对象：  
Objective-C  
```objc
#import <AMSComponent/AMSComponent-Swift.h>

AMSCashierPaymentConfiguration *componentConfig = [AMSCashierPaymentConfiguration new];
componentConfig.locale = @"en_US";
// 指定选项以使用沙盒环境。如果不设置，将默认使用生产环境。
NSDictionary *options = @{@"showLoading": @"true", @"sandbox": @"true"};
componentConfig.options = options;

[[AMSCashierPayment shared] initConfiguration:componentConfig];
[[AMSCashierPayment shared] ...];
```
请注意，文档中的省略号（...）表示代码可能继续，但未在此处提供。在实际使用中，您需要根据蚂蚁金服的SDK文档和您的业务需求来填充这部分。
.paymentDelegate = self;  
\[AMSCashierPayment shared\]  
.loggerDelegate = self;  
\[\[AMSCashierPayment shared\]  
createComponent  
:paymentSessionData\];  

#pragma AMSPaymentProtocol  
\- (void)onEventCallback  
:(NSString \*)eventCode  
eventResult:(AMSEventResult  
\*)eventResult  
{  
NSLog(@"eventCode%@  
eventResult%@",  
eventCode, eventResult);  
}  

#pragma AMSLogProtocol  
\- (void)logWithName:(NSString  
\*)name parameter  
:(NSDictionary<NSString  
\*,id\> \*)parameter  
{  
NSLog(@"name%@ parameter%@",  
name, parameter);  
}  

注：以下内容为原文档的非翻译部分，保持原样。  
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  

4  
向支付宝服务器发送**创建支付会话（结账支付）**请求。  
服务器端  
当用户选择支付方式，且您的客户端检测到支付按钮点击事件后，您的服务器需要发送一个[**创建支付会话（结账支付）**](https://global.alipay.com/docs/ac/ams/session_cashier)请求。从创建支付会话的响应中获取paymentSessionData值，并在步骤5中使用。  

在**创建支付会话（结账支付）**请求中传递以下参数：  
*   paymentRequestId：商家为识别支付请求而分配的唯一ID。  
*   productCode：表示正在使用的支付产品，值固定为`AGREEMENT_PAYMENT`。  
*   paymentNotifyUrl：用于接收支付结果通知的URL。  
*   paymentRedirectUrl：支付完成后用户重定向到的商户页面URL。
*   paymentAmount: 商家希望在订单货币中接收的支付金额。
*   order.orderAmount: 商家方面的订单金额。在促销活动期间，_orderAmount_ 可能与 _paymentAmount_ 不同。
*   order.orderDescription: 订单描述。
*   order.referenceOrderId: 商家端的订单ID。当单个订单有多个支付请求时，支付宝建议使用同一个 _referenceOrderId_ 与多个 _paymentRequestId_ 配对。
*   paymentMethod.paymentMethodType: 设置为 `BANK`。
*   paymentMethod.paymentMethodMetaData:
    *   要在单一银行模式下显示支付方式，设置 _bankName_ 为银行名称。
    *   要在银行类型模式下显示支付方式，设置 _paymentMethodCaregory_ 为支付方法类型。有效值为 `BANK_TRANSFER`，`MOBILE_BANKING_APP` 和 `ONLINE_BANKING`。
    *   要在银行国家模式下显示支付方式，设置 _paymentMethodRegion_ 为国家。有效值为 `TH` 和 `ID`。

单一银行模式示例 JSON：

```json
{
  "order": {
    "orderAmount": {
      "currency": "THB",
      "value": "160"
    },
    "orderDescription": "Cappuccino #grande (Mika's coffee shop)",
    "referenceOrderId": "ORDER_20230803165257496"
  },
  "paymentAmount": {
    "currency": "THB",
    "value": "160"
  },
  "paymentMethod": {
    "paymentMethodType": "BANK",
    "paymentMethodMetaData": "{\"bankName\":\"Siam Commerical Bank\"}"
  },
  "settlementStrategy": {
    "settlementCurrency": "USD"
  },
  "paymentNotifyUrl": "https://kademo.intlalipay.cn/payments/notifySuccess",
  "paymentRedirectUrl": "https://kademo.intlalipay.cn/melitigo/Test_114.html",
  "paymentRequestId": "PAY_20230804165257508",
  "productCode": "CASHIER_PAYMENT"
}
```

请注意，以上 JSON 示例展示了如何在单一银行模式下设置支付请求，其中银行名称为 "Siam Commerical Bank"。其他模式的设置需要根据需要调整。
银行类型模式

JSON

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
{
"order": {
"orderAmount": {
"currency": "THB",  // 货币类型：泰铢
"value": "160"  // 订单金额：160
},
"orderDescription": "Cappuccino #grande (Mika's coffee shop)",  // 订单描述：大杯卡布奇诺（Mika的咖啡店）
"referenceOrderId": "ORDER_20230803165257496"  // 参考订单ID
},
"paymentAmount": {
"currency": "THB",  // 货币类型：泰铢
"value": "160"  // 支付金额：160
},
"paymentMethod": {
"paymentMethodType": "BANK",  // 支付方式类型：银行转账
"paymentMethodMetaData": "{\"paymentMethod Gregory\":\"BANK_TRANSFER\"}"  // 支付方法元数据：银行转账
},
"settlementStrategy": {
"settlementCurrency": "USD"  // 结算货币：美元
},
"paymentNotifyUrl": "https://kademo.intlalipay.cn/payments/notifySuccess",  // 支付通知URL
"paymentRedirectUrl": "https://kademo.intlalipay.cn/melitigo/Test_114.html",  // 支付重定向URL
"paymentRequestId": "PAY_20230804165257508",  // 支付请求ID
"productCode": "CASHIER_PAYMENT"  // 产品代码：收银台支付
}
银行国家模式

JSON

1
2
3
4
5
6
7
8
9
10
11
12
13
14

请注意，以上内容是示例JSON格式的数据，用于描述一个支付交易的详细信息，包括订单金额、订单描述、支付方式、结算策略、通知和重定向URL等。在实际应用中，这些数据会被用于蚂蚁金服或其他类似金融服务平台的支付接口中。
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
{  
"订单": {  
"订单金额": {  
"货币": "THB",  
"值": "160"  
},  
"订单描述":  
"卡布奇诺 #大杯  
(Mika's 咖啡店  
)",  
"参考订单号":  
"ORDER\_202308031652  
57496"  
},  
"支付金额": {  
"货币": "THB",  
"值": "160"  
},  
"支付方式": {  
"支付方式类型":  
"银行",  
"支付方式元数据"  
:  
"{\\"支付方式地区\\":\\"TH\\"}"  
},  
"结算策略": {  
"结算货币":  
"USD"  
},  
"支付通知URL": "https  
://kademo.intlalipay.cn  
/payments  
/notifySuccess",  
"支付重定向URL":  
"https://kademo  
.intlalipay.cn/melitigo  
/Test\_114.html",  
"支付请求ID":  
"PAY\_20230804165257508"  
,  
"产品代码":  
"收银台支付"  
}  
啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦
当用户发起多个支付时，释放之前在`createPaymentSession`中创建的组件资源。  
使用`createComponent`方法  
Objective-C  
1  
2  
3  
4  
\[ \[AMSCashierPayment shared\]  
createComponent:sessionData\]  
;  
// 释放SDK组件资源  
\[ \[AMSCashierPayment shared\]  
onDestroy\];  

获取支付结果  
服务器端  
当支付达到成功或失败的最终状态时，支付宝会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API向您在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) API中传递的_paymentNotifyUrl_发送异步通知。收到支付宝的通知后，您必须按照[要求](https://global.alipay.com/docs/ac/ams/paymentrn_online)返回响应。您也可以通过调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API获取支付结果。  

事件代码  
SDK 提供以下状态代码：  
*   `SDK_START_OF_LOADING`: 支付组件创建时加载动画开始播放。  
*   `SDK_END_OF_LOADING`: 支付组件创建时加载动画结束。  

SDK 提供以下错误代码：  
*   `SDK_INTERNAL_ERROR`: SDK 内部错误发生。请联系支付宝技术支持解决此问题。
*   `SDK_CREATEPAYMENT_PARAMETER_ERROR`: 调用 `AMSCashierPayment` 方法时传递的参数错误。请确保参数正确传递，然后重新发送请求。
*   `SDK_CALL_URL_ERROR`: 支付方式客户端撤销失败。请联系支付宝技术支持以解决问题。
*   `SDK_INTEGRATION_ERROR`: 未找到依赖项。请确保已正确添加依赖项并重新尝试集成过程。

#### 这个页面有帮助吗？

要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。

![图片 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)
Android | EasySafePay | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Feasypay_en%2Fandroid_en)

[Go to Homepage](../../)

EasySafePay

[Overview](/docs/ac/easypay_en/overview_en)

Accept payments

After payments

Android
=======

In this topic, you'll learn how to integrate the SDK into an Android client so that you can render cashier pages in a mobile application. The integration process is the same for the seamless experience and the redirection experience.

Prerequisites

Before integrating the SDK, ensure that you have completed the following tasks:

*   Install the latest version of Android Studio.
*   Target at least Android 4.4 (API level 19) or higher.
*   Use Gradle 4.1 or earlier.
*   Configure a physical machine or simulator to run your application.

Key integration steps

For first-time payments and subsequent payments, integrate the SDK by following these steps:

1

Integrate the SDK package

Client side

To integrate the SDK package, please refer to [Integrate the SDK Package](https://global.alipay.com/docs/ac/antom_sdk/android_en?expiry=1711418202657&preview=page&signature=K2pOH%2FM0us2EKhhHBnlhonUSbCU%3D).

2

Display available payment methods

Client side

Use the [tool](https://global.alipay.com/docs/ac/ref/brandasset) to obtain available payment methods, customize their logos, and display them on your cashier pages.

For first-time payments, we recommend you display the names and logos of available payment methods. For subsequent payments, we recommend you display the names and logos of these payment methods as well as the desensitized buyer account.

![Image 3: Android](https://mdn.alipayobjects.com/huamei_1vxa1o/afts/img/A*MgHwQL2O1NUAAAAAAAAAAAAADjeBAQ/original)

3

Create an SDK instance by using the `AMSEasyPay`:

Client side

Follow these steps to create an SDK instance:

1.  Create a _configuration_ object: A required object. The object must contain all of the following configuration parameters:
    *   _setLocale_: An optional string, which is used by the merchant client to identify the language of the buyer's browser. Specify this parameter to ensure that the SDK displays pages in the correct language. The valid values are as follows. If any other values are passed, English will be used as the default language.
        *   `locale("en", "US")`: English
        *   `locale("in", "ID")`: Indonesian
        *   `locale("th", "TH")`: Thai
        *   `locale("ms", "MY")`: Malaysian
        *   `locale("tl", "PH")`: Filipino
        *   `locale("ko", "KR")`: Korean
        *   `locale("vi", "VN")`: Vietnamese
        *   ​`locale("zh", "HK")`: Traditional Chinese (Hong Kong, China)
    *   _setOption_: Optional. It is used to specify whether to use the default loading pattern and the sandbox environment. Valid values are:
        *   `"sandbox", "true"`: Sandbox environment
        *   `"sandbox", "false"`: Production environment
        *   `"showLoading", "true"`: Use the default loading pattern.
        *   `"showLoading", "false"`: Do not use the default loading pattern.
        *   `"windowGravity","LANDSCAPE_CENTER"`: Center the window in landscape mode.
        *   `"windowGravity","LANDSCAPE_RIGHT"`: Align the window to the right in landscape mode.
2.  Create an instance of the **onCheckoutListener** interface, which is used for event handling in the subsequent process. The interface includes the following method:
    *   `onEventCallback`: Required. A callback function that monitors payment events on the checkout page, returning _eventCode_ and _eventResult_.
3.  Set the instance of the **onCheckoutListener** interface in that of the _configuration_ object to execute event callbacks.
4.  Instantiate the `AMSEasyPay` method.

**Note:** To improve component performance and user experience, you can pre-create a component instance before calling the **createPaymentSession** API.

Create an instance:

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

// Step 1: Create the

    AMSEasyPayConfiguration

    type.

AMSEasyPayConfiguration

    configuration \= new

    AMSEasyPayConfiguration();

configuration.setLocale(new

    Locale("en", "US"));

// Specify showLoading as true

    (default value) to use the

    default loading pattern.

    Specify it as false to

    customize the loading

    animation based on

    onEventCallback.

configuration.setOption

    ("showLoading", "true");

// Set the sandbox environment.

    If you leave it empty, the

    production environment is

    used by default.

configuration.setOption

    ("sandbox", "true");

// Center the window in

    landscape mode, or align it

    to the right if not set.

configuration.setOption

    ("windowGravity",

    "LANDSCAPE\_CENTER");

// Set the callback to monitor

    payment events on the

    checkout page.

configuration

    .setOnCheckoutListener(new

    OnCheckoutListener() {

@Override

public void onEventCallback

        (String eventCode,

        AMSEventResult

        eventResult) {

if("SDK\_PAYMENT\_CANCEL"

            .equals(eventCode

            )){

// Add interactive

               prompts.

}

Toast.makeText(activity

            , "eventCode=" +

            eventCode + "

            message=" + message

            , Toast

            .LENGTH\_SHORT).show

            ();

}

});

// Instantiate AMSEasyPay.

    Create a new AMSEasyPay

    component before each

    createPaymentSession API

    request.

AMSEasyPay checkout \= new

    AMSEasyPay.Builder(activity

    , configuration).build();

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

4

Send a [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) request to the Alipay server.

Server side

After the user selects the payment method and your client detects the payment button click event, your server sends a [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) request. Get the paymentSesssionData value from the createPaymentSession response and use it in Step 5.

For the first-time payment or subsequent payments, you need to specify different parameters when calling the **createPaymentSession** API:

**The first-time payment**

*   _paymentRedirectUrl_: The URL of the merchant result page. We recommend that you pass in a scheme URL or H5-scheme URL.
*   _authState_: The unique ID generated by the merchant to initiate an EasySafePay authorization. Specify this parameter to obtain an access token for future password-free payments.
*   _paymentNotifyUrl_: The URL that is used to receive the payment result notification. It must be an HTTPS URL.
*   _paymentSessionExpiryTime_: The date and time when the payment session expires. It defaults to 1 hour and must not exceed 1 hour. The value follows the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) standard format. For example, "2019-11-27T12:01:01+08:00".
*   _userLoginId_: The login ID that the user used to register in the wallet. The login ID can be the user's email address or phone number.
*   _order.buyer.referenceBuyerId/buyerPhoneNo/buyerEmail_: Pass in the buyer information for Alipay to provide risk control policies. Pass in one of the three parameters: _referenceBuyerId_, _buyerPhoneNo_, and _buyerEmail._

**The subsequent payments**

*   _paymentMethod.paymentMethodId:_ Pass in _accessToken_ that you obtain from the **notifyAuthorization** API for the first-time payment.
*   _paymentRedirectUrl_: The URL of the merchant result page. We recommend that you pass in a scheme URL or H5-scheme URL.
*   _paymentNotifyUrl_: The URL that is used to receive the payment result notification. It must be an HTTPS URL.
*   _paymentSessionExpiryTime_: The date and time when the payment session expires. It defaults to 1 hour and must not exceed 1 hour. The value follows the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) standard format. For example, "2019-11-27T12:01:01+08:00".
*   _order.buyer.referenceBuyerId/buyerPhoneNo/buyerEmail_: Pass in the buyer information for Alipay to provide risk control policies. Pass in one of the three parameters: _referenceBuyerId_, _buyerPhoneNo_, and _buyerEmail._

First-time payment

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

{

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"productCode":

        "AGREEMENT\_PAYMENT",

"productScene": "EASY\_PAY",

"paymentNotifyUrl": "https

        ://www.yourNotifyUrl",

"paymentRequestId":

        "paymentRequestId001",

"paymentRedirectUrl":

        "https://www

        .yourMerchantWeb.com",

"paymentMethod": {

"paymentMethodType":

            "ALIPAY\_CN"

},

"agreementInfo": {

"authState":

            "authState001",

"userLoginId"

            :"userLoginId001"

},

"paymentAmount": {

"currency": "CNY",

"value": "100"

},

"order": {

"orderAmount": {

"currency": "CNY",

"value": "100"

},

"referenceOrderId":

            "referenceOrderId00

            1",

"orderDescription":

            "orderDescription00

            1",

"buyer":{

"referenceBuyerId"

              :"referenceBuyerI

              d001"

}

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Subsequent payment

JSON

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

{

"settlementStrategy": {

"settlementCurrency":

            "USD"

},

"productCode":

        "AGREEMENT\_PAYMENT",

"productScene": "EASY\_PAY",

"paymentNotifyUrl": "https

        ://www.yourNotifyUrl",

"paymentRequestId":

        "paymentRequestId002",

"paymentRedirectUrl":

        "https://www

        .yourMerchantWeb.com",

"paymentMethod": {

"paymentMethodId": "

            \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

            \*\*\*\*\*\*\*\*\*\*",

"paymentMethodType":

            "ALIPAY\_CN"

},

"paymentAmount": {

"currency": "CNY",

"value": "30000"

},

"order": {

"orderAmount": {

"currency": "CNY",

"value": "30000"

},

"referenceOrderId":

            "referenceOrderId00

            2",

"orderDescription":

            "orderDescription00

            2",

"buyer":{

"referenceBuyerId"

              :"referenceBuyerI

              d002"

}

}

}

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

5

Render the payment pages

Client side

The AMSEasyPay component cannot be reused. Create a new AMSEasyPay component before each **createPaymentSession** API request.

Call the `createComponent()` method in the configuration object and pass in the following parameters:

*   _activity_: A required object belonging to the _Activity_ type. It is used to include the information about context parameters on the current page.
*   _sessionData_: A required string. Pass the _paymentSessionData_ value obtained in Step 4 to the _sessionData_ parameter of the `createComponent` method

Call the `onDestroy()` method to free SDK component resources in the following situations:

*   When the user exits the checkout page, free the component resources created in the **createPaymentSession**.
*   When the user initiates multiple payments, free the component resources created in the previous **createPaymentSession**.

Re-create AMSEasyPay:

Java

1

2

3

4

5

6

// Instantiate AMSEasyPay.

    Create a new AMSEasyPay

    component before each

    createPaymentSession API

    request.

if(checkout !=null){

//Free SDK components

      resources.

checkout.onDestroy()

}

checkout \= new AMSEasyPay

    .Builder(activity,

    configuration).build();

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

Call the createComponent method:

Java

1

checkout.createComponent

    (activity,sessionData);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

6

Obtain an authorization result or a payment result

Server side

Regardless of a seamless experience or a redirection experience, you can obtain an authorization result and a payment result for first-time payments, and a payment result only for subsequent payments:

*   **Obtain an authorization result**  
    When the authorization is successful, Alipay sends you the asynchronous notification through the [**notifyAuthorization**](https://global.alipay.com/docs/ac/ams/notifyauth) notification. When you receive the notification, you must return a response as instructed in [Requirements](https://global.alipay.com/docs/ac/ams/paymentrn_online). Meanwhile, you must update the authorization status of the buyer in your system and display the buyer's desensitized account obtained from the notification on your authorization management page.
*   **Obtain a payment result**  
    When the payment reaches a final status of success or failure, Alipay sends an asynchronous notification through the [**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API to _paymentNotifyUrl_ that you pass through the [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/createpaymentsession_easypay) API. When you receive the notification from Alipay, you must return a response as instructed in [Requirements](https://global.alipay.com/docs/ac/ams/paymentrn_online).

**Note**: If you call the **[inquiryPayment](https://global.alipay.com/docs/ac/ams/paymentri_online)** API and the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API after the buyer abandons the payment, you might receive a response indicating that the order does not exist, and you might not receive an asynchronous notification of the payment failure as well. We recommend that you take the following actions:

For orders that you have actively closed:

*   If you receive a payment success notification from Alipay, no further action is needed.
*   If you receive a notification from Alipay with an unknown order status, call the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API to cancel the corresponding order.

For duplicate payments (one merchant order corresponds to multiple Alipay orders), if you have received multiple payment success notifications for Alipay orders, keep only one Alipay order with a successful result and cancel the rest of the Alipay orders by using the **[cancel](https://global.alipay.com/docs/ac/ams/paymentc)** API.

Event codes

The SDK provides the following status codes:

*   `SDK_START_OF_LOADING`: The loading animation starts to play during the payment component creation.
    
*   `SDK_END_OF_LOADING`: The loading animation ends during the payment component creation.
    
*   `SDK_PAYMENT_CANCEL`: The user cancels the payment on the account confirmation page or the large transaction confirmation page.
    

The SDK provides the following error codes:

*   `SDK_INTERNAL_ERROR`: The internal error of the SDK occurs. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_CREATEPAYMENT_PARAMETER_ERROR`: The parameters passed into the `AMSEasyPay` method are incorrect. Ensure the parameters are passed correctly and send a new request.
    
*   `SDK_CALL_URL_ERROR`: The payment method client failed to be revoked. Contact Alipay Technical Support to resolve the issue.
    
*   `SDK_INTEGRATION_ERROR`: Dependencies are not found. Ensure that the dependencies are added correctly and retry the integration process.
    

Integration key steps code sample

The following code sample shows the key steps during integration.

Java

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

// Step 1: Create the

    AMSEasyPayConfiguration type.

AMSEasyPayConfiguration

    configuration \= new

    AMSEasyPayConfiguration();

configuration.setLocale(new Locale

    ("en", "US"));

// Specify showLoading as true

    (default value) to use the

    default loading pattern.

    Specify it as false to

    customize the loading animation

    based on onEventCallback.

configuration.setOption

    ("showLoading", "true");

// Set the sandbox environment. If

    you leave it empty, the

    production environment is used

    by default.

configuration.setOption("sandbox",

    "true");

// Set the callback to monitor

    payment events on the checkout

    page.

configuration.setOnCheckoutListener

    (new OnCheckoutListener() {

@Override

public void onEventCallback

        (String eventCode,

        AMSEventResult eventResult)

        {

if("SDK\_PAYMENT\_CANCEL"

            .equals(eventCode)){

// Add interactive

                prompts.

}

Toast.makeText(activity,

            "eventCode=" +

            eventCode + " message="

            + message, Toast

            .LENGTH\_SHORT).show();

}

});

// Instantiate AMSEasyPay. Create a

    new AMSEasyPay component before

    each createPaymentSession API

    request.

AMSEasyPay checkout \= new

    AMSEasyPay.Builder(activity,

    configuration).build();

// Step 2: Back-end process: Call a

    createPaymentSession API.

String sessionData \=

    createSessionData()

// Step 3: Initiate the payment and

    pass sessionData to the front

    \-end component.

checkout.createComponent(activity

    ,sessionData);

//Step 4: Call the onDestroy()

    method when the user exits the

    merchant page.

checkout.onDestroy(activity

    ,sessionData);

הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

#### Is this page helpful?

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)
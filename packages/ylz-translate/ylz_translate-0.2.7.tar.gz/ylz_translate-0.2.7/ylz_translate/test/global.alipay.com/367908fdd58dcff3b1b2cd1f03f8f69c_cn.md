信用卡支付（Web/WAP）| 结账支付 | 支付宝文档
==================

[![图片1：支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg) ![图片2：支付宝，中国领先的第三方在线支付解决方案](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fwwcard)  
[返回首页](../../)

结账支付
[概述](/docs/ac/cashierpay/overview)  
接受支付  
SDK集成  
[APM支付（Web/WAP）APM](/docs/ac/cashierpay/apm_ww)  
[APM支付（Android）APM](/docs/ac/cashierpay/apm_android)  
[APM支付（iOS）APM](/docs/ac/cashierpay/apm_ios)  
[信用卡支付（Web/WAP）卡](/docs/ac/cashierpay/wwcard)  
[信用卡支付（Android）卡](/docs/ac/cashierpay/adcard)  
[信用卡支付（iOS）卡](/docs/ac/cashierpay/ioscard)  
仅API集成  
支付后  
支付方式  
其他资源  
高级功能  
[预前端解决方案API](/docs/ac/cashierpay/prefront)  
[先买后付API](/docs/ac/cashierpay/bnpl)  
[卡存储API](/docs/ac/cashierpay/cv)  
[卡存储SDK](/docs/ac/cashierpay/cvsdk)  
[卡支付功能API/SDK](/docs/ac/cashierpay/mf?pageVersion=7)  
信用卡支付（Web/WAP）
=======================

2024-05-11 10:13  
Antom SDK 是一个预构建的UI组件，用于收集卡信息并为您管理3D验证流程。集成此组件不需要您具有PCI资格，适合那些希望委托Antom收集卡信息的用户。

用户体验
==========

以下图示展示了在购物网站或移动网页应用上支付的用户流程：

Web  
WAP  
Web用户体验
------------

![图片3：下载.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713406482917-aed9aca8-6009-4a41-bc79-f68a98a9525b.png)  
WAP用户体验
------------

![图片4：2.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713406504140-9dcd329f-e0c1-4cdc-be8a-f574a9adec57.png)  
支付流程
==========

以下流程展示了如何通过Antom SDKs集成结账支付：

![图片5：111卡.webp](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1713520960682-e0a3067a-9ab7-49d7-b7e4-6be9118f6e30.webp)  
1. **用户进入结账页面。**
2. **创建** [**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier) **请求**
   买家选择支付方式并提交订单后，您可以通过调用[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口获取支付会话。
3. **调用客户端SDK**
   在客户端，通过支付会话调用SDK。SDK将根据支付方式的特性处理信息收集、重定向、应用调用、二维码显示、验证等流程。
4. **获取支付结果**
   通过以下两种方法之一获取支付结果：
   1. 异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中指定_paymentNotifyUrl_，设置接收异步通知的地址。支付成功或过期时，Antom会使用[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)向您发送异步通知。
   2. 同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口检查支付状态。
5. **获取扣款结果**
   对于信用卡支付，您需要通过以下两种方法之一获取扣款结果：
   1. 异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中指定_paymentNotifyUrl_，设置接收异步通知的地址。支付请求成功或过期时，Antom会使用[**notifyCapture**](https://global.alipay.com/docs/ac/ams/notify_capture)向您发送异步通知。
   2. 同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口检查支付请求状态。

集成步骤
==========

通过以下步骤开始集成：

1. 创建支付会话
2. 创建并调用SDK
3. 获取支付结果
4. 获取扣款结果

步骤1：创建支付会话 服务器端
--------------------------------------------

当买家选择由Antom提供的支付方式时，您需要收集支付请求ID、订单金额、支付方式、订单描述、支付重定向URL和支付结果通知URL等关键信息，调用**createPaymentSession** API创建支付会话，并将支付会话返回给客户端。

Antom提供了多种语言的服务器端API库。以下代码以Java为例，您需要安装Java 6或更高版本。
### 安装API库  
您可以在[GitHub](https://github.com/alipay/global-open-sdk-java)上找到最新版本。  
复制以下内容：  

```xml
<dependency>
    <groupId>com.alipay.global.sdk</groupId>
    <artifactId>global-open-sdk-java</artifactId>
    <version>2.0.18</version>
</dependency>
```

这段代码是用于Maven项目的依赖配置，将允许您在Java项目中使用蚂蚁金服的全球开放SDK。
### 初始化请求实例  
创建一个单例资源以向Antom发起请求。  
复制  
```java
import com.alipay.global.api.AlipayClient;
import com.alipay.global.api.DefaultAlipayClient;

String merchantPrivateKey = "您的私钥";
String alipayPublicKey = "支付宝公钥";
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);
```

这里，我们导入了蚂蚁金服的`AlipayClient`类，并使用`DefaultAlipayClient`的构造函数来初始化一个客户端实例。`merchantPrivateKey`是您的商户私钥，`alipayPublicKey`是支付宝的公钥。`EndPointConstants.SG`代表请求的端点，可能是蚂蚁金服的某个特定服务地址。这个初始化步骤是进行后续API调用的前提。
### 创建支付会话  
创建支付会话包括以下参数：  
<table style="width:748px;outline:none;border-collapse:collapse;border:1px solid #D9E4F8;" class="lake-table"><colgroup><col width="211" span="1"><col width="97" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><strong><span style="color:#141E3C">参数名</span></strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><strong><span style="color:#141E3C">是否必需</span></strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><strong><span style="color:#141E3C">描述</span></strong></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">productCode</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span><span style="color:rgba(0, 0, 0, 0.78)"></span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>固定值为 </span><code style="font-family:monospace;font-size:inherit;background-color:rgba(0, 0, 0, 0.06);padding:0px 2px;border:1px solid rgba(0, 0, 0, 0.08);border-radius:2px;line-height:inherit;overflow-wrap:break-word;text-indent:0px"><span>CASHIER_PAYMENT</span></code><span>。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">paymentRequestId</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>商家生成的唯一ID，每次发起支付时需新生成一个ID。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">paymentAmount</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>支付金额，应按订单货币的最小单位设置，如CNY为分，KRW为元。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">paymentMethod</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>支付方式枚举</span></p></td></tr><tr style="height:35px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">paymentRedirectUrl</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>商家的支付结果页面，根据服务器端的结果，不是固定的成功页面。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">order</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>必需</span></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>订单信息，包括订单金额、订单ID和商家侧的订单描述。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">paymentNotifyUrl</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>支付结果通知地址，可通过API传递或在门户上设置为固定值。</span></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="text-align:center;font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><em><span style="color:rgba(0, 0, 0, 0.78)">settlementStrategy</span></em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F8;padding:4px 8px;cursor:default"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em"><span>支付的结算货币，如果业务签约了多个结算货币，需要在API中指定。</span></p></td></tr></tbody></table>  
以上参数是创建支付会话的基本参数，完整的参数和某些支付方式的额外要求请参考[**createPaymentSession (Checkout Payment)**](https://global.alipay.com/docs/ac/ams/session_cashier)**。**  
#### 调用createPaymentSession API的示例代码  
以下示例代码展示了如何调用**createPaymentSession** API：  
```java
AlipayPaymentSessionRequest alipayPaymentSessionRequest = new AlipayPaymentSessionRequest();
alipayPaymentSessionRequest.setClientId(CLIENT_ID);
alipayPaymentSessionRequest.setPath("/ams/sandbox/api/v1/payments/createPaymentSession");
alipayPaymentSessionRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);  
// 替换为你的paymentRequestId
alipayPaymentSessionRequest.setPaymentRequestId("paymentRequestId01");  
Amount amount = new Amount();
amount.setCurrency("SGD");
amount.setValue("4200");  
alipayPaymentSessionRequest.setPaymentAmount(amount);  
// 设置结算货币
SettlementStrategy settlementStrategy = new SettlementStrategy();
settlementStrategy.setSettlementCurrency("SGD");
alipayPaymentSessionRequest.setSettlementStrategy(settlementStrategy);  
// 设置支付方式
PaymentMethod paymentMethod = new PaymentMethod();
paymentMethod.setPaymentMethodType("CARD");
alipayPaymentSessionRequest.setPaymentMethod(paymentMethod);  
// 设置支付因子
PaymentFactor paymentFactor = new PaymentFactor();
paymentFactor.setAuthorization(true);
alipayPaymentSessionRequest.setPaymentFactor(paymentFactor);  
// 设置订单信息
Order order = new Order();
order.setReferenceOrderId("referenceOrderId01");
order.setOrderDescription("antom sdk test order");
order.setOrderAmount(amount);
Buyer buyer = new Buyer();
buyer.setReferenceBuyerId("yourBuyerId");
order.setBuyer(buyer);
order.setOrderAmount(amount);
alipayPaymentSessionRequest.setOrder(order);  
// 替换为你的通知地址
alipayPaymentSessionRequest.setPaymentNotifyUrl("https://www.yourNotifyUrl");  
// 替换为你的重定向地址
alipayPaymentSessionRequest.setPaymentRedirectUrl("https://www.yourMerchantWeb.com");
AlipayPaymentSessionResponse alipayPaymentSessionResponse = null;  
try {
    alipayPaymentSessionResponse = defaultAlipayClient.execute(alipayPaymentSessionRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}  
```
以下代码展示了请求消息的示例：
```json
{
  "order": {
    "buyer": {
      "referenceBuyerId": "yourBuyerId"
    },
    "orderAmount": {
      "currency": "SGD",
      "value": "4200"
    },
    "orderDescription": "antom sdk test order",
    "referenceOrderId": "referenceOrderId01"
  },
  "paymentAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "paymentFactor": {
    "isAuthorization": true
  },
  "paymentMethod": {
    "paymentMethodType": "CARD"
  },
  "paymentNotifyUrl": "https://www.yourNotifyUrl",
  "paymentRedirectUrl": "https://www.yourMerchantWeb.com",
  "paymentRequestId": "paymentRequestId01",
  "productCode": "CASHIER_PAYMENT",
  "settlementStrategy": {
    "settlementCurrency": "SGD"
  }
}
```
以下代码展示了响应的示例，其中包含以下参数：
*   _paymentSessionData_：返回给前端的支付会话数据
*   _paymentSessionExpiryTime_：支付会话的过期时间  
```json
{
  "paymentSessionData": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
  "paymentSessionExpiryTime": "2023-04-06T03:28:49Z",
  "paymentSessionId": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```
### 常见问题
#### 请求中可以使用中文字符吗？
请勿在请求中的字段使用中文字符，包括`paymentRequestId`、`referenceOrderId`、`orderDescription`和`goods`，以避免与QRIS和Mastercard等不兼容的支付方式。

#### 如何设置支付结果通知地址？
Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)接口发送支付结果。您可以在**createPaymentSession** API中通过`paymentNotifyUrl`参数指定通知地址。如果每个支付的地址都相同，您也可以在Antom控制台上进行配置。如果您同时在控制台配置了地址并在API中设置了参数，Antom将使用API中设置的地址。

### 步骤2：创建并调用SDK客户端
---------------------------------------------
Antom SDK是一个用于处理支付流程的组件。您通过创建支付会话来收集信息并根据**createPaymentSession** API中指定的支付方式在应用间切换。
### 安装

在开始集成之前，请确保已完成以下环境准备：

1. **兼容性处理**：为Internet Explorer和其他旧版浏览器提供相应的polyfills。我们建议您在构建项目时使用[babel-preset-env](https://babeljs.io/docs/en/babel-preset-env)来解决浏览器兼容性问题。

2. **推荐的浏览器版本**：
   - **移动浏览器**：
     - iOS 11及以上版本
     - Android 5.0及以上版本
   - **电脑浏览器**，推荐以下版本：
     <table id="DXgZ7" style="width:747px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table">
       <colgroup>
         <col width="113" span="1">
         <col width="123" span="1">
         <col width="130" span="1">
         <col width="126" span="1">
         <col width="125" span="1">
         <col width="130" span="1">
       </colgroup>
       <tbody>
         <tr id="u08e6b074" style="height:127px">
           <td id="u12d12d70" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="u442907d9" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="zH80i">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143117412-8322ebf3-b84b-48d1-a696-5cc5703d1006.png" data-raw-src="" title="image" data-height="51px" style="visibility:visible;width:51px" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143117412-8322ebf3-b84b-48d1-a696-5cc5703d1006.png" loading="lazy">
                 </a>
               </span>
               <strong id="u7e40d0e4" class="lake-fontsize-11" style="font-size:14px">Edge</strong>
             </p>
             <p id="u6af6f0af" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u0ebc1a3f" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
             </p>
           </td>
           <td id="u2ddfe253" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="uaf1ab9f7" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u4841717a" class="lake-fontsize-11"></span>
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="fLjSJ">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143117377-62f319d6-72e5-4555-aacd-f0efc434ef9e.png" data-raw-src="" title="image" style="visibility:visible" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143117377-62f319d6-72e5-4555-aacd-f0efc434ef9e.png" loading="lazy">
                 </a>
               </span>
               <strong id="u500f6867" class="lake-fontsize-11">Firefox</strong>
               <span id="uac75678e" class="lake-fontsize-11"></span>
             </p>
             <p id="u5dbea113" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u834edd1d" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
               <span id="u8462bae1" class="lake-fontsize-11"></span>
             </p>
           </td>
           <td id="u545b2fa9" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="u5d843aa2" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u6ac90e6e" class="lake-fontsize-11"></span>
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="Y6kff">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118111-1392b868-4947-4d0f-941c-53d54c655c8d.png" data-raw-src="" title="image" style="visibility:visible" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118111-1392b868-4947-4d0f-941c-53d54c655c8d.png" loading="lazy">
                 </a>
               </span>
               <strong id="u51c80cf2" class="lake-fontsize-11">Chrome</strong>
               <span id="u2406b4d2" class="lake-fontsize-11"></span>
             </p>
             <p id="ud3822dcf" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u116746d0" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
               <span id="u69cd60f5" class="lake-fontsize-11"></span>
             </p>
           </td>
           <td id="u85b33924" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="u609f1a7a" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="ub5e061d0" class="lake-fontsize-11"></span>
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="l4Dxu">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118162-1fc223a0-8a35-488f-91aa-5833f5d7726a.png" data-raw-src="" title="image" style="visibility:visible" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118162-1fc223a0-8a35-488f-91aa-5833f5d7726a.png" loading="lazy">
                 </a>
               </span>
               <strong id="ue316f93d" class="lake-fontsize-11">Safari</strong>
               <span id="u9af61bba" class="lake-fontsize-11"></span>
             </p>
             <p id="u9dfa907f" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="uc15a7cab" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
               <span id="u7e2aed56" class="lake-fontsize-11"></span>
             </p>
           </td>
           <td id="u68afb414" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="u390dabcf" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u63fd0592" class="lake-fontsize-11"></span>
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="AhSm3">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118154-fc609c28-81bf-4442-985b-fdf4d1c3554d.png" data-raw-src="" title="image" style="visibility:visible" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118154-fc609c28-81bf-4442-985b-fdf4d1c3554d.png" loading="lazy">
                 </a>
               </span>
               <strong id="uda388252" class="lake-fontsize-11">Opera</strong>
               <span id="uba17d0f2" class="lake-fontsize-11"></span>
             </p>
             <p id="uf8ee6932" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u0c1abf2a" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
               <span id="u9cac1b24" class="lake-fontsize-11"></span>
             </p>
           </td>
           <td id="u64e703fd" style="background-color:rgb(246, 249, 254);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default">
             <p id="u7b586175" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="u2b170feb" class="lake-fontsize-11"></span>
               <span data-card-type="inline" data-lake-card="image" contenteditable="false" id="Aw7jF">
                 <a href="http://godban.github.io/browsers-support-badges/" target="_blank">
                   <img alt="image" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118867-73ee0c65-fbf2-4ff3-b18e-8fa092801c30.png" data-raw-src="" title="image" style="visibility:visible" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1680143118867-73ee0c65-fbf2-4ff3-b18e-8fa092801c30.png" loading="lazy">
                 </a>
               </span>
               <strong id="u8b4e4e2c" class="lake-fontsize-11">Electron</strong>
               <span id="u5456649a" class="lake-fontsize-11"></span>
             </p>
             <p id="ua57ff78e" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">
               <span id="uf1d296ae" style="color:rgba(4, 15, 36, 0.85);background-color:#F6F9FE">最后2个版本</span>
               <span id="u740743fb" class="lake-fontsize-11"></span>
             </p>
           </td>
         </tr>
       </tbody>
     </table>

3. 通过CDN或npm安装SDK资源包：
   - 复制以下代码通过CDN引入：
   ```html
   <script src="https://sdk.marmot-cloud.com/package/ams-checkout/1.13.0/dist/umd/ams-checkout.min.js"></script>
   ```
   - 或者使用npm安装：
   ```bash
   npm install @alipay/ams-checkout
   ```

请根据您的项目需求选择合适的集成方式。
### 初始化 SDK  
使用 `AMSCashierPayment` 创建 SDK 实例，配置对象包括以下参数：  

| 参数名称 | 是否必需 | 描述 |
| --- | --- | --- |
| environment | ✅ | 用于传递环境信息。有效值为： |
| | | - `sandbox`：沙箱环境 |
| | | - `prod`：生产环境 |
| locale |  | 用于传递语言信息。有效值如下，根据支付方式所在地区选择传递的值。如果传递其他值，默认使用本地语言： |
| | | - `en_US`：英语 |
| | | - `pt_BR`：葡萄牙语 |
| | | - `ko_KR`：韩语 |
| | | - `es_ES`：西班牙语 |
| | | - `ms_MY`：马来语 |
| | | - `in_ID`：印尼语 |
| | | - `tl_PH`：他加禄语 |
| | | - `th_TH`：泰语 |
| | | - `vi_VN`：越南语 |
| | | - `fr_FR`：法语 |
| | | - `nl_NL`：荷兰语 |
| | | - `it_IT`：意大利语 |
| | | - `de_DE`：德语 |
| | | - `zh_CN`：简体中文 |
| | | - `zh_HK`：繁体中文 |
| analytics |  | 用于配置和分析数据，包含以下值： |
| | | - `enabled`：可选布尔值，默认为 `true`，表示允许 SDK 上传和分析操作数据以提供更好的服务。如果不允许上传和分析数据，设置为 `false`。 |
| onLog |  | 一个回调方法，用于生成 SDK 执行期间的日志和 API 异常的错误信息。 |
| onEventCallback |  | 当 SDK 运行时发生支付事件（如支付结果或表单提交错误）时返回特定事件代码的回调函数。详细信息请参考相关文档。 |

以下是如何获取浏览器语言的示例代码：  
```javascript
let language = navigator.language || navigator.userLanguage;
language = language.replace("-", "_"); // 将 "-" 替换为 "_" 
```

以下是如何实例化 SDK 的示例代码：  
```javascript
const checkoutApp = new window.AMSCashierPayment({
  environment: "sandbox",
  locale: "en_US",
  onLog: ({ code, message }) => {},
  onEventCallback: ({ code, message }) => {},
});
```
### 调用SDK  
当买家在页面上选择支付方式后，需要创建并初始化支付组件。  
使用实例对象中的`createComponent`或`mountComponent`函数创建支付组件：  

| 参数名 | 是否必需 | 描述 |
| --- | --- | --- |
| sessionData | 是 | 使用`sessionData`参数创建配置对象：将通过`createpaymentSession (Checkout Payment)` API获取的完整`paymentSessionData`参数传递给`sessionData`参数。 |
| appearance | 否 | 自定义外观主题配置，包含以下子参数： |
| | | - showLoading：可选，布尔类型，默认为`true`，显示默认加载动画。如果不使用默认加载动画，需设置为`false`。 |
| | | - showSubmitButton：可选，布尔类型，默认为`false`，禁用支付页面的按钮渲染。 |
| notRedirectAfterComplete | 否 | 默认为`false`，支付完成后会跳转回您的页面。空值时同样适用。设置为`true`表示支付完成后不跳转，需要使用客户事件代码来控制卡绑定以完成后续流程。注意，客户端返回的支付结果码仅作为客户端页面跳转操作的参考，交易状态的更新请参考服务器端`notifyPayment`或`inquiryPayment` API返回的结果。 |
| merchantAppointParam | 否 | 用于设置自定义功能，包含以下值： |
| | | - storedCard：可选对象，用于设置已存储卡的自定义功能。 |
| | |   - needCVV：可选布尔值，默认为`false`，表示买家在支付过程中不需要输入CVV号码。空值时同样适用。设置为`true`表示买家在支付过程中需要输入CVV号码。 |

#### 嵌入式体验与弹出式体验  
可以通过弹出窗口或页面内嵌入两种方式让SDK在页面上显示。  

|  | 嵌入式体验 | 弹出式体验 |
| --- | --- | --- |
|  | ![嵌入式体验](image.png) | ![弹出式体验](image.png) |

#### 弹出式体验  
弹出式体验对页面样式影响较小，流程相对独立。  
买家在页面上选择支付方式并点击提交后，需要调用SDK并弹出窗口。  
```javascript
async function create(sessionData) {
  await checkoutApp.createComponent({
    sessionData: sessionData,
    appearance: {
      showLoading: true, // 默认为true，允许配置是否显示加载动画
    },
    notRedirectAfterComplete: true,
  });
}
```

#### 嵌入式体验  
嵌入式体验将支付元素内置于指定视图中。需要关注支付列表的样式调整。嵌入内容的宽度会自动适应父容器，高度会随视图变化动态更新。  
```javascript
async function create(sessionData) {
  await checkoutApp.mountComponent({
    sessionData: sessionData,
    appearance: {
      showLoading: true, // 默认为true，允许配置是否显示加载动画
      showSubmitButton: false, // 配置是否由组件渲染支付按钮
    },
    notRedirectAfterComplete: true,
  }, '#ContainerNodeId');
}
```

#### 嵌入式提交支付  
使用嵌入式体验和自定义提交按钮时，记得主动调用submit函数来启动提交过程。  
```javascript
// 当买家完成表单并点击提交按钮时执行
checkoutApp.submit().then(({code, message})=>{})
```

#### 销毁组件  
在以下情况调用`unmount`方法释放SDK组件资源：  
* 买家切换视图离开结账页面时，释放`createPaymentSession`创建的组件资源。
* 买家发起多次支付时，释放前一次`createPaymentSession`创建的组件资源。
* 买家完成支付并设置`notRedirectAfterComplete`为`true`时，在获取特定支付结果码后释放组件资源。  
```javascript
// 释放SDK组件资源
checkoutApp.unmount();
```

#### 常见问题  
##### 收到`SDK_CREATEPAYMENT_PARAMETER_ERROR`时怎么办？  
收到此事件码时，检查传递的`sessionData`是否正确且完整。  
##### 收到`SDK_PAYMENT_ERROR`或渲染视图错误时怎么办？  
收到此事件码时，检查网络请求。初始化接口可能存在异常，确保支付会话创建请求的环境与SDK实例化时的环境参数一致。检查支付会话创建参数是否正确传递。如果接口异常仍然存在，可以联系我们进行故障排查。  
##### 收到`SDK_FORM_VERIFICATION_FAILED`时怎么办？  
可能是买家未填写所有必填项。提交时，可能会返回表示表单验证失败的错误码。建议引导买家完善表单内容。
### 显示支付结果  
如果在调用`createPaymentSession` API时设置了`notRedirectAfterComplete`为`false`，买家在完成支付后会被重定向到您提供的`paymentRedirectUrl`。您可以在该URL中主动查询支付结果并展示给买家。  
如果`notRedirectAfterComplete`为`true`，支付结果将通过`onEventCallback`函数返回。这里的支付结果仅用于前端显示，最终订单状态以服务器端为准。  
您需要通过`onEventCallback`返回结果中的数据自定义每个支付结果的处理流程。  
以下是`onEventCallback`返回的支付结果可能的事件代码：  

| 事件代码 | 消息 | 解决方案 |
| --- | --- | --- |
| SDK_PAYMENT_SUCCESSFUL | 支付成功。 | 建议将买家重定向到支付结果页面。 |
| SDK_PAYMENT_PROCESSING | 支付处理中。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情。根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_FAIL | 支付失败。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情。根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_CANCEL | 买家未提交订单就退出了支付页面。 | SDK在有效期内可以重新调用，如果已过期，需要重新请求`paymentSessionData`。 |
| SDK_PAYMENT_ERROR | 支付状态异常。 | 建议检查`onEventCallback`结果数据中的`paymentResultCode`详情。根据提供的信息引导买家重试支付。 |

以下是一个处理`onEventCallback`的示例代码：

```javascript
function onEventCallback({ code, result }) {
  switch (code) {
    case 'SDK_PAYMENT_SUCCESSFUL':
      // 支付成功。将买家重定向到支付结果页面。
      break;
    case 'SDK_PAYMENT_PROCESSING':
      console.log('检查支付结果数据', result);
      // 支付处理中。根据提供的信息引导买家重试支付。
      break;
    case 'SDK_PAYMENT_FAIL':
      console.log('检查支付结果数据', result);
      // 支付失败。根据提供的信息引导买家重试支付。
      break;
    case 'SDK_PAYMENT_CANCEL':
      // 引导买家重试支付。
      break;
    case 'SDK_PAYMENT_ERROR':
      console.log('检查支付结果数据', result);
      // 支付状态异常。根据提供的信息引导买家重试支付。
      break;
    default:
      break;
  }
}
```

### 步骤3：服务器端获取支付结果  
在买家完成支付或支付超时后，蚂蚁金服会通过服务器交互将相应的支付结果发送给您，您可以通过以下方式之一获取支付结果：

1. 接收异步通知
2. 查询结果
### **接收异步通知**  
当支付成功或失败并达到最终状态时，蚂蚁金服会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API 将异步通知发送到在 **createPaymentSession** API 中指定的 _paymentNotifyUrl_。收到蚂蚁金服的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。  
蚂蚁金服允许您在 **createPaymentSession** API 的 _paymentNotifyUrl_ 参数中指定 URL。如果每个支付的 URL 相同，您也可以在蚂蚁金服控制台中进行配置。  

以下是一个通知请求的示例：  
```json
{
"notifyType": "PAYMENT_RESULT",
"result": {
"resultCode": "SUCCESS",
"resultStatus": "S",
"resultMessage": "success"
},
"paymentRequestId": "2020010123456789XXXX",
"paymentId": "2020010123456789XXXX",
"paymentAmount": {
"value": "4200",
"currency": "SGD"
},
"paymentCreateTime": "2020-01-01T12:01:00+08:30",
"paymentTime": "2020-01-01T12:01:01+08:30"
}
```

以下示例代码展示了如何验证通知的签名并做出响应：  
```java
@RequestMapping(path = "/payResult", method = RequestMethod.POST)
public ResponseEntity<AlipayResponse> paymentNotifyProcessor(HttpServletRequest request,
@RequestBody String body) {
// 从请求头中获取所需参数。
String requestTime = request.getHeader("request-time");
String clientId = request.getHeader("client-id");
String rawSignature = request.getHeader("signature");
String signature = "";  

// 从原始签名中获取有效部分
if(rawSignature==null||rawSignature.isEmpty()){
  throw new RuntimeException("empty notify signature");
}else {
  String[] parts = rawSignature.split("signature=");
  if (parts.length > 1) {
    signature = parts[1];
  }
}  

// 验证支付结果通知的签名
boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
clientId, requestTime, body, signature,
ALIPAY_PUBLIC_KEY);
if (!verifyResult) {
  throw new RuntimeException("Invalid notify signature");
}  

// 根据通知结果更新记录状态
// 向服务器发送我们已接收通知的响应
Result result = new Result("SUCCESS", "success", ResultStatusType.S);
AlipayResponse response = new AlipayResponse();
response.setResult(result);
return ResponseEntity.ok().body(response);
}
```

#### 常见问题  
##### 何时会发送通知？  
这取决于支付是否完成：  
*   如果支付成功完成，蚂蚁金服通常会在3到5秒内发送异步通知。对于像柜台支付（OTC）这样的支付方式，通知可能会稍有延迟。
*   如果支付未完成，蚂蚁金服需要先关闭订单，然后才会发送异步通知。不同支付方式关闭订单所需的时间会有所不同，通常默认为14分钟。  

##### 通知会重新发送吗？  
如果您收到蚂蚁金服的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果您未按要求响应异步通知，或者由于网络原因通知未送达，通知将在24小时内自动重新发送，最多可重试8次，直到收到正确响应为止。重试间隔为：0分钟、2分钟、10分钟、10分钟、1小时、2小时、6小时和15小时。  

##### 是否需要在响应中添加数字签名？  
如果您收到蚂蚁金服的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应，但不需要在您的响应中添加数字签名。  

##### 如何理解以下关键字段的含义？  
*   _result_：订单的支付结果。
*   _paymentRequestId_：商家生成的用于查询、取消和对账的支付请求ID。
*   _paymentId_：蚂蚁金服生成的用于退款和对账的支付订单ID。
*   _paymentAmount_：如果有金额对账需求，可以使用此字段。
### **查询结果**
您可以调用**inquiryPayment** API 来查询订单的结果。  
<table style="width:748px;outline:none;border-collapse:collapse;border:1px solid #D9E4F2;" class="lake-table"><colgroup><col width="211" span="1"><col width="97" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>参数名称</strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>是否必需</strong></p></td><td style="background-color:#D4EEFC;font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>描述</strong></p></td></tr><tr style="height:33px"><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRequestId</em></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"></p></td><td style="font-size:14px;white-space:normal;border:1px solid #D9E4F2;padding:4px 8px;cursor:default;text-align:center"><p style="font-size:14px;color:#262626;line-height:1.74;letter-spacing:0.05em;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">商家生成的支付请求ID。</p></td></tr></tbody></table>  
完整的参数列表，请参考[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档以获取全部参数和特定支付方式的额外要求。  
以下示例代码展示了如何调用**inquiryPayment** API:  
```java
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);
AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/api/v1/payments/inquiryPayment");  
AlipayPayQueryResponse alipayPayQueryResponse;
try {
    alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}  
```
以下代码展示了请求消息的示例:  
```json
{
  "paymentRequestId": "2019060811401080010018882020035****"
}
```
以下代码展示了响应消息的示例:  
```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "Success"
  },
  "paymentStatus": "SUCCESS",
  "paymentRequestId": "pay_1089760038715669_10277574507XXXX",
  "paymentId": "2019060811401080010018882020035XXXX",
  "paymentAmount": {
    "value": "4200",
    "currency": "SGD"
  },
  "paymentCreateTime": "2019-06-01T12:01:01+08:30",
  "paymentTime": "2019-06-01T12:01:01+08:30",
  "transactions": null
}
```
#### 常见问题解答
##### 如何理解以下关键字段的含义？
*   _result_：API调用的结果。仅表示**inquiryPayment** API调用的结果。订单结果应根据_paymentStatus_来确定。`SUCCESS`和`FAIL`表示最终结果，`PROCESSING`表示交易仍在进行中。
*   _paymentAmount_：金额验证。如果需要进行金额验证，可以使用此字段。
##### 应该多频繁发起查询？
建议以2秒的间隔轮询查询，直到获取到最终的支付结果或接收到异步支付通知为止。

### **步骤4：获取扣款结果（服务器端）**
买家完成扣款或扣款超时后，蚂蚁金服会通过服务器交互将相应的扣款结果发送给您，您可以通过以下方式之一获取扣款结果：
*   接收异步通知
*   查询结果
### **接收异步通知**  
当扣款达到成功或失败的最终状态时，Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API，向在**createPaymentSession** API中指定的_paymentNotifyUrl_ 发送异步通知。收到Antom的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。  
Antom允许您在**createPaymentSession** API的_paymentNotifyUrl_ 参数中指定URL。如果每个支付的URL相同，您也可以在Antom控制台中进行配置。  

#### 成功扣款示例:  
```json
{
  "captureAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "notifyType": "CAPTURE_RESULT",
  "captureId": "2022XXXXXXX",
  "captureRequestId": "Merchant_Request_ID_XXXXXX",
  "captureTime": "2022-11-10T00:34:52-08:00",
  "paymentId": "2022XXXXXXX",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "success.",
    "resultStatus": "S"
  }
}
```

#### 失败扣款示例:  
```json
{
  "captureAmount": {
    "currency": "SGD",
    "value": "4200"
  },
  "notifyType": "CAPTURE_RESULT",
  "captureId": "2022XXXXXXX",
  "captureRequestId": "Merchant_Request_ID_XXXXXX",
  "captureTime": "2022-11-10T00:34:52-08:00",
  "paymentId": "2022XXXXXXX",
  "result": {
    "resultCode": "PROCESS_FAIL",
    "resultMessage": "fail.",
    "resultStatus": "F"
  }
}
```

#### 验证通知签名并响应通知的示例代码:  
```java
@RequestMapping(path = "/captureResult", method = RequestMethod.POST)
public ResponseEntity<AlipayResponse> captureNotifyProcessor(HttpServletRequest request,
@RequestBody String body) {
  // 从请求头中获取所需参数。
  String requestTime = request.getHeader("request-time");
  String clientId = request.getHeader("client-id");
  String rawSignature = request.getHeader("signature");
  String signature = "";  

  // 从原始签名中获取有效部分
  if(rawSignature==null||rawSignature.isEmpty()){
    throw new RuntimeException("empty notify signature");
  } else {
    String[] parts = rawSignature.split("signature=");
    if (parts.length > 1) {
      signature = parts[1];
    }
  }  

  // 验证支付结果通知的签名
  boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
      clientId, requestTime, body, signature,
      ALIPAY_PUBLIC_KEY);
  if (!verifyResult) {
    throw new RuntimeException("Invalid notify signature");
  }  

  // 根据通知结果更新记录状态
  // 告诉服务器我们已接受通知
  Result result = new Result("SUCCESS", "success", ResultStatusType.S);
  AlipayResponse response = new AlipayResponse();
  response.setResult(result);
  return ResponseEntity.ok().body(response);
}
```

#### 常见问题解答  
##### 何时发送通知？  
这取决于支付是否完成:  
*   如果支付成功完成，Antom通常会在3到5秒内发送异步通知。对于像柜台支付（OTC）这样的支付方式，通知可能需要更长时间。
*   如果支付未完成，Antom需要先关闭订单，然后才会发送异步通知。不同支付方式关闭订单所需的时间会有所不同，通常默认为14分钟。  

##### 会重新发送异步通知吗？  
如果您收到Antom的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果您未按要求响应异步通知，或者由于网络原因通知未送达，通知将在24小时内自动重新发送，最多可重试8次，或直到收到正确响应以终止发送。发送间隔为：0分钟，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。  

##### 是否需要在响应中添加数字签名？  
如果您收到Antom的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应，但不需要在您的响应中添加数字签名。  

##### 如何理解以下关键字段的含义？  
*   _result_：表示订单的扣款结果。
*   _notifyType_：notifyType 的值为 `CAPTURE_RESULT`。
*   _paymentRequestId_：您生成的支付请求号，用于查询、取消和对账。
*   _paymentId_：Antom 生成的支付订单ID，用于退款和对账。
*   _acquirerReferenceNo_：在新加坡和香港集成卡内支付服务的商家将在通知中收到特定的收单方编号。
### **查询订单结果**

您可以调用 **inquiryPayment** API 来查询订单的结果。

**参数**

| 参数名 | 必填 | 描述 |
| --- | --- | --- |
| paymentRequestId | 是 | 商家生成的支付请求 ID。 |

请注意，以上参数不完整，完整的参数列表和特定支付方式的额外要求请参考 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档。

**查询示例代码**

```java
// 初始化 SDK
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG, merchantPrivateKey, alipayPublicKey);

// 创建请求
AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/api/v1/payments/inquiryPayment");

// 执行查询
try {
    AlipayPayQueryResponse alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```

**交易状态值**

API 响应中的 `transactions` 字段表示交易状态：

| 参数名 | 描述 |
| --- | --- |
| transactions.transactionType | 交易类型，值为 `CAPTURE` 表示扣款状态。 |
| transactions.transactionStatus | 交易状态，`SUCCESS` 表示成功，`FAIL` 表示失败，`PROCESSING` 表示处理中。 |
| transactions.transactionRequestId | 交易请求 ID。 |
| transactions.transactionAmount.currency | 货币类型。 |
| transactions.transactionAmount.value | 交易金额。 |
| transactions.transactionId | 交易 ID。 |
| transactions.transactionResult.resultStatus | 结果状态。 |
| transactions.transactionResult.resultCode | 结果代码。 |
| transactions.transactionResult.resultMessage | 结果消息。 |

**常见问题**

**1. 如何理解以下关键字段的含义？**

- `result`：API 调用的结果，仅表示 **inquiryPayment** API 的调用结果。订单状态应根据 `paymentStatus` 来确定。`SUCCESS` 和 `FAIL` 表示最终结果，`PROCESSING` 表示交易仍在进行中。
- `paymentAmount`：金额验证，如有需要验证金额，可以使用此字段。

**2. 应该多频繁发起查询？**

建议每 2 秒轮询一次，直到获取到最终支付结果或收到异步支付通知。

**示例代码**

以下是前端的完整示例代码、自定义加载动画示例以及 AVS 身份验证示例。由于篇幅原因，这里只列举了部分代码，完整代码请参考原文档。

**事件代码**

您可能会遇到两种类型的事件代码：

- 状态代码：在组件运行时生命周期中由 `onEventCallback` 返回。
- 错误代码：在组件初始化阶段由 `onEventCallback` 或 `onError` 返回。

有关事件代码的详细信息，请参阅原文档中的表格。

要查看文档的最新更新，请访问 [发布说明](https://global.alipay.com/docs/releasenotes)。

**此页面是否有帮助？**

**本页内容**

- 用户体验
- 支付流程
- 集成步骤
- 步骤 1：创建支付会话
- 安装 API 库
- 初始化请求实例
- 创建支付会话
- 调用 createPaymentSession API 的示例代码
- 常见问题
- 请求中可以使用中文字符吗？
- 如何设置支付结果通知地址？
- 步骤 2：创建并调用 SDK
- 安装
- 实例化 SDK
- 调用 SDK
- 内嵌体验与弹出体验
- 弹出体验
- 内嵌体验
- 内嵌提交支付
- 销毁组件
- 常见问题
- 显示支付结果
- 步骤 3：获取支付结果
- 接收异步通知
- 常见问题
- 查询结果
- 获取扣款结果
- 接收异步通知
- 常见问题
- 查询结果
- 扣款状态值
- 常见问题
- 示例代码
- 事件代码

以上内容为原文档的中文翻译，如有遗漏或需要进一步解释，请参考原文档。
Obtain authorization | Scan to Bind | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fscantopay_en%2Fauthorization)

[Go to Homepage](../../)

Scan to Bind

[Overview](/docs/ac/scantopay_en/overview)

Integration guide

[Obtain authorization](/docs/ac/scantopay_en/authorization)

[Pay](/docs/ac/scantopay_en/pay)

After payments

[Reconciliation](/docs/ac/scantopay_en/settle_reconcile)

Obtain authorization
====================

2024-04-10 02:48

Before an automatic deduction can be made, you need to obtain the buyer's authorization. After the authorization is successfully obtained, you need to obtain a payment token using an authorization code. The payment token is used to perform subsequent one-click payments, and you must handle the token properly in the following cases:

*   When the payment token for a payment method authorized for Scan to bind is about to expire, you need to refresh the payment token.
*   If the buyer deauthorizes the payment method, the payment token needs to be handled accordingly.

Prerequisites
=============

Before you begin, you must complete the following tasks:

*   Register on [Antom Dashboard](https://global.alipay.com/docs/dashboard_en).
*   Set your keysÂ on Antom Dashboard.
*   Configure an address for receiving asynchronous [notifications](https://global.alipay.com/docs/ac/scan_to_bind_en/notification).

For details, see [Integration guide](https://global.alipay.com/docs/integration_guide_en).

Obtain the authorization
========================

To obtain authorization from the buyer, complete the following integration steps:

1.  Obtain the QR code from Alipay.
2.  Display the QR code.
3.  Obtain the authorization code.
4.  Apply for a payment token.
5.  (Optional) Refresh the payment token.

Step 1: Obtain the QR code from Alipay
--------------------------------------

After you have signed contracts to support the desired payment methods, you can call the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API. Alipay will return the QR code for obtaining the buyer's authorization in the API response. The QR code value is the value of _authCodeForm.codeDetails.codeValue_. The value is provided in the format of both a picture and a text, and you can choose either one depending on your requirements.

When calling the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API, pass the following parameters correctly in the request:

*   _authRedirectUrl_: the URL for redirecting the buyer to the merchant page on their mobile client after the authorization is completed. For Scan to bind payments, the buyer will not be redirected to the merchant page on their mobile client after the authorization is completed.
*   _authState_: A string specified by yourself to identify an authorization request.
*   _customerBelongsTo_: specify the target payment method for which you are requesting authorization.
*   _scopes_: Pass in the fixed value `AGREEEMENT_PAY`.
*   terminalType: indicates your client type. The value is fixed as `WEB`.

Step 2: Display the QR code
---------------------------

After obtaining the QR code value from Alipay, generate a QR code based on the text and display it on your Web client if you want to use the text. If you want to use the picture, directly render the picture on your Web client. The buyer scans the QR code to authorize the payment.

Step 3: Obtain the authorization code
-------------------------------------

After the buyer's authorization has been obtained, you can obtain the authorization code (_authCode_) from the authorization success notification sent by Alipay.

1.  Configure the address for receiving authorization result notifications. For details, see [Notifications](https://global.alipay.com/docs/ac/cashier_payment_cn/notification#oUAYb).
2.  After the buyer agrees to the authorization, you will receive an [authorization success notification](https://global.alipay.com/docs/ac/ams/notifyauth) sent by Alipay.
3.  After receiving the asynchronous notification, return a response as instructed in the [Requirements](https://global.alipay.com/docs/ac/cashier_payment_cn/notification#OqpVS). Otherwise, Alipay will resend the asynchronous notification.

The authorization can be successful or failed. The subsequent redirections in these two cases are as follows:

*   **Authorization success**: Handle the redirection to your authorization result page on your Web client.
*   **Authorization failure**: If the buyer fails to agree to the authorization due to authorization timeout or failure, we recommend that you guide the buyer to reinitiate the authorization. Usually, if you have not received an authorization success notification after 15 minutes, the authorization fails.

Since the authorization URL can only be used once, if the user authorization fails, you need to call the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API with a new authState value.

Step 4: Apply for a payment Token
---------------------------------

After obtaining the authorization code (_authCode_), call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API to obtain a payment token (_accessToken_).

### Obtain a payment token

Call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API within one minute after obtaining the authorization code (_authCode_) to apply for the payment token (_accessToken_). Otherwise, the authorization code (_authCode_) will expire and become invalid. Only with the payment token (_accessToken_) can an automatic deduction from the buyer's account be implemented.

When calling the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API, pass the following parameters correctly in the request:

*   _grantType_: Pass in the fixed value `AUTHORIZATION_CODE`.
*   _customerBelongsTo_: Specify the target payment method for which you are requesting authorization.
*   _authCode_: Pass in the value of _authCode_ that you obtained in [Step 3](#CvOoy).

The following example is a sample request for applying for the payment token:

copy

    {
      "grantType": "AUTHORIZATION_CODE",
      "customerBelongsTo": "GCASH",
      "authCode": "d2f60253-ecdc-e9bc-27d1-566970191040"
    }

In the response, you will receive the following key parameters:

*   _accessToken_: the payment token.
*   _accessTokenExpiryTime_: the expiration time of the payment token.
*   _refreshToken_: the refresh token used to refresh the current payment token.
*   _refreshTokenExpiryTime_: the expiration time of the refresh token. Usually, the _refreshTokenExpiryTime_ value is greater than the _accessTokenExpiryTime_ value to ensure the payment method is available. After the refresh token expires, you need to start from [Step 1](#qGhSj) to obtain a new authorization code (_authCode_) and then call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API.

> **Note**:
> 
> *   If you do not receive a response after calling the API, we recommend that you resend the request with the same parameters and parameter values.
> *   If you receive a response without the payment token (_accessToken_), we recommend that you handle it as follows:
> 
> *   If the value of _result.resultStatus_ is U, resend the request with the same parameters and parameter values.
> *   If the value of _result.resultStatus_ is F, troubleshoot the issue according to the result code. If you need to call the API again to obtain a payment token, since the authCode can only be used once, you need to start from Step 1 to obtain a new authorization code (_authCode_) and then call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API.
> 
> *   If you want to display the buyer's linked account used for Scan to bind in your client, use the _userLoginId_ value returned through the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API response. The value of this field is desensitized and can be directly displayed.

### Refresh a payment token

Once the payment token (_accessToken_) expires, it can no longer be used for an Scan to bind payment. Therefore, you need to call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API to refresh the payment token (_accessToken_) before it expires. To call this API, pass the following parameters in the request:

*   _grantType_: Pass in the fixed value `REFRESH_TOKEN`.
*   _customerBelongsTo_: Specify the target payment method for which you are requesting authorization.
*   _refreshToken_: Pass in the value of the refresh token parameter (refreshToken). The parameter value is obtained from the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API response that is used to obtain a payment token in the previous steps.

The following example is a sample request for refreshing the payment token:

copy

    {
      "grantType": "REFRESH_TOKEN",
      "customerBelongsTo": "GCASH",
      "refreshToken": "281xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx7811"
    }

Always use the latest _refreshToken_ value to extend the access token validity period. This is because some payment methods may return a new _refreshToken_ value when you call the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API to refresh the token (when you specify the value of _grantType_ as `REFRESH_TOKEN` in the [**applyToken**](https://global.alipay.com/docs/ac/ams/accesstokenapp) API request).

> **Note**:
> 
> *   We recommend that you refresh the payment token (_accessToken_) at least ten days before it expires, so that the Alipay Technical Support team has enough time to handle it. This rule also applies to payment methods with a longer validity period for the payment token _(accessToken_), such as KakaoPay.
> *   For payment methods with a longer validity period for the payment token (_accessToken_), such as KakaoPay, _refreshToken_ and _refreshTokenExpiryTime_ parameters may not be provided.

### Payment token lifecycle table

Due to risk control requirements in different countries, payment methods have different validity periods for access tokens. The minimum validity period is one year. The following table shows the validity period of payment methods:



| **Payment method** | **Access token validity period** | **Possible to refresh the token?** | **Response fields of the applyToken API** |
| --- | --- | --- | --- |
| DANA | 10 years | Yes | accessToken accessTokenExpiryTime refreshToken refreshTokenExpiryTime |
| AlipayHK | Until Jan 01, 2038 | Yes | accessToken accessTokenExpiryTime refreshToken refreshTokenExpiryTime |



Table 1. Access token validity period for different payment methods

We recommend that you maintain a lifecycle table containing information about all payment methods' payment tokens (_accessToken_), so that you can regularly retrieve expiring payment tokens (_accessToken_) and refresh them. For example:

![Image 3: image](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1673864558983-8d64973b-1fd4-40c1-8270-61f86514c3cf.png)

Cancel an authorization
=======================

When a buyer is to disable the Scan to bind service, they may cancel the service within your client or the payment method client. How they cancel the service determines your required actions:

*   If the buyer cancels the service within your client, invalidate the payment token of the payment method using the [**revoke**](https://global.alipay.com/docs/ac/ams/authrevocation) API. In the API request, pass the payment token (_accessToken_) used to initiate an Scan to bind payment. After a successful API call, the payment token (_accessToken_) will become invalid.
*   Some payment methods support buyers canceling the Scan to bind service within the payment method client. In this case, you need to configure the address to receive [authorization cancellation notifications](https://global.alipay.com/docs/ac/ams/notifyauth). When an Scan to bind authorization is canceled within the payment method client, you will receive an [authorization cancellation notification](https://global.alipay.com/docs/ac/ams/notifyauth). The notification will indicate the payment token (_accessToken_) that is invalidated for the canceled Scan to bind service. The following example shows an asynchronous notification of an authorization cancellation:

copy

    {
      "authorizationNotifyType": "TOKEN_CANCELED",
      "accessToken": "28100103_20215703001538122119",
      "result": {
        "resultCode": "SUCCESS",
        "resultMessage": "success",
        "resultStatus": "S"
      }
    }

After receiving the asynchronous notification, return a response as instructed in the [Requirements](https://global.alipay.com/docs/ac/cashier_payment_cn/notification#OqpVS). Otherwise, Alipay will resend the asynchronous notification.

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 4](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 5](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Prerequisites](#cXNt1 "Prerequisites")

[Obtain the authorization](#2BiKE "Obtain the authorization")

[Step 1: Obtain the QR code from Alipay](#qGhSj "Step 1: Obtain the QR code from Alipay")

[Step 2: Display the QR code](#ziJ3z "Step 2: Display the QR code")

[Step 3: Obtain the authorization code](#CvOoy "Step 3: Obtain the authorization code")

[Step 4: Apply for a payment Token](#rLErG "Step 4: Apply for a payment Token")

[Obtain a payment token](#ECpYN "Obtain a payment token")

[Refresh a payment token](#tN3SV "Refresh a payment token")

[Payment token lifecycle table](#HiHdb "Payment token lifecycle table")

[Cancel an authorization](#eNTbh "Cancel an authorization")
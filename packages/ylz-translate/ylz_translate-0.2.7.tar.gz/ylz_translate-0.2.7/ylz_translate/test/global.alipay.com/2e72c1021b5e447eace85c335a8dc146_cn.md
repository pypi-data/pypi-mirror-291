蚂蚁金服支付（Android）| 结账支付 | 支付宝文档
======================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fapm_android)  
[返回首页](../../)

结账支付
--------

[概述](/docs/ac/cashierpay/overview)  
接收支付  
SDK 集成  
[APM 支付（Web/WAP）](/docs/ac/cashierpay/apm_ww)  
[APM 支付（Android）](/docs/ac/cashierpay/apm_android)  
[APM 支付（iOS）](/docs/ac/cashierpay/apm_ios)  
[卡支付（Web/WAP）](/docs/ac/cashierpay/wwcard)  
[卡支付（Android）](/docs/ac/cashierpay/adcard)  
[卡支付（iOS）](/docs/ac/cashierpay/ioscard)  
仅API集成  
支付后  
支付方式  
其他资源  
高级功能  
[预前端解决方案API](/docs/ac/cashierpay/prefront)  
[先买后付API](/docs/ac/cashierpay/bnpl)  
[卡存储API](/docs/ac/cashierpay/cv)  
[卡存储SDK](/docs/ac/cashierpay/cvsdk)  
[卡支付功能API/SDK](/docs/ac/cashierpay/mf)  
APM 支付（Android）
======================

2024-05-11 10:13

Antom SDK 是一个预构建的UI组件，简化了集成Antom支付服务的过程。这个组件提供了一种简单快捷的方式来集成Antom支持的所有支付方式，包括信用卡、数字钱包、银行转账、在线银行等。
SDK组件能够自动适应买家的设备和位置，根据支付方式的特性执行信息收集、重定向、应用切换、显示二维码等任务。这使得您能够在您的网站或应用上轻松提供全面的支付解决方案，节省构建每个支付界面和流程所需的时间和资源。

用户体验
==========

以下图示展示了在App中支付的用户流程：

[图片3: image.png]

支付流程
==========

对于每种支付方式，支付流程包括以下步骤：

[图片4: 333.webp]

1. **买家到达结账页面。**
2. **创建**[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)**请求**
   买家选择支付方式并提交订单后，您可以调用[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口获取支付会话。
3. **调用客户端SDK**
   在客户端，通过支付会话调用SDK。SDK将根据支付方式的特性处理信息收集、重定向、应用调用、二维码显示、验证等流程。
4. **获取支付结果**
   通过以下两种方法之一获取支付结果：
异步通知：在[**createPaymentSession**](https://global.alipay.com/docs/ac/ams/session_cashier)接口中指定_paymentNotifyUrl_，设置接收异步通知的地址。当支付成功或超时时，Antom会使用[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)向您发送异步通知。

同步查询：调用[**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online)接口来查询支付状态。

集成步骤
==========

1.  创建支付会话
2.  创建并调用SDK
3.  获取支付结果

步骤1：创建支付会话（服务器端）
--------------------------------------------

当买家选择Antom提供的支付方式时，您需要收集支付请求ID、订单金额、支付方式、订单描述、支付重定向URL和支付结果通知URL等关键信息，调用**createPaymentSession** API创建支付会话，并将支付会话返回给客户端。

Antom提供了多种语言的服务器端API库。以下代码以Java为例，您需要安装Java 6或更高版本。
### 安装API库
您可以在[GitHub](https://github.com/alipay/global-open-sdk-java)上找到最新版本。  
复制以下内容：  

```xml
<dependency>
    <groupId>com.alipay.global.sdk</groupId>
    <artifactId>global-open-sdk-java</artifactId>
    <version>2.0.21</version>
</dependency>
```

这段代码是用于Maven项目的依赖配置，将它添加到您的`pom.xml`文件中，即可引入蚂蚁金服的全球开放SDK Java版本2.0.21。
### 初始化请求实例  
创建一个单例资源以向Antom发起请求。  
复制  
String 商户私钥 = "YOUR PRIVATE KEY";
String 支付宝公钥 = "ALIPAY PUBLIC KEY"
AlipayClient 默认Alipay客户端 = new DefaultAlipayClient(EndPointConstants.SG,
商户私钥, 支付宝公钥);
### 创建支付会话  
创建支付会话包括以下参数：  
| **参数名** | **必填** | **描述** |
| --- | --- | --- |
| productCode | ✅ | 值固定为 `CASHIER_PAYMENT`。 |
| paymentRequestId | ✅ | 商户生成的唯一ID，每次发起支付时需新生成一个ID。 |
| paymentAmount | ✅ | 支付金额，应根据订单货币的最小单位设置，如CNY表示分，KRW表示元。 |
| paymentMethod | ✅ | 支付方式枚举。 |
| paymentRedirectUrl | ✅ | 商户的支付结果页面，根据服务器端结果，非固定的成功页面。 |
| order | ✅ | 订单信息，包括订单金额、订单ID和商户侧的订单描述。 |
| paymentNotifyUrl |  | 支付结果通知地址，可通过接口传入，也可通过门户设置为固定值。 |
| settlementStrategy |  | 支付的结算货币，如果业务签约了多个结算货币，需要在接口中指定。 |  
以上参数是创建支付会话的基本参数，完整参数和某些支付方式的额外要求请参考 [**createPaymentSession (Checkout Payment)**](https://global.alipay.com/docs/ac/ams/session_cashier)**。**  
#### 调用createPaymentSession API的示例代码  
以下示例代码展示了如何调用 **createPaymentSession** API：  
```java
AlipayPaymentSessionRequest alipayPaymentSessionRequest = new AlipayPaymentSessionRequest();
alipayPaymentSessionRequest.setClientId(CLIENT_ID);
alipayPaymentSessionRequest.setPath("/ams/sandbox/api/v1/payments/createPaymentSession");
alipayPaymentSessionRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);  
// 替换为你的paymentRequestId
alipayPaymentSessionRequest.setPaymentRequestId("paymentRequestId01");
// 设置金额
```
请注意替换示例代码中的 `CLIENT_ID` 和 `paymentRequestId01` 为实际的值。
```java
Amount amount = new Amount();
amount.setCurrency("MYR");
amount.setValue("4200");
alipayPaymentSessionRequest.setPaymentAmount(amount);  
// 设置支付方式
PaymentMethod paymentMethod = new PaymentMethod();
paymentMethod.setPaymentMethodType("ONLINEBANKING_FPX");
alipayPaymentSessionRequest.setPaymentMethod(paymentMethod);  
// 设置订单信息
Order order = new Order();
order.setReferenceOrderId("referenceOrderId01");
order.setOrderDescription("蚂蚁sdk测试订单");
order.setOrderAmount(amount);
Buyer buyer = new Buyer();
buyer.setReferenceBuyerId("yourBuyerId");
order.setBuyer(buyer);
order.setOrderAmount(amount);
alipayPaymentSessionRequest.setOrder(order);  
// 替换为你的重定向URL
alipayPaymentSessionRequest.setPaymentRedirectUrl("https://www.yourMerchantWeb.com");
alipayPaymentSessionRequest.setPaymentNotifyUrl("https://www.yourNotifyUrl");  
AlipayPaymentSessionResponse alipayPaymentSessionResponse = null;
try {
    alipayPaymentSessionResponse = defaultAlipayClient.execute(alipayPaymentSessionRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}  
```

以下是一个请求消息的示例：

```json
{
    "paymentNotifyUrl": "https://www.yourNotifyUrl",
    "paymentRequestId": "paymentRequestId01",
    "paymentAmount": {
        "currency": "MYR",
        "value": "4200"
    },
    "productCode": "CASHIER_PAYMENT",
    "paymentRedirectUrl": "https://www.yourMerchantWeb.com",
    "paymentMethod": {
        "paymentMethodType": "ONLINEBANKING_FPX"
    },
    "order": {
        "orderAmount": {
            "currency": "MYR",
            "value": "4200"
        },
        "referenceOrderId": "referenceOrderId01",
        "orderDescription": "蚂蚁sdk测试订单",
        "buyer": {
            "referenceBuyerId": "yourBuyerId"
        }
    }
}
```

以下是一个响应的示例，其中包含以下参数：

*   `paymentSessionData`: 用于返回给前端的支付会话数据
*   `paymentSessionExpiryTime`: 支付会话的过期时间。

```json
{
    "paymentSessionData": "...");
    "paymentSessionExpiryTime": "2022-12-31T23:59:59Z"
}
```
"paymentSessionData": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
"paymentSessionExpiryTime": "2023年4月6日03:28:49 UTC",
"paymentSessionId": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
"result": {
"resultCode": "成功",
"resultMessage": "操作成功。",
"resultStatus": "S"
}
}

这段Markdown格式的文档翻译成中文如下：

"支付会话数据": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Kvvmsdk+akdLvoShW5avHX8e8J15P8uNVEf/PcCMyXg==&&SG&&111",
"支付会话过期时间": "2023年4月6日03:28:49协调世界时",
"支付会话ID": "UNvjVWnWPXJA4BgW+vfjsQj7PbOraafHY19X+6EqMz6Ikyj9FPVUOpv+DjiIZqMe",
"结果": {
"结果代码": "成功",
"结果信息": "操作成功。",
"结果状态": "S"
}
}
### 常见问题解答  
#### 请求中可以使用中文字符吗？  
请勿在请求中的字段，包括`paymentRequestId`、`referenceOrderId`、`orderDescription`和`goods`使用中文字符，以避免与QRIS和Mastercard等不兼容的支付方式。  
#### 如何设置支付结果通知地址？  
Antom会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)接口发送支付结果。您可以在`createPaymentSession` API中通过`paymentNotifyUrl`参数指定此地址。如果每个支付的通知地址相同，您也可以在Antom控制台上进行配置。如果您已经配置了地址并在API中设置了参数，Antom将使用API中设置的地址。  

### 步骤2：创建并调用SDK客户端
---------------------------------------------  
Antom SDK是一个用于处理支付流程的组件。通过创建支付会话，您可以收集信息、在应用间切换以及根据`createPaymentSession` API中指定的支付方式显示二维码来初始化SDK。  

当买家在页面上选择支付方式后，您需要创建SDK并使用支付会话来启动它。
### 安装  
版本要求：目标至少为Android 4.4（API级别19）或更高。  
要集成SDK包，请参考[集成SDK包](https://global.alipay.com/docs/ac/antom_sdk/android_en)。
### 初始化SDK  
使用`AMSCashierPayment`创建SDK实例，并设置基础配置。创建配置对象包括以下方法：

| **方法名** | **必需** | **描述** |
| --- | --- | --- |
| *setLocale* |  | 用于传入语言信息。有效值如下，根据支付方式所在地区选择传递的值。如果传递其他值，默认使用本地语言：* `en_US`: 英语 * `pt_BR`: 葡萄牙语 * `ko_KR`: 韩语 * `es_ES`: 西班牙语 * `ms_MY`: 马来语 * `in_ID`: 印尼语 * `tl_PH`: 塔加洛语 * `th_TH`: 泰语 * `vi_VN`: 越南语 * `fr_FR`: 法语 * `nl_NL`: 荷兰语 * `it_IT`: 意大利语 * `de_DE`: 德语 * `zh_CN`: 简体中文 * `zh_HK`: 繁体中文 |

| *setOption* |  | 用于指定是否使用默认加载模式和沙箱环境。有效值为：* `"sandbox", "true"`: 沙箱环境 * `"sandbox", "false"`: 生产环境 * `"showLoading", "true"`: 使用默认加载模式。 * `"showLoading", "false"`: 不使用默认加载模式。 |

| *setOnCheckoutListener* |  | 创建**OnCheckoutListener** API实例，用于后续流程中的事件处理。API包含以下方法：* `onEventCallback`: 必需。一个监听结账页面支付事件的回调函数，返回*eventCode*和*eventResult*。 |

以下示例代码展示了如何初始化SDK：

```java
AMSCashierPaymentConfiguration configuration = new AMSCashierPaymentConfiguration();
configuration.setLocale(new Locale("en", "US"));
// 设置showLoading为true（默认值）以使用默认加载模式。设置为false则根据onEventCallback自定义加载动画。
configuration.setOption("showLoading", "true");
```

请注意，代码示例使用了Java语法。如果原始文档使用了其他编程语言，请根据实际情况调整。
// 设置沙箱环境。如果不设置，将默认使用生产环境。
configuration.setOption("sandbox", "true");
// 设置监听器以监控结账页面上的支付事件。
configuration.setOnCheckoutListener(new OnCheckoutListener() {
    @Override
    public void onEventCallback(String eventCode, AMSEventResult eventResult) {
        Log.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());
    }
});
// 初始化AMSCashierPayment对象。
AMSCashierPayment checkout = new AMSCashierPayment.Builder(activity, configuration).build();
### 调用SDK

调用`createComponent`方法：

| **参数名** | **是否必需** | **描述** |
| --- | --- | --- |
| *sessionData* | ✅ | 使用*sessionData*参数创建配置对象：将通过**createpaymentSession（结账支付）**API获取的*paymentSessionData*参数中的完整数据传递给*sessionData*参数。 |

在以下情况下调用`onDestroy`方法释放SDK组件资源：

*   当买家离开结账页面时，释放**createPaymentSession**中创建的组件资源。
*   当买家发起多次支付时，释放之前**createPaymentSession**中创建的组件资源。

以下示例代码展示了如何调用SDK：

```java
checkout.createComponent(activity, sessionData);
// 释放SDK组件资源
checkout.onDestroy();
```

请注意，这里的示例代码是基于Java的，假设`checkout`对象已经初始化并且`activity`是Android的Activity实例。实际使用时，需要根据你的项目环境和SDK的具体实现进行相应调整。
### 显示支付结果  
您可以使用支付组件处理需要重定向（异步支付）和不需要重定向（同步支付）的支付方式。  

#### 重定向支付  
某些支付方式的支付过程需要离开原始网页，跳转到机构页面完成支付，例如在线银行支付。在这种情况下，买家在完成支付后会被重定向到您在 **createPaymentSession** API 中提供的 _paymentRedirectUrl_。您可以在该URL中主动查询支付结果，并将其显示给买家。  

#### 非重定向支付  
对于无需重定向的支付，支付结果将通过 `onEventCallback` 函数返回。这里的支付结果仅用于前端显示，最终订单状态以服务器端为准。您需要通过 `onEventCallback` 结果数据中的信息自定义每个支付结果的处理流程。  

以下是 `onEventCallback` 返回的支付结果可能的事件代码：  

| **事件代码** | **消息** | **解决方案** |
| --- | --- | --- |
| SDK_PAYMENT_SUCCESSFUL | 支付成功。 | 建议将买家重定向到支付结果页面。 |
| SDK_PAYMENT_PROCESSING | 支付处理中。 | 建议查看 `onEventCallback` 结果数据中的 *paymentResultCode* 以获取详细信息。根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_FAIL | 支付失败。 | 建议查看 `onEventCallback` 结果数据中的 *paymentResultCode* 以获取详细信息。根据提供的信息引导买家重试支付。 |
| SDK_PAYMENT_CANCEL | 买家未提交订单就退出了支付页面。 | 如果 *paymentSessionData* 在有效期内，可以重新调用 SDK；如果已过期，需要重新请求 *paymentSessionData*。 |
| SDK\_PAYMENT\_ERROR | 支付状态异常 | 建议您检查`onEventCallback`结果数据中的`paymentResultCode`值以获取详细信息。根据提供的信息引导买家重试支付。 |
  
以下示例代码展示了如何处理`onEventCallback`：

```java
@Override
public void onEventCallback(String eventCode, AMSEventResult eventResult) {
    AlipayLog.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());
    if (!TextUtils.isEmpty(eventCode)) {
        if ("SDK_PAYMENT_SUCCESSFUL".equals(eventCode)) {
            // 支付成功。将买家重定向到支付结果页面。
        } else if ("SDK_PAYMENT_PROCESSING".equals(eventCode)) {
            // 支付处理中。根据提供的信息引导买家重试支付。
        } else if ("SDK_PAYMENT_FAIL".equals(eventCode)) {
            // 支付失败。根据提供的信息引导买家重试支付。
        } else if ("SDK_PAYMENT_CANCEL".equals(eventCode)) {
            // 引导买家重试支付。
        } else if ("SDK_PAYMENT_ERROR".equals(eventCode)) {
            // 支付状态异常。根据提供的信息引导买家重试支付。
        } else if ("SDK_END_OF_LOADING".equals(eventCode)) {
            // 结束您的自定义加载动画。
        }
    }
}
```

步骤3：获取支付结果（服务器端）
--------------------------------

买家完成支付或支付超时后，Antom会通过服务器交互将相应的支付结果发送给您，您可以使用以下方法之一获取支付结果：

1. **接收异步通知**：等待蚂蚁金服发送的支付结果通知。
2. **查询结果**：主动向蚂蚁金服的服务器查询支付状态。
### 接收异步通知  
当支付成功或失败时，蚂蚁金服会通过[**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online) API，向在**createPaymentSession** API 中指定的 _paymentNotifyUrl_ 发送异步通知。收到蚂蚁金服的通知后，您需要按照[要求](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)返回响应。

蚂蚁金服允许您在**createPaymentSession** API 的 _paymentNotifyUrl_ 参数中指定URL。如果每个支付的URL相同，您也可以在蚂蚁金服控制台中进行配置。

以下是一个通知请求的示例：

```json
{
"notifyType": "PAYMENT_RESULT",
"result": {
"resultCode": "SUCCESS",
"resultStatus": "S",
"resultMessage": "success"
},
"paymentRequestId": "paymentRequestId01",
"paymentId": "2020010123456789XXXX",
"paymentAmount": {
"value": "4200",
"currency": "MYR"
},
"paymentCreateTime": "2020-01-01T12:01:00+08:30",
"paymentTime": "2020-01-01T12:01:01+08:30"
}
```

以下示例代码展示了如何验证通知的签名并做出响应：

```java
@RequestMapping(path = "/payResult", method = RequestMethod.POST)
public ResponseEntity<AlipayResponse> paymentNotifyProcessor(HttpServletRequest request,
@RequestBody String body) {
    // 从请求头中获取所需参数。
    String requestTime = request.getHeader("request-time");
    String clientId = request.getHeader("client-id");
    String rawSignature = request.getHeader("signature");
    String signature = "";  

    // 从原始签名中获取有效部分
    if(rawSignature==null||rawSignature.isEmpty()){
        throw new RuntimeException("empty notify signature");
    } else {
        String[] parts = rawSignature.split("signature=");
        if (parts.length > 1) {
            signature = parts[1];
        }
    }  

    // 验证支付结果通知的签名
    // ...
    // 验证和处理逻辑在这里
    // ...

    // 返回响应
    return ResponseEntity.ok(new AlipayResponse(...));
}
```

请注意，上述代码中的`...`表示需要您根据实际业务逻辑填写或实现的部分，例如签名验证的具体实现和业务处理。
```java
boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
        clientId, requestTime, body, signature,
        ALIPAY_PUBLIC_KEY);
if (!verifyResult) {
    throw new RuntimeException("无效的回调签名");
}  
// 根据通知结果更新记录状态
// 回复服务器我们已接收通知
Result result = new Result("SUCCESS", "success", ResultStatusType.S);
AlipayResponse response = new AlipayResponse();
response.setResult(result);
return ResponseEntity.ok().body(response);
```

#### 常见问题解答 (FAQs)

##### 何时会发送通知？
这取决于支付是否完成：
*   如果支付成功完成，蚂蚁金服通常会在3到5秒内发送异步通知。对于像柜台支付（OTC）这样的支付方式，通知可能会稍有延迟。
*   如果支付未完成，蚂蚁金服需要先关闭订单，然后才会发送异步通知。不同支付方式关闭订单的时间会有所不同，通常默认为14分钟。

##### 异步通知会被重新发送吗？
当你收到蚂蚁金服的异步通知时，你需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应。如果你没有按照要求响应异步通知，或者由于网络原因通知未送达，通知将在24小时内自动重试发送。通知最多重试8次，或者直到收到正确的响应以终止发送。重试间隔为：0分钟，2分钟，10分钟，10分钟，1小时，2小时，6小时和15小时。

##### 需要在响应中添加数字签名吗？
不需要在响应中添加数字签名。通常，蚂蚁金服的异步通知验证是单向的，即由服务器向你的应用发送已签名的通知，你的应用验证签名后进行处理，但响应不需要签名。
如果您收到蚂蚁金服的异步通知，您需要按照[示例代码](https://global.alipay.com/docs/ac/cashier_payment_cn/notification)的格式返回响应，但不需要在响应中添加数字签名。

#### 如何理解以下关键字段的含义？

*   **result**：订单的支付结果。
*   **paymentRequestId**：商家生成的支付请求ID，用于查询、取消和对账。
*   **paymentId**：蚂蚁金服生成的支付订单ID，用于退款和对账。
*   **paymentAmount**：如果需要进行金额对账，可以使用这个字段。
### 查询支付结果  
您可以调用 **inquiryPayment** API 来查询订单的支付结果。  
| **参数名称** | **必填** | **描述** |
| --- | --- | --- |
| *paymentRequestId* |  | 商户生成的支付请求ID。 |  
请注意，以上参数并非完整参数集，完整参数和特定支付方式的额外要求请参考 [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API 文档。  
以下示例代码展示了如何调用 **inquiryPayment** API:  
```java
AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
    merchantPrivateKey, alipayPublicKey);  
AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
alipayPayQueryRequest.setClientId(CLIENT_ID);
alipayPayQueryRequest.setPath("/ams/sandbox/api/v1/payments/inquiryPayment");
alipayPayQueryRequest.setPaymentRequstId("paymentRequestId01");  
AlipayPayQueryResponse alipayPayQueryResponse;
try {
    alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
} catch (AlipayApiException e) {
    String errorMsg = e.getMessage();
    // 处理错误情况
}
```  
以下是一个请求消息的示例:  
```json
{
  "paymentRequestId": "paymentRequestId01"
}
```  
以下是一个响应消息的示例:  
```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "Success"
  },
  "paymentStatus": "SUCCESS",
  "paymentRequestId": "paymentRequestId01",
  "paymentId": "2019060811401080010018882020035XXXX",
  "paymentAmount": {
    "value": "4200",
    "currency": "MYR"
  },
  "paymentCreateTime": "2019-06-01T12:01:01+08:30",
  "paymentTime": "2019-06-01T12:01:01+08:30",
  "transactions": null
}
```  
#### 常见问题解答  
##### 如何理解以下关键字段的含义？
*   _result_: API调用的结果。它仅表示**inquiryPayment** API调用的结果。订单状态应根据_paymentStatus_来确定。`SUCCESS`和`FAIL`表示最终结果，而`PROCESSING`表示交易仍在进行中。
*   _paymentAmount_: 金额验证。如果需要验证金额，可以使用此字段。
##### 应该多久查询一次？
建议以2秒的间隔进行轮询查询，直到获取到最终的支付结果或接收到异步支付通知为止。

示例代码
==========

前端完整示例代码：

```java
AMSCashierPaymentConfiguration configuration = new AMSCashierPaymentConfiguration();
configuration.setLocale(new Locale("en", "US"));
// 设置showLoading为true（默认值）以使用默认加载模式。设置为false以根据onEventCallback自定义加载动画。
configuration.setOption("showLoading", "true");
// 设置沙箱环境。如果不设置，将默认使用生产环境。
configuration.setOption("sandbox", "true");
// 设置用于监听结账页面支付事件的回调。
configuration.setOnCheckoutListener(new OnCheckoutListener() {
    @Override
    public void onEventCallback(String eventCode, AMSEventResult eventResult) {
        AlipayLog.e(TAG, "onEventCallback eventCode=" + eventCode + " eventResult=" + eventResult.toString());  
        if (!TextUtils.isEmpty(eventCode)) {
            if ("SDK_PAYMENT_SUCCESSFUL".equals(eventCode)) {
                // 支付成功。将买家重定向到支付结果页面。
            } else if ("SDK_PAYMENT_PROCESSING".equals(eventCode)) {
                // 支付处理中。根据提供的信息引导买家重试支付。
            } else if ("SDK_PAYMENT_FAIL".equals(eventCode)) {
                // 支付失败。根据提供的信息引导买家重试支付。
            }
        }
    }
});
```

请注意，以上代码示例是基于假设的API和类，实际的代码可能需要根据蚂蚁金服提供的具体SDK进行调整。
```java
}else if ("SDK_PAYMENT_CANCEL".equals(eventCode)) {
    // 引导买家重试支付。
} else if ("SDK_PAYMENT_ERROR".equals(eventCode)) {
    // 支付状态异常。根据提供的信息引导买家重试支付。
} else if ("SDK_END_OF_LOADING".equals(eventCode)) {
    // 结束自定义加载动画。
}
}
}
});
// 初始化AMSCashierPayment。
AMSCashierPayment checkout = new AMSCashierPayment.Builder(activity, configuration).build();  
checkout.createComponent(activity, sessionData);  
checkout.onDestroy();  
```

**事件代码**
------------

您可能会遇到两种类型的事件代码：

*   状态代码：在组件运行时生命周期中由`onEventCallback`返回。
*   错误代码：在组件初始化阶段由`onEventCallback`或`onError`返回。

| **类型** | **代码** | **描述** | **进一步操作** |
| --- | --- | --- | --- |
| 状态代码 | SDK\_START\_OF\_LOADING | 支付组件创建时加载动画开始播放。 | 无需进一步操作。 |
| SDK\_END\_OF\_LOADING | 支付组件创建时加载动画结束。 | 无需进一步操作。 |
| 错误代码 | SDK\_INTERNAL\_ERROR | SDK内部错误发生。 | 联系Antom技术支持解决问题。 |
| SDK\_CREATEPAYMENT\_PARAMETER\_ERROR | 传递给`createComponent`方法的参数不正确。 | 确保参数传递正确并发送新请求。 |
| SDK\_CALL\_URL\_ERROR | 表示以下情况之一：* 商家页面重定向执行失败。* 在**createpaymentSession (Cashier Payment)**请求中的`paymentRedirectUrl`参数未传递或传递错误。 | 联系Antom技术支持解决问题。 |
| SDK\_INTEGRATION\_ERROR | 依赖项未找到。 | 确保已正确添加依赖项并重试集成过程。 |
查看文档的最新更新，请访问[版本说明](https://global.alipay.com/docs/releasenotes)。  
![图片 5](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片 6](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)  
@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)  

#### 这个页面有帮助吗？  

#### 本页内容  

[用户体验](#BkD7T "用户体验")  
[支付流程](#eLZVd "支付流程")  
[集成步骤](#QLFGi "集成步骤")  
[步骤1：创建支付会话](#zhBSk "步骤1：创建支付会话")  
[安装API库](#d3kyo "安装API库")  
[初始化请求实例](#WLui0 "初始化请求实例")  
[创建支付会话](#Cwfah "创建支付会话")  
[调用createPaymentSession API的示例代码](#3L7zQ "调用createPaymentSession API的示例代码")  
[常见问题解答](#niSqk "常见问题解答")  
[请求中可以使用中文字符吗？](#Xz79a "请求中可以使用中文字符吗？")  
[如何设置支付结果通知地址？](#9JAyd "如何设置支付结果通知地址？")  
[步骤2：创建并调用SDK](#db6T7 "步骤2：创建并调用SDK")  
[安装](#JmurT "安装")  
[实例化SDK](#KQO5X "实例化SDK")  
[调用SDK](#OXd8h "调用SDK")  
[显示支付结果](#9tXGT "显示支付结果")  
[重定向支付](#bj20g "重定向支付")  
[非重定向支付](#NG8h1 "非重定向支付")  
[步骤3：获取支付结果](#Mo7TZ "步骤3：获取支付结果")  
[接收异步通知](#WDV7j "接收异步通知")  
[常见问题解答](#V1F5v "常见问题解答")  
[查询结果](#pCGDb "查询结果")  
[常见问题解答](#tkpZO "常见问题解答")  
[示例代码](#OV6gg "示例代码")  
[事件代码](#OlIKO "事件代码")
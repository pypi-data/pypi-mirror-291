Server-to-server mode | Checkout Payment | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fcashierpay%2Fcardinfocallmerchant)

[Go to Homepage](../../)

Checkout Payment

[Overview](/docs/ac/cashierpay/overview)

Accept payments

SDK integration

API-only integration

[APM paymentsAPM](/docs/ac/cashierpay/apm_api)

Card paymentsCard

[Hosted mode](/docs/ac/cashierpay/cardcollant)

[Server-to-server mode](/docs/ac/cashierpay/cardinfocallmerchant)

After payments

Payment methods

Other resources

Advanced features

[Pre-front solutionAPI](/docs/ac/cashierpay/prefront)

[Buy now pay laterAPI](/docs/ac/cashierpay/bnpl)

[Card vaultingAPI](/docs/ac/cashierpay/cv)

[Card vaultingSDK](/docs/ac/cashierpay/cvsdk)

[Card payment featuresAPISDK](/docs/ac/cashierpay/mf?pageVersion=7)

Server-to-server mode
=====================

2024-05-11 10:13

This article describes how to integrate card payment methods through the server-to-server mode, which is suitable for merchants who have high requirements for the degree of customization of the payment process.

The server-to-server integration mode requires that you are PCI qualified. Provide the following materials to complete verification according to business requirements:

*   If your annual card transaction volume is expected to exceed 6 million, complete and submit the [PCI Attestation of Compliance (AoC)](https://docs-prv.pcisecuritystandards.org/PCI%20DSS/Reporting%20Template%20or%20Form/PCI-DSS-v4-0-ROC-AOC-Merchants-r1.pdf) file for verification.
*   If your annual card transaction volume is expected to be below 6 million, complete and submit the [PCI DSS Self-Assessment Questionnaires (SAQs)](https://docs-prv.pcisecuritystandards.org/SAQ%20\(Assessment\)/SAQ/PCI-DSS-v4-0-SAQ-D-Merchant-r1.pdf) file for verification.

For more information about PCI DSS compliance requirements, see [PCI DSS standard](https://www.pcisecuritystandards.org/).

User experience
===============

The following figures show the user experience in the first-time and saved card payments.

First-time payments
-------------------

Web

App

### Web user experience

![Image 3: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902305943-6fc9c937-0cbf-4544-a0a8-101c879af48f.png)

### App user experience

![Image 4: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902321825-2c7816ee-f13d-4a57-b074-635b2957023d.png)

EAOEITAAAEA

WAITFORAWHILE,DONOTCLOEETHEBROWERORTRETRESH

42424242424

宁CREDITANDDEBITCARD

USD42.00

RW42.00

USD42.00

CHECKORDERS

CHECKOUT

BACKTOHOME

DDBEREE

FREESHIPPING

WOMENPLAIDTOR

EAL:7USDOFF

ALIPAY-

USD42.00

AOUEOAO

SS品O

USD4200

VERIFYLINFORME

CHECKOUT

ALIPAY-

USD000

DINFORMATIO

MERCHANT:TC

\_JPAYMENTMET

PAYMENTRE

5B49007U50

BI1ONOXXXX5205

Saved card payments
-------------------

Web

App

### Web user experience

![Image 5: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902366698-1e9938ff-89c7-452f-bac3-8bd9a06b9b73.png)

### App user experience

![Image 6: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902382786-17b03f22-4738-4378-afa6-821149c9ed57.png)

ATOAHIEAONOTALOEEEIETETEE

CREDITANDDEBITCARD

\[\_\]PAYMENTMETHODNAM

EE

RCHANTDEAL:7USDOFF

USD42.00

SD42.00

CARDNUMBEF

CHECKORDERS

WNOMENPLAID

PAYMENTSUCCES

FREESHIPPNG

128.00THB

EXPIRYDATE

U5D4200

ALIPAY-

S品

VERIFYINFORMAT

USD42.00

EEA

4MMM-M

USD0.00

CHEEKOUT

GLOBALCE

LIPAY

Payment flow
============

For card payments with the server-to-server mode, the payment flow is composed of the following steps:

![Image 7: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902415977-e2827dcd-8c63-48c3-9adf-f93730a40b0a.png)

1.  **The buyer enters the checkout page.**

1.  **Create the** [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) **request**  
    After the buyer selects a payment method and submits the order, call the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to obtain the payment link to complete the payment.
2.  **Handle the payment continuation URL**  
    The payment continuation URL is to be returned to the client. You need to redirect the buyer to the payment continuation URL. The payment continuation URL proceeds the payment process with different operations based on the characteristics of payment methods, such as collecting information, redirecting users, invoking the app, displaying QR codes, and performing verifications.
3.  **Get the payment result**  
    Obtain the payment result using one of the following two methods:

*   Asynchronous notification: Specify the _paymentNotifyUrl_ in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to set the address for receiving asynchronous notifications. When the payment is successful or expires, Antom uses [**notifyPayment**](https://global.alipay.com/docs/ac/cashierpay/overview) to send asynchronous notifications to you.
*   Synchronous inquiry: Call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment status.

5.  **Get the capture result**  
    For card payments, you need to obtain the capture result using one of the following two methods:

*   Asynchronous notification: Specify _paymentNotifyUrl_ in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API to set the address for receiving asynchronous notifications. When the payment request is successful or expires, Antom uses [**notifyCapture**](https://global.alipay.com/docs/ac/ams/notify_capture) to send asynchronous notifications to you.
*   Synchronous inquiry: Call the [**inquiryPayment**](https://global.alipay.com/docs/ac/ams/paymentri_online) API to check the payment request status.

Integration steps
=================

Start your integration by taking the following steps:

1.  (Optional) Display payment methods
2.  Authorize payment
3.  Obtain the pre-authorized payment results
4.  Capture
5.  Obtain the capture results

Step 1: (Optional) Display payment methods Client-side
------------------------------------------------------

Add the logo and name of the payment methods to be integrated to the payment method list on the payment page for buyers to select. You can obtain the logo and name in one of the following two ways:

*   Contact Antom Technical Support to obtain.
*   Call the **consult** API to obtain the payment methods and logo URL supported by the current transactions based on the currency, transaction initiation terminal type, buyer region, and contracted payment methods.

The following figure shows the page effect after adding a payment method:

![Image 8: image.png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1712902513132-aeb76ae1-db5d-4b99-9151-3145a3bd0a75.png)

Step 2: Authorize payment Server-side
-------------------------------------

When the buyer selects a payment method provided by Antom, the card information collection page is displayed for the buyer. During this process, you need to collect the buyer's card, environment, and order information. Call the **pay** API, and submit an authorization request for payment.

### Initiate a payment request Server-side

Antom provides server-side API libraries for multiple languages. The following code uses Java as an example. You need to install Java 6 or higher.

#### Install an API library

You can find the latest version on [GitHub](https://github.com/alipay/global-open-sdk-java).

copy

    <dependency>
      <groupId>com.alipay.global.sdk</groupId>
      <artifactId>global-open-sdk-java</artifactId>
      <version>2.0.21</version>
    </dependency>

#### Initialize the request instance

copy

    String merchantPrivateKey = "YOUR PRIVATE KEY";
    String alipayPublicKey = "ALIPAY PUBLIC KEY"
    AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
                    merchantPrivateKey, alipayPublicKey);

#### Create a payment request

When sending a request for the **pay** API, you can also choose the following features according to your business needs:

*   **Enable 3D authentication**: Specify the value of _is3DSAuthentication_ in the **pay** API to set whether the transaction is authenticated by using 3D Secure.
*   **Salvage transaction intelligently**: Automatically initiate a 3D Secure authentication for a non-3D Secure transaction if required by the card issuer to salvage a failed transaction.
*   **Value-added risk control services**: Antom provides upgraded risk control services at a transaction level, and intelligently decides risk control strategies based on the risk level of a transaction.
*   **Address Verification System (AVS) service**: This service verifies whether the provided billing address matches the cardholder's address on record at the issuing bank. AVS helps to prevent fraudulent transactions.
*   **Store card info**: Obtain the buyer's agreement to store card information at the first payment, so that the card information does not need to be entered again for the next payment.
*   **Merchant-initiated transactions (MIT)**: Initiate scheduled or unscheduled transactions without buyer involvement.
*   **Specify card brand**: When the buyer chooses co-badged card payment, you can specify the card brand or the region where the card is authorized for payment.
*   **MPI capability**: The merchant prioritizes the third-party verification before the transaction is initiated, passes in the verification result information in the payment request, and specifies non-3D verification, which is not available if the merchant does not capture the card information.
*   **Installment payments**: When making a payment, buyers can choose the installment payment method and make regular payments for each installment period. After the buyer completes the payment for the initial installment period, Antom settles the full order amount based on the settlement period specified in the contract.

The following parameters are included in the payment request.

<table style="width:750px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="211" span="1"><col width="99" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3e05a0bed9337de5ae8d9ffa4c2c9b9d" id="ue38567b6" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">Parameter name</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="9c98ab97255b664a127ee4ba96e1e2d3" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">Is required?</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="8066ff6bb7a67986cd6a6682708a3285" id="u71019669" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">Description</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="03328c85dcdf47a6d71fd76292b07643" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">productCode</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="31127d7ad86d06636175fe2b55c9cee2" id="u64d89bd7" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="a215174a4d6a3c801616d7e805378207" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The value is fixed as <code style="font-family:monospace;font-size:inherit;background-color:rgba(0, 0, 0, 0.06);padding:0px 2px;border:1px solid rgba(0, 0, 0, 0.08);border-radius:2px;line-height:inherit;overflow-wrap:break-word;text-indent:0px">CASHIER_PAYMENT</code>.in this scenario.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="63261582422b41bfd49f89ea71979c13" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentRequestId</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="8c350ab920ed3b6b62b66b9d015a97ce" id="uae780e8b" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="a968049ada593dcc9851d1b4aa7eca5c" id="uf550ad27" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The unique ID assigned by a merchant to identify a payment request.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="0644a0009e0b859b182a165ab5110c08" id="ub8894523" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentAmount</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="618e1977a66095be5f9320995b14d86f" id="u027c1a27" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="56bc8368a8aeb5db9ff5c90cf46d19a5" id="uf2ff8680" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The payment amount that the merchant requests to receive in the order currency.</p></td></tr><tr style="height:37px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c81273fc89bce3ef609c08f8a63d4458" id="u0f63f2e6" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentMethod</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="9efd69ca2ed32fa2d4df1c0dbc4dce39" id="uf6d71146" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="0c2d83e11c97bc4139a738438e6591d5" id="u148c1f8b" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The payment method that is used to collect the payment by the merchant or acquirer.</p></td></tr><tr style="height:63px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="bba9b55984226f34031ed3f5863c1999" id="ua9c8c8d1" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentRedirectUrl</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="44786eeef9ca8804980a56419c43fa6c" id="u402023f5" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="59b32cefad200c98be32e92c5ea8893d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The merchant page URL that the buyer is redirected to after the payment is completed.</p></td></tr><tr style="height:37px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="4066c0ab16d7e5f6d1e1fcf20ffd3925" id="u393bb337" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">settlementStrategy</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="65a0a36a1646d5fdb4618a12e6e4c558" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">No</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="965a5afc7f2ded6ea2e105d2c3d67e5c" id="u3d53147f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The settlement strategy for the payment request.</p></td></tr><tr style="height:37px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="5e6661f08779b22906aaf6fd9518c853" id="u1034cc2d" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">order</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="fc96a438dc1b826d6ba02f7ffc19a4bc" id="ued414d21" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c2d34d2bcc0bbc3e0befb1ba50c78ab6" id="u0bd8b4db" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The order information, such as buyer, merchant, goods, amount, shipping information, and purchase environment.</p></td></tr><tr style="height:37px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="73491513bd8a844d2ea6852a252025d3" id="u923c3510" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">paymentMethodMetaData</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="56a1a51ad66a369ddebba40d55fbe6f2" id="u959a4e54" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="e69877f365bf10d60380245b711314a9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Card element information: <em>cardNo, cvv, expiryYear, expiryMonth, cardholderName, billingAddress</em>.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f82f65c0d89c0a68b3a4d52706de4b02" id="u363373ac" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em><span style="color:#333333">env</span></em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="4895cc598f0d069db5b1cbb614ba54eb" id="u560487d5" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:#333333">Yes</span></p></td><td style="text-align:left;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1fbe3578b2743bd63f9f367ebe490af8" id="u18186291" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Environmental information: used to improve payment success rate</p></td></tr></tbody></table>

For more information about the whole parameters, refer to [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API.

##### Sample codes of calling the pay API

The following sample code is used for initiating a payment:

copy

      AlipayPayRequest alipayPayRequest = new AlipayPayRequest();
      alipayPayRequest.setClientId(CLIENT_ID);
      alipayPayRequest.setPath("/ams/sandbox/api/v1/payments/pay");
      alipayPayRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);
    
      // replace to your paymentRequestId
      alipayPayRequest.setPaymentRequestId("paymentRequestId01");
    
      // set amount
      Amount amount = new Amount();
      amount.setCurrency("SGD");
      amount.setValue("4200");
      alipayPayRequest.setPaymentAmount(amount);
    
      // set paymentMethod
      PaymentMethod paymentMethod = new PaymentMethod();
      paymentMethod.setPaymentMethodType("CARD");
      alipayPayRequest.setPaymentMethod(paymentMethod);
    
      //if merchant collect card info, set card info in this paymentMethodMetaData
      Map<String, Object> paymentMethodMetaData = new HashMap<String, Object>();
      paymentMethodMetaData.put("cardNo", "4054695723100768");
      paymentMethodMetaData.put("cvv", "712");
      paymentMethodMetaData.put("expiryMonth", "06");
      paymentMethodMetaData.put("expiryYear", "28");
      paymentMethodMetaData.put("tokenize", false);
      JSONObject cardholderName = new JSONObject();
      cardholderName.put("firstName", "Alan");
      cardholderName.put("lastName", "Wallex");
      paymentMethodMetaData.put("cardholderName", cardholderName);
      paymentMethod.setPaymentMethodMetaData(paymentMethodMetaData);
    
    
      // set order Info
      Order order = new Order();
      order.setReferenceOrderId("3232db07-91f7-4364-85bc-829a4c1c653f");
      order.setOrderDescription("antom test order");
      order.setOrderAmount(amount);
      Buyer buyer = new Buyer();
      buyer.setReferenceBuyerId("yourBuyerId");
      order.setBuyer(buyer);
      order.setOrderAmount(amount);
      alipayPayRequest.setOrder(order);
    
      //set env Info
      Env env = new Env();
      env.setTerminalType(TerminalType.WEB);
      env.setClientIp("114.121.121.01");
      alipayPayRequest.setEnv(env);
      order.setEnv(env);
    
      // set auth capture payment mode
      PaymentFactor paymentFactor = new PaymentFactor();
      paymentFactor.setAuthorization(true);
      alipayPayRequest.setPaymentFactor(paymentFactor);
    
      // replace to your notify url
      alipayPayRequest.setPaymentNotifyUrl("http://www.yourNotifyUrl.com");
    
      // replace to your redirect url
      alipayPayRequest.setPaymentRedirectUrl("http://www.yourRedirectUrl.com");
    
      //do the Payment
      AlipayPayResponse alipayPayResponse = null;
      try {
          alipayPayResponse = defaultAlipayClient.execute(alipayPayRequest);
      } catch (AlipayApiException e) {
          String errorMsg = e.getMessage();
          // handle error condition
      }

The following code shows a sample of the request message:

copy

    {
        "paymentNotifyUrl": "http://www.yourNotifyUrl.com",
        "paymentRequestId": "paymentRequestId01",
        "env": {
            "terminalType": "WEB",
            "clientIp": "114.121.121.01"
        },
        "paymentAmount": {
            "currency": "SGD",
            "value": "4200"
        },
        "productCode": "CASHIER_PAYMENT",
        "paymentRedirectUrl": "http://www.yourRedirectUrl.com",
        "paymentFactor": {
            "isAuthorization": true
        },
        "paymentMethod": {
            "paymentMethodMetaData": {
                "cvv": "712",
                "cardholderName": {
                    "firstName": "Alan",
                    "lastName": "Wallex"
                },
                "expiryMonth": "06",
                "expiryYear": "28",
                "cardNo": "4054695723100768"
            },
            "paymentMethodType": "CARD"
        },
        "order": {
            "orderAmount": {
                "currency": "SGD",
                "value": "4200"
            },
            "referenceOrderId": "3232db07-91f7-4364-85bc-829a4c1c653f",
            "env": {
                "terminalType": "WEB",
                "clientIp": "114.121.121.01"
            },
            "orderDescription": "antom test order",
            "buyer": {
                "referenceBuyerId": "yourBuyerId"
            }
        }
    }

#### FAQs

##### **How to set the value of** _**terminalType**_**?**

If the buyer initiates a transaction from PC, the _terminalType_ needs to be specified as `WEB`.

##### Can Chinese characters be used in the request?

Do not use Chinese characters in the request field to avoid incompatible payment methods, such as QRIS and Mastercard.

##### How to set the payment result notification address？

Antom will send the payment result through the [**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online), which you can specify in the **pay** API via the _paymentNotifyUrl_ parameter. If the address of each payment is the same, you can also configure it in the Antom Dashboard. If you have configured the address and set the parameter in the API, Antom will use the address set in the API.

### Receive a payment response

The returned parameters contain the following content:

*   _normalUrl_: Redirect URL address.
*   _paymentId_: Order ID.

The following code is the sample response:

Successful authorized payment

Failed authorized payment

Authorized payments are not final

##### Successful authorization

copy

    {
        "paymentAmount": {
            "currency": "SGD",
            "value": "4200"
        },
        "paymentCreateTime": "2021-11-12T01:27:50-08:00",
        "paymentId": "20211112194010800100188570271832381",
        "paymentRequestId": "paymentRequestId01",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456"
        },
        "result": {
            "resultCode": "SUCCESS",
            "resultMessage": "success.",
            "resultStatus": "S"
        }
    }

##### Failed authorization

copy

    {
        "paymentAmount": {
            "currency": "SGD",
            "value": "4200"
        },
        "paymentCreateTime": "2021-11-12T01:27:50-08:00",
        "paymentId": "20211112194010800100188570271832381",
        "paymentRequestId": "paymentRequestId01",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456"
        },
        "result": {
            "resultCode": "ACCESS_DENIED",
            "resultMessage": "Access is denied.",
            "resultStatus": "F"
        }
    }

##### Processing authorization

copy

    {
      "result": {
        "resultStatus": "U",
        "resultCode": "PAYMENT_IN_PROCESS",
        "resultMessage": "payment in process"
      },
      "normalUrl": "https://pgw-ui.2c2p.com/payment/4.1/ant/#/token/kSAops9Zwhos8hSTSeLTUchuUa9%2bFg0EHv0XtS%2bTyCt8%2f1qy%2fDZCW88dV9FH3Yh8pEobKvOj%2fsh6nbH95mDRORzWy%2bsBbFh541I7QzVolYBEzeYnLiTC6lP2hjCAwadc",
      "paymentId": "20221111194010890100111650285726898",
      "paymentRequestId": "paymentRequestId01",
      "redirectActionForm": {
        "redirectUrl": "https://pgw-ui.2c2p.com/payment/4.1/ant/#/token/kSAops9Zwhos8hSTSeLTUchuUa9%2bFg0EHv0XtS%2bTyCt8%2f1qy%2fDZCW88dV9FH3Yh8pEobKvOj%2fsh6nbH95mDRORzWy%2bsBbFh541I7QzVolYBEzeYnLiTC6lP2hjCAwadc",
        "method": "GET"
      },
      "paymentAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "paymentCreateTime": "2022-11-10T18:47:20-08:00"
    }

#### FAQs

##### What is the normalUrl?

For web transactions, Antom returns _normalUrl_, which the merchant server needs to pass to the merchant client for redirection. When you initiate payment for the same order again, you need to obtain a new _normalUrl_ for redirection.

##### What is the paymentId？

If you store the corresponding order number for subsequent refunds and reconciliations, you can specify the _paymentId_.

### Redirect to the payment continuation URL Client-side

The merchant server passes the _normalUrl_ to the front-end, and the front-end page handles the redirection process to _normalUrl_.

Step 3: Obtain the pre-authorized payment results Server-side
-------------------------------------------------------------

When the buyer completes the payment or the payment times out, you can get the corresponding payment result from the Antom asynchronous notification or by inquiring the payment result actively.

The response obtained from asynchronous notifications and **inquiryPayment** contains the authorization payment result as well as other key information such as:

<table style="width:811px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="142" span="1"><col width="147" span="1"><col width="141" span="1"><col width="131" span="1"><col width="250" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1c6456cde8eda1f0549b05d85cefe8c1" id="ua1ba3adb" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>API</strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="b471fdd5af35a9d659405241f1135d80" id="u91e46072" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>Authorization result</strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="2cc5a4dd2352abd85e1bf089197cf0bb" id="u1f7c97cd" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>AVS info</strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="55366d5c1db9eb0e501d8d7c4ce320d9" id="ub7a28bea" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>CVV info</strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="60c625ca3aa6a59ce9239f958d86445a" id="ubcec2751" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>3DS authentication info</strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3877ba4e1d9673dda4cedeadae630858" id="u02984850" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">notifyPayment</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f2e5d3d5785fff7652dda5c2615623d2" id="u6510f393" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">resultStatus</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="5422d7be2f45915cf7c393b41587b9a4" id="ue84375d2" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">avsResultRaw</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="0050b8d97195712b8b4e9da72021f2dc" id="u37ce820c" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">cvvResultRaw</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="81f382f370fde664babba3037d31bc27" id="uf7982dc6" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">threeDSResult (only available for the 3DS authentication authorization)</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3ffc681f5596187f8235755724806388" id="u532dd2bd" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">inquiryPayment</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="98d878162a7aa86bbf568290c3b91479" id="u2edc7685" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">paymentStatus</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f9c2447b8a513a2d61a7393d35004652" id="u01109f6a" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">avsResultRaw</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="6066aa9e44fe209bd107c75ada3f1e6d" id="ueecd131f" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">cvvResultRaw</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="34119a8b3b1e9e464a5a32408597b0da" id="ub39e51f4" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">threeDSResult (only available for the 3DS authentication authorization)</p></td></tr></tbody></table>

### Asynchronous notifications

When a payment is completed or fails, Antom sends an asynchronous notification ([**notifyPayment**](https://global.alipay.com/docs/ac/ams/paymentrn_online)) to the address that you specified in the **pay** API via the _paymentNotifyUrl_ parameter. If the address of each payment is the same, you can also configure the address in Antom Dashboard.

The following sample code shows a notification for a 3D payment:

copy

    {
        "notifyType": "PAYMENT_RESULT",
        "result": {
            "resultCode": "SUCCESS",
            "resultStatus": "S",
            "resultMessage": "success"
        },
        "paymentRequestId": "paymentRequestId01",
        "paymentId": "2020010123456789XXXX",
        "paymentAmount": {
            "value": "4200",
            "currency": "SGD"
        },
        "paymentCreateTime": "2020-01-01T12:01:00+08:30",
        "paymentTime": "2020-01-01T12:01:01+08:30",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456",
            "threeDSResult": {
                "eci": "02",
                "threeDSVersion": "2.2.0",
                "caav": "cavvSample",
                "dsTransactionId": "sample_dsTranasctionId"
            }
        }
    }

The following sample code shows a notification for a non-3D payment:

copy

    {
        "notifyType": "PAYMENT_RESULT",
        "result": {
            "resultCode": "SUCCESS",
            "resultStatus": "S",
            "resultMessage": "success"
        },
        "paymentRequestId": "paymentRequestId01",
        "paymentId": "2020010123456789XXXX",
        "paymentAmount": {
            "value": "4200",
            "currency": "SGD"
        },
        "paymentCreateTime": "2020-01-01T12:01:00+08:30",
        "paymentTime": "2020-01-01T12:01:01+08:30",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456"
        }
    }

The following is the code that verifies and returns the notification:

copy

    @RequestMapping(path = "/payResult", method = RequestMethod.POST)
    public ResponseEntity<AlipayResponse> paymentNotifyProcessor(HttpServletRequest request,
                                                                 @RequestBody String body) {
    
        // retrieve the required parameters from the request header.
        String requestTime = request.getHeader("request-time");
        String clientId = request.getHeader("client-id");
        String rawSignature = request.getHeader("signature");
        String signature = "";
    
        // get valid part from raw signature
        if(rawSignature==null||rawSignature.isEmpty()){
            throw new RuntimeException("empty notify signature");
        }else {
            String[] parts = rawSignature.split("signature=");
            if (parts.length > 1) {
                signature = parts[1];
            }
        }
    
        // verify payment result notify's signature
        boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
                clientId, requestTime, body, signature,
                ALIPAY_PUBLIC_KEY);
        if (!verifyResult) {
            throw new RuntimeException("Invalid notify signature");
        }
    
        // update the record status with notify result
    
        // respond the server that we accept the notify
        Result result = new Result("SUCCESS", "success", ResultStatusType.S);
        AlipayResponse response = new AlipayResponse();
        response.setResult(result);
        return ResponseEntity.ok().body(response);
    }

#### FAQs

##### When will the notification be sent?

After the payment is completed, Antom will send the asynchronous notification to you in 3~5s. If the payment is not completed, you need to wait for Antom to close the order before sending the asynchronous notification. The time to close the order is different for different payment methods, generally the default is 14 minutes.

##### Will the asynchronous notification be re-sent?

If you receive an asynchronous notification from Antom, you are required to return the response in the [Sample code](https://global.alipay.com/docs/ac/cashier_payment_cn/notification) format. If you do not respond to the asynchronous notification as required, or the asynchronous notification is not delivered due to network reasons, the notification will be automatically resent within 24 hours. The notification can be resent up to 8 times or until a correct response is received to terminate delivery. The sending intervals are as follows: 0 minutes, 2 minutes, 10 minutes, 10 minutes, 1 hour, 2 hours, 6 hours, and 15 hours.

##### Do I need to countersign the response?

If you receive an asynchronous notification from Antom, you are required to return the response in the [Sample code](https://global.alipay.com/docs/ac/cashier_payment_cn/notification) format, but you do not need to countersign the response.

##### How do I understand the meaning of the following key fields?

*   _result_: Indicates the payment result of the order.
*   _paymentRequestId_: Indicates the payment request number you generated for consult, cancel, and reconciliation.
*   _paymentId_: Indicates the payment order number generated by Antom, used for refund and reconciliation.
*   _paymentAmout_: Indicates the payment amount.

### Inquire about the payment result

Initiating a query request will involve the following parameters.

<table style="width:784px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="211" span="1"><col width="133" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="9f60d92cb91d21c51d896a914aca3bf5" id="ud2eea623" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">Parameter name</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="b84e77b02f24ccc7defb29c7ddf3e092" id="uf17d3dbd" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">is required?</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="9b1389a1e66b777e2a293ab7f502babc" id="u7aa93d8a" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span style="color:#20304C">Description</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="66692ba6b8da904afc194311e1cc59d2" id="u8c7b1b2d" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRequestId</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3337973d7cf4e3b134327fd09162e7f1" id="u76f7c8a3" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>No</span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f06d1b9db2c014e0ad1ce6e4b1fcabdf" id="u4793d7b4" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The payment request number generated by the merchant</p></td></tr></tbody></table>

The following is the sample code when calling the **inquiryPayment** API:

copy

    AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
            merchantPrivateKey, alipayPublicKey);
    
    AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
    alipayPayQueryRequest.setClientId(CLIENT_ID);
    alipayPayQueryRequest.setPath("/ams/api/v1/payments/inquiryPayment");
    alipayPayQueryReuqest.setPaymentRequestId("paymentRequestId01");
    
    AlipayPayQueryResponse alipayPayQueryResponse;
    try {
        alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
    } catch (AlipayApiException e) {
        String errorMsg = e.getMessage();
        // handle error condition
    }

The following code shows a sample of the request message:

copy

    {
      "paymentRequestId": "paymentRequestId01"
    }

The following code shows a sample of the response message for a 3D payment:

copy

    {
        "result": {
            "resultCode": "SUCCESS",
            "resultStatus": "S",
            "resultMessage": "Success"
        },
        "paymentStatus": "SUCCESS",
        "paymentRequestId": "paymentRequestId01",
        "paymentId": "2019060811401080010018882020035XXXX",
        "paymentAmount": {
            "value": "4200",
            "currency": "SGD"
        },
        "paymentCreateTime": "2019-06-01T12:01:01+08:30",
        "paymentTime": "2019-06-01T12:01:01+08:30",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456",
            "threeDSResult": {
                "eci": "02",
                "threeDSVersion": "2.2.0",
                "caav": "cavvSample",
                "dsTransactionId": "sample_dsTranasctionId"
            }
        }
    }

The following code shows a sample of the response message for a non-3D payment:

copy

    {
        "result": {
            "resultCode": "SUCCESS",
            "resultStatus": "S",
            "resultMessage": "Success"
        },
        "paymentStatus": "SUCCESS",
        "paymentRequestId": "paymentRequestId01",
        "paymentId": "2019060811401080010018882020035XXXX",
        "paymentAmount": {
            "value": "4200",
            "currency": "SGD"
        },
        "paymentCreateTime": "2019-06-01T12:01:01+08:30",
        "paymentTime": "2019-06-01T12:01:01+08:30",
        "paymentResultInfo": {
            "avsResultRaw": "A",
            "cvvResultRaw": "Y",
            "networkTransactionId": "sampleNetworkTransactionId123456"
        }
    }

#### FAQs

##### How do I understand the meaning of the following key fields?

*   _result_: Represents the result of this **inquiryPayment** API call, the result of the order needs to be judged according to _paymentStatus_, `SUCCESS` and `FAIL` represent the final result, `PROCESSING` represents the processing.
*   _paymentAmout_: Indicates the payment amount.

##### How often is it initiated?

It is recommended to initiate a round-robin query at an interval of 2 seconds, and you can initiate a round poll after initiating the **pay** API until the final payment result is queried or an asynchronous payment result notification is received.

Step 4: Capture Server-side
---------------------------

By default, Antom automatically handles funds capture for you. If you specify the value of _paymentFactor.captureMode_ to `MANUAL` when calling the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API, you must capture the funds of the payment by calling the [**capture**](https://global.alipay.com/docs/ac/ams/capture) API.

*   **Automatic capture**: Antom automatically captures funds immediately after the buyer authorizes the payment. The capture result is then communicated to you via an asynchronous notification. Automatic capture is activated when one of the following conditions is met:

*   You set the value of _paymentFactor.captureMode_ in the **pay** API to `AUTOMATIC`.
*   You leave the value of _paymentFactor.captureMode_ in the **pay** API empty or you do not pass in this parameter.

*   **Manual capture**: You must initiate fund capture by calling the **capture** API within seven days after successful authorization, otherwise Antom automatically unfreezes the authorized funds of the payment. The total capture amount must be equal to the total authorized amount.

> **Note**: For card payments, it is recommended to confirm the successful capture result before shipping.

The key request parameters in the **capture** API are shown in the following table:

<table style="width:671px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="198" span="1"><col width="473" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="d65e98d9496e4bc6916d4ddf5880f736" id="ud8e2feba" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>Parameter</strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="7c32f6411c31ecc8cd28341f5330a6bc" id="u507b914a" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong>Description</strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="2f18eb909f3e2441ec77445f2c836e5c" id="u8e9c9231" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>captureRequestId</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="d9fe05d23c6c671ff28cc2c8cac0a9b3" id="u52f6c738" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">A unique identifier that you assign to a capture request.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="62bc9dcbf1d01d4c96409e1dcbd783a8" id="u7ce94883" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentId</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="67da0845041d122a35ba3dfba1775f08" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">A unique identifier that Antom assigns to an order.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="587d9104564863976674b5db3e3ec85d" id="ub118aa6a" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>captureAmount</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="d00ce5ba6fc7114bde9ee25fd102881c" id="uc594543a" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The capture amount, which must be equal to the total authorized amount.</p></td></tr></tbody></table>

The following is a sample code and packet for initiating a payment.

copy

    AlipayCaptureRequest alipayCaptureRequest = new AlipayCaptureRequest();
    alipayCaptureRequest.setPath("/ams/sandbox/api/v1/payments/capture");
    alipayCaptureRequest.setClientId(CLIENT_ID);
    
    Amount amount = new Amount();
    amount.setCurrency("SGD");
    amount.setValue("4200");
    alipayCaptureRequest.setCaptureAmount(amount);
    
    alipayCaptureRequest.setCaptureRequestId("captureRequestId01");
    alipayCaptureRequest.setPaymentId("2019060811401080010018882020035XXXX");
    
    AlipayCaptureResponse alipayCaptureResponse= null;
    
    try{
        alipayCaptureResponse = defaultAlipayClient.execute(alipayCaptureRequest);
    }catch (AlipayApiException e){
        String errorMsg = e.getMessage();
    }

The following code shows a sample of the response message:

copy

    {
        "paymentId": "2019060811401080010018882020035XXXX",
        "captureRequestId": "captureRequestId01",
        "captureAmount": {
            "currency": "SGD",
            "value": "4200"
        }
    }

Step 5: Obtain the capture results Server-side
----------------------------------------------

When the buyer completes the capture or the capture times out, you can get the corresponding payment result from the Antom asynchronous notification or by inquiring the payment result actively.

### Asynchronous notifications

When a payment is completed or fails, Antom sends an asynchronous notification via [**notifyCapture**](https://global.alipay.com/docs/ac/ams/notify_capture). You can specify in the **pay** API via the _paymentNotifyUrl_ parameter. If the address of each payment is the same, you can also configure it in the Antom Dashboard.

The following is the notification request sample code:

copy

      "captureAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "notifyType": "CAPTURE_RESULT",
      "captureId": "2022XXXXXXX",
      "captureRequestId": "captureRequestId01",
      "captureTime": "2022-11-10T00:34:52-08:00",
      "paymentId": "2022XXXXXXX",
      "result": {
        "resultCode": "SUCCESS",
        "resultMessage": "success.",
        "resultStatus": "S"
      }
    }

The following code is a notification sample of a failed payment:

copy

      "captureAmount": {
        "currency": "SGD",
        "value": "4200"
      },
      "notifyType": "CAPTURE_RESULT",
      "captureId": "2022XXXXXXX",
      "captureRequestId": "captureRequestId01",
      "captureTime": "2022-11-10T00:34:52-08:00",
      "paymentId": "2022XXXXXXX",
      "result": {
        "resultCode": "PROCESS_FAIL",
        "resultMessage": "fail.",
        "resultStatus": "F"
      }
    }

The following is the code that verifies and returns the notification:

copy

    @RequestMapping(path = "/captureResult", method = RequestMethod.POST)
    public ResponseEntity<AlipayResponse> captureNotifyProcessor(HttpServletRequest request,
                                                                 @RequestBody String body) {
    
        // retrieve the required parameters from the request header.
        String requestTime = request.getHeader("request-time");
        String clientId = request.getHeader("client-id");
        String rawSignature = request.getHeader("signature");
        String signature = "";
    
        // get valid part from raw signature
        if(rawSignature==null||rawSignature.isEmpty()){
            throw new RuntimeException("empty notify signature");
        }else {
            String[] parts = rawSignature.split("signature=");
            if (parts.length > 1) {
                signature = parts[1];
            }
        }
    
        // verify payment result notify's signature
        boolean verifyResult = SignatureTool.verify(request.getMethod(), request.getRequestURI(),
                clientId, requestTime, body, signature,
                ALIPAY_PUBLIC_KEY);
        if (!verifyResult) {
            throw new RuntimeException("Invalid notify signature");
        }
    
        // update the record status with notify result
    
        // respond the server that we accept the notify
        Result result = new Result("SUCCESS", "success", ResultStatusType.S);
        AlipayResponse response = new AlipayResponse();
        response.setResult(result);
        return ResponseEntity.ok().body(response);
    }

#### FAQs

##### When will the notification be sent?

After the payment is completed, Antom will send the asynchronous notification to you in 3~5s. If the payment is not completed, you need to wait for Antom to close the order before sending the asynchronous notification. The time to close the order is different for different payment methods, generally the default is 14 minutes.

##### Will the asynchronous notification be re-sent?

If you receive an asynchronous notification from Antom, you are required to return the response in the [Sample code](https://global.alipay.com/docs/ac/cashier_payment_cn/notification) format. If you do not respond to the asynchronous notification as required, or the asynchronous notification is not delivered due to network reasons, the notification will be automatically resent within 24 hours. The notification can be resent up to 8 times or until a correct response is received to terminate delivery. The sending intervals are as follows: 0 minutes, 2 minutes, 10 minutes, 10 minutes, 1 hour, 2 hours, 6 hours, and 15 hours.

##### Do I need to countersign the response?

If you receive an asynchronous notification from Antom, you are required to return the response in the [Sample code](https://global.alipay.com/docs/ac/cashier_payment_cn/notification) format, but you do not need to countersign the response.

##### How do I understand the meaning of the following key fields?

*   _result_: Indicates the payment result of the order.
*   _notifyType_: `CAPTURE_RESULT`
*   _paymentId_: Indicates the payment order number generated by Antom, used for refund and reconciliation.
*   _acquirerReferenceNo_: For merchants that access card payment in Singapore and Hong Kong, the specific acquiring station number will be notified in the notification.

### Inquire about the payment result

Initiating a query request will involve the following parameters.

<table style="width:784px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="211" span="1"><col width="133" span="1"><col width="440" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="b0796a0d7442e96a601bfbfb5c0bbd03" id="u672634a9" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">Parameter name</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="564296334eb4571513373d014903f035" id="ucf5730e6" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">is required?</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="a4f2d71f71afb01b178ba8a046602387" id="u57f43a79" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" style="color:rgb(32, 48, 76);font-size:14px" data-mce-style="font-size: 11px">Description</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="0c71b3eb9b6e15b07afdf371b72a2045" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>paymentRequestId</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="fa9adf36b1a163cf974094d6227924e0" id="u83891110" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">No</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="b30b272d361fa65f17e8fcc8608e9cbb" id="u9b260877" style="text-align:center;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span style="color:rgba(4, 15, 36, 0.85)">The payment request number generated by the merchant</span></p></td></tr></tbody></table>

The following is the sample code:

copy

      AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG,
              merchantPrivateKey, alipayPublicKey);
    
      AlipayPayQueryRequest alipayPayQueryRequest = new AlipayPayQueryRequest();
      alipayPayQueryRequest.setClientId(CLIENT_ID);
      alipayPayQueryRequest.setPath("/ams/sandbox/api/v1/payments/inquiryPayment");
      alipayPayQueryRequest.setPaymentRequestId("paymentRequestId01");
    
      AlipayPayQueryResponse alipayPayQueryResponse;
      try {
          alipayPayQueryResponse = defaultAlipayClient.execute(alipayPayQueryRequest);
      } catch (AlipayApiException e) {
          String errorMsg = e.getMessage();
          // handle error condition
      }

The following is the request message:

copy

    {
      "paymentRequestId": "paymentRequestId01"
    }

#### Value of capture status

The value of the _transactions_ field in the API response is the capture status:

<table style="width:750px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="375" span="1"><col width="375" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="8d8e3b0d67ab3136f2e9cd7155d78724" id="u7d65a37f" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Parameter</span></strong></p></td><td style="background-color:rgb(212, 238, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="140238a7a7f6ef8fb55c4f171a7bf041" id="ud1da5ae6" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Description</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="380c42fc20296de6d842139f95df9a82" id="u2ea64b24" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>transactions.transationType</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="5ab8446c7296b9abb0ad43a4e7860dcc" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The value is <code style="font-family:monospace;font-size:inherit;background-color:rgba(0, 0, 0, 0.06);padding:0px 2px;border:1px solid rgba(0, 0, 0, 0.08);border-radius:2px;line-height:inherit;overflow-wrap:break-word;text-indent:0px">CAPTURE</code>. It indicates the capture status.</p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="02fdb3e8094cca4dd1b0f59085b7d1db" id="u1a37fc23" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><em>transactions.transactionResult</em></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c1e4d684ba860777f6cfd48fbc67b2eb" id="u132737ce" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The capture result.</p></td></tr></tbody></table>

The value of _transactions_ indicates the capture status. See the following code samples for details:

copy

    {
        "transactions": [
            {
                "transactionType": "CAPTURE",
                "transactionStatus": "SUCCESS",
                "transactionRequestId": "test_test_test_XXXX",
                "transactionAmount": {
                    "currency": "SGD",
                    "value": "4200"
                },
                "transactionId": "2022XXXXXXXX",
                "transactionResult": {
                    "resultStatus": "S",
                    "resultCode": "SUCCESS",
                    "resultMessage": "success"
                }
            }
        ]
    }

The value of _transactions_ indicates the capture status. See the following code samples for a failed capture:

copy

    {
        "transactions": [
            {
                "transactionType": "CAPTURE",
                "transactionStatus": "FAIL",
                "transactionRequestId": "test_test_test_XXXX",
                "transactionAmount": {
                    "currency": "SGD",
                    "value": "4200"
                },
                "transactionTime": "2022-09-29T07:13:50-07:00",
                "transactionId": "2022XXXXXXXX",
                "transactionResult": {
                    "resultStatus": "F",
                    "resultCode": "PROCESS_FAIL",
                    "resultMessage": "General business failure. No retry."
                }
            }
        ]
    }

The value of _transactions_ indicates the capture status. See the following code samples for a capture that is in processing:

copy

    {
        "transactions": [
            {
                "transactionType": "CAPTURE",
                "transactionStatus": "PROCESSING",
                "transactionRequestId": "test_test_test_XXXX",
                "transactionAmount": {
                    "currency": "SGD",
                    "value": "4200"
                },
                "transactionId": "2022XXXXXXXX",
                "transactionResult": {
                    "resultStatus": "U",
                    "resultCode": "PAYMENT_IN_PROCESS",
                    "resultMessage": "payment in process"
                }
            }
        ]
    }

#### **FAQs**

##### How do I understand the meaning of the following key fields?

*   _result_: Represents the result of this **inquiryCapture** API call, the result of the order needs to be judged according to _transactionResult_, `SUCCESS` and `FAIL` represent the final result, `PROCESSING` represents the processing.

##### How often is it initiated?

It is recommended to initiate a round-robin query at an interval of 2 seconds, and you can initiate a round poll after initiating the order **consult** API until the final capture result is queried or an asynchronous capture result notification is received.

Best practice
=============

Follow these best practices to improve integration efficiency.

Customize the payment timeout
-----------------------------

In the checkout payment scenario, the default timeout on the Antom side is 14 mins, and after the payment timeout, the buyer can't continue to pay. To define the timeout time, you can specify through the _paymentExpireTime_ parameter of the **pay** API. After exceeding the specified time, the buyer can not scan the code or log in to the checkout page.

The following sample code shows how to specify the _paymentExpireTime_ parameter in the **pay** API:

copy

    {
      "env": {
        "osType": "ANDROID",
        "terminalType": "APP"
      },
      "order": {
        "orderAmount": {
          "currency": "CNY",
          "value": "1314"
        },
        "orderDescription": "Cappuccino #grande (Mika's coffee shop)",
        "referenceOrderId": "ORDER_0517884936248XXXX"
      },
      "paymentAmount": {
        "currency": "CNY",
        "value": "1314"
      },
      "paymentMethod": {
        "paymentMethodType": "ALIPAY_CN"
      },
      "paymentExpiryTime":"2024-01-20T08:51:06+08:00",
      "paymentNotifyUrl": "https://www.gaga.com/notify",
      "paymentRedirectUrl": "imeituan://",
      "paymentRequestId": "iJ9lsVgTx8pX7qJpvW6rfqEE2Kdv9M3lgL8e1999ydfz52uMSqwvT3qXYw8IFBYt",
      "productCode": "CASHIER_PAYMENT",
      "settlementStrategy": {
        "settlementCurrency": "USD"
      }
    }

It is recommended to set the API timeout to 10s to ensure the success rate of getting a response.

Suggestions on processing logic for merchant results pages
----------------------------------------------------------

1.  **Front-end redirection abnormality**

If the buyer pays successfully, the buyer may not be able to redirect to the _paymentRedirectUrl_ that you specified due to network reasons or the limitations of the payment method itself, and the following two points should be noted in this case:

*   You cannot use the front-end bounce as the basis for determining the success of the payment.
*   If the _paymentRedirectUrl_ of the payment method page fails to redirect to the merchant page, the buyer may manually click the original merchant page. Therefore, in order to avoid the original merchant page manually cutting back to the payment page, leading the buyer to initiate payment of the order again, it is recommended to add a pop-up window for querying the transaction results after redirecting on the original merchant's order page, when the buyer clicks on the pop-up window to display the result of the order, avoiding the payment of the order again.

2.  **Trigger order result query after redirection**

If the merchant side is pulled up after triggering a call to the **inquiryPayment** API, then the following different results are suggested:

*   **Successful payment**: the page will display the content related to the shipment after successful payment;
*   **Payment Failure**: the page displays the payment failure, and it is recommended to guide the re-payment;
*   **Payment processing**: the page displays the landing effect, waits for 3-5s, and at the same time, queries the server-side payment results, if it still does not return successful or failed final results, it is recommended to display the "order processing" or "order management portal to view the final results"; it is not recommended to display the "network processing". If there is still no result, we suggest displaying "order processing" or going to "order management portal for final result".

Payment failed retry
--------------------

For the same order on the merchant side, if the first payment is not completed and the buyer is supported to initiate the payment again, then it is recommended that you follow the integration steps below:

1.  In the payment request, set the _referenceOrderId_ to the order ID and the _paymentRequestId_ to the payment order ID.
2.  When the same order initiates payment again, the order status will be prioritized, and if the payment is successful, the buyer will be shown the "completed payment", and if the payment is not successful, the **pay** API will be called again to get a new _normalUrl_ to redirect. Note that since it is the same order, the _referenceOrderId_ can be kept unchanged, while the corresponding new payment order needs to update the _paymentRequestId_.
3.  The merchant side needs to check that there is only one successful payment order for a merchant order, if there is more than one successful payment order, then it needs to call the **cancel** API to refund the buyer.
4.  For payment methods that do not support refunds, it is recommended to cancel the first payment order before initiating a new payment.

Obtain payment results
----------------------

In order to guarantee the stable acquisition of payment results and avoid the situation where the buyer's payment is completed but you do not get the payment result. It is recommended that you check the payment results at the following stages:

1.  When the merchant payment result page is displayed.
2.  Before shipping to the buyer.
3.  When you receive the Antom reconciliation file.

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 9](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 10](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[User experience](#Ksw2W "User experience")

[First-time payments](#L6Q9L "First-time payments")

[Saved card payments](#yopMY "Saved card payments")

[Payment flow](#N7q25 "Payment flow")

[Integration steps](#nbBeY "Integration steps")

[Step 1: (Optional) Display payment methods](#VTOFD "Step 1: (Optional) Display payment methods")

[Step 2: Authorize payment](#C25pP "Step 2: Authorize payment")

[Initiate a payment request](#vPvsX "Initiate a payment request")

[Install an API library](#TOMt8 "Install an API library")

[Initialize the request instance](#EEPT3 "Initialize the request instance")

[Create a payment request](#5rJJx "Create a payment request")

[FAQs](#AyrQ5 "FAQs")

[Receive a payment response](#be8ll "Receive a payment response")

[FAQs](#ERqSs "FAQs")

[Redirect to the payment continuation URL](#e3v5s "Redirect to the payment continuation URL")

[Step 3: Obtain the pre-authorized payment results](#R8LWX "Step 3: Obtain the pre-authorized payment results")

[Asynchronous notifications](#PMBUH "Asynchronous notifications")

[FAQs](#GpTIJ "FAQs")

[Inquire about the payment result](#rWbYT "Inquire about the payment result")

[FAQs](#nBDHL "FAQs")

[Step 4: Capture](#izoQV "Step 4: Capture")

[Step 5: Obtain the capture results](#YgG79 "Step 5: Obtain the capture results")

[Asynchronous notifications](#o77OU "Asynchronous notifications")

[FAQs](#N5Lap "FAQs")

[Inquire about the payment result](#xrFse "Inquire about the payment result")

[Value of capture status](#q3e0A "Value of capture status")

[FAQs](#KCJeA "FAQs")

[Best practice](#xKj3a "Best practice")

[Customize the payment timeout](#yGaRZ "Customize the payment timeout")

[Suggestions on processing logic for merchant results pages](#GdEle "Suggestions on processing logic for merchant results pages")

[Payment failed retry](#hAeaV "Payment failed retry")

[Obtain payment results](#o55cG "Obtain payment results")
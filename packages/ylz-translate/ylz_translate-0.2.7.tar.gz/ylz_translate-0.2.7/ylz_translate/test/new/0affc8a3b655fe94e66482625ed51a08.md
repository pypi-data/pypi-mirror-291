Best practices for configuring the authorization URL | Auto Debit | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fautodebit_en%2Fbest_practice)

[Go to Homepage](../../)

Auto Debit

[Overview](/docs/ac/autodebit_en/overview)

Accept payments

After payments

Other resources

Best practices for configuring the authorization URL
====================================================

2023-12-28 08:41

After you call the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API, a different type of authorization URLs is returned in the API response depending on the payment method used to proceed with the authorization process. This article provides you with best practices for using authorization URLs corresponding to different client types. For more details about authorization URLs returned for each payment method, see the [URLs returned for some payment methods](https://global.alipay.com/docs/ac/autodebit_en/redirection_details).

Authorization URL parameters
============================

For different merchant client types (Web, WAP, App), different payment methods will return part or all of the following three types of authorization URLs in the response of the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API to proceed with the authorization process.

<table style="width:769px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="146" span="1"><col width="623" span="1"></colgroup><tbody><tr style="height:33px"><td style="text-align:left;vertical-align:top;background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f13ad3f69041583c58d6148ffb66ccad" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span>Type</span></strong></p></td><td style="text-align:left;vertical-align:top;background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="9ce3a0145fb75fc398b8f9b20f6d7d2c" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span>Description</span></strong></p></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="850b0b0611329043597c9f5de4a27819" id="u2f5bba1a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">normalUrl</p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="e42ca1373f901f42a8646745a2c9dc8a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The URL of an HTTPS address, used to redirect to the website page of the payment method on the same browser page.</p><p data-lake-id="9b7fff3dbb143eee1c81dbf9c9d54349" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Example:&nbsp;<a href="https://msp.boost-my.com/onlinepayment/authorise?source=alipay-connect&amp;codeValue=https%3A%2F%2Fglobal.alipay.com%2F2810020400931LFH2t2mq1jjJ8zSetyv31VU" target="_blank"><span>https://msp.boost-my.com/onlinepayment/authorise?source=alipay-connect&amp;codeValue=https%3A%2F%2Fglobal.alipay.com%2F2810020400931LFH2t2mq1jjJ8zSetyv31VU</span></a></p></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c2557144d47553dae5e339129ac31df1" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>applinkUrl</span></p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f6b241291377ac543b39f074b742bcb7" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The Android App Link or iOS Universal Link that is used for redirection in the authorization process.</p><p data-lake-id="e995ae3387fed36b8c5a515749874b90" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Example:&nbsp;<a href="https://myboost.app.link/IvWm7QZkfjb?%24fallback_url=https%3A%2F%2Fmsp.boost-my.com%2Fonlinepayment%2Fauthorise&amp;source=alipay-connect&amp;codeValue=https%3A%2F%2Fglobal.alipay.com%2F2810020400931LFH2t2mq1jjJ8zSetyv31VU" target="_blank"><span>https://myboost.app.link/IvWm7QZkfjb?%24fallback_url=https%3A%2F%2Fmsp.boost-my.com%2Fonlinepayment%2Fauthorise&amp;source=alipay-connect&amp;codeValue=https%3A%2F%2Fglobal.alipay.com%2F2810020400931LFH2t2mq1jjJ8zSetyv31VU</span></a></p></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="a9d1f1f705394f28c6ed7f4d8f79cb01" id="u5d3eabed" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">schemeUrl</p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="67855f55efa07a223e6d8746f1e6777f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The scheme URL that is used to open a payment method app.</p><p data-lake-id="cdadece299ef99fa46a3e2c7e4a2f459" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Example:&nbsp;<span>boostapp://inAppDeeplink?deeplink_path=deeplink/onetimepayment&amp;source=alipay-connect&amp;codeValue=https%3A%2F%2Fglobal.alipay.com%2F2810020400931LFH2t2mq1jjJ8zSetyv31VU</span></p></td></tr></tbody></table>

> **Notes**:
> 
> *   When using the above links to initiate an authorization, an exception may occur during the redirection if the buyer does not have the payment method app installed. Handle the exception properly if any.
> *   The URLs returned by some payment methods cannot be used multiple times. If the authorization page failed to be invoked using the URL, we recommend that you use a new _authState_ value to obtain the URL and reinvoke the authorization page.

Web
===

For payments on a computer website, _normalUrl_ is returned in the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API response.

Open the URL
------------

After obtaining the _normalUrl_ value, you need to redirect the buyer to the authorization page using the authorization URL. We recommend that you open the URL in a new tab to guide the buyer to complete the authorization. The code for opening a new page is as follows:

copy

    if (serverResponse.normalUrl != null) {
        window.open(serverResponse.normalUrl, '_blank');
    }

User experience
---------------

The authorization page rendered using _normalUrl_ can be a QR code-scanning page or a login page. The following diagram shows the authorization process in the two cases:

![Image 3: yuque_diagram (1).jpg](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1691564148142-585eaf71-1328-4303-abf7-227cd8105ac6.jpeg)

WAP
===

For payments on a mobile website, the response of the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API may contain one or more of the following URLs:

*   _normalUrl_
*   _applinkUrl_
*   _schemeUrl_

Choose a URL
------------

If the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API response only contains one of the three URLs, use the received URL directly as the redirection link. If you receive multiple URLs, we recommend that you choose the URL based on the following instruction:

*   For iOS system: prioritize using _applinkUrl_, then _schemeUrl_, and finally _normalUrl_.
*   For Android system: prioritize using _schemeUrl_, then _applinkUrl_, and finally _normalUrl_.

Open the URL
------------

To open the URL using JavaScript's redirection method, use the following code:

copy

    window.location.href = URL;

User Experience
---------------

<table style="width:733px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="98" span="1"><col width="635" span="1"></colgroup><tbody><tr style="height:33px"><td style="text-align:left;vertical-align:top;background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1c1e9fa6bd73b5fb2b290d6f2c62951f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span>Type</span></strong></p></td><td style="text-align:left;vertical-align:top;background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="e684edf68156733d06a79616cca6bd2e" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span>Payment experience</span></strong></p></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1edeb2fe09b1cc1031d1478bc4d38a4d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">normalUrl</p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c2f78b5df1ecc6a60085b3fa5dc83dc1" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The buyer is redirected from your mobile website page to the payment method's mobile website page. The content displayed to the buyer on the payment method's mobile webiste page depends on the payment method and can be divided into the following two types:</p><ul data-lake-id="9cb2dc7c9dd8a08399613efe85ade944" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="cb73034ab2a00e3574955cece45f2fed">Login page: The subsequent authorization process is completed within the payment method's mobile website page.</li><li data-lake-id="cc144842243dd135ea43eb43e9c1339b">Guide the buyer to click a button to launch the payment method app. The subsequent authorization process is completed within the payment method app.</li></ul></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="e1ed8aef8e5c575c7616f4414cc21082" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span>applinkUrl</span></p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="11bc82d193d5f8e2ac2e8d286f0f8d5a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The subsequent authorization process is automatically determined based on whether the buyer has installed the payment method app:</p><ul data-lake-id="f487491e7f11db34595193765f91ec85" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="ca10cc15ba34ff2eebbbb7489fb2c896">If the buyer has installed the payment method's app: the app is opened, and the buyer completes the authorization process within the app.</li><li data-lake-id="5ce6086b93a91f2a552434dd057900be">If the buyer has not installed the payment method's app: the mobile website page is opened, and the buyer continues the authorization process according to the instructions on the mobile website page. This process is opened and rendered in the default browser.</li></ul></td></tr><tr style="height:33px"><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="bc282b33afbb567c36bc58158be0b713" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">schemeUrl</p></td><td style="text-align:left;vertical-align:top;min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="ed2c932ea4f7b78fad89f1e9e5d6a775" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">The payment experience depends on whether the buyer has installed the payment method's app:</p><ul data-lake-id="e5dba00bdc912f3ecd9b2b77bec30d03" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="0496ed1bf423222a9c74f81777d28322">If the buyer has installed the payment method's app: the app is opened, and the buyer completes the authorization process within the app.</li><li data-lake-id="ea383dad83a7abeccbca5a7eabd0621c">If the buyer has not installed the payment method's app: the app cannot be launched using this URL, and the buyer may stay on the current page without being able to proceed with the authorization process.</li></ul></td></tr></tbody></table>

The following diagram illustrates the authorization process on a mobile website. The browser needs to redirect the buyer to the redirection link or open the link in a new tab.

![Image 4: yuque_diagram (3).jpg](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1691569112416-31ed231c-7ff7-4641-aad0-75b890d55d15.jpeg)

APP  

======

For payments on a mobile application, the response of the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API may contain one or more of the following URLs:

*   _normalUrl_
*   _applinkUrl_
*   _schemeUrl_

> **Note**: For payments on a mobile application, in addition to the URL parameters used for redirection mentioned above, the response of the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API also contains the _appIdentifier_ parameter. This parameter is the package name of the corresponding payment method app and is used to determine whether the payment method app is installed for app payment. It can also be used to avoid disambiguation dialogs on Android.

Choose a URL
------------

If the [**consult**](https://global.alipay.com/docs/ac/ams/authconsult) API response only contains one of the three URLs, use the received URL directly as the redirection link. If you receive multiple URLs, we recommend that you choose the URL based on the following instruction:

*   For iOS system: prioritize using _applinkUrl_, then _schemeUrl_, and finally _normalUrl_.
*   For Android system: prioritize using _schemeUrl_, then _applinkUrl_, and finally _normalUrl_.

Open a URL
----------

For Android and iOS, open the authorization URL using the following methods:

<table style="width:750px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="375" span="1"><col width="375" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c4447ce4833f20c79afa53e7bba84262" id="ud90fc311" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">iOS</span></strong></p></td><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="a4e4a02f5c845710ca8b01ea284f9cdc" id="u693dcac1" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Android</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><ul data-lake-id="49340d3fed59e33b3c88bacf0b9dcc7e" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="27669f0de2273dbaca07e85342690752"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Redirect outside of the application: Call the iOS method to open the </span>authorization URL<span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">.</span></li><li data-lake-id="149f49bd40b1f13edfd34cb7a8d5e658">Redirect within the application:</li></ul><ul data-lake-id="71161a49859ff440d404edd5c0fe6a7c" lake-indent="1" style="list-style-type:none;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><ul data-lake-id="48338eedb2bbbbb9db272c5be818ff4b" lake-indent="0" style="list-style-type:circle;padding-left:23px;margin:0px;line-height:1.74"><li data-lake-id="d39abc58cbf3fafb6766c0aa2f8ee368"><span class="lake-fontsize-11" style="color:rgb(55, 65, 81);font-size:14px" data-mce-style="font-size: 11px">Use WKWebView</span></li><li data-lake-id="9c91e134e84930e172c1bd7257a2c8a2"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Use WKWebView and JSBridge</span></li><li data-lake-id="9fd29b9121c3b542a0df075b69720c69"><span class="lake-fontsize-11" style="color:rgb(55, 65, 81);font-size:14px" data-mce-style="font-size: 11px">Use SafariViewController</span></li></ul></ul><ul data-lake-id="ccd6cd03c3e6b7c4e6e59d94f1f95c41" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="7f10cd8556b9baf03c540d1b379127ec">Depending on whether the payment method app is installed, open the authorization URL either outside of the application or within the application.</li></ul></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><ul data-lake-id="d1674178401b5744494b83238814f0d3" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="836885d6b5271feb18275ced094f9efc">Redirect outside of the application: Call the Android method to open the authorization URL.</li><li data-lake-id="4e5e56857cacde54868abf1097c8b474">Redirect within the application:</li></ul><ul data-lake-id="a053455d39f230ca82b8301da7c28138" lake-indent="1" style="list-style-type:none;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><ul data-lake-id="3b2dd5d8ffd8947757f25078fd3e159c" lake-indent="0" style="list-style-type:circle;padding-left:23px;margin:0px;line-height:1.74"><li data-lake-id="44854eda5449abcbed3874d31dad1056"><span class="lake-fontsize-11" style="color:rgb(55, 65, 81);font-size:14px" data-mce-style="font-size: 11px">Use WKWebView</span></li><li data-lake-id="9b3d74734073014a897442796c764de9"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Use WKWebView and&nbsp;</span><span>JavascriptInterface</span></li><li data-lake-id="f70c7189cb1c5ab630f37d33464c5720"><span class="lake-fontsize-11" style="color:rgb(55, 65, 81);font-size:14px" data-mce-style="font-size: 11px">Use</span><span style="color:#374151">&nbsp;Custom Tabs plug-in</span></li></ul></ul><ul data-lake-id="28874f3d3d949ca5b23c3b25992b58fb" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="806074a7bc3450151688a00e00cd298e">Depending on whether the payment method app is installed, open the authorization URL either outside of the application or within the application.</li></ul></td></tr></tbody></table>

### Pros and cons of each redirection method  

Each redirection method has its pros and cons. We recommend that you choose the most suitable redirection method based on the operation system and integration scenario.

<table style="width:1104px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="152" span="1"><col width="248" span="1"><col width="704" span="1"></colgroup><tbody><tr style="height:33px"><td rowspan="1" colspan="2" style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="946a6518407ca1de11f3c4a2ef7b9bfb" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Redirection method</span></strong></p></td><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="8bbb029839570fb5f34e467c435e4ec9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Description</span></strong></p></td></tr><tr style="height:33px"><td colspan="2" style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="2ac6bcdacc45d5e0bfac80dccf32b1e2" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Redirect outside of the application: Call the Android/iOS method to open the authorization URL.</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="7c2d34cf93ee54229aec988bbcd47961" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Alipay recommends this method.</span></strong></p><ul data-lake-id="382fbbd38203756b02caa66b0da106fe" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="df03e2f6f26a56cf2b3dd21f48941736"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Pros: Low integration costs. One-time integration suits all payment methods.</span></li><li data-lake-id="6f938ba619643f66f03979c0a07438d3"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Cons: The payment process is not fully kept on your clients.</span></li></ul></td></tr><tr style="height:33px"><td rowspan="3" style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="505cd5ec6390be335b4009a26336f150" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Redirect within the application</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><ul data-lake-id="6c411cfc897400c9ce9f000140ff7c28" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="5e76990c9898dc4c14031f79ce5d6e4a"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">WKWebView</span></li><li data-lake-id="626faf9a103ea8e98297ae9c9a642d1c"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">WebView</span></li></ul><p data-lake-id="40d3380bb35b6bb601b4044332ecf11f" id="ud08670be" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px"></span></p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="1d8989da72feb82d642cebd250045449" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">WKWebView/WebView is a built-in control that can embed a web browser in an application. You can use it to load website links.</p><ul data-lake-id="d7b310e3a8cf9be8531ab3b44a1d7845" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="ae639e947e4767f13f4ec0a09fb9c321">Pros: You can customize a better payment experience for buyers. Furthermore, you can achieve a seamless payment experience by redirecting buyers within the application, which means buyers do not leave your application and complete the subsequent payment process within your application.</li><li data-lake-id="762996a2edb0cd4133640c8babb2ba13">Cons: Requires more development and testing efforts.</li></ul></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><ul data-lake-id="710745100a337281f7a7c42cc3864d41" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="40f2538b87dd139cbde80fb64dc5612d"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">WKWebView+JSBridge</span></li><li data-lake-id="ef462acf44d3e409fa346cafbe8caf5f"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">WebView+JavascriptInterface</span></li></ul></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="049ec4b0db8088a03d3e44cc3e564f39" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">An upgrade solution based on WKWebView/WebView. After using JSBridge/JavascriptInterface, you can directly call Android/iOS methods to open the authorization URL in WebView.</p><ul data-lake-id="59e7de3607b551b195b2e81e48bf22be" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="5ce77732fbb90344e3e9c6e673a36f5e">Pros: <span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Performance, scalability, and security is improved compared to WKWebView/WebView. Provides a customized payment experience for buyers.</span></li><li data-lake-id="07cf36cc90192b26c7f4296c01fec5ee">Cons: Requires more development and testing efforts.</li></ul></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><ul data-lake-id="1f7633f1ffa7635da369c934ae1da55c" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="2b0c929a491617e1032e500557256a5e"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">SafariViewController</span></li><li data-lake-id="1ece2f355587135153c8a59e747ce5ac"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Custom Tabs</span></li></ul></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="53f9578b18597dad2ce6297217db3f10" style="text-align:left;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Provided by iOS/Android to open the authorization URL within the application. <span>Has </span><span>more comprehensive capabilities</span><span> compared to WebView.</span></p><ul data-lake-id="780929af524dbfa82ceb279f965f610a" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="2c236872c5fbc036bff0b8936c1ff545">Pros: Can be integrated with the system browser, and share capabilities such as cookies with the system browser. The integration is relatively simple.</li><li data-lake-id="ab6e92762184db3e086eee2a1c9bde86">Cons: Does not support customizing payment experience.</li></ul></td></tr><tr style="height:33px"><td colspan="2" style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="4f3c79cd10aeb43190dd4202bf781423" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Depending on whether the payment method app is installed, open the authorization URL either outside of the application or within the application.</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="d4ead6ae92acfed4fce3f57f5aa1244e" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Depending on whether the payment method app is installed, provide different redirection methods.</p><ul data-lake-id="e44ce0eeb9ae8eec6a65d25db72a0aad" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="51c0de001d2dd56bba8b2eb6381f5a28">Pros: Provides a buyer-friendly payment experience.</li><li data-lake-id="275ae5d38dc8c385a012e2f8c3886b97">Cons: Requires more development and testing efforts.</li></ul></td></tr></tbody></table>

### Code sample (iOS)

#### Method 1: Call the iOS method to open the authorization URL

The following code sample shows how to redirect buyers from your application to a payment method application using an iOS method in the iOS system.

copy

    if ([[[UIDevice currentDevice] systemVersion] floatValue] >= 10.0) {
        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:Url] options:@{} completionHandler:nil];
    }else{ 
        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:Url]];
    }

#### Method 2: Open the authorization URL within the application  

To open the authorization URL in your application, use the following URL types:

*   _normalUrl_
*   _applinkUrl_

> **Note**: Some payment methods do not support authorization on a mobile website. Opening _normalUrl_ triggers invoking the corresponding payment method app via a redirection, while WKWebView intercepts the redirection. You need to use the `decidePolicyForNavigationAction` method of WKWebView and call the iOS method to open the authorization URL to achieve the redirection from your WKWebView to the payment method app.

##### Use WKWebView

The following code sample shows how to use WKWebView to load the payment method page within the iOS application:

copy

    // Initialize webview configuration
    WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc]init];
    // Initialize webView 
    WKWebView *webView = [[WKWebView alloc]initWithFrame:CGRectMake(0, 0, [UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height) configuration:configuration];
    webView.navigationDelegate = self;
    //Load the payment method URL
    [webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:Url]]];
    [self.view addSubview:self.webView];

The following code sample shows how to use the `decidePolicyForNavigationAction` method of WKWebView to achieve the redirection from your WKWebView to a payment method app:

copy

    - (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler{
        // WKWebView intercepts the redirection by default. Enable the redirection in the following ways.
        // Operations such as opening Safari
        NSURL *url = navigationAction.request.URL;
        NSString *absoluteString = url.absoluteString;
        NSString *scheme = url.baseURL.scheme;
    
        DLog(@"navigationAction.request.URL.absoluteString=====> %@", absoluteString);
        if ([absoluteString isEqualToString:@"about:blank"]) {
            decisionHandler(WKNavigationActionPolicyCancel);
        }
        if (!([absoluteString containsString:@"https://"] || [absoluteString containsString:@"http://"])) {
            if ([absoluteString containsString:@"://"]) {
                NSString *urlHeader =  [absoluteString componentsSeparatedByString:@"://"][0];
                [MBProgressHUD showAutoMessage:[NSString stringWithFormat:@"Scheme\n%@://",urlHeader] toView:self.view];
                dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
                    [self openAppWithUrlStr:navigationAction.request.URL];
                    decisionHandler(WKNavigationActionPolicyAllow);
                });
            }
        } else {
            decisionHandler(WKNavigationActionPolicyAllow);
        }
    }

##### Use WKWebView and JSBridge

Using WKWebView and JSBridge optimizes the buyer's payment experience, while requiring strong development capabilities. Combining the use of JSBridge with opening URLs through WKWebView is beneficial for the project's maintenance and scalability, as well as improving performance and security. Using JSBridge can facilitate interaction between web pages and native applications, allowing WAP pages to directly call native methods of the app. The following code example demonstrates how to use JSBridge in WKWebView.

copy

    [self.wkWebView evaluateJavaScript:bridge completionHandler:nil];

##### Use SFSafariViewController

SFSafariViewController supports opening and rendering _normalUrl_, _applinkUrl_, and _schemeUrl_. Compared to WebView, it has more comprehensive capabilities and a simpler integration. For how to use SFSafariViewController to open the authorization URL, see the [SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) user guide. The following code sample demonstrates how to use SFSafariViewController.

copy

    SFSafariViewController *safariVC = [[SFSafariViewController alloc] initWithURL:Url entersReaderIfAvailable:NO];
    safariVC.delegate = self;
    [self.navigationController presentViewController:safariVC animated:YES completion:nil];

#### Method 3: Handle the redirection according to whether the payment method app is installed  

You must first determine whether the buyer has installed the payment method app, and then handle the opening method of the authorization URL accordingly. Perform the following steps:

1.  Add _LSApplicationQueriesSchemes_ to the configuration in _info.plist_. Note that there is a limit on the number of schemes in _info.plist_.
2.  Use the `canOpenURL` method to determine whether the payment method app is installed. See the following code:

copy

    NSString *walletSchemeUrl = @"gcash://";
    
    if ([[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:walletSchemeUrl]]){
        // The payment method app is installed. Open the app directly.
        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:Url] options:@{} completionHandler:nil];
        
        return YES;
    } else {
        // The payment method app is not installed. We recommend that you load the mobile website in WebView.
        SFSafariViewController *safariVC = [[SFSafariViewController alloc] initWithURL:Url entersReaderIfAvailable:NO];
        safariVC.delegate = self;
        [self.navigationController presentViewController:safariVC animated:YES completion:nil];
        
        return NO;
    }

### Code sample (Android)

#### Method 1: Call an Android method to open the authorization URL

The following code sample demonstrates how to open the authorization URL using an Android method to achieve the redirection from your application to a payment method application.

copy

    try {
        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(Url));
        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); 
        // use the startActivity function to redirect to the wallet app 
        startActivity(intent);
    } catch (Exception e) {
        e.printStackTrace();
    }

Using this method may result in the appearance of a disambiguation dialog box.

**What is a disambiguation dialog box**

Android App Link requests authentication from Google servers when installing the app. If authentication fails, the Android App Link will become invalid, and a disambiguation dialog box will appear when the buyer tries to open the app through such a link. The buyer needs to manually select how to open the link.

<table style="width:708px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="354" span="1"><col width="354" span="1"></colgroup><tbody><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="7a001b55551334dc20619ab8cb18b6a4" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">This image shows an example of a disambiguation dialog box that appears when a buyer clicks on an Android App Link. The user needs to manually select how to open the link: using Google Maps or Google Browser.</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="c0a993a66ad671681a6e0c2757630971" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="1632448161329-0aef337a-b4eb-4700-a8d0-042ca36658e4.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692166561686-c538f4bd-b4e5-4f17-a7b1-c3bad1b1a6ff.png" data-raw-src="" title="1632448161329-0aef337a-b4eb-4700-a8d0-042ca36658e4.png" data-height="1010px" style="visibility:visible;width:500px" class="docs-image loaded showImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692166561686-c538f4bd-b4e5-4f17-a7b1-c3bad1b1a6ff.png" loading="lazy"></span></p></td></tr></tbody></table>

**Prevent the appearance of a disambiguation dialog box**

When a disambiguation dialog box appears, the buyer needs to manually select the way to open the application, which affects the payment success rate. Therefore, you need to prevent the appearance of a disambiguation dialog box by taking the following action as needed:

*   If the buyer has installed the payment method app, specify the package name of the payment method and open the URL of the payment method.
*   If the buyer has not installed the payment method app, use the sample code below to open the URL.  
    

copy

    Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(applinkUrl));
    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); 
    //Specify the package name of the payment method
    intent.setPackage(walletPackageName);
    PackageManager packageManager = MainActivity.this.getPackageManager();
    //Check whether there is an app that supports opening this link.
    List<ResolveInfo> activities = packageManager.queryIntentActivities(intent, 0);
    if (activities.size() <= 0) {
       //The payment method app is not installed. Initialize the Intent object. This link will be opened by the default Android method.
       intent = new Intent(Intent.ACTION_VIEW, Uri.parse(applinkUrl));
       intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
         startActivity(intent);
    } else {
      //The payment method app is installed. Specify the package name of the payment method and open the payment method URL. The disambiguation dialog box will not appear.
         startActivity(intent);
    }

> Note: The _packageName_ values of some payment methods are shown as follows:
> 
> *   AlipayHK: hk.alipay.wallet
> *   GCash: com.globe.gcash.android
> *   TrueMoney: th.co.truemoney.wallet
> *   KakaoPay: com.kakao.talk
> *   Touch 'n Go: my.com.tngdigital.ewallet
> *   Dana: id.dana

#### Method 2: Open the authorization URL within the application

To open the authorization URL in your application, use WebView to load _normalUrl_ or _applinkUrl_ as a mobile website:

*   _normalUrl_
*   _applinkUrl_

> **Note**: Some payment methods do not support authorization on a mobile website. Opening _normalUrl_ triggers invoking the corresponding payment method app via a redirection, while WKWebView intercepts the redirection. You need to use the `shouldOverrideUrlLoading` method of WKWebView and call the Android method to open the authorization URL to achieve the redirection from your WKWebView to the payment method app.

##### Use WebView

The following code sample demonstrates how to load the payment method page in WebView.

copy

    WebView webView = findViewById(R.id.webview);
    //Set webview
    webView.setWebViewClient(new WebViewClient() {
        @Override
        public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
            view.loadUrl(request.getUrl().toString());
            return super.shouldOverrideUrlLoading(view, request);
        }});
    
    WebSettings webSettings = webView.getSettings();
    //Enable javascript
    webSettings.setJavaScriptEnabled(true);
    //Enable scaling
    webSettings.setSupportZoom(true);
    //Enable scaling controls (buttons)
    webSettings.setBuiltInZoomControls(true);
    //Webview has two cache modes. Cache is not used here.
    webSettings.setCacheMode(WebSettings.LOAD_NO_CACHE);
    //Allow JavaScript to open a new tab (false by default)
    webSettings.setJavaScriptCanOpenWindowsAutomatically(true);
    //Allow JavaScript to load local storage
    webSettings.setDomStorageEnabled(true);
    //WAP cache size (settings are not needed)
    //webSettings.setAppCacheMaxSize(1024 * 1024 * 8);
    //WAP cache path
    String absolutePath = getApplicationContext().getCacheDir().getAbsolutePath();
    //WAP cache size
    webSettings.setAppCachePath(absolutePath);
    //Set whether to allow WebView to access files (true by default)
    webSettings.setAllowFileAccess(true);
    //Allow WAP cache to be saved
    webSettings.setAppCacheEnabled(true);
    //In preview mode, if the page width exceeds the WebView display, scale down the page to fit WebView (false by default)
    webSettings.setLoadWithOverviewMode(true);
    //Support the viewport HTML meta tag
    webSettings.setUseWideViewPort(true);
    //Load the payment method URL
    webView.loadUrl(Url);

Set WebViewClient for WebView, use the `WebViewClient.shouldOverrideUrlLoading` method to intercept the URL, and call the corresponding Android method. See the following code sample:

copy

    @Override
    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
        if (request.getUrl().toString().startsWith("http")) {
            view.loadUrl(request.getUrl().toString());
            return super.shouldOverrideUrlLoading(view, request);
        } else {
            view.onPause();
            view.stopLoading();
            try {
              Intent intent = Intent.parseUri(uri, Intent.URI_INTENT_SCHEME);
              intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
              view.getContext().startActivity(intent);
            } catch (URISyntaxException e) {
              //Alert that this scheme is not supported
            }
            return false;
        }
    }

> **Note**: If your application has an allowlist of applications that can be redirected to, configure the allowlist properly, consider compatibility issues with older versions, and reduce the number of application releases.

##### Use WebView and JavascriptInterface  

Using this method will optimize the buyer's payment experience, while requiring strong development capabilities. We recommend that you use JavascriptInterface in WevView. Using JavascriptInterface can help facilitate bidirectional communication between the Android application and WebView, allowing a mobile webpage to directly call native methods of the app, making your application more flexible and powerful, and beneficial for the subsequent maintenance and improvement of the project. The following code sample demonstrates how to use JavascriptInterface in WebView.

1.  Declare JavascriptInterface in WebView

copy

    @JavascriptInterface
        public void openActivity(String url) {
            //Add the code if needed
            try {
            Intent intent = Intent.parseUri(uri, Intent.URI_INTENT_SCHEME);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            context.startActivity(intent);
        } catch (Exception e) {
            Toast.makeText(context, "App not installed", Toast.LENGTH_SHORT).show();
        }
    }

2.  Add JavascripInterface to WebView

copy

    mWebView.addJavascriptInterface(this, "bridge");

3.  Open the authorization URL using the following code

copy

    window.bridge.openActivity("Url");

##### Use Custom Tabs

Custom Tabs supports opening and rendering _normalUrl_, _applinkUrl_, and _schemeUrl_. Compared to WebView, it has more comprehensive capabilities and a simpler integration. The following code sample demonstrates how to use Custom Tabs.

1.  Add Custom Tabs in the _build.gradle_ file.

copy

    dependencies {
        ...
        implementation "androidx.browser:browser:1.4.0"
    }

2.  Use Custom Tabs to open a Chrome tab in your application.

copy

    // Use CustomTabsIntent.Builder to configure CustomTabsIntent.
    // Use CustomTabsIntent.Builder.build() to create CustomTabsIntent
    // Use CustomTabsIntent.launchUrl() to launch the URL
    
    CustomTabsIntent.Builder builder = new CustomTabsIntent.Builder();
    CustomTabsIntent customTabsIntent = builder.build();
    customTabsIntent.launchUrl(this, Uri.parse(url));

For more information about how to use CustomTabs to open the URL, see the [Custom Tabs user guide](https://developer.chrome.com/docs/android/custom-tabs/).

#### Method 3: Handle the redirection according to whether the payment method app is installed

You must first determine whether the buyer has installed the payment method app, and then handle the opening method of the authorization URL accordingly. Perform the following steps:

1.  To comply with Android system's privacy and security policies, the <queries> tag needs to be added in _AndroidManifest.xml_ to ensure that the authorization URL can invoke the corresponding payment method app. The package name of the payment method app needs to be configured in the <queries> tag. You can obtain the corresponding value from the _appIdentifier_ parameter in the [**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) response returned by Alipay or by contacting Alipay Technical Support.

copy

    <?xml version="1.0" encoding="utf-8"?>
    <manifest xmlns:android="http://schemas.android.com/apk/res/android"
              xmlns:tools="http://schemas.android.com/tools"
              package="com.llw.scandemo">
      
      ...
      <queries>
        <package android:name="th.co.truemoney.wallet" />
        <package android:name="com.eg.android.AlipayGphone" />
        <package android:name="my.com.tngdigital.ewallet" />
        ...
      </queries>
      ...
      
    </manifest>

2.  Determine whether the payment method app is installed and invoke the authorization page:

copy

    String Url = "applinkUrl/schemeUrl";
    try {
        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(Url));
        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        intent.setPackage("my.com.tngdigital.ewallet");
        // Determine whether the payment method app is installed
        PackageManager packageManager = MainActivity.this.getPackageManager();
        List<ResolveInfo> activities = packageManager.queryIntentActivities(intent, 0);
        
        if (activities.size() <= 0) {
            // The payment method app is not installed. We recommend that you open the mobile website URL in WebView.
    
            intent = new Intent(MainActivity.this, WebviewActivity.class);
            intent.setData(Uri.parse(Url));
            startActivity(intent);
        } else {
            
            // The payment method app is installed. Open the payment method app directly.
            startActivity(intent);
        }
    } catch (Exception e) {
        // Handle exceptions
        e.printStackTrace();
    }

User experience
---------------

The authorization processes corresponding to different opening methods of the authorization URL are as follows:

<table style="width:907px;outline:none;border-collapse:collapse;border:1px solid rgb(217, 217, 217)" class="lake-table"><colgroup><col width="135" span="1"><col width="772" span="1"></colgroup><tbody><tr style="height:33px"><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="d88e613bef7f5604abceab06c3e93e0d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Redirection method</span></strong></p></td><td style="background-color:rgb(217, 234, 252);min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="3aa3508b67b7d8d6d79c3734575b6eaa" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Authorization process</span></strong></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="b348bcdd309023bf5457a6430eab65ed" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Redirect outside of the application: Call the Android/iOS method to open the authorization URL.</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="6b7e42430e1c67cacb239758a7fcaff8" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Redirect outside of the application. The authorization process depends on whether the buyer has installed the payment method app:</span></p><ul data-lake-id="ccde749c4ef84c39fc540977f474c883" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="65eed59db744c2ec87187a44b2093aa2"><strong>Installed</strong>: Redirect from your app to the payment method app. After the buyer selects the payment method, the payment method app is directly launched for authorization through the <em>schemeUrl</em> or <em>applinkUrl</em> returned by Alipay, and the buyer completes the authorization on the payment method app.</li></ul><p data-lake-id="429de0f958579ae1843c71a759018881" style="padding-left:2em;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="image.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178056637-f70c7259-4c83-4936-a209-8c1c920bb2f5.png" data-raw-src="" title="image.png" data-height="417px" style="visibility:visible;width:675px" class="docs-image loaded showImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178056637-f70c7259-4c83-4936-a209-8c1c920bb2f5.png" loading="lazy"></span></p><ul data-lake-id="4d42f952e701bce4d4d3609f543f2ce9" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="6b12e1af238b676a221e34f1305ccccb"><strong>Not installed</strong>: Redirect from the your app to the default browser.</li></ul><ul data-lake-id="52321a212ca7b3de38a14dd520932096" lake-indent="1" style="list-style-type:none;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><ul data-lake-id="d109b8047b11108a03ee3ef5aa5e15ec" lake-indent="0" style="list-style-type:circle;padding-left:23px;margin:0px;line-height:1.74"><li data-lake-id="af4f29a272863939bbd3eb47f8b25767"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Authorization in a default browser:&nbsp;</span></strong>After the buyer selects the payment method, they are redirected from your app to the payment method page in the default browser via&nbsp;<em>normalUrl</em> or <em>applinkUrl </em>returned by Alipay, and the buyer completes the authorization on this page.</li></ul></ul><p data-lake-id="f122d6e069ed7bf93d7567a3bc4aee58" style="padding-left:4em;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="image.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178123130-3f2fd4dd-fd50-418e-a0cb-4a193f74b787.png" data-raw-src="" title="image.png" data-height="418px" style="visibility:visible;width:796px" class="docs-image loaded showImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178123130-3f2fd4dd-fd50-418e-a0cb-4a193f74b787.png" loading="lazy"></span></p><ul data-lake-id="26edd607485f9d500b6adb643ce207a5" lake-indent="1" style="list-style-type:none;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><ul data-lake-id="a28a4f4df223b2170cc52b6132f77680" lake-indent="0" style="list-style-type:circle;padding-left:23px;margin:0px;line-height:1.74"><li data-lake-id="8506b6461b5d5057d1ea7159974a649d"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Authorization in a payment method app:&nbsp;</span></strong>After the buyer selects the payment method, they are redirected from your app to the payment method page in the default browser via <em>normalUrl</em> or <em>applinkUrl </em>returned by Alipay, the payment method page will launch the payment method app, and the buyer completes the authorization on the payment method app.</li></ul></ul><p data-lake-id="5e1b2b10907eccbb1eb016cb5e61af36" style="padding-left:6em;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="image.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178443015-f785962c-34a5-4669-86c5-0d6bee88cc00.png" data-raw-src="" title="image.png" data-height="406px" style="visibility:visible;width:821.5px" class="docs-image loaded hideImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692178443015-f785962c-34a5-4669-86c5-0d6bee88cc00.png" loading="lazy"></span></p></td></tr><tr style="height:33px"><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="f8c5c56c5aad0feffc849457a2773d68" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">Redirect within the application</p></td><td style="min-width:90px;font-size:14px;white-space:normal;overflow-wrap:break-word;border:1px solid rgb(217, 217, 217);padding:4px 8px;cursor:default"><p data-lake-id="8b8152b7998bd9c27e3e79960ec5d98b" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px">There are two types of authorization experiences: redirection from your app and redirection within your app.</p><ul data-lake-id="ec26cf624c4c80108efc264c581e043a" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="e980f8dfd25d24c2182808b7919085cc"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">Payment method app authorization (redirection from your app):&nbsp;</span></strong>After the buyer selects the payment method, they are redirected from your app to the payment method page in WebView via <em>normalUrl</em> or <em>applinkUrl </em>returned by Alipay, the payment method page will launch the payment method app, and the buyer completes the authorization on the payment method app.</li></ul><p data-lake-id="1ce023829fc72bf456d5d88c843f4b89" style="padding-left:2em;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin-top:0px;margin-bottom:0px"><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="image.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692179846777-d4120d61-a03c-42e9-a207-e9436308f891.png" data-raw-src="" title="image.png" data-height="404px" style="visibility:visible;width:824.5px" class="docs-image loaded showImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692179846777-d4120d61-a03c-42e9-a207-e9436308f891.png" loading="lazy"></span></span></p><ul data-lake-id="304af067d1f64582d1151e6646234af4" lake-indent="0" style="list-style-type:disc;padding-left:23px;margin:0px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word"><li data-lake-id="f494567a15c1666a2261f4717e8b081f"><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">WebView authorization (redirection within your app):&nbsp;</span></strong><strong><span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px">&nbsp;</span></strong>After the buyer selects the payment method, they are redirected from your app to the payment method page in WebView via <em>normalUrl</em> or <em>applinkUrl </em>returned by Alipay, and the buyer completes the authorization on this page.<span class="lake-fontsize-11" data-mce-style="font-size: 11px" style="font-size:14px"><span data-card-type="inline" data-lake-card="image" contenteditable="false" style="display:block"><img alt="image.png" data-role="image" src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692179741961-365209f8-0826-4e7f-a5e6-3359eee8cb22.png" data-raw-src="" title="image.png" data-height="415px" style="visibility:visible;width:676px" class="docs-image loaded showImg" data-src="https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692179741961-365209f8-0826-4e7f-a5e6-3359eee8cb22.png" loading="lazy"></span></span></li></ul></td></tr></tbody></table>

### Best practice

We recommend that you fix the configuration for opening the authorization URL based on different payment methods, or route based on the payment method, device environment, and URL type. The following figure shows an example of fixed configuration based on different payment methods:

![Image 11: .png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692185554471-ed9470f8-75d8-40ce-a87c-4f82b7762e80.png)

For each payment method, we recommend that you determine the method of opening the authorization URL according to the following logic:

![Image 12: .png](https://idocs-assets.marmot-cloud.com/storage/idocs87c36dc8dac653c1/1692186917510-07617213-0181-43f7-b020-7a3f13887799.png)

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 13](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 14](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Authorization URL parameters](#iNXn2 "Authorization URL parameters")

[Web](#bX4WN "Web")

[Open the URL](#JBNgb "Open the URL")

[User experience](#ig8tT "User experience")

[WAP](#FH33G "WAP")

[Choose a URL](#BMKoi "Choose a URL")

[Open the URL](#BcQ7m "Open the URL")

[User Experience](#1HoED "User Experience")

[APP](#7mCxH "APP")

[Choose a URL](#6z5bs "Choose a URL")

[Open a URL](#fFC1f "Open a URL")

[Pros and cons of each redirection method](#jze1x "Pros and cons of each redirection method")

[Code sample (iOS)](#GnZMZ "Code sample (iOS)")

[Method 1: Call the iOS method to open the authorization URL](#vlgjI "Method 1: Call the iOS method to open the authorization URL")

[Method 2: Open the authorization URL within the application](#yuBtd "Method 2: Open the authorization URL within the application")

[Method 3: Handle the redirection according to whether the payment method app is installed](#j85Ww "Method 3: Handle the redirection according to whether the payment method app is installed")

[Code sample (Android)](#hjtaK "Code sample (Android)")

[Method 1: Call an Android method to open the authorization URL](#bJPgb "Method 1: Call an Android method to open the authorization URL")

[Method 2: Open the authorization URL within the application](#Bdlpk "Method 2: Open the authorization URL within the application")

[Method 3: Handle the redirection according to whether the payment method app is installed](#NUx16 "Method 3: Handle the redirection according to whether the payment method app is installed")

[User experience](#ZB7Lt "User experience")

[Best practice](#niti4 "Best practice")
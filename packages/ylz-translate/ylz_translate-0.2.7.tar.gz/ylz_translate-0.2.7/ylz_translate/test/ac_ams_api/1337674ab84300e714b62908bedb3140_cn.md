申请令牌 | 产品API | 支付宝文档
==========================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_a52690f40beef33d7d37f1bda6f48c27.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_d70d46fd32b98952674df01c03131d87.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Faccesstokenapp)

[返回首页](../../)

产品API

[支付宝API](/docs/ac/ams/api)

在线支付

授权

[咨询](/docs/ac/ams/authconsult)

[通知授权](/docs/ac/ams/notifyauth)

[申请令牌](/docs/ac/ams/accesstokenapp)

[撤销](/docs/ac/ams/authrevocation)

保险箱

支付

订阅

争议

退款

申报

店内支付

申请令牌
==========

2024-04-10 03:24

POST /v1/authorizations/applyToken

使用以下方式之一调用此API以完成不同任务：

*   使用此API通过成功调用**咨询**API获取的_authCode_获取访问令牌。该访问令牌将在发起自动扣款时使用。
*   当现有访问令牌即将过期时，使用此API通过刷新令牌获取新访问令牌。

结构
====

消息由头部和主体组成。以下部分专注于主体结构。头部结构请参阅：

*   [请求头部](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头部](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**：除数组外，每个字段的数据类型应设置为String。这意味着必须使用双引号（" "）包围字段值。例如：

*   如果字段的数据类型为Integer且其值为20，则设置为"20"。
*   如果字段的数据类型为Boolean且其值为true，则设置为"true"。

### 请求参数

#### grantType 字符串  必需

使用此API要完成的任务。有效值为：

*   `AUTHORIZATION_CODE`: 当您想要获取访问令牌时，使用此值。成功调用此API后，您可以获取访问令牌。
*   `REFRESH_TOKEN`: 每个访问令牌都有一个由`accessTokenExpiryTime`指定的有效期。当您的访问令牌即将过期且需要获取新令牌时，使用此值。成功调用此API后，您可以获取新的访问令牌。

#### customerBelongsTo 字符串  必需

客户使用的钱包。查看[支付方式](https://global.alipay.com/docs/ac/ref/payment_method)以检查有效值。

关于此字段的更多信息：

*   最大长度：64个字符

#### authCode 字符串 

授权码，用于获取访问令牌。此字段的值从钱包返回的重建重定向URL中获取。

注意: 当_grantType_的值为`AUTHORIZATION_CODE`时指定此字段。

关于此字段的更多信息

*   最大长度: 64 个字符

#### refreshToken 字符串

刷新令牌，用于在访问令牌即将过期时获取新的访问令牌。刷新令牌是从成功调用的**applyToken** API响应中获取的。

注意: 当_grantType_的值为`REFRESH_TOKEN`时指定此字段。

关于此字段的更多信息

*   最大长度: 128 个字符

#### merchantRegion 字符串

商家或二级商家经营业务所在的国家或地区。该参数遵循[ISO 3166 国家代码](https://www.iso.org/obp/ui/#search)标准的2字母国家/地区代码。目前仅支持`US`，`JP`，`PK`，`SG`。

注意: 当使用全球收单网关（GAGW）产品时，此字段是必需的。

关于此字段的更多信息

*   最大长度: 2 个字符

### 响应参数

#### 结果 Result 对象 **必需**

指示此 API 是否调用成功。如果 API 调用成功，可以获取访问令牌。

显示子参数

#### accessToken 字符串

用于访问用户资源相应范围的访问令牌。

**注意**：此字段在 API 调用成功时返回。

关于此字段的更多信息：

*   最大长度：128 个字符

#### accessTokenExpiryTime 日期时间

访问令牌过期的时间。访问令牌过期后，无法使用它从用户账户扣款。

**注意**：当返回 _accessToken_ 时，此字段也会返回。

关于此字段的更多信息：

*   值遵循 [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) 标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### refreshToken 字符串

刷新令牌，用于在访问令牌即将过期时换取新的访问令牌。

注意：此字段仅在钱包支持刷新令牌时返回。如果未返回此字段，表示访问令牌的有效期相当长。

关于此字段的更多信息

*   最大长度：128 个字符

#### refreshTokenExpiryTime Datetime 

刷新令牌过期的时间。刷新令牌过期后，无法使用它来获取新的访问令牌。

注意：当返回 _refreshToken_ 时，此字段也会返回。

关于此字段的更多信息

*   值遵循 [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) 标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### userLoginId String

用户在钱包中注册时使用的登录ID。登录ID可以是用户的电子邮件地址或电话号码，当返回给支付宝+ MPP时会被遮掩。此字段可让商家知道已注册的用户。

注意：当_result.resultCode_为`S`且咨询API中的_scopes_字段值为`AGREEMENT_PAY`时，此字段会被返回。

关于此字段的更多信息：

*   最大长度：64个字符

#### extendInfo 字符串

扩展信息。

注意：当存在扩展信息时，此字段会被返回。

关于此字段的更多信息：

*   最大长度：2048个字符

API 探索器

示例代码在沙箱中运行

### 请求

#### URL

北美

https://open-na-global.alipay.com/ams/api/v1/authorizations/applyToken

#### 示例

使用authCode获取accessToken

请求体

复制

```json
{
  "authCode": "663A8FA9D83648EE8AA11FF68298XXXX",
  "customerBelongsTo": "GCASH",
  "grantType": "AUTHORIZATION_CODE"
}
```

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

### 响应

案例

Touch'n Go

案例描述

如果您申请Touch'n Go的访问令牌，将返回以下响应：

响应体

```json
{
  "accessTokenExpiryTime": "2022-09-14T17:14:16+08:00",
  "result": {
    "resultStatus": "S",
    "resultCode": "SUCCESS",
    "resultMessage": "Success"
  },
  "accessToken": "281011030220200914TLsu9RhgUv87Lf1111********"
}
```

请注意，`accessToken` 中的星号（*）用于替换实际数据，以保护隐私。在实际响应中，`accessToken` 将包含一个完整的、未被替换的值。

"extendInfo": "{\"userId\":\"100000111111****\",\"userLoginId\":\"6017271
********\"}",

"refreshTokenExpiryTime": "2023-03-16T17:14:16+08:00",

"refreshToken": "281011111110200914aGT3jbpxci875H0041****",

"userLoginId": "6017271****"

}

请注意，这里的星号（****）是用于替换敏感信息的，实际数据中会有具体的值。

结果处理逻辑
--------------------

对于不同的请求结果，需要执行不同的操作。详细如下：

- **请求成功 (Request Success)**:
  - 如果请求成功，系统将执行以下步骤：
    - **数据处理 (Data Processing)**:
      - 解析返回的JSON数据。
      - 验证数据的完整性和准确性。
    - **业务逻辑 (Business Logic)**:
      - 根据返回的数据更新用户账户状态。
      - 如果涉及交易，更新交易记录。
    - **用户反馈 (User Feedback)**:
      - 显示成功消息给用户。
      - 更新用户界面以反映新状态。

- **请求失败 (Request Failure)**:
  - 如果请求失败，根据错误代码采取相应措施：
    - **网络错误 (Network Error)**:
      - 检查网络连接，提示用户网络问题。
      - 重试请求，最多尝试三次。
    - **服务器错误 (Server Error)**:
      - 显示错误信息，告知用户服务暂时不可用。
      - 记录错误日志，供后续分析。
    - **授权错误 (Authorization Error)**:
      - 通知用户登录或授权已过期。
      - 弹出重新登录或授权的界面。

- **超时 (Timeout)**:
  - 如果请求超时，可以：
    - 用户界面提示请求超时。
    - 询问用户是否要重新尝试。

- **异常情况 (Exceptional Cases)**:
  - 对于未预见的错误，执行以下操作：
    - **错误处理 (Error Handling)**:
      - 显示一般错误消息，避免暴露详细信息。
    - **日志记录 (Logging)**:
      - 记录详细的异常信息，便于排查问题。
    - **恢复策略 (Recovery Strategy)**:
      - 如果可能，尝试恢复到请求前的状态。
      - 否则，提示用户操作无法完成，并提供退出选项。

请确保在处理每个结果时，都遵循安全和用户体验的最佳实践。

*   如果_result.resultStatus_的值为`S`，则成功获取了访问令牌。使用该访问令牌访问对应的用户资源范围。
*   如果_result.resultStatus_的值为`U`，则未获取到访问令牌。通过再次调用此API来重试该过程。
*   如果_result.resultStatus_的值为`F`，则未获取到访问令牌。检查错误代码并采取相应措施，然后再次调用此API重试。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 授权完成。存储_accessToken_和其他相关字段。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持以获取详细原因。 |
| CLIENT\_FORBIDDEN\_ACCESS\_API | F | 客户端无权使用此API。 | 联系支付宝技术支持以获取详细原因。 |

| 错误代码 | 错误类型 | 错误描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_ACCESS\_TOKEN | F | 访问令牌已过期、被撤销或不存在。 | 检查\_accessToken\是否正确。如果不正确，请传入正确值。如果正确，请联系支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决此问题。 |
| INVALID\_AUTHCODE | F | 授权码无效。 | 重新发起授权，调用咨询接口获取\_authcode\。如果授权码正确，请联系支付宝技术支持进行故障排除。 |
| INVALID\_CLIENT\_STATUS | F | 客户端状态无效。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_REFRESH\_TOKEN | F | 刷新令牌无效。 | 使用有效的\_refreshToken\重新发起请求。如果刷新令牌正确，请联系支付宝技术支持解决问题。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_SIGNATURE | F | 签名验证失败。请求中使用的私钥与Antom Dashboard的公钥不匹配。 | 确保用于签署请求的私钥与Antom Dashboard的公钥匹配。以下签名参考信息可能有所帮助：
* 请求头中的[签名](https://global.alipay.com/docs/ac/ams/api_fund)字段
* 如何[计算签名](https://global.alipay.com/docs/ac/ams/digital_signature) |

|
| KEY\_NOT\_FOUND | F | 支付宝或商家的私钥或公钥未找到。 | 检查私钥或公钥是否存在。如果不存在，请在Antom Dashboard上上传私钥。 |

|
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| NO\_PAY\_OPTIONS | F | 该API不支持此支付方式。 | 检查传入的支付方式是否为\_customerBelongsTo\参数的有效值。如果传入的值正确，请联系支付宝技术支持获取详细原因。 |

| OAUTH\_FAILED | F | OAuth流程失败。 | 请联系支付宝技术支持获取详细原因。 |

| PARAM\_ILLEGAL | F | 缺少必需参数，或存在非法参数。例如，非数字输入，无效日期，或参数长度和类型错误。 | 检查并验证当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |

| PROCESS\_FAIL | F | 发生了一般业务失败。 | 不要重试，通常需要人工干预。建议联系支付宝技术支持来解决问题。 |

| 错误代码 | 类型 | 错误信息 | 处理建议 |
| --- | --- | --- | --- |
| SYSTEM\_ERROR | F | 系统错误发生。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |

| UNKNOWN\_CLIENT | F | 客户端未知。 | 联系支付宝技术支持获取详细原因。 |

| USER\_NOT\_EXIST | F | 用户在钱包端不存在。 | 联系支付宝技术支持获取详细原因。 |

| USER\_STATUS\_ABNORMAL | F | 用户在钱包端的状态异常。 | 联系支付宝技术支持了解具体原因。 |

| AUTH\_IN\_PROCESS | U | 授权仍在进行中。 | 重复调用此接口，直到收到最终状态结果。 |

| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

|
| 未知异常 | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![图片 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面是否有帮助？
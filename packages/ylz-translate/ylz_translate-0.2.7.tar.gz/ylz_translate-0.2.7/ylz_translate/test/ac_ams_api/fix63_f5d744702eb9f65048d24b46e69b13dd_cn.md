
查询退款
==========

2024-05-22 08:45

POST /v1/payments/inquiryRefund

使用此API查询先前提交的退款请求的状态。

结构
====

一条消息由头部和主体组成。以下部分专注于主体结构。关于头部结构，请参阅：

*   [请求头部](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头部](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着必须使用双引号（" "）包围字段值。示例：

*   如果字段的数据类型为Integer，其值为20，则设置为"20"。
*   如果字段的数据类型为Boolean，其值为true，则设置为"true"。

### 请求参数

#### refundRequestId 字符串

商家为标识退款请求分配的唯一ID。*refundRequestId* 和 *refundId* 不能都为null。不支持特殊字符。如果同时指定了 *refundRequestId* 和 *refundId*，则 *refundId* 优先。

关于此字段的更多信息

*   最大长度: 64 个字符

#### refundId 字符串

支付宝为退款分配的唯一标识。*refundRequestId* 和 *refundId* 不能都为 null。*refundId* 与 *refundRequestId* 之间存在一对一对应关系。如果同时指定了 *refundRequestId* 和 *refundId*，则以 *refundId* 为准。

关于此字段的更多信息

*   最大长度: 64 个字符

#### merchantAccountId 字符串

识别商家账户的唯一标识。

当您在多个地点使用同一个客户端 ID 时，需要指定此参数。

关于此字段的更多信息

*   最大长度: 32 个字符

### 响应参数

显示全部

#### result Result 对象 **必需**

请求调用的结果信息。

**注意: 此字段不表示退款结果。它仅表示调用 inquiryRefund 接口是否成功。**

显示子参数

#### refundId 字符串

蚂蚁金服分配的唯一退款标识，用于识别一次退款操作。每个*refundId*与一个*refundRequestId*一一对应。

注意：此字段仅在API调用成功（*result.resultStatus* 的值为`S`）时返回。

关于此字段的更多信息：

*   最大长度：64 个字符

#### refundRequestId 字符串

商家为识别退款请求而分配的唯一ID。

注意：此字段仅在API调用成功（*result.resultStatus* 的值为`S`）时返回。

关于此字段的更多信息：

*   最大长度：64 个字符

#### refundAmount Amount 对象

商家发起的退款金额。

注意：此字段仅在API调用成功（*result.resultStatus* 的值为`S`）时返回。

显示子参数

#### refundTime 日期时间

退款在支付宝端成功完成的日期和时间。

注意：此字段在退款成功时返回（*refundStatus* 的值为 `SUCCESS`）。

关于此字段的更多信息：

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### refundStatus 字符串

表示支付宝退款的最终状态。有效值包括：

*   `SUCCESS`：表示退款成功。
*   `PROCESSING`：表示退款处理中。
*   `FAIL`：表示退款失败。

注释：

*   当API调用成功（*result.resultStatus* 的值为 `S`）时，此字段将返回。
*   此字段仅标识支付宝一侧的退款状态，不包括支付宝+移动支付提供商（Alipay+ MPP）一侧的状态。

关于此字段的更多信息：

*   最大长度：16个字符

#### grossSettlementAmount 金额对象

退款结算金额，等于退款金额乘以*settlementQuote*的值。当货币兑换预先确定且交易时汇率被锁定时，此字段会被返回。

显示子参数

#### settlementQuote 货币兑换对象

结算货币与交易货币之间的汇率。当*grossSettlementAmount*被返回时，此字段会被返回。

显示子参数

API 探索器

示例代码在沙箱中运行

### 请求

URL

北美地区

https://open-na-global.alipay.com/ams/api/v1/payments/inquiryRefund

请求体

```json
{}
```

### 响应

情况

成功

响应体

```json
{
  "refundAmount": {
    "currency": "HKD",
    "value": "10000"
  },
  "refundId": "2021080419401080130018866020092XXXX",
  "refundRequestId": "amsdemorefund_zhangyikai_zyk_20210804_165236_931",
  "refundStatus": "SUCCESS",
  "refundTime": "2021-08-04T01:52:37-07:00",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "Success",
    "resultStatus": "S"
  }
}
```

更多信息
------------

决定何时使用*refundRequestId*或*refundId*，请遵循以下规则：

*   如果调用**refund** API后返回成功结果，使用*refundId*或*refundRequestId*查询原始退款结果。
*   如果在调用**refund** API后发生未知异常或超时，仅使用*refundRequestId*查询原始退款结果。

结果处理逻辑
------------------

对于不同的请求结果，需要执行不同的操作。详细信息如下：

*   如果`result.resultStatus`的值为`S`，退款查询成功。
*   如果`result.resultStatus`的值为`F`，退款查询失败。
*   如果`result.resultStatus`的值为`U`，请求结果未知。使用相同的请求参数重试查询请求。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 接口调用成功。从_refundStatus_获取退款状态。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决问题。 |
| KEY\_NOT\_FOUND | F | 支付宝或商家的私钥或公钥未找到。 | 检查私钥或公钥是否存在。如果不存在，请在支付宝开发者中心上传私钥。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 请检查URL是否正确。参考API文档中的端点信息。 |
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 15秒后再次调用接口。如果三次重试后仍无结果，说明订单未创建。 |
| PARAM\_ILLEGAL | F | 必需参数未传递，或存在非法参数。例如，非数字输入，无效日期，或参数长度和类型错误。 | 检查并验证当前API所需的请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般业务错误。 | 不要重试，通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| SYSTEM\_ERROR | F | 系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

### 退款结果代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 退款成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持获取详细原因。 |
| API\_INVALID | F | API名称或调用格式使用错误。 | 检查请求时API名称、HTTP方法或请求格式是否正确。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不支持。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_MERCHANT\_STATUS | F | 商户状态异常，存在限制。 | 联系支付宝技术支持获取详细原因。 |
| KEY\_NOT\_FOUND | F | 未找到支付宝或商家的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在支付宝开发者中心上传私钥。 |
| MERCHANT\_BALANCE\_NOT\_ENOUGH | F | 商家余额不足。 | 等待商家余额充足后再次调用接口。重试时需要更改*refundRequestId*字段。 |
| MULTIPLE\_REFUNDS\_NOT\_SUPPORTED | F | 由于合同限制，不支持多次退款。 | 检查是否存在多次退款。请勿再次调用退款接口。对于每次退款，仅调用一次接口。 |
| NO\_INTERFACE\_DEF | F | API 未定义。 | 检查 URL 是否正确。请参考 API 文档中的端点信息。 |
| ORDER\_IS\_CLOSED | F | 您发起的请求具有与已存在交易相同的*paymentRequestId*, 且该交易已关闭。 | 使用新的*paymentRequestId*重新发起退款请求。 |
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 检查*paymentId*是否正确。如果正确，请联系支付宝技术支持以获取具体原因。 |
| ORDER\_STATUS\_INVALID | F | 订单状态无效。交易正在进行中或交易已失败。 | 检查订单状态并采取相应措施。如果交易正在进行中，请等待。如果交易失败，请不要发起退款。联系支付宝技术支持以获取具体原因。 |
| PARAM\_ILLEGAL | F | 必需的参数未传递，或者存在非法参数。例如，非数字输入、无效日期，或者参数的长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般性的业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| REFUND\_AMOUNT\_EXCEED | F | 退款总额超过了支付金额。 | 确认退款总额是否超过支付金额。创建一个退款金额小于或等于支付金额的新退款，或者联系支付宝技术支持。 |
| REFUND\_WINDOW\_EXCEED | F | 退款日期超出了合同约定的退款期。 | 确认退款日期是否超出了退款期。检查合同中的退款期，或联系支付宝技术支持获取具体的退款期信息。 |
| REPEAT\_REQ\_INCONSISTENT | F | 金额或币种与之前的请求不一致。 | 确保所有请求字段保持一致，或使用新的_paymentRequestId_重新发起退款。 |
| RISK\_REJECT | F | 请求因风险控制被拒绝。 | 通知用户请求被拒绝，因为风险控制未通过。 |
| SYSTEM\_ERROR | F | 发生系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果问题未解决，联系支付宝技术支持。 |
| 未知异常 | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。
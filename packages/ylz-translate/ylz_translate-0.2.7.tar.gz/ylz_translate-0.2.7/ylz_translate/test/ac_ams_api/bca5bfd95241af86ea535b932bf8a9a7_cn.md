支付（入口码支付） | 产品API | 支付宝文档
==========================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_a52690f40beef33d7d37f1bda6f48c27.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_d70d46fd32b98952674df01c03131d87.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Fec)

[返回首页](../../)

产品API

[支付宝API](/docs/ac/ams/api)

在线支付

店内支付

支付

[支付（用户出示模式支付）](/docs/ac/ams/upm)

[支付（订单码支付）](/docs/ac/ams/oc)

[支付（入口码支付）](/docs/ac/ams/ec)

[通知支付](/docs/ac/ams/paymentrn)

[查询支付](/docs/ac/ams/paymentri)

[取消支付](/docs/ac/ams/paymentc)

退款

注册

支付（入口码支付）
========================

2023-07-27 09:58

POST /v1/payments/pay

使用**pay** API 启动向支付宝的支付，并根据支付宝返回的状态和操作指示处理支付结果。

结构
----

一条消息由头部和主体组成。以下部分专注于主体结构。头部结构请参考：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着字段值必须用双引号（" "）括起来。例如：

*   如果字段的数据类型是整数，值为20，则设置为"20"。
*   如果字段的数据类型是布尔值，值为true，则设置为"true"。

### 请求参数

显示全部

#### productCode 字符串  必需

商家可以使用的支付产品，基于商家与支付宝之间的合同约定。对于条码支付，该值固定为 `IN_STORE_PAYMENT`。

#### paymentRequestId String REQUIRED

商家为识别一次支付请求而分配的唯一ID。支付宝使用此字段进行幂等性控制。

关于此字段的更多信息：

*   这是一个API幂等性字段。商家使用paymentRequestId字段进行幂等性控制。对于具有相同paymentRequestId值并达到最终状态（S或F）的支付请求，应为该请求返回相同的结果。
*   最大长度：64个字符

#### order Order对象 REQUIRED

订单信息，如买家信息、商家信息、订单描述和订单金额。

该参数也用于风险控制、监管、报告、用户支付结果展示等。

显示子参数

#### paymentAmount Amount对象 REQUIRED

商家在订单中请求接收的支付金额，以订单货币表示。

显示子参数

#### paymentMethod 支付方式对象 **必需**

商家或收单机构用来收集支付的方法。

显示子参数

#### paymentExpiryTime 日期时间

支付过期时间是一个特定时间点，超过该时间点后支付将过期。支付过期时间后，收单机构或商家必须终止订单处理。默认的支付过期时间由合同确定。如果想要使用不同于默认时间的支付过期时间，请指定此字段。

注意：通常对于用户展示模式的支付，合同中的默认支付过期时间是在发送支付请求后3分钟。例如，如果请求在时间2019-11-27T12:00:01+08:30发送，那么支付过期时间是2019-11-27T12:03:01+08:30。

关于此字段的更多信息

* 值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### paymentRedirectUrl - URL

支付完成后用户被重定向的URL。

关于此字段的更多信息

* 最大长度：2048个字符

#### paymentNotifyUrl - URL **必需**

用于接收支付结果通知的URL。

关于此字段的更多信息

* 最大长度：2048个字符

#### paymentFactor - PaymentFactor 对象

指示支付场景。

显示子参数

#### settlementStrategy - SettlementStrategy 对象

支付请求的结算策略。

注意：当满足以下条件之一时，需要指定此字段：

*   多个结算协议已签署，且有多个结算协议支持此交易。在这种情况下，使用此字段指定结算货币，以便从所有已签署的结算协议中选择用于此交易的协议。
*   当 _paymentMethodType_ 的值为 `CONNECT_WALLET` 时。

显示子参数

#### 商家地区 String

商家或二级商家经营业务的国家或地区。遵循 [ISO 3166 国家代码](https://www.iso.org/obp/ui/#search) 标准的2位国家/地区代码。目前仅支持 `US`、`JP`、`PK`、`SG`。

注意：当使用 Alipay Global Gateway (GGW) 产品时，此字段是必需的。

关于此字段的更多信息

*   最大长度：2 个字符

### 响应参数

显示全部

#### 结果 Result 对象 REQUIRED

请求结果包含状态和错误代码等信息。

显示子参数

#### paymentRequestId 字符串

商家为标识支付请求而分配的唯一ID。

关于此字段的更多信息：

*   最大长度：64个字符

#### paymentId 字符串

支付宝为标识支付分配的唯一ID。

关于此字段的更多信息：

*   最大长度：64个字符

#### paymentAmount 金额对象

商家在订单货币中请求收取的支付金额。

显示子参数

#### paymentTime 日期时间

支付成功或失败的最终状态的日期和时间。

关于此字段的更多信息：

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### paymentCreateTime 日期时间

支付创建的日期和时间。

关于此字段的更多信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### pspCustomerInfo PspCustomerInfo 对象

这是Alipay+ MPP的客户信息。

注意：Alipay+ Mobile Payment Provider，是指参与Alipay+ Core或其他与蚂蚁集团成员合作，为用户提供或发卡方提供支付服务的移动支付伙伴。

显示子参数

#### challengeActionForm ChallengeActionForm 对象

当支付结果未处于成功或失败的最终状态时，提供关于挑战操作的信息。

显示子参数

#### redirectActionForm RedirectActionForm 对象

提供关于重定向操作的信息。

显示子参数

#### grossSettlementAmount Amount 对象

总结算金额，等于交易金额乘以_settlementQuote_的值。

注意：当结算货币与交易货币相同时，此字段为空。

显示子参数

#### settlementQuote 赋值对象

交易时结算货币与交易货币之间的汇率，仅在锁定汇率的情况下提供。

注意：当结算货币与交易货币相同时，此字段为空。

显示子参数

API 探索器

### 请求

URL

北美地区

https://open-na-global.alipay.com/ams/api/v1/payments/pay

请求体

复制

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

```json
{
  "productCode": "IN_STORE_PAYMENT",
  "paymentNotifyUrl": "http://xmock.inc.alipay.net/api/Ipay/globalSite/automtion/paymentNotify.htm",
  "paymentRequestId": "10277574507XXXX",
  "paymentFactor": {
    "inStorePaymentScenario": "EntryCode"
  },
  "order": {
    ...
  }
}
```

（此处省略了 "order" 字段的详细内容，因为原始文档中没有提供）

"订单描述": "Mi Band 3 金属无螺丝不锈钢腕带

专为小米Mi Band 3设计",

"订单金额": {

"货币": "美元",

"值": "10"

},

"商家": {

"参考商家ID": "seller231117459@login.com",

"商家名称": "胡杯",

"商家MCC": "1234",

"店铺": {

"参考店铺ID": "S000000XXXX",

"店铺名称": "UGG-2",

"店铺MCC": "1405"

}

},

"环境": {

"用户代理": "Mozilla/5.0 (Linux; Android 9; LYA-AL00 Build/HUAWEILYA-AL00L

          ; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/70.0

          .3538.110 Mobile Safari/537.36 NebulaSDK/1.8.100112 Nebula

          AlipayDefined(nt:WIFI,ws:360|0|3.0) AliApp(APHK/2.6.0.160)

          AlipayClientHK/2.6.0.160 Language/zh-HK useStatusBar/true

          isConcaveScreen/true AlipayClient/10.1.32.600 Alipay Language/zh-Hans"

}

},

"支付金额": {

"货币": "美元",

"值": "10"

},

"支付方式": {

"支付方式类型": "CONNECT\_WALLET"

}

}

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

### 响应

响应体

Copy

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

{  
"result": {  
"resultStatus": "S",  
"resultCode": "SUCCESS",  
"resultMessage": "成功"  
},  
"paymentId": "2019111919401080010018885020050XXXX",  
"paymentRequestId": "10277574507XXXX",  
"redirectActionForm": {  
"redirectUrl": "http://render-dev.site.alipay.net/p/h5\_dev/hk-cashier  
-merchant-S907753718/www/index.html#/landing?pre\_order\_id=https://global"  
}  
}

请注意，由于Markdown格式的限制，嵌套的Markdown语法在此处未显示，但已翻译成中文。在实际的Markdown文档中，`redirectActionForm`内的URL可能需要使用Markdown的代码块（使用三个反引号）来正确格式化。在翻译中，我保留了原始文档的空白行以保持Markdown格式的正确性，并未翻译JSON键，同时确保了语句的通顺性。

# 支付宝支付请求示例

```json
{
  "app_id": "2016081801234567",
  "charset": "UTF-8",
  "format": "json",
  "method": "alipay.trade.precreate",
  "notify_url": "http://example.com/notify",
  "return_url": "http://example.com/return",
  "sign_type": "RSA2",
  "timestamp": "2019-11-19 10:36:48",
  "trade_no": "2019111902441004811234567890",
  "biz_content": {
    "out_trade_no": "20191119024410",
    "product_code": "FAST_INSTANT_TRADE_PAY",
    "total_amount": "10.00",
    "subject": "商品标题",
    "body": "商品描述",
    "extend_params": {
      "sys_service_provider_id": "2088511833207846"
    },
    "qr_pay_mode": "1",
    "qrcode_width": "250"
  }
}
```

此JSON对象代表一个支付宝支付请求。其中包含以下字段：

- `app_id`: 应用ID，用于标识调用方的支付宝应用。
- `charset`: 字符集，通常为UTF-8。
- `format`: 返回数据格式，这里是JSON。
- `method`: 调用的接口方法，例如`alipay.trade.precreate`表示预创建交易。
- `notify_url`: 支付成功后，支付宝回调通知的URL。
- `return_url`: 用户支付完成后返回的页面URL。
- `sign_type`: 签名类型，如RSA2。
- `timestamp`: 请求的时间戳。
- `trade_no`: 交易号，由支付宝生成。
- `biz_content`: 业务内容，包含交易的具体信息。

在`biz_content`中：

- `out_trade_no`: 商家订单号。
- `product_code`: 交易类型，如`FAST_INSTANT_TRADE_PAY`表示快速即时支付。
- `total_amount`: 订单总金额，例如10.00美元。
- `subject`: 订单标题。
- `body`: 订单描述。
- `extend_params`: 扩展参数，包含服务提供商ID。
- `qr_pay_mode`: 二维码支付模式。
- `qrcode_width`: 二维码的宽度。

请注意，JSON键不应翻译，以保持数据的原始格式。

更多信息
-----------------

本节提供有关其他参数的额外信息。详细信息如下：

**•** _productCode_:  
此参数的值是商家根据与支付宝签订的合同用于收款的支付产品。当商家可以使用多个产品时，此参数是必需的。

**•** _订单信息(order):_  
_order_ 参数包含了订单的相关信息，如商家、商品、物流和购买环境等。在支付过程中，这些信息主要用于支付宝的风险控制或反洗钱检测。支付完成后，这些信息用于展示消费记录、监管报告等用途。

然而，支付宝不会校验_order_ 中的金额与支付请求中的金额是否一致，订单信息也不应用于资金操作。如果需要使用支付宝提供的风险控制能力，应使用 _env_ 字段。

_order_ 字段示例：

复制

**•** _paymentMethod:_  
`paymentMethod` 的值为 `CONNECT_WALLET`，表示支付宝通过由支付宝生成的二维码进行收款。

**•** _paymentExpiryTime:_  
支付执行方必须确保在过期时间后支付不会成功。如果请求中未指定此参数，则过期时间由支付执行方决定。

**•** _paymentFactor:_
`paymentFactor.inStorePaymentScenario` 的值为 `EntryCode`，表示支付宝需要在这个支付场景中生成一个重定向URL。

**•** _paymentId:_
如果响应中未返回此字段，您可以使用 _paymentRequestId_ 字段发起 **inquiryPayment** 和 **cancel** 请求。

结果处理逻辑
--------------------

调用 **pay** 接口后，支付宝可能会返回以下结果：

*   支付宝返回的 _result.resultStatus_ 为 `S`，表示商家需要使用表单中的参数启动重定向，以驱动支付流程。
*   支付宝返回的 _result.resultStatus_ 为 `F`，支付请求失败。
*   支付宝返回的 _result.resultStatus_ 为 `U`，商家需要再次调用 **pay** 接口。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 支付成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 请咨询支付宝技术支持以获取详细原因。 |

| 错误代码 | 错误类型 | 错误描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决此问题。 |

| CLIENT\_INVALID | F | 客户端ID无效。支付宝对客户端ID有限制。 | 检查客户端ID是否正确，或联系支付宝技术支持获取详细原因。 |

| CURRENCY\_NOT\_SUPPORT | F | 货币不受支持。 | 联系支付宝技术支持获取详细原因。 |

| INVALID\_CONTRACT | F | 合同中的参数值与当前交易不符。 | 检查合同中的参数值是否与当前交易匹配。如果匹配，请联系支付宝技术支持排查问题。 |

| INVALID\_MERCHANT\_STATUS | F | 商户状态异常，存在限制。 | 联系支付宝技术支持获取详细原因。 |

| 错误代码 | 错误类型 | 错误描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_SIGNATURE | F | 签名验证失败。用于签署请求的私钥与支付宝开发者中心的公钥不匹配。 | 检查用于签署请求的私钥是否与支付宝开发者中心的公钥匹配。以下签名参考信息可能有帮助：

* 请求头中的[签名](https://global.alipay.com/docs/ac/ams/api_fund)字段
* 如何[计算签名](https://global.alipay.com/docs/ac/ams/digital_signature) |

| KEY\_NOT\_FOUND | F | 找不到支付宝或商家的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在支付宝开发者中心上传私钥。

| MEDIA\_TYPE\_NOT\_ACCEPTABLE | F | 服务器不支持客户端可接受的媒体类型。 | 检查媒体类型是否正确，并使用支付宝接受的媒体类型。 |

| 错误代码 | 错误类型 | 错误描述 | 解决方案 |
| --- | --- | --- | --- |
| MERCHANT\_KYB\_NOT\_QUALIFIED | F | 由于商家的KYB状态导致支付失败。商家可能未符合KYB要求，或者KYB状态不适用于此交易。 | 请咨询支付宝技术支持以获取详细原因。 |
| MERCHANT\_NOT\_REGISTERED | F | 商家未注册。 | 请使用注册接口注册商家。如果调用注册接口失败，请联系支付宝技术支持。 |
| METHOD\_NOT\_SUPPORTED | F | 服务器不支持请求的HTTP方法。仅支持POST方法。 | 确保使用的是POST HTTP方法。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点信息。 |

| 错误代码 | 状态 | 错误信息 | 解决方案 |
| --- | --- | --- | --- |
| NO\_PAY\_OPTIONS | F | 交易不支持该货币。 | 检查钱包是否支持该货币，或者检查钱包和货币是否与合同一致。如需详细原因，请联系支付宝技术支持。 |

| ORDER\_IS\_CANCELED | F | 您发起的请求具有与之前已支付交易相同的paymentRequestId，该交易已被取消。 | 使用新的_paymentRequestId_重新发起支付。 |

| ORDER\_IS\_CLOSED | F | 您发起的请求具有与已存在交易相同的paymentRequestId，该交易已关闭。 | 使用新的_paymentRequestId_重新发起支付。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| PARAM\_ILLEGAL | F | 必需的参数未传递，或者存在非法参数。例如，非数字输入、无效日期，或者参数的长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PAYMENT\_AMOUNT\_EXCEED\_LIMIT | F | 支付金额超过了合同或钱包允许的最大金额。 | 检查支付金额是否超出限制，或使用更低金额重试。联系支付宝技术支持了解具体限制。 |
| PAYMENT\_COUNT\_EXCEED\_LIMIT | F | 支付次数超过了钱包指定的上限。 | 联系支付宝技术支持了解具体限制。 |

| 错误代码 | 状态 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| PAYMENT\_NOT\_QUALIFIED | F | 商户未达到支付条件，可能是因为未注册、未签订自动扣款协议或被禁止支付。 | 请咨询支付宝技术支持以获取具体原因。 |
| PROCESS\_FAIL | F | 发生了一般的业务处理失败。 | 不要重试，通常需要人工干预。建议联系支付宝技术支持解决问题。 |
| REPEAT\_REQ\_INCONSISTENT | F | 金额或币种与前一次请求不一致。 | 确保所有请求字段相同，或使用新的_paymentRequestId_重新发起支付。 |
| RISK\_REJECT | F | 请求因风险控制被拒绝。 | 通知用户请求因风险控制失败而被拒绝。 |
| SYSTEM\_ERROR | F | 系统错误。 | 不要重试，联系支付宝技术支持获取更多信息。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| USER\_NOT\_EXIST | F | 钱包端不存在该用户。 | 联系支付宝技术支持获取详细原因。 |

| PAYMENT\_IN\_PROCESS | U | 支付正在处理中。 | 使用新的_paymentRequestId_重新发起支付。 |

| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 本页面是否有帮助？
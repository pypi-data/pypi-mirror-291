
撤销
====

2024-04-10 03:24

POST /v1/authorizations/revoke

使用此API来撤销用户对商户的授权。一旦支付宝接收到撤销请求，访问令牌就会失效，商户无法再使用该访问令牌访问用户资源范围。此外，商户也不能使用相关的刷新令牌来获取新的访问令牌。

结构
====

一个消息由头部和主体组成。以下部分专注于主体结构。头部结构请参考：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur) 
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90) 

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着必须使用双引号（" "）包围字段值。例如：

如果字段的数据类型是Integer，其值为20，应设置为"20"。

如果字段的数据类型是Boolean，其值为`true`，应设置为"true"。

### 请求参数

#### accessToken 字符串  必需

用于访问用户资源相应范围的访问令牌。

更多关于此字段的信息

*   最大长度：128 个字符

### 响应参数

显示全部

#### result 结果对象  必需

指示此 API 是否调用成功。如果 API 调用成功，授权将成功取消。

显示子参数

API 探索器

示例代码 在沙箱中运行

### 请求

URL

北美

https://open-na-global.alipay.com/ams/api/v1/authorizations/revoke

请求体

```json
{
  "accessToken": "281010033AB2F588D14B43238637264FCA5Axxxx"
}
```
### 响应

情况

成功

响应体

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "Success"
  }
}
```

结果处理逻辑
--------------------

对于不同的请求结果，需要执行不同的操作。详细如下：

- **请求成功 (Request Success)**:
  - 如果请求成功，系统将执行以下步骤：
    - **数据处理 (Data Processing)**:
      - 解析返回的JSON数据。
      - 验证数据的完整性和准确性。
    - **业务逻辑 (Business Logic)**:
      - 根据返回的数据更新用户账户状态。
      - 如果涉及交易，更新交易记录。
    - **用户反馈 (User Feedback)**:
      - 显示成功消息给用户。
      - 更新用户界面以反映新状态。

- **请求失败 (Request Failure)**:
  - 如果请求失败，根据错误代码采取相应措施：
    - **网络错误 (Network Error)**:
      - 检查网络连接，提示用户网络问题。
      - 重试请求，最多尝试三次。
    - **服务器错误 (Server Error)**:
      - 显示错误信息，告知用户服务暂时不可用。
      - 记录错误日志，供后续分析。
    - **授权错误 (Authorization Error)**:
      - 通知用户登录或授权已过期。
      - 弹出重新登录或授权的界面。

- **超时 (Timeout)**:
  - 如果请求超时，可以：
    - 用户界面提示请求超时。
    - 询问用户是否要重新尝试。

- **异常情况 (Exceptional Cases)**:
  - 对于未预见的错误，执行以下操作：
    - **错误处理 (Error Handling)**:
      - 显示一般错误消息，避免暴露详细信息。
    - **日志记录 (Logging)**:
      - 记录详细的异常信息，便于排查问题。
    - **恢复策略 (Recovery Strategy)**:
      - 如果可能，尝试恢复到请求前的状态。
      - 否则，提示用户操作无法完成，并提供退出选项。

请确保在处理每个结果时，都遵循安全和用户体验的最佳实践。

*   如果*result.resultStatus*的值为`S`，授权已成功取消。访问令牌不能再用于访问用户的资源，同时，对应的*refreshToken*也不能再用于更新*accessToken*。
*   如果*result.resultStatus*的值为`F`，表示系统缺陷或系统故障。建议手动检查系统并根据结果代码采取相应行动。
*   如果*result.resultStatus*的值为`U`，表示此API的调用状态未知。请再次调用此API以重试过程。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 取消成功。访问令牌已失效。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 请咨询支付宝技术支持以获取详细原因。 |
| CLIENT\_FORBIDDEN\_ACCESS\_API | F | 客户端无权使用此API。 | 请咨询支付宝技术支持以获取详细原因。 |
| INVALID\_ACCESS\_TOKEN | F | 访问令牌已过期、被撤销或不存在。 | 检查*accessToken*是否正确。如果不正确，请传入正确的值。如果正确，请联系支付宝技术支持以获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决问题。 |
| INVALID\_CLIENT\_STATUS | F | 客户端状态无效。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_SIGNATURE | F | 签名验证失败。用于签署请求的私钥与Antom Dashboard的公钥不匹配。 | 检查用于签署请求的私钥是否与Antom Dashboard的公钥匹配。以下签名参考信息可能有用：<br>*   请求头中的[签名](https://global.alipay.com/docs/ac/ams/api_fund)字段<br>*   如何[计算签名](https://global.alipay.com/docs/ac/ams/digital_signature) |
| KEY\_NOT\_FOUND | F | 未找到Antom或商户的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在Antom仪表板上上传私钥。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点。 |
| OAUTH\_FAILED | F | OAuth流程失败。 | 请咨询支付宝技术支持以获取详细原因。 |
| PARAM\_ILLEGAL | F | 未传递必需参数，或存在非法参数。例如，非数字输入，无效日期，或参数的长度和类型错误。 | 检查并验证当前API所需的请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般性的业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| SYSTEM\_ERROR | F | 发生了系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。 |
| UNKNOWN\_CLIENT | F | 客户端未知。 | 联系支付宝技术支持以获取详细原因。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

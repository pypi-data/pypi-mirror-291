咨询（结账支付）
==========================

2024-05-22 08:45

POST /v1/payments/consult

使用**咨询** API 向支付宝发起支付咨询请求。此请求会返回给商家，提供不同的支付方式及其对应的金额、国家、货币、规则和配置信息。

**咨询** API 允许商家：

*   为消费者提供多种支付方式，而不承担因这些支付方式变化而产生的额外成本，或管理选择和排序这些支付方式的逻辑。
*   自动化选择和排序多种支付方式。

结构
====
一条消息由头部和正文组成。以下部分专注于正文结构。头部结构的详情请参考：
*   [请求头部](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头部](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)  

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着字段值必须用双引号（" "）包围。例如：
*   如果字段的数据类型为整型，其值为20，应表示为"20"。
*   如果字段的数据类型为布尔型，其值为true，应表示为"true"。
### 请求参数  
显示全部  
#### productCode 字符串  必需  
表示正在使用的支付产品。可使用的支付产品在合同中规定。固定值为：  
*   `CASHIER_PAYMENT`: 表示此API用于收银台支付场景。  
关于此字段的更多信息  
*   最大长度：32个字符  
#### paymentAmount Amount 对象  必需  
商家在订单货币中请求收取的支付金额。  
显示子参数  
#### userRegion 字符串  
用户的2位国家或地区代码。更多信息请参考[ISO 3166国家代码](https://www.iso.org/obp/ui/#search)标准。支付方式将根据给定用户地区的支付方式相关性进行排序。  
关于此字段的更多信息  
*   最大长度：2个字符  
#### merchantRegion 字符串  
商家经营业务的国家或地区。参数是遵循[ISO 3166国家代码](https://www.iso.org/obp/ui/#search)标准的2位国家或地区代码。  
可能的值有 `US`, `SG`, `HK`, `PK`, `JP`, `CN`, `BR`, `AU`, 和 `MY`。  
当使用全球收单网关（GAGW）产品时，此参数是必需的。  
关于此字段的更多信息  
*   最大长度：2个字符  
#### settlementStrategy SettlementStrategy 对象  
结算策略。  
显示子参数  
#### allowedPaymentMethodRegions 字符串数组  
表示支付方法国家或地区的代码列表。此参数的值为2位[ISO国家代码](https://www.iso.org/obp/ui/#search)或`GLOBAL`。  
如果您希望返回特定地区的可用支付方式，请指定此参数。例如，如果传入`GLOBAL`，则返回全球卡片Visa和Mastercard。  
关于此字段的更多信息  
*   最大长度：6个字符  
#### env Env 对象  必需
关于订单放置的环境信息，例如设备信息。  
显示子参数  
#### 买家（Buyer）对象  
买家信息。  
显示子参数  
#### 商家账户ID（merchantAccountId）字符串  
用于唯一标识商家账户的ID。  
当您在多个地点使用同一个客户端ID时，需要指定此参数。  
关于此字段的更多信息  
*   最大长度：32个字符
### 响应参数  
显示全部  
#### result 结果对象 **必需**  
包含状态和错误代码等请求结果信息。  
注意：此字段不表示支付结果。它仅表示咨询接口是否调用成功。  
显示子参数  
#### paymentOptions 支付选项列表 Array<PaymentOption> 对象  
支付选项列表。  
显示子参数  
API 探索器  
示例代码 在沙箱中运行
### 请求  
URL  
北美地区  
https://open-na-global.alipay.com/ams/api/v1/payments/consult  

请求体  
```json
{
  "settlementStrategy": {
    "settlementCurrency": "USD"
  },
  "productCode": "CASHIER_PAYMENT",
  "userRegion": "SG",
  "allowedPaymentMethodRegions": [
    "HK",
    "JP",
    "CN",
    "SG",
    "MY",
    "PH",
    "ID",
    "KR",
    "TH"
  ],
  "env": {
    "osType": "IOS",
    "terminalType": "WAP"
  },
  "paymentAmount": {
    "currency": "THB",
    "value": "30000"
  }
}
```
### 响应  
响应体  

```json
{
  "result": {
    "resultStatus": "S",
    "resultCode": "SUCCESS",
    "resultMessage": "success."
  },
  "paymentOptions": [
    {
      "paymentMethodRegion": [
        "BR"
      ],
      "installment": {
        "plans": [
          {
            "interestRate": "0.00",
            "installmentNum": "2",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "3",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "4",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "5",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "6",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "7",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "8",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "9",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "10",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "11",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          },
          {
            "interestRate": "0.00",
            "installmentNum": "12",
            "interval": "MONTH",
            "minInstallmentAmount": {
              "currency": "BRL",
              "value": "4000"
            },
            "enabled": true,
            "maxInstallmentAmount": {
              "currency": "BRL",
              "value": "999999999900"
            }
          }
        ],
        "supportCardBrands": [
          {
            "logo": {
              "logoName": "AMEX",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/91418df3-a62b-47be-a3c4-9a40bb66f0c5.svg"
            },
            "cardBrand": "AMEX"
          },
          {
            "logo": {
              "logoName": "HIPERCARD",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/b2a364ef-0a94-4591-8eb6-749837ed4a12.svg"
            },
            "cardBrand": "HIPERCARD"
          },
          {
            "logo": {
              "logoName": "MASTERCARD",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/30/593c0dd3-b12e-4578-8efb-17b85614f92c.svg"
            },
            "cardBrand": "MASTERCARD"
          },
          {
            "logo": {
              "logoName": "VISA",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/dfd471f3-da7d-4ef1-8486-cfa4301045c6.svg"
            },
            "cardBrand": "VISA"
          },
          {
            "logo": {
              "logoName": "ELO",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/ae2b5c32-ce7f-473c-b311-763563dc4145.svg"
            },
            "cardBrand": "ELO"
          }
        ]
      },
      "paymentMethodCategory": "CARD",
      "paymentOptionDetail": {
        "funding": [
          "CREDIT"
        ],
        "supportCardBrands": [
          {
            "logo": {
              "logoName": "AMEX",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/91418df3-a62b-47be-a3c4-9a40bb66f0c5.svg"
            },
            "cardBrand": "AMEX"
          },
          {
            "logo": {
              "logoName": "HIPERCARD",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/b2a364ef-0a94-4591-8eb6-749837ed4a12.svg"
            },
            "cardBrand": "HIPERCARD"
          },
          {
            "logo": {
              "logoName": "MASTERCARD",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/30/593c0dd3-b12e-4578-8efb-17b85614f92c.svg"
            },
            "cardBrand": "MASTERCARD"
          },
          {
            "logo": {
              "logoName": "VISA",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/dfd471f3-da7d-4ef1-8486-cfa4301045c6.svg"
            },
            "cardBrand": "VISA"
          },
          {
            "logo": {
              "logoName": "ELO",
              "logoUrl": "https://cdn.marmot-cloud.com/storage/2022/9/26/ae2b5c32-ce7f-473c-b311-763563dc4145.svg"
            },
            "cardBrand": "ELO"
          },
          {
            "logo": {
              "logoName": "DINERS",
              "logoUrl": "https://gw.alipay.com/antom/icon/medium/default/DINERS.svg"
            },
            "cardBrand": "DINERS"
          }
        ]
      },
      "logo": {
        "logoName": "Card"
      },
      "paymentMethodType": "CARD",
      "enabled": true
    },
    {
      "paymentMethodRegion": [
        "BR"
      ],
      "paymentMethodCategory": "",
      "logo": {
        "logoName": "Pix",
        "logoUrl": "https://resourcecenter-v2-internet-site-dev-s29001109997.alipay.net/antom/icon/medium/default/pix.svg"
      },
      "paymentMethodType": "PIX",
      "enabled": true
    },
    {
      "disableReason": "CURRENT_CHANNEL_NOT_EXIST",
      "paymentMethodRegion": [
        "PL"
      ],
      "logo": {
        "logoName": "Blik",
        "logoUrl": "https://gw.alipay.com/antom/icon/medium/default/blik.svg"
      },
      "paymentMethodType": "BLIK",
      "enabled": false
    },
    {
      "disableReason": "CURRENT_CHANNEL_NOT_EXIST",
      "paymentMethodRegion": [
        "HK",
        "TH",
        "KR",
        "PH",
        "ID",
        "CN",
        "MY"
      ],
      "logo": {
        "logoName": "Alipay+",
        "logoUrl": "https://cdn.marmot-cloud.com/storage/aplus-checkout-prod/icon/prod/CONNECT_WALLET.png"
      },
      "paymentMethodType": "CONNECT_WALLET",
      "enabled": false
    }
  ]
}
```

### 结果/错误代码  
| 代码 | 值 | 消息 | 进一步行动 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 咨询成功。无需进一步操作。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不受支持。 | 更改请求中使用的货币。如果问题持续，请联系支付宝技术支持以获取详细原因。 |
| MERCHANT\_NOT\_REGISTERED | F | 商户未注册。 | 请使用注册接口注册商户。如果调用注册接口失败，请联系支付宝技术支持。 |
| NO\_PAY\_OPTIONS | F | 无可用支付选项。 | 请联系蚂蚁金服技术支持以获取详细原因。 |
| PARAM\_ILLEGAL | F | 缺少必需参数，或存在非法参数。例如，非数字输入、无效日期或参数长度和类型错误。 | 检查并验证当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生一般业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持解决此问题。 |
| SETTLE\_CONTRACT\_NOT\_MATCH | F | 未找到匹配的结算合同。 | 请检查以下解决方案：  <br>1. 从商户注册的多种货币中指定一种结算货币。  <br>2.  检查结算货币是否在结算合同中指定。  <br>3.  商户未签署结算合同。请联系支付宝技术支持。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果未解决，请联系支付宝技术支持。 |

要查看文档的最新更新，请访问 [发行说明](https://global.alipay.com/docs/releasenotes)。

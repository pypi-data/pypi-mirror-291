Use SDK to sign a request and verify the signature | Product APIs | Alipay Docs
===============
                        

[![Image 1: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/d66c43c0-440d-4c97-9976-f2028a2c8c5e.svg)![Image 2: Alipay, China's leading third-party online payment solution](https://ac.alipay.com/storage/2024/3/26/a48bd336-aea0-4f16-bf83-616eacbb4434.svg)](/docs/)

[Log In](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Fsignature_sdk)

[Go to Homepage](../../)

Product APIs

[Alipay APIs](/docs/ac/ams/api)

[Overview](/docs/ac/ams/api_fund)

[Idempotency](/docs/ac/ams/idempotency)

[Message encoding](/docs/ac/ams/me)

[Use SDK to sign a request and verify the signature](/docs/ac/ams/signature_sdk)

[Sign a request and verify the signature](/docs/ac/ams/digital_signature?pageVersion=34)

[API change history](/docs/ac/ams/changehistory)

Online payments

In-store payments

Use SDK to sign a request and verify the signature
==================================================

2024-05-29 10:14

Using the SDK provided by Antom for request signing and signature verification can significantly streamline your programming tasks and expedite the process of adding and validating API signatures. All available SDKs can be found in [SDKs](https://global.alipay.com/docs/sdks). If you prefer not to use the SDK, refer to the instructions of [Sign a request and verify the signature](https://global.alipay.com/docs/ac/ams/digital_signature).

To ensure the authenticity and integrity of data after transmission, Antom requires all requests to be signed and the signatures to be verified:

*   When calling an API, you must sign the request sent to Antom and verify the Antom response signature accordingly. For more information, see [Call an API](#zt532).
*   When receiving a notification, you must verify the Antom request signature. However, you do not need to sign the response for the notification. For more information, see [Receive a notification](#KpEOV).

Call an API
===========

Prerequisite
------------

Ensure that you have generated a pair of asymmetric public and private keys on the [Antom Dashboard](https://dashboard.alipay.com/global-payments/developers/quickStart). For more information, see [Generate keys](https://global.alipay.com/docs/dashboard_en#D584U).

Send Request & Handle Response
------------------------------

If you make an API call using SDK, the signing and verification process will be done automatically.

1.  Add maven dependency:

> You can find the latest version on [GitHub](https://github.com/alipay/global-open-sdk-java).

copy

    <dependency>
      <groupId>com.alipay.global.sdk</groupId>
      <artifactId>global-open-sdk-java</artifactId>
      <version>{latest_version}</version>
    </dependency>

2.  The following code sample shows how to use Java to send a request：

copy

    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RestController;
    
    import com.alipay.global.api.AlipayClient;
    import com.alipay.global.api.DefaultAlipayClient;
    import com.alipay.global.api.exception.AlipayApiException;
    import com.alipay.global.api.model.ams.*;
    import com.alipay.global.api.model.constants.EndPointConstants;
    import com.alipay.global.api.request.ams.pay.AlipayPayRequest;
    import com.alipay.global.api.response.ams.pay.AlipayPayResponse;
    
    @RestController
    public class PaymentBySDK {
    
        /**
         * alipay public key, used to verify signature
         */
        private static final String SERVER_PUBLIC_KEY = "";
    
        /**
         * your private key, used to sign
         * please ensure the secure storage of your private key to prevent leakage
         */
        private static final String CLIENT_PRIVATE_KEY = "";
    
        /**
         * you clientId
         */
        private static final String CLIENT_ID = "";
    
        public static AlipayClient defaultAlipayClient = new DefaultAlipayClient(EndPointConstants.SG, CLIENT_PRIVATE_KEY, SERVER_PUBLIC_KEY);
    
        @RequestMapping("/pay")
        public Object pay() {
            AlipayPayRequest alipayPayRequest = composePayRequest();
    
            AlipayPayResponse alipayPayResponse = null;
            try {
                // automatically sign and verify
                alipayPayResponse = defaultAlipayClient.execute(alipayPayRequest);
            } catch (AlipayApiException e) {
                String errorMsg = e.getMessage();
                // handle error condition
            }
            return alipayPayResponse;
        }
    
        private AlipayPayRequest composePayRequest() {
            AlipayPayRequest alipayPayRequest = new AlipayPayRequest();
    
            alipayPayRequest.setClientId(CLIENT_ID);
            alipayPayRequest.setPath("/ams/api/v1/payments/pay");
    
            Env env = new Env();
            env.setTerminalType(TerminalType.WEB);
            alipayPayRequest.setEnv(env);
    
            Amount amount = new Amount();
            amount.setCurrency("CNY");
            amount.setValue("100");
            alipayPayRequest.setPaymentAmount(amount);
    
            Amount orderAmount = new Amount();
            orderAmount.setCurrency("CNY");
            orderAmount.setValue("100");
    
            Order order = new Order();
            order.setReferenceOrderId("ORDER_ID_1685599933871");
            order.setOrderDescription("Testing order");
            order.setOrderAmount(orderAmount);
            alipayPayRequest.setOrder(order);
    
            PaymentMethod paymentMethod = new PaymentMethod();
            paymentMethod.setPaymentMethodType("ALIPAY_CN");
            alipayPayRequest.setPaymentMethod(paymentMethod);
    
            alipayPayRequest.setPaymentRequestId("REQUEST_ID_1685599933871");
    
            alipayPayRequest.setProductCode(ProductCodeType.CASHIER_PAYMENT);
    
            alipayPayRequest.setPaymentRedirectUrl("https://www.example.com");
            return alipayPayRequest;
        }
    
    }

Receive a notification
======================

Handle a request
----------------

After receiving a notification from Antom, verify the signature of the request. The process of verifying the request signature is similar to the process introduced in the [Send Request & Handle Response](#oTHvx) section. Follow these steps to verify the signature:

1.  Obtain the Antom public key for the request from [Prerequisite](#sxRYf) to verify the signature.
2.  Get the `request-time`、`client-id`、`signature` from the request header.
3.  Verify the signature.

The following code sample shows how to use Java to verify the signature:

copy

    import javax.servlet.http.HttpServletRequest;
    
    import org.springframework.http.ResponseEntity;
    import org.springframework.web.bind.annotation.PostMapping;
    import org.springframework.web.bind.annotation.RequestBody;
    import org.springframework.web.bind.annotation.RestController;
    
    import com.alipay.global.api.model.Result;
    import com.alipay.global.api.model.ResultStatusType;
    import com.alipay.global.api.response.AlipayResponse;
    import com.alipay.global.api.tools.WebhookTool;
    
    @RestController
    public class PaymentNotifyHandleBySDK {
    
        /**
         * alipay public key, used to verify signature
         */
        private static final String SERVER_PUBLIC_KEY = "";
                
        /**
         * payment result notify processor
         * using <a href="https://spring.io">Spring Framework</a>
         *
         * @param request    HttpServletRequest
         * @param notifyBody notify body
         * @return
         */
        @PostMapping("/payNotify")
        public Object payNotifyHandler(HttpServletRequest request, @RequestBody String notifyBody) {
    
            // retrieve the required parameters from http request.
            String requestUri = request.getRequestURI();
            String requestMethod = request.getMethod();
    
            // retrieve the required parameters from request header.
            String requestTime = request.getHeader("request-time");
            String clientId = request.getHeader("client-id");
            String signature = request.getHeader("signature");
    
            Result result;
            AlipayResponse response = new AlipayResponse();
    
            try {
                // verify the signature of notification
                boolean verifyResult = WebhookTool.checkSignature(requestUri, requestMethod, clientId, requestTime, signature, notifyBody, SERVER_PUBLIC_KEY);
                if (!verifyResult) {
                    throw new RuntimeException("Invalid notify signature");
                }
    
                // deserialize the notification body
                
                // update the order status with notify result
    
                // respond the server that the notification is received
                result = new Result("SUCCESS", "success", ResultStatusType.S);
    
            } catch (Exception e) {
                String errorMsg = e.getMessage();
                // handle error condition
                result = new Result("ERROR", errorMsg, ResultStatusType.F);
            }
            response.setResult(result);
            return ResponseEntity.ok().body(response);
        }
    
    }

To view the latest updates to the documentation, visit [Release notes](https://global.alipay.com/docs/releasenotes).

![Image 3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![Image 4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 Alipay [Legal Information](https://global.alipay.com/docs/ac/platform/membership)

#### Is this page helpful?

#### On this page

[Call an API](#zt532 "Call an API")

[Prerequisite](#sxRYf "Prerequisite")

[Send Request & Handle Response](#oTHvx "Send Request & Handle Response")

[Receive a notification](#KpEOV "Receive a notification")

[Handle a request](#a8PNS "Handle a request")
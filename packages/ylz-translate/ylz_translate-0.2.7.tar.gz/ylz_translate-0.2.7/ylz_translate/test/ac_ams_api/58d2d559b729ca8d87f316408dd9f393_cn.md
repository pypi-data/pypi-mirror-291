支付（自动扣款）| 产品API | 支付宝文档
==================

[![图片1：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_a52690f40beef33d7d37f1bda6f48c27.svg)![图片2：中国领先的第三方在线支付解决方案 - 支付宝](./img_m_d70d46fd32b98952674df01c03131d87.svg)](/docs/)

[登录](https://global.alipay.com/ilogin/account_login.htm?goto=https%3A%2F%2Fglobal.alipay.com%2Fdocs%2Fac%2Fams%2Fpayment_agreement)

[返回首页](../../)

产品API

[支付宝API](/docs/ac/ams/api)

在线支付

授权

保管箱

支付

[咨询（结账支付）](/docs/ac/ams/consult)

[支付（结账支付）](/docs/ac/ams/payment_cashier)

[创建支付会话（结账支付）](/docs/ac/ams/session_cashier)

[扣款（结账支付）](/docs/ac/ams/capture)

[支付（自动扣款）](/docs/ac/ams/payment_agreement)

创建支付会话（EasySafePay）
==========================

通知支付
========

通知捕获（结账支付）
====================

查询支付
========

取消支付
========

订阅
====

争议
====

退款
====

申报
====

店内支付
========

自动扣款
==========

2024-04-24 07:05

POST /v1/payments/pay

在用户同意授权后，使用此API发起自动扣款支付，并根据支付宝返回的状态和操作指示处理支付结果。

结构
===

消息由头和正文组成。以下部分专注于正文结构。关于请求头和响应头的结构，请参阅：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**: 除数组外，每个字段的数据类型均设置为字符串。这意味着字段值必须用双引号（" "）括起来。示例：

*   如果字段的数据类型为整数，其值为20，则应表示为 "20"。
*   如果字段的数据类型为布尔值，其值为true，则应表示为 "true"。

### 请求参数

显示全部

#### productCode 字符串  必填

表示正在使用的支付产品，根据合同规定。对于自动扣款，该值固定为 `AGREEMENT_PAYMENT`。

#### paymentRequestId 字符串  必填

商家为标识支付请求而分配的唯一ID。

关于此字段的更多信息...

*   此字段是一个API幂等性字段。商家使用paymentRequestId字段来实现幂等控制。对于使用相同paymentRequestId发起并达到最终状态（S或F）的支付请求，应返回相同的请求结果。
*   最大长度：64个字符

#### order 订单对象 **必需**

订单信息，包括买家、商家、商品、金额、配送信息和购买环境。此字段用于以下目的：

*   在支付过程中，主要用于支付宝的风险控制或反洗钱。
*   支付完成后，用于购买跟踪和监管报告等记录和报告目的。

显示子参数

#### paymentAmount 金额对象 **必需**

交易货币，遵循[ISO 4217](https://www.iso.org/iso-4217-currency-codes.html)标准的3位字母货币代码。

显示子参数

#### 支付方式 PaymentMethod 对象 必需

商家或收单机构用来收取款项的支付方式。

显示子参数

#### 支付过期时间 PaymentExpiryTime 日期时间

支付过期时间是指在该时间点之后，支付将过期，收单方或商家必须终止订单处理。默认的支付过期时间由合同规定。

注意事项：

*   如果您希望使用不同于默认时间的支付过期时间，请指定此字段。指定的支付过期时间必须在发送支付请求后的一分钟内，并且必须遵循正确的格式。
*   通常，对于自动借记，合同中的默认支付过期时间是在发送支付请求后的一分钟，例如，当时间是 2019-11-27T12:00:01+08:30 时，支付过期时间是 2019-11-27T12:01:01+08:30。

关于此字段的更多信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### settlementStrategy SettlementStrategy 对象 必需

支付请求的结算策略

显示子参数

#### creditPayPlan CreditPayPlan 对象

此支付的信用支付计划信息。

注意：如果要支持分期付款，请指定此字段，并联系支付宝技术支持获取关于如何提供分期付款的详细信息。

显示子参数

#### appId 字符串

支付宝分配的用于识别小程序应用的唯一ID。

注意：当 _terminalType_ 为 `MINI_APP` 时指定此字段。

关于此字段的更多信息

*   最大长度：32 个字符

#### paymentNotifyUrl URL

用于接收支付结果通知的URL。

注意：如果希望接收到自动扣款结果的异步通知，请在此字段中指定。您也可以在蚂蚁开放平台仪表盘中设置接收支付结果通知的URL。如果请求中和蚂蚁开放平台仪表盘都指定了支付通知URL，则以请求中指定的URL优先。

更多关于此字段的信息

*   最大长度：2048个字符

### 响应参数

显示全部

#### result 结果对象 **必需**

表示此API调用是否成功。如果API调用成功，表示自动扣款支付顺利完成。

显示子参数

#### paymentRequestId 字符串 

商家为标识一次支付请求而分配的唯一ID。

注意：此字段仅在API调用成功时返回。

更多关于此字段的信息

*   最大长度：64个字符

#### paymentId 字符串 

支付宝为标识一次支付分配的唯一ID。

注意：当API调用成功时，此字段将返回。

此字段的更多信息

*   最大长度：64个字符

#### paymentAmount - 金额对象

商家在订单货币中请求接收的支付金额。

注意：当API调用成功时，此字段将返回。

显示子参数

#### paymentTime - 日期时间

支付达到最终成功状态的日期和时间。

注意：当API调用成功时，此字段将返回。

此字段的更多信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### paymentCreateTime - 创建时间 - 日期时间

支付创建的日期和时间。

注意：当API调用成功时，此字段将返回。

此字段的更多信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，“2019-11-27T12:01:01+08:00”。

#### pspCustomerInfo PspCustomerInfo 对象

支付宝+移动支付提供商（Alipay+ MPP）的客户信息。

注意：当支付宝+ MPP可以提供相关信息时，此字段会被返回。

显示子参数

#### grossSettlementAmount Amount 对象

此字段的值等于交易金额乘以_settlementQuote_的值。当交易时预先确定货币兑换且汇率被锁定时，此字段会被返回。

显示子参数

#### settlementQuote Quote 对象

结算货币与交易货币之间的汇率。当_grossSettlementAmount_被返回时，此字段会被返回。

显示子参数

API 探索器

示例代码在沙箱中运行

### 请求

URL

北美

请求正文

Copy

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

{
"settlementStrategy": {
"settlementCurrency": "USD"
},
"order": {
"orderAmount": {
"currency": "PHP",
"value": "1100"
},
"orderDescription": "Mika's咖啡店",
"referenceOrderId": "ORDER_2020070316170XXXX"
},
"paymentAmount": {
"currency": "PHP",
"value": "1100"
},
"paymentMethod": {
"paymentMethodId": "28101003_20200703duEWYqq9p9RSzGbOisAnJ4NCKygW3KQSMYouR73Vuqn088630526XXXXX",
"paymentMethodType": "GCASH"
},
"paymentRequestId": "AGREEMENT_PAYMENT_REQUEST_2020070316170XXXX",
"productCode": "AGREEMENT_PAYMENT"
}

请注意，JSON键未翻译，以保持原始数据的完整性。此请求正文是用于支付的API调用，包含以下信息：

- 结算策略：指定结算货币为美元（USD）。
- 订单：订单金额为1100菲律宾比索（PHP），订单描述为"Mika's咖啡店"，参考订单ID为"ORDER_2020070316170XXXX"。
- 支付金额：同样为1100菲律宾比索（PHP）。
- 支付方式：使用GCASH，支付方法ID为一个特定的长字符串。
- 支付请求ID：标识此次支付请求的唯一ID，为"AGREEMENT_PAYMENT_REQUEST_2020070316170XXXX"。
- 产品代码：标识此交易类型为"AGREEMENT_PAYMENT"，可能指的是协议支付或分期付款等服务。

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

### 响应

响应体

Copy

1

2

3

4

5

6

7

8

9

10

11

12

13

14

{  
"paymentAmount": {  
"currency": "PHP",  
"value": "1100"  
},  
"paymentCreateTime": "2020-07-03T01:17:50-07:00",  
"paymentId": "2020070311401080010018840027964XXXX",  
"paymentRequestId": "AGREEMENT\_PAYMENT\_REQUEST\_2020070316170XXXX",  
"result": {  
"resultCode": "SUCCESS",  
"resultMessage": "成功",  
"resultStatus": "S"  
}  
}

请注意，这里的翻译已保留原始Markdown格式，并且没有翻译JSON键，以遵循您的要求。翻译内容如下：

### 响应

响应体

1

2

3

4

5

6

7

8

9

10

11

12

13

14

{
"支付金额": {
"货币": "PHP",
"值": "1100"
},
"支付创建时间": "2020-07-03T01:17:50-07:00",
"支付ID": "2020070311401080010018840027964XXXX",
"支付请求ID": "AGREEMENT\_PAYMENT\_REQUEST\_2020070316170XXXX",
"结果": {
"结果代码": "SUCCESS",
"结果信息": "成功",
"结果状态": "S"
}
}

已检查翻译，确保语句通顺。

很抱歉，我看到您输入的内容似乎是以希伯来文字符重复组成的，这可能是一个输入错误。如果您能提供需要翻译的英文或中文Markdown文档，我将非常乐意帮助您进行翻译。请确保文档内容是与蚂蚁金服的业务或金融技术相关，以便我提供专业且准确的翻译。

更多信息
-----------------

本节提供有关其他参数的额外信息。请参阅以下详细列表：

*   **订单(order)**: 支付宝不会校验_order_字段中的金额与支付请求中的金额是否一致，也不会在资金操作中使用订单信息。该字段主要用于风险控制、监管、合规报告以及消费记录展示。如果需要使用支付宝提供的风险控制能力，应使用_env_字段。

订单字段示例

Copy

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

*   _支付时间_（paymentTime）：支付宝成功执行此支付的时间，即支付达到最终成功状态的日期和时间。这个值用作后续可撤销和可退款时间的起始时间。例如，如果退款期限是6个月，那么接受退款的最终截止时间是_paymentTime_加上6个月。

结果处理逻辑
--------------------

对于不同的请求结果，需要执行不同的操作。详细信息如下：

*   如果_result.resultStatus_的值为`S`，则支付成功。
*   如果_result.resultStatus_的值为`F`，则支付失败。
*   如果_result.resultStatus_的值为`U`，支付状态未知。您可以等待支付结果的异步通知，并不断调用**inquiryPayment**接口查询支付结果，直到获取最终的支付结果。如果无法接收到异步通知，或者从inquiryPayment响应中未得到确定结果（`S`或`F`），应通过调用**cancel** API来终止交易，以保持您和用户之间的交易状态一致。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 支付成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 请咨询支付宝技术支持以获取详细原因。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不支持。 | 请咨询支付宝技术支持以获取详细原因。 |

| 错误代码 | 错误类型 | 错误信息 | 解决建议 |
| --- | --- | --- | --- |
| EXPIRED\_CODE | F | 支付码已过期。 | 用户需要刷新支付码。 |

| INVALID\_ACCESS\_TOKEN | F | 访问令牌已过期、被撤销或不存在。 | 检查访问令牌是否过期、被撤销或不存在。重新签署合同并重新启动授权签署流程。 |

| INVALID\_CONTRACT | F | 合同中的参数值与当前交易不符。 | 检查合同中的参数值是否与当前交易匹配。如果匹配，请联系支付宝技术支持以解决问题。 |

| INVALID\_MERCHANT\_STATUS | F | 商户状态异常，存在限制。 | 联系支付宝技术支持获取详细原因。 |

| INVALID\_PAYMENT\_CODE | F | 支付码不被支付宝+接受。 | 选择其他支付方式。如果支付方式被支持，请联系支付宝技术支持。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| INVALID\_PAYMENT\_METHOD\_META\_DATA | F | 支付方式的元数据无效。 | 检查支付方式的元数据是否正确。如果正确，请联系支付宝技术支持。 |

| KEY\_NOT\_FOUND | F | 找不到支付宝或商家的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在Antom仪表板上上传私钥。 |

| MERCHANT\_KYB\_NOT\_QUALIFIED | F | 由于商家的KYB状态，支付失败。商家可能未完成KYB认证，或者KYB状态不满足此交易要求。 | 请咨询支付宝技术支持以获取详细原因。 |

| MERCHANT\_NOT\_REGISTERED | F | 商家未注册。 | 使用注册接口注册商家。如果调用注册接口失败，请联系支付宝技术支持。 |

| 错误代码 | 类型 | 错误信息 | 解决方案 |
| --- | --- | --- | --- |
| NO\_INTERFACE\_DEF | F | 未定义API。 | 请检查URL是否正确。参考API文档中的端点信息。 |

 | 
| NO\_PAY\_OPTIONS | F | 无可用支付方式。 | 请联系蚂蚁金服技术支持获取详细原因。 |

 |

 | 
| ORDER\_IS\_CANCELED | F | 您发起的请求具有与之前已支付但被取消的交易相同的paymentRequestId。 | 使用新的_paymentRequestId_重新发起支付。 |

 |

 | 
| ORDER\_IS\_CLOSED | F | 您发起的请求具有与已存在且已关闭的交易相同的paymentRequestId。 | 使用新的_paymentRequestId_重新发起支付。 |

 |

 | 
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 请检查_paymentId_是否正确。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| PARAM\_ILLEGAL | F | 必需的参数未传递，或者存在非法参数。例如，非数字输入、无效日期，或者参数的长度和类型错误。 | 检查并确认当前API的必需请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PAYMENT\_AMOUNT\_EXCEED\_LIMIT | F | 支付金额超过了合同或钱包允许的最大金额。 | 检查支付金额是否超出限制，或使用更低金额重试。联系支付宝技术支持了解具体限制。 |
| PAYMENT\_COUNT\_EXCEED\_LIMIT | F | 支付次数超过了钱包指定的最大限制。 | 联系支付宝技术支持了解具体限制。 |

| 支付未达标 | F | 商户未达标，可能是因为未注册、未签订自动扣款协议或被禁止支付。 | 请咨询支付宝技术支持以获取具体原因。

|
| 业务处理失败 | F | 发生了一般的业务处理失败。 | 不要重试，通常需要人工干预。建议联系支付宝技术支持解决问题。

|
| 重复请求不一致 | F | 金额或币种与前一次请求不同。 | 确保所有请求字段相同，或使用新的_paymentRequestId_重新发起支付。

|
| 风险拒绝 | F | 请求因风险控制被拒绝。 | 通知用户请求因风险控制失败而被拒绝。

|
| 结算合约不匹配 | F | 未找到匹配的结算合约。 | 请检查以下解决方案：

*   选择商户签约的多种货币中的一种作为结算货币。
*   检查结算货币是否在结算合同中指定。
*   商户未签署结算合同。请联系支付宝技术支持。

 |
| SYSTEM\_ERROR | F | 发生系统错误。 | 不要重试，联系支付宝技术支持获取更多详细信息。

 |
| USER\_AMOUNT\_EXCEED\_LIMIT | F | 支付金额超过用户支付限额。 | 使用不超过账户可用余额的金额创建新的支付，或联系支付宝技术支持。

 |
| USER\_BALANCE\_NOT\_ENOUGH | F | 由于对应支付方式的用户余额不足，无法完成支付。 | 请充值账户或选择其他支付方式。

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| USER\_KYC\_NOT\_QUALIFIED | F | 由于用户的KYC状态导致支付失败。用户可能未完成KYC认证，或者KYC状态不满足此交易要求（例如，支付金额或产品信息的限制）。 | 首先完成KYC验证。 |
| USER\_NOT\_EXIST | F | 在钱包端用户不存在。 | 联系支付宝技术支持获取详细原因。 |
| USER\_PAYMENT\_VERIFICATION\_FAILED | F | 用户在OTP、PIN等验证方式中未能通过支付验证。 | 联系支付宝技术支持了解具体原因。 |
| USER\_STATUS\_ABNORMAL | F | 在钱包端用户的账户状态异常。 | 联系支付宝技术支持了解具体原因。 |
| PAYMENT\_IN\_PROCESS | U | 支付正在处理中。 | 等待异步通知或调用查询支付接口查询最终支付状态。 |

| 错误代码 | 类型 | 描述 | 解决方案 |
| --- | --- | --- | --- |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |

| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 调用inquiryPayment接口查询最终支付状态。如果问题未解决，请联系支付宝技术支持。 |

| VERIFY\_TIMES\_EXCEED\_LIMIT | F | 当前验证码在支付验证中失败次数过多。 | 用户必须获取新的验证码。 |

| VERIFY\_UNMATCHED | F | 验证码无效。 | 用户必须获取新的验证码。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png) ![图片4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 支付宝 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 本页面是否有帮助？
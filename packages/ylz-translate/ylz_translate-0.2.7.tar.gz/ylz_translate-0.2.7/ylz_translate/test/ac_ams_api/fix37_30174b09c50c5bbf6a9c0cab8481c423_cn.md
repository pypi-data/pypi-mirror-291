通知支付
========

2024-05-28 01:56

当支付处理达到成功或失败的最终状态时，支付宝使用**notifyPayment**将支付结果发送给商家。商家根据支付结果在商户端促进交易。

结构
===

消息由头和正文组成。以下部分专注于正文结构。头结构的详情请参阅：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**: 除数组外，每个字段的数据类型均设置为字符串。这意味着字段值必须用双引号（" "）括起来。示例：

*   如果字段的数据类型为整数，其值为20，则应表示为 "20"。
*   如果字段的数据类型为布尔值，其值为true，则应表示为 "true"。

### 请求参数

显示全部

#### notifyType 字符串  必填

支付状态通知的类型。有效值包括：

*   `PAYMENT_RESULT`：表示通知与支付结果有关。
*   `PAYMENT_PENDING`：表示用户已完成支付，商家需要等待最终的支付结果。

#### result Result对象  必填

支付结果的详细信息，如支付状态、结果代码和结果消息。

显示子参数

#### paymentRequestId 字符串  必填

商家为标识支付请求而分配的唯一ID。

关于此字段的更多信息

*   最大长度: 64 个字符

#### paymentId 字符串 **必需**

支付宝为识别一次支付分配的唯一ID。*paymentId* 与 *paymentRequestId* 之间存在一对一对应关系。

关于此字段的更多信息

*   最大长度: 64 个字符

#### paymentAmount Amount 对象 **必需**

商家在订单货币中请求收取的支付金额。

显示子参数

#### paymentCreateTime 日期时间 **必需**

支付创建的日期和时间。

关于此字段的更多信息

*   值遵循 [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) 标准格式。例如, "2019-11-27T12:01:01+08:00"。

#### paymentTime 日期时间 

支付达到最终成功状态的日期和时间。

注意: 只有当支付达到最终成功状态（*result.resultStatus* 的值为 `S`）时，此字段才会返回。

关于此字段的更多信息

*   值遵循[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)标准格式。例如，"2019-11-27T12:01:01+08:00"。

#### pspCustomerInfo PspCustomerInfo 对象

关于支付宝+移动支付提供商（支付宝+ MPP）的客户信息。

注意：只有当支付宝+ MPP可以提供相关信息时，此字段才会返回。

显示子参数

#### customsDeclarationAmount Amount 对象

海关申报的总额。

注意：此字段仅在支付成功且钱包为 AlipayCN 时返回。

显示子参数

#### grossSettlementAmount Amount 对象

此字段的值等于交易金额乘以 *settlementQuote* 的值。当货币兑换预先确定且交易时汇率被锁定时，此字段会返回。

显示子参数

#### settlementQuote Quote 对象

结算货币与交易货币之间的汇率。当返回*grossSettlementAmount*时，此字段会被返回。

显示子参数

#### acquirerReferenceNo 字符串

非支付宝收单方为交易分配的唯一ID。

关于此字段的更多信息

*   最大长度：64个字符

#### paymentResultInfo PaymentResultInfo 对象

支付结果信息。

当在[**pay**](https://global.alipay.com/docs/ac/ams/payment_cashier) API中的*paymentMethodType*值为`CARD`, `GRABPAY_MY`, 或 `GRABPAY_SG`时，返回此参数。

选择场景

#### promotionResult PromotionResult 对象数组

促销结果。

当买家在下单时应用了促销时，返回此参数。

显示子参数

### 响应参数

显示全部

#### result Result 对象 **必需**

一个固定值，发送给支付宝以确认已接收到通知。

显示子参数

API 探索器

### 请求

案例

支付成功

请求体

```json
{
  "notifyType": "PAYMENT_RESULT",
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "success"
  },
  "paymentRequestId": "2020010123456789XXXX",
  "paymentId": "2020010123456789XXXX",
  "paymentAmount": {
    "value": "8000",
    "currency": "EUR"
  },
  "paymentCreateTime": "2020-01-01T12:01:00+08:30",
  "paymentTime": "2020-01-01T12:01:01+08:30"
}
```
### 响应

响应体

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "Success"
  }
}
```

更多信息
-----------------

本节提供有关关键参数的额外信息。请参阅以下参数以获取详细信息：

* *paymentTime*：支付宝成功执行此支付的时间，即支付达到最终成功状态的日期和时间。这个值用作后续可撤销和可退款时间的起始时间。例如，如果退款期限是6个月，那么接受退款的最终截止时间是 *paymentTime* 加上6个月。

结果处理逻辑
--------------------

在接收到通知后，向支付宝发送包含固定值的消息，以确认已收到支付宝的通知：

示例代码

```json
{
 "result": {
    "resultCode":"SUCCESS",
    "resultStatus":"S",
    "resultMessage":"success"
 }
}
```

如果没有因为操作问题或网络问题返回给支付宝相应的消息，支付宝会持续重试发送通知，直到商家返回所需的消息。首次通知发送后的24小时内，支付宝会进行重试，最多重试8次，重试间隔依次为0秒、2分钟、10分钟、10分钟、1小时、2小时、6小时和15小时。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 支付成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决问题。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不支持。 | 联系支付宝技术支持获取详细原因。 |
| EXPIRED\_CODE | F | 支付码已过期。 | 用户需要刷新支付码。 |
| FRAUD\_REJECT | F | 由于风险控制，交易无法进一步处理。如果用户已支付交易，交易将被退款。 | 当满足以下条件之一时联系支付宝技术支持：<br>*   您想要申诉。<br>*   用户在两周内未收到退款。 |
| INVALID\_ACCESS\_TOKEN | F | 访问令牌已过期、被撤销或不存在。 | 检查*accessToken*是否过期、被撤销或不存在。重新签署合同并重新启动授权签名流程。 |
| INVALID\_CONTRACT | F | 合同中的参数值与当前交易不符。 | 检查合同中的参数值是否与当前交易匹配。如果匹配，请联系支付宝技术支持以解决问题。 |
| INVALID\_MERCHANT\_STATUS | F | 商家状态异常，存在限制。 | 联系支付宝技术支持获取详细原因。 |
| KEY\_NOT\_FOUND | F | 找不到支付宝或商家的私钥或公钥。 | 检查私钥或公钥是否存在。如果不存在，请在支付宝开发者中心上传私钥。 |
| MERCHANT\_BALANCE\_NOT\_ENOUGH | F | 商户余额不足。 | 确保商户有足够的余额后，再调用接口。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点。 |
| NO\_PAY\_OPTIONS | F | 无可用的支付方式。 | 请咨询Antom技术支持以获取详细原因。 |
| ORDER\_IS\_CLOSED | F | 交易已关闭，无法再次支付。 | 使用新的*paymentRequestId*发起支付。 |
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 检查*paymentId*是否正确。 |
| PARAM\_ILLEGAL | F | 必需参数未传递，或存在非法参数。例如，非数字输入，无效日期，或参数长度和类型错误。 | 检查并验证当前API所需的请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PAYMENT\_AMOUNT\_EXCEED\_LIMIT | F | 付款金额超过了合同或支付方式允许的最大金额。 | 检查付款金额是否超出限制，如超出，请使用较低金额重试。联系支付宝技术支持了解具体限制。 |
| PAYMENT\_COUNT\_EXCEED\_LIMIT | F | 支付次数超过了支付方式指定的最大限制。 | 联系支付宝技术支持了解具体限制。 |
| PAYMENT\_NOT\_QUALIFIED | F | 商家未达到支付资格，可能是因为未注册、未签订自动扣款协议或被禁止支付。 | 联系支付宝技术支持获取详细原因。 |
| PROCESS\_FAIL | F | 发生了一般的业务处理失败。 | 不要重试，通常需要人工干预。建议联系支付宝技术支持解决此问题。 |
| RISK_REJECT | F | 由于风险控制，交易无法进一步处理。如果用户已经为交易付款，交易将会被退款。 | 如果用户在两周内未收到退款，请联系支付宝技术支持。
| PAYMENT_IN_PROCESS | U | 支付正在处理。 | 您发起的请求具有与现有交易相同的*paymentRequestId*，该交易可能已成功或正在处理中。检查响应中是否返回了*redirectActionForm.redirectUrl*。如果返回，将用户重定向到redirectUrl指定的地址以完成支付。如果没有返回，支付可能已经完成。详细结果处理逻辑请参阅相关文档。 |
| SUSPECTED\_RISK | F | 由于疑似安全问题，交易无法继续处理。您可以在工作日后一天重试交易。如果交易不安全且用户已付款，交易将被退款。 | 当满足以下任一条件时，请联系支付宝技术支持：<br>* 重试后交易仍无法处理。<br>* 用户在两周内未收到退款。 |
| SYSTEM\_ERROR | F | 发生系统错误。 | 不要重试，联系支付宝技术支持以获取更多详细信息。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果问题未解决，请联系支付宝技术支持。 |
| USER\_AMOUNT\_EXCEED\_LIMIT | F | 支付金额超过用户支付限额。 | 使用不超过账户可用余额的金额创建新支付，或联系支付宝技术支持。 |
| USER\_BALANCE\_NOT\_ENOUGH | F | 由于用户在相应支付方式中的余额不足，无法完成支付。 | 请充值账户或选择其他支付方式。 |
| USER\_KYC\_NOT\_QUALIFIED | F | 由于用户的KYC状态，支付失败。用户可能未完成KYC认证，或者KYC状态不满足此交易要求（例如，支付金额或产品信息的限制）。 | 首先完成KYC验证。 |
| USER\_NOT\_EXIST | F | 钱包端不存在该用户。 | 请联系支付宝技术支持获取详细原因。 |
| USER\_PAYMENT\_VERIFICATION\_FAILED | F | 用户在支付方式端被限制支付。 | 联系支付宝技术支持了解具体原因。 |
| USER\_STATUS\_ABNORMAL | F | 用户在支付方式端的状态异常。 | 联系支付宝技术支持了解具体原因。 |
| VERIFY\_TIMES\_EXCEED\_LIMIT | F | 当前验证码在支付验证中失败次数过多。 | 用户必须获取新的验证码。 |
| VERIFY\_UNMATCHED | F | 验证码无效。 | 用户必须获取新的验证码。 |
| AUTHENTICATION\_REQUIRED | F | 需要进行3D Secure认证。 | 重新发起支付并引导用户进行3D Secure认证。 |
| PAYMENT\_PROHIBITED | F | 由于商品在该国家禁止销售，无法处理支付。 | 该交易不允许申诉。 |
| CARD\_NOT\_SUPPORTED | F | 用于交易的卡片不被支持。 | 使用其他卡片进行支付。 |
| INVALID\_EXPIRATION\_DATE | F | paymentMethod.paymentMethodMetaData.expiryYear 或 paymentMethod.paymentMethodMetaData.expiryDate 的值无效。 | 检查 *paymentMethod.paymentMethodMetaData.expiryYear* 或 *paymentMethod.paymentMethodMetaData.expiryDate* 的值是否正确：<br>1. 如果不正确，请传入正确的值。<br>2. 如果正确，请联系支付宝技术支持获取详细原因。 |
| INVALID\_CARD\_NUMBER | F | 用于交易的卡片号无效。 | 检查 *paymentMethod.paymentMethodMetaData.cardno* 的值是否正确：<br>1. 如果不正确，请输入正确的值并重试。<br>2. 如果正确，该卡片不支持此交易，请使用其他卡片支付。 |
| DO\_NOT\_HONOR | F | 发卡银行拒绝支付。 | 使用不同的卡重试支付或联系发卡银行。|
| INVALID\_AMOUNT | F | 交易因多种原因被发卡银行拒绝。例如，指定的金额无效或超过最大金额限制。 | 请咨询支付宝技术支持获取详细原因。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

通知退款
==========

2024-05-13 02:56

POST /undefined

支付宝使用**notifyRefund**在退款处理成功或失败的最终状态下，将退款结果发送给商家。商家根据退款结果在商户端推进交易。

结构
====

消息由头部和主体组成。以下部分专注于主体结构。头部结构请参考：

*   [请求头](https://global.alipay.com/docs/ac/ams/api_fund#ML5ur)
*   [响应头](https://global.alipay.com/docs/ac/ams/api_fund#WWH90)

**注意**：除数组外，每个字段的数据类型应设置为字符串。这意味着字段值必须用双引号（" "）包围。例如：

*   如果字段的数据类型是Integer，其值为20，则设置为"20"。
*   如果字段的数据类型是Boolean，其值为true，则设置为"true"。

### 请求参数

显示全部

#### notifyType 字符串  必需

退款状态通知的类型。有效值为：

*   `REFUND_RESULT`: 表示通知与退款结果有关。

#### result 结果对象 **必需**

退款结果的详细信息，如退款状态、结果代码和结果消息。

显示子参数

#### refundStatus 字符串 **必需**

表示退款结果。有效值为：

*   `SUCCESS`: 表示退款成功。 
*   `FAIL`: 表示退款失败。 

#### refundRequestId 字符串 **必需**

商家为识别退款请求分配的唯一ID。

关于此字段的更多信息

*   最大长度：64 个字符

#### refundId 字符串 **必需**

支付宝为识别退款分配的唯一ID。与 *paymentId* 和 *paymentRequestId* 之间存在一对一对应关系。

关于此字段的更多信息

*   最大长度：64 个字符

#### refundAmount 金额对象 **必需**

商家发起的退款金额。

显示子参数

#### refundTime 日期时间

退款成功或失败的最终状态的日期和时间。

注意：此字段在退款成功（*result.resultStatus* 的值为 `S`）时返回。

#### grossSettlementAmount Amount 对象

退款结算金额，等于退款金额乘以 *settlementQuote* 的值。当货币兑换在交易时预先确定且汇率被锁定时，此字段返回。

显示子参数

#### settlementQuote Quote 对象

结算货币和交易货币之间的汇率。当返回 *grossSettlementAmount* 时，此字段返回。

显示子参数

### 响应参数

显示全部

#### result Result 对象 **必需**

一个固定值，发送给支付宝以确认已接收到通知。

显示子参数

API 探索器

### 请求

请求体

```json
{
  "notifyType": "REFUND_RESULT",
  "refundAmount": {
    "currency": "HKD",
    "value": "10000"
  },
  "refundId": "2021080419401080130018866020092XXXX",
  "refundRequestId": "amsdemorefund_zhangyikai_zyk_20210804_165236_931",
  "refundStatus": "SUCCESS",
  "refundTime": "2021-08-04T01:52:37-07:00",
  "result": {
    "resultCode": "SUCCESS",
    "resultMessage": "Success",
    "resultStatus": "S"
  }
}
```

### 响应

响应体

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "Success"
  }
}
```

结果处理逻辑
--------------------

在接收到支付宝的通知后，使用固定值发送以下消息给支付宝，以确认已收到支付宝的通知：

示例代码

```json
{
 "result": {
    "resultCode":"SUCCESS",
    "resultStatus":"S",
    "resultMessage":"success"
 }
}
```

如果由于操作问题或网络问题，支付宝没有收到返回的消息，支付宝会重发通知，直到商家返回所需的消息。首次通知发送后24小时内会进行重发，最多重发8次，重发间隔为0秒、2分钟、10分钟、10分钟、1小时、2小时、6小时和15小时。

### 结果/错误代码

| 代码 | 值 | 消息 | 进一步操作 |
| --- | --- | --- | --- |
| SUCCESS | S | 成功 | 退款成功，无需进一步操作。 |
| ACCESS\_DENIED | F | 访问被拒绝。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_API | F | 调用的API无效或未激活。 | 联系支付宝技术支持解决问题。 |
| CLIENT\_INVALID | F | 客户端ID无效。支付宝对客户端ID有限制。 | 检查客户端ID是否正确，或联系支付宝技术支持获取详细原因。 |
| CURRENCY\_NOT\_SUPPORT | F | 货币不支持。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_CONTRACT | F | 合同中的参数值与当前交易不符。 | 检查合同中的参数值是否与当前交易匹配。如果匹配，请联系支付宝技术支持排查问题。 |
| INVALID\_MERCHANT\_STATUS | F | 商户状态异常，存在限制。 | 联系支付宝技术支持获取详细原因。 |
| INVALID\_SIGNATURE | F | 签名验证失败。用于签署请求的私钥与Antom Dashboard的公钥不匹配。 | 确保用于签署请求的私钥与Antom Dashboard的公钥匹配。参考以下签名信息：<br>* 请求头中的[签名](https://global.alipay.com/docs/ac/ams/api_fund)字段<br>* 如何[计算签名](https://global.alipay.com/docs/ac/ams/digital_signature) |
| KEY\_NOT\_FOUND | F | 支付宝或商家的私钥或公钥未找到。 | 检查私钥或公钥是否存在。如果不存在，请在Antom Dashboard上上传私钥。 |
| MEDIA\_TYPE\_NOT\_ACCEPTABLE | F | 服务器不支持客户端可接受的媒体类型。 | 检查媒体类型是否正确，并使用支付宝接受的媒体类型。 |
| MERCHANT\_BALANCE\_NOT\_ENOUGH | F | 商户余额不足。 | 等待商户余额充足后再次调用接口。重试时需要更改*refundRequestId*字段。 |
| MERCHANT\_NOT\_REGISTERED | F | 商户未注册。 | 请使用注册接口注册商户。如果调用注册接口失败，请联系支付宝技术支持。 |
| METHOD\_NOT\_SUPPORTED | F | 服务器不支持请求的HTTP方法。仅支持POST方法。 | 确保使用的HTTP方法为POST。 |
| MULTIPLE\_REFUNDS\_NOT\_SUPPORTED | F | 由于合同限制，不支持多次退款。 | 检查是否存在多次退款。请勿再次调用退款接口。每次退款仅调用接口一次。 |
| NO\_INTERFACE\_DEF | F | API未定义。 | 检查URL是否正确。请参考API文档中的端点信息。 |
| ORDER\_IS\_CLOSED | F | 交易已关闭，无法再次支付。 | 使用新的*paymentRequestId*重新发起退款。 |
| ORDER\_NOT\_EXIST | F | 订单不存在。 | 检查*paymentId*是否正确。如果正确，请联系支付宝技术支持以获取具体原因。 |
| ORDER\_STATUS\_INVALID | F | 订单状态无效。交易正在进行中或交易失败。 | 检查订单状态并采取相应行动。如果交易正在进行中，请等待。如果交易失败，不要发起退款。联系支付宝技术支持以获取具体原因。 |
| PARAM\_ILLEGAL | F | 缺少必需的参数，或者存在非法参数。例如，非数字输入，无效的日期，或参数的长度和类型错误。 | 检查并验证当前API所需的请求字段（包括头部字段和正文字段）是否正确传递并有效。 |
| PROCESS\_FAIL | F | 发生了一般性的业务失败。 | 不要重试。通常需要人工干预。建议联系支付宝技术支持以解决问题。 |
| REFUND\_AMOUNT\_EXCEED | F | 退款总额超过了支付金额。 | 确认退款总额是否超过支付金额。创建一个新的退款请求，金额应小于或等于支付金额，或联系支付宝技术支持。 |
| REFUND\_WINDOW\_EXCEED | F | 退款日期超出了合同约定的退款期限。 | 确认退款日期是否超过退款期限。检查合同中的退款期限，或联系支付宝技术支持获取具体的退款期限。 |
| REPEAT\_REQ\_INCONSISTENT | F | 金额或币种与之前的请求不一致。 | 确保所有请求中的字段相同，或使用新的*paymentRequestId*重新发起退款。 |
| RISK\_REJECT | F | 由于风险控制，请求被拒绝。 | 通知用户请求因风险控制失败而被拒绝。 |
| SYSTEM\_ERROR | F | 发生系统错误。 | 不要重试，联系支付宝技术支持获取更多详情。 |
| REFUND\_IN\_PROCESS | U | 退款正在处理中。 | 等待异步通知或调用**查询退款**接口查询最终退款状态。不要重试退款请求。 |
| REQUEST\_TRAFFIC\_EXCEED\_LIMIT | U | 请求流量超过限制。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |
| UNKNOWN\_EXCEPTION | U | 由于未知原因，API调用失败。 | 重新调用接口以解决问题。如果未解决，联系支付宝技术支持。 |

要查看文档的最新更新，请访问[发行说明](https://global.alipay.com/docs/releasenotes)。

![图片3](https://ac.alipay.com/storage/2021/5/20/19b2c126-9442-4f16-8f20-e539b1db482a.png)![图片4](https://ac.alipay.com/storage/2021/5/20/e9f3f154-dbf0-455f-89f0-b3d4e0c14481.png)

@2024 蚂蚁金服 [法律信息](https://global.alipay.com/docs/ac/platform/membership)

#### 这个页面是否有帮助？
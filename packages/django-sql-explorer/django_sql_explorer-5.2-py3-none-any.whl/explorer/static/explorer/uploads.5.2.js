import{g as p}from"./csrf.5.2.js";function h(){var o=document.getElementById("drop-area"),c=document.getElementById("fileElem"),s=document.getElementById("progress-bar"),i=document.getElementById("upload-status");o&&(o.onclick=function(){c.click()},o.addEventListener("dragover",function(e){e.preventDefault(),o.classList.add("bg-info")}),o.addEventListener("dragleave",function(e){o.classList.remove("bg-info")}),o.addEventListener("drop",function(e){e.preventDefault(),o.classList.remove("bg-info");let r=e.dataTransfer.files;r.length&&u(r[0])}),c.onchange=function(){this.files.length&&u(this.files[0])});function u(e){m(e)}function m(e){let r=new FormData;r.append("file",e);let n=document.getElementById("append"),d=n.value;d&&r.append("append",d);let t=new XMLHttpRequest;t.open("POST","../upload/",!0),t.setRequestHeader("X-CSRFToken",p()),t.upload.onprogress=function(a){if(a.lengthComputable){let l=a.loaded/a.total*100;s.style.width=l+"%",s.setAttribute("aria-valuenow",l),s.innerHTML=l.toFixed(0)+"%",l>99&&(i.innerHTML="Upload complete. Parsing and saving to S3...")}},t.onload=function(){if(t.status===200){let a=d?n.options[n.selectedIndex].text:e.name.substring(0,e.name.lastIndexOf("."))||e.name;window.location.href=`../?highlight=${encodeURIComponent(a)}`}else console.error("Error:",t.response),i.innerHTML=t.response},t.onerror=function(){console.error("Error:",t.statusText),i.innerHTML=t.response},t.send(r)}let f=document.getElementById("test-connection-btn");f&&f.addEventListener("click",function(){let e=document.getElementById("db-connection-form"),r=new FormData(e);fetch("../validate/",{method:"POST",body:r,headers:{"X-CSRFToken":p()}}).then(n=>n.json()).then(n=>{n.success?alert("Connection successful!"):alert("Connection failed: "+n.error)}).catch(n=>console.error("Error:",n))})}export{h as setupUploads};

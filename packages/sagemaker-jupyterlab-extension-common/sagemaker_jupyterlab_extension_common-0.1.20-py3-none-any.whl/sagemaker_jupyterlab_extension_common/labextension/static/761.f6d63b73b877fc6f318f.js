"use strict";(self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common=self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common||[]).push([[761],{761:(e,t,a)=>{a.r(t),a.d(t,{ILogger:()=>N,default:()=>ee,logSchemas:()=>h});var o=a(663),r=a(281);const n="@amzn/sagemaker-jupyterlab-extension-common:logger",s="@amzn/sagemaker-jupyterlab-extension-common:jumpstart-deeplinking",i=[200,201],c="/aws/sagemaker/api/context",l="/api/ai/config";var d=a(768),u=a(321),m=a.n(u);const p=(e,t,a,n)=>{const s=[],i=()=>{((e,t,a)=>{const n=r.PageConfig.getBaseUrl(),s=`${n}${a}`,i=o.ServerConnection.makeSettings({baseUrl:n}),c={method:"POST",body:JSON.stringify({events:e})},l={retries:t,onFailedAttempt:e=>{console.warn({message:`Deliver events attempt (${e.attemptNumber}) with (${e.retriesLeft}) retries remaining.`,error:e})}};m()((async()=>{let e;try{e=await o.ServerConnection.makeRequest(s,c,i)}catch(e){throw e instanceof TypeError&&Object.setPrototypeOf(e,Error.prototype),e}if(!e.ok)throw new Error(e.statusText)}),l).catch((t=>{console.error({message:`Failed to deliver events after (${l.retries}) retries.`,error:t,events:e})}))})(s.splice(0),e,n)};return setInterval(i,t),(e,t)=>{const o=a-s.length;s.push(...t.slice(0,o)),t.length>o&&(i(),console.log("Logger plugin max buffer size exceeded."))}},h={operationalLogger:{schemaId:"http://sagemaker.studio.jupyterlab.ui.log.schema",schemaVersion:1},performance:{schemaId:"http://sagemaker.studio.jupyterlab.ui.performance.schema",schemaVersion:1}},g=Object.keys(h).map((e=>h[e].schemaId)),v="__INJECT__",{name:w,version:y}=a(147),b=()=>{const e=p(2,5e3,1e4,"aws/sagemaker/api/jumpstart/eventlog");return new d.EventLog({allowedSchemas:g,handlers:[e]})},f="Cookie Preferences";var E;!function(e){e.POST="POST",e.GET="GET",e.PUT="PUT"}(E||(E={}));class _ extends Error{constructor(e,t,a,o){super(e),this.errorStatus=t,this.errorCode=a,this.cause=o,Object.setPrototypeOf(this,_.prototype)}}const S=async(e,t,a,n)=>{var s,c;const l=o.ServerConnection.makeSettings({}),d=r.URLExt.join(l.baseUrl,e),u={method:t};a&&(u.body=a),n&&(u.headers=n);const m=await o.ServerConnection.makeRequest(d,u,l);if(!i.includes(m.status)){const e=await m.json(),t=null!==(s=e.errorCode)&&void 0!==s?s:void 0,a=null!==(c=e.errorMessage)&&void 0!==c?c:"unable to fetch data";throw new _(a,m.status,t)}return m};var k=a(29),j=a.n(k),O=a(586);const x={ShortBreadFooter:a(933).css`
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  line-height: 24px;
`},L=()=>((0,k.useEffect)((()=>{(()=>{const e=document.createElement("script");e.src="https://prod.assets.shortbread.aws.dev/shortbread.js",e.type="text/javascript",e.async=!0,document.head.appendChild(e),e.onload=()=>window.AWSCShortbreadInstance=(()=>{const e=window.AWSCShortbread({domain:window.location.hostname,hasConsoleNavFooter:!0});return e.checkForCookieConsent(),e})();const t=document.createElement("link");t.href="https://prod.assets.shortbread.aws.dev/shortbread.css",t.rel="stylesheet",document.head.appendChild(t)})()}),[]),j().createElement("div",{className:x.ShortBreadFooter},j().createElement("span",{onClick:()=>{const e=window.AWSCShortbreadInstance;e&&e.customizeCookies()},style:{cursor:"pointer"}},f)));class I extends O.ReactWidget{render(){return j().createElement(L,null)}}var C=a(655);const R={id:"@amzn/sagemaker-jupyterlab-extension-common:panorama",autoStart:!0,requires:[C.IStatusBar],activate:(e,t)=>{(async e=>{try{await e.started;const t=document.getElementById("main"),a=await S(c,E.GET),o=await a.json();if(!t)throw new Error("JupyterLab application or region not found in DOM");((e,t)=>{if(!e)throw new Error("Failed to get region");const a=document.createElement("script"),o=t&&"prod"===t.toLocaleLowerCase()?"Prod":"NonProd";a.src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js",a.id="awsc-panorama-bundle",a.type="text/javascript",a.setAttribute("data-config",`{"appEntity": "aws-sagemaker", "region": "${e}", "service" :"sagemaker-jupyterlab", "domain": "${o}"}`),document.head.appendChild(a)})(o.region,o.stage)}catch(e){}})(e);const a=new I;t.registerStatusItem("@amzn/sagemaker-jupyterlab-extension-common:widget:shortbread-status",{item:a,align:"right",rank:599,isActive:()=>!0})}};var T,M=a(930);!function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(T||(T={}));const N=new M.Token(n);var A;!function(e){e.SMStudio="SageMaker Studio",e.SMStudioSSO="SageMaker Studio SSO",e.MD="MD"}(A||(A={}));var D=a(13);class z{constructor(e,t,a){this.trace=e=>this.record(e,T.TRACE),this.debug=e=>this.record(e,T.DEBUG),this.info=e=>this.record(e,T.INFO),this.warn=e=>this.record(e,T.WARN),this.error=e=>this.record(e,T.ERROR),this.fatal=e=>this.record(e,T.FATAL),this.child=(e,t,a)=>{const o=t||this.schema,r=a||this.eventLog;return new z(r,o,{...this.context,...e})},this.eventLog=e,this.schema=t,this.context={...a,AccountId:v,SpaceName:v}}format(e,t){if("Error"in e&&void 0!==e.Error){const a={...e,Name:e.Error.name,Message:e.Error.message,Stack:e.Error.stack,Level:t,Context:this.context};return delete e.Error,a}return{...e,Level:t,Context:this.context}}record(e,t){return this.eventLog.recordEvent({version:this.schema.schemaVersion,schema:this.schema.schemaId,body:this.format(e,t)})}}const $={id:n,autoStart:!0,provides:N,activate:e=>{const t={SessionId:(e=>{const t=window.sessionStorage.getItem(e);let a;return null==t?(a={id:(0,D.v4)(),startTime:(new Date).toISOString()},window.sessionStorage.setItem(e,JSON.stringify(a))):a=JSON.parse(t),a})(n).id},a=p(2,5e3,1e4,"aws/sagemaker/api/eventlog"),o=new d.EventLog({allowedSchemas:g,handlers:[a]});return new z(o,h.operationalLogger,t)}};var q,V=a(85);!function(e){e.NOTEBOOK_NOT_AVAILABLE="NOTEBOOK_NOT_AVAILABLE",e.NOTEBOOK_SIZE_TOO_LARGE="NOTEBOOK_SIZE_TOO_LARGE",e.INVALID_REQUEST="INVALID_REQUEST",e.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR"}(q||(q={}));const U={errorTitle:"Unable to open JumpStart notebook",defaultErrorMessage:"Something went wrong when opening the JumpStart notebook.",notebookNotFoundErrorMessage:"The JumpStart notebook does not exist or is not supported in the current region.",notebookSizeTooLargeErrorMessage:"The notebook size is too large.",invalidRequestErrorMessage:"A request to open the JumpStart notebook is invalid."};let F=!1;const J=async e=>(0,O.showErrorMessage)(U.errorTitle,{message:e}),P={id:s,requires:[V.IRouter,N],autoStart:!0,activate:async(e,t,a)=>{const{commands:o}=e,n="jumpstart:open-notebook-for-deeplinking",i=((e,t,a)=>{var o;const r={[s]:b()};return e.child({ExtensionName:w,ExtensionVersion:y,PluginId:t},void 0,null!==(o=r[t])&&void 0!==o?o:void 0)})(a,s);o.addCommand(n,{execute:()=>(async(e,t,a)=>{if(!F)try{const{search:o}=e.current;if(!o)return await J(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: Query params must be specified")});const{key:n,model_id:s,endpoint_name:i,resource_type:c,inference_component:l,set_default_kernel:d}=r.URLExt.queryStringToObject(o);if(!n)return await J(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: the notebook key must be specified.")});const u={key:n,...c&&{resource_type:c},...s&&{model_id:s},...i&&{endpoint_name:i},...l&&{inference_component:l},...d&&{set_default_kernel:d}},m=await(async(e,t)=>{const a=(0,D.v4)();let o;t.info({Message:"Fetching JumpStart Notebook",ClientRequestId:a});try{o=await S("aws/sagemaker/api/jumpstart/notebook",E.POST,JSON.stringify(e),{"x-client-req-id":a})}catch(e){throw t.error({Error:new Error(`Error executing open notebook: ${e}`),ClientRequestId:a}),e}const r=o.headers.get("x-server-req-id")||"SERVER_REQUEST_ID_MISSING";t.info({Message:"Successfully fetched JumpStart Notebook",ClientRequestId:a,ServerRequestId:r});const n=await o.json(),{notebookPath:s}=n;return s})(u,a);t.restored.then((()=>{t.commands.execute("docmanager:open",{factory:"Notebook",path:m})})),a.info({Message:"Successfully loaded the JumpStart Deeplinking plugin"})}catch(e){return e instanceof _?void await(async e=>{switch(e){case q.NOTEBOOK_NOT_AVAILABLE:await J(U.notebookNotFoundErrorMessage);break;case q.NOTEBOOK_SIZE_TOO_LARGE:await J(U.notebookSizeTooLargeErrorMessage);break;case q.INVALID_REQUEST:await J(U.invalidRequestErrorMessage);break;case q.INTERNAL_SERVER_ERROR:default:await J(U.defaultErrorMessage)}})(q[e.errorCode]):(await J(U.defaultErrorMessage),void a.error({Error:new Error(`Error executing open notebook: ${e}`)}))}finally{F=!0}})(t,e,i)}),t.register({command:n,pattern:new RegExp("[?]command=open-jumpstart-notebook"),rank:10})}},B=new(a(316).LabIcon)({name:"@amzn/sagemaker-jupyterlab-extension-common:q-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128" fill="none">\n  <path\n    d="M113.31 25.53L72.66 2.06C70.28 0.68 67.14 0 64 0C60.86 0 57.72 0.69 55.34 2.06L14.69 25.53C9.93003 28.28 6.03003 35.03 6.03003 40.53V87.47C6.03003 92.97 9.93003 99.72 14.69 102.47L55.34 125.94C57.72 127.32 60.86 128 64 128C67.14 128 70.28 127.31 72.66 125.94L113.31 102.47C118.07 99.72 121.97 92.97 121.97 87.47V40.53C121.97 35.03 118.07 28.28 113.31 25.53ZM67.66 117.28C67.19 117.55 65.9 118 64 118C62.1 118 60.8 117.55 60.34 117.28L19.69 93.81C18.01 92.84 16.03 89.4 16.03 87.47V40.53C16.03 38.59 18.01 35.16 19.69 34.19L60.34 10.72C60.81 10.45 62.1 10 64 10C65.9 10 67.2 10.45 67.66 10.72L108.31 34.19C109.99 35.16 111.97 38.6 111.97 40.53V85.92L74 64V59.67C74 58.78 73.52 57.95 72.75 57.51L65.25 53.18C64.86 52.96 64.43 52.85 64 52.85C63.57 52.85 63.14 52.96 62.75 53.18L55.25 57.51C54.48 57.96 54 58.78 54 59.67V68.33C54 69.22 54.48 70.05 55.25 70.49L62.75 74.82C63.14 75.04 63.57 75.15 64 75.15C64.43 75.15 64.86 75.04 65.25 74.82L69 72.65L106.97 94.57L67.66 117.26V117.28Z"\n    fill="currentColor" />\n</svg>'});function G(e){if(e.shell instanceof V.LabShell){const t=Array.from(e.shell.widgets("left")).find((e=>"jupyter-ai::chat"===e.id));t&&(t.title.icon=B,function(e){const t=t=>{var a;const o=null===(a=e.node.querySelector('button svg[data-testid="SettingsIcon"]'))||void 0===a?void 0:a.parentElement;o&&(o.remove(),t.disconnect())},a=new MutationObserver(((e,a)=>{t(a)}));a.observe(e.node,{attributes:!0,childList:!0,subtree:!0}),t(a)}(t))}}const W="api/contents",Q=".aws",K=Q+"/sso",Z=Q+"/amazon_q",H=Q+"/enabled_features",X="amazon-q:Q-Developer";class Y{constructor(e){this.app=e,this.putDirectory=async(e,t)=>await S(`${W}/${e}`,E.PUT,JSON.stringify({type:"directory",format:"text",name:t})),this.getAllowedDomains=async()=>{if(!this.region)try{const e=await S(c,E.GET),t=await e.json();this.region=t.region}catch(e){}const e=this.region;return[`.v2.${e}.beta.app.iceland.aws.dev`,`.v2.niceland-gamma.${e}.on.aws`,`.datazone.${e}.on.aws`]},this.isMessageOriginValid=(e,t)=>this.isLocalhost()?"http://localhost:5173"===e.origin:t.some((t=>e.origin.endsWith(t))),this.putMetadataFile=async(e,t,a,o)=>await S(`${W}/${e?`${e}/${t}.${a}`:`/${t}.${a}`}`,E.PUT,JSON.stringify({content:JSON.stringify(o),format:"text",name:`${t}.${a}`,type:"file"})),this.messageListener=async e=>{const t=await this.getAllowedDomains();if(this.isMessageOriginValid(e,t))try{const t=JSON.parse(e.data);if(!("accessToken"in t))throw new Error("IAM Identity Center access token not found.");this.updateMetadata(t)}catch(e){}}}async initialize(){const e=await this.postAuthDetails();(null==e?void 0:e.environment)===A.SMStudio||(null==e?void 0:e.environment)===A.SMStudioSSO?e.isQDeveloperEnabled&&(G(this.app),this.initializeSMInterval()):(null==e?void 0:e.environment)===A.MD&&(G(this.app),this.initializeTwoWayIframeCommunication())}async initializeSMInterval(){this.smInterval||(this.smInterval=setInterval((async()=>{await this.postAuthDetails()}),3e5))}async updateMetadata(e){var t,a;await this.createDirectoryIfDoesNotExist(Q,".aws"),await this.createDirectoryIfDoesNotExist(K,"sso"),await this.createDirectoryIfDoesNotExist(Z,"amazon_q"),await this.createDirectoryIfDoesNotExist(H,"enabled_features"),await this.putMetadataFile(K,"idc_access_token","json",{idc_access_token:e.accessToken}),await this.putMetadataFile(Z,"q_dev_profile","json",{q_dev_profile_arn:null!==(t=e.profileArn)&&void 0!==t?t:""}),await this.putMetadataFile(H,"enabled_features","json",{enabled_features:null!==(a=e.enabledFeatures)&&void 0!==a?a:[]})}async updateInitialLanguageModelConfig(){const e=await this.postAuthDetails(),t=await this.getLanguageModelConfig();(null==e?void 0:e.environment)!==A.SMStudio&&(null==e?void 0:e.environment)!==A.SMStudioSSO||e.isQDeveloperEnabled&&(null==t?void 0:t.model_provider_id)!==X&&await this.updateLanguageModelConfig(X)}async getLanguageModelConfig(){try{const e=await S(l,E.GET);return await e.json()}catch{return}}async updateLanguageModelConfig(e){try{await S(l,E.POST,JSON.stringify({model_provider_id:e}))}catch{return}}async postAuthDetails(){try{const e=await S("/aws/sagemaker/api/auth-details",E.POST);return await e.json()}catch{return}}async getDirectory(e,t){try{return await S(`${W}/${e}?content=${t?1:0}`,E.GET)}catch{return}}sendMessageWhenReadyToReceiveUserMetadata(){var e;null===(e=window.top)||void 0===e||e.postMessage("JL_COMMON_PLUGIN_LOADED","*")}async createDirectoryIfDoesNotExist(e,t){await this.getDirectory(e,!1)||await this.putDirectory(e,t)}isLocalhost(){return["localhost","127.0.0.1"].some((e=>document.location.href.includes(e)))}initializeTwoWayIframeCommunication(){window.addEventListener("message",this.messageListener),this.sendMessageWhenReadyToReceiveUserMetadata()}}const ee=[R,$,P,{id:"@amzn/sagemaker-jupyterlab-extension-common:q-developer",autoStart:!0,activate:async e=>{const t=new Y(e);await t.updateInitialLanguageModelConfig(),e.restored.then((async()=>{t.initialize()}))}}]},147:e=>{e.exports=JSON.parse('{"name":"@amzn/sagemaker-jupyterlab-extension-common","description":"SageMaker JupyterLab workspace common module","version":"0.1.20","author":"Amazon","homepage":"https://aws.amazon.com/sagemaker/","license":"Amazon Software License","licenses":[{"type":"Amazon Software License","url":"http://aws.amazon.com/asl"}],"directories":{"test":"__tests__"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","schema/*.json"],"scripts":{"build":"tsc","build:labextension":"tsc && jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True --source-map True .","lint:check":"eslint . --ext .js,.ts,.tsx","lint:fix":"eslint --fix . --ext .js,.ts,.tsx","release":"run-s build","install:extension":"jlpm run build","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch .","watch":"run-p watch:src watch:labextension","test":"jest","dev:setup":"run-s -n dev:docker:build dev:docker:reset dev:docker:create","dev:docker:build":"(cd devSetup ; sh pull-jupyterlab-base-image.sh && docker build . --tag jupyterlab_ext_dev_image_common --build-arg CONTAINER_USER_ID=$(id -u) --build-arg CONTAINER_GROUP_ID=$(id -g))","dev:docker:reset":"docker stop jupyterlab_ext_dev_container_common || true && docker rm jupyterlab_ext_dev_container_common || true","dev:docker:create":"docker create --name jupyterlab_ext_dev_container_common --publish 8888:8888 --volume $(pwd):/sagemaker-studio-extension --volume $HOME/.aws:/home/sagemaker-user/.aws jupyterlab_ext_dev_image_common","dev:start":"docker start jupyterlab_ext_dev_container_common --attach","test:watch":"jest --watch"},"main":"lib/index.js","dependencies":{"@emotion/css":"^11.1.3","@jupyterlab/application":"^4.0.5","@jupyterlab/apputils":"^4.0.5","@jupyterlab/ui-components":"^4.0.5","@jupyterlab/coreutils":"^6.0.5","@jupyterlab/jupyterlab-telemetry":"^1.0.3","@jupyterlab/services":"^7.0.0","@jupyterlab/statusbar":"^4.0.5","@lumino/coreutils":"^2.1.2","@lumino/signaling":"^2.1.2","@lumino/widgets":"^2.1.2","@testing-library/jest-dom":"^6.1.6","isomorphic-fetch":"^3.0.0","p-retry":"^6.1.0","react":"^18.2.0","uuid":"^9.0.1"},"jupyterlab":{"extension":true,"outputDir":"sagemaker_jupyterlab_extension_common/labextension"},"devDependencies":{"@babel/preset-env":"^7.22.7","@babel/preset-react":"^7.22.5","@jupyterlab/builder":"^4.0.5","@testing-library/react":"^13.0.0","@types/jest":"^29.5.12","@types/lodash":"^4.14.172","@types/uuid":"^9.0.6","@typescript-eslint/eslint-plugin":"^5.61.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"^2.27.5","eslint-plugin-json":"^3.1.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","jest":"^28.0.0","jest-environment-jsdom":"^29.7.0","npm-run-all":"^4.1.5","prettier":"^2.4.1","ts-jest":"^28.0.5","typescript":"^4.3.5"}}')}}]);
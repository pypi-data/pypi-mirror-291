var U=Object.defineProperty;var S=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var p=(s,e,n)=>(S(s,typeof e!="symbol"?e+"":e,n),n);import{_ as V}from"./DocsButton.vue_vue_type_script_setup_true_lang.7780e068.js";import{_ as E}from"./AbstraButton.vue_vue_type_script_setup_true_lang.6c824560.js";import{G as L}from"./PhDotsThreeVertical.vue.83d724ac.js";import{e as M,f as q,cE as g,d as A,o as l,c as f,w as o,b as i,u as t,d9 as d,d4 as m,ax as r,e6 as I,$ as N,e7 as B,W as _,aJ as y,d5 as v,d3 as R,e9 as $,bJ as O,bq as z,bo as j,R as w,a as T,bD as F,ef as G,eg as J}from"./vue-router.d9feb5a3.js";import{C as h}from"./gateway.bcb6c1cd.js";import{A as x}from"./Avatar.65572443.js";import{C as D}from"./Card.afa2cbc4.js";import{A as P}from"./index.3ceffa89.js";import"./BookOutlined.06277ca0.js";import"./popupNotifcation.326ad4ba.js";import"./TabPane.51d9ffdd.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="ec567dd3-4446-42a9-a027-fc6ca46da100",s._sentryDebugIdIdentifier="sentry-dbid-ec567dd3-4446-42a9-a027-fc6ca46da100")}catch{}})();class W{async getLoginUrl(e,n,a){return h.get(`projects/${e}/connectors/${a}/connections/${n}/login-url`)}async listConnectors(e){return h.get(`projects/${e}/connectors`)}async listConnections(e){return h.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:n,connectionName:a,connectorType:C}=e;return h.delete(`projects/${n}/connectors/${C}/connections/${a}`)}async renameConnection(e){const{projectId:n,connectionName:a,connectorType:C,newConnectionName:u}=e;return h.patch(`projects/${n}/connectors/${C}/connections/${a}`,{newConnectionName:u})}}class Y{constructor(e,n){p(this,"state");p(this,"hasChanges",q(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));p(this,"handleDeletionClick",async e=>{g.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});p(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});p(this,"handleAddConnectionSubmit",async e=>{const{url:n}=await this.getLoginUrl(e,this.getUniqueName(e));window.location.href=n});p(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const n=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};g.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:n})});p(this,"showAddConfirmationModal",e=>{g.confirm({title:"Add connection",content:"You are about to be redirected to the external service to authorize the connection.",icon:null,onOk:()=>this.handleAddConnectionSubmit(e.type)})});this.projectId=e,this.api=n,this.state=M({connectors:[],connections:[],editingConnection:null,showCreateModal:!1})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){this.state.value.connections=(await this.api.listConnections(this.projectId)).map(e=>{const n=this.state.value.connectors.find(a=>a.type===e.connectorType);if(!n)throw new Error(`Unknown connector type: ${e.connectorType}`);return{name:e.name,connectorTitle:n.title,connectorType:e.connectorType,icon:n.logoUrl}})}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,n){return this.api.getLoginUrl(this.projectId,n,e)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const n=this.state.value.connections.filter(a=>a.connectorType===e).length;return n===0?e:`${e}-${n}`}}const H=A({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{}},setup(s){return(e,n)=>(l(),f(t(D),{class:"connector-card"},{default:o(()=>[i(t(d),{style:{width:"100%"},vertical:"",gap:12},{default:o(()=>[i(t(d),{justify:"space-between"},{default:o(()=>[i(t(x),{src:e.logoUrl,shape:"square",size:"large"},null,8,["src"])]),_:1}),i(t(d),{vertical:""},{default:o(()=>[i(t(m),{strong:""},{default:o(()=>[r(I(e.title),1)]),_:1}),i(t(m),{type:"secondary"},{default:o(()=>[r(I(e.description),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});const K=N(H,[["__scopeId","data-v-9fe50f51"]]),Q=s=>(G("data-v-46320a53"),s=s(),J(),s),X=Q(()=>T("div",{style:{"flex-grow":"1"}},null,-1)),Z={class:"connectors-grid"},ee=A({__name:"ConnectorsView",setup(s){const n=B().params.projectId,a=new Y(n,new W);return a.fetchInitialState(),(C,u)=>{var b;return l(),_(y,null,[i(t(P),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:o(()=>[i(t(d),{align:"center",justify:"space-between"},{default:o(()=>[i(t(v),null,{default:o(()=>[r("Connectors")]),_:1})]),_:1}),i(t(R),null,{default:o(()=>[r(" Add and manage external integrations to your project. "),i(V)]),_:1}),t(a).state.value.connections.length?(l(),f(t(d),{key:0,vertical:""},{default:o(()=>[i(t(v),{level:2},{default:o(()=>[r("Installed")]),_:1}),i(t(d),{vertical:"",gap:10},{default:o(()=>[(l(!0),_(y,null,$(t(a).state.value.connections,c=>(l(),f(t(D),{key:c.name},{default:o(()=>[i(t(d),{align:"center",gap:20},{default:o(()=>[i(t(x),{src:c.icon,height:"40px",shape:"square"},null,8,["src"]),i(t(m),{strong:""},{default:o(()=>[r(I(c.connectorTitle),1)]),_:2},1024),X,i(t(m),{content:c.name,copyable:"",code:""},null,8,["content"]),i(t(O),null,{overlay:o(()=>[i(t(z),null,{default:o(()=>[i(t(j),{onClick:k=>t(a).handleEditConnectionClick(c)},{default:o(()=>[r(" Rename ")]),_:2},1032,["onClick"]),i(t(j),{danger:"",onClick:k=>t(a).handleDeletionClick(c)},{default:o(()=>[r(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[i(t(L))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):w("",!0),i(t(d),{vertical:""},{default:o(()=>[t(a).state.value.connections.length?(l(),f(t(v),{key:0,level:2},{default:o(()=>[r("Available")]),_:1})):w("",!0),T("div",Z,[(l(!0),_(y,null,$(t(a).state.value.connectors,c=>(l(),f(K,{key:c.type,title:c.title,"logo-url":c.logoUrl,description:c.description,onClick:k=>t(a).showAddConfirmationModal(c)},null,8,["title","logo-url","description","onClick"]))),128))])]),_:1})]),_:1}),i(t(g),{open:!!t(a).state.value.editingConnection,title:`${(b=t(a).state.value.editingConnection)==null?void 0:b.connectorTitle} Connection`,onCancel:u[2]||(u[2]=c=>t(a).state.value.editingConnection=null)},{footer:o(()=>[i(t(d),{justify:"end"},{default:o(()=>[i(E,{disabled:!t(a).hasChanges.value,onClick:u[1]||(u[1]=c=>t(a).renameConnection())},{default:o(()=>[r(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:o(()=>[t(a).state.value.editingConnection?(l(),f(t(F),{key:0,value:t(a).state.value.editingConnection.newName,"onUpdate:value":u[0]||(u[0]=c=>t(a).state.value.editingConnection.newName=c)},null,8,["value"])):w("",!0)]),_:1},8,["open","title"])],64)}}});const fe=N(ee,[["__scopeId","data-v-46320a53"]]);export{fe as default};
//# sourceMappingURL=ConnectorsView.e39aa101.js.map

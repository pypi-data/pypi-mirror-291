(self["webpackChunkbeaker_vue"]=self["webpackChunkbeaker_vue"]||[]).push([[64],{81265:function(e,t){"use strict";t.Z={}},35200:function(e,t,s){"use strict";s.d(t,{EK:function(){return a},Gn:function(){return c},b9:function(){return u},qC:function(){return h},yt:function(){return r}});s(70560);var n=s(37353),o=s(728),i=s(17769);class l{constructor(){this.IPYNB_KEYS=["cell_type","source","metadata","id","attachments","outputs","execution_count"],this.status="idle",this.last_execution={status:"none"},this.children=[]}reset_execution_state(){this.last_execution={status:"modified"}}fromJSON(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}toJSON(){return{...this}}fromIPynb(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}toIPynb(){const e={};for(const t of Object.keys(this))this.IPYNB_KEYS.includes(t)&&(e[t]=this[t]);return e}}class c extends l{constructor(e){super(),Object.keys(e).forEach((t=>{this[t]=e[t]})),void 0===this.id&&(this.id=(0,o.Z)())}execute(e){return null}}class r extends l{constructor(e){super(),Object.keys(e).forEach((t=>{this[t]=e[t]})),this.outputs=this.outputs??[],void 0===this.id&&(this.id=(0,o.Z)()),void 0===this.execution_count&&(this.execution_count=null),this.busy=!1,Array.isArray(this.source)&&(this.source=this.source.join("\n"))}execute(e,t=void 0){var s;return this.busy=!0,this.outputs.splice(0,this.outputs.length),void 0!==t?s=t:(s=e.sendBeakerMessage("execute_request",{code:this.source,silent:!1,store_history:!0,user_expressions:{},allow_stdin:!0,stop_on_error:!1}),s.onIOPub=e=>i.Kf.handleIOPub(e,this),s.onReply=e=>i.Kf.handleReply(e,this)),s}rollback(e){if("ok"===this?.last_execution?.status){const t=e.executeAction("rollback",{checkpoint_index:this.last_execution.checkpoint_index});return this.busy=!0,t.done.then((e=>{"ok"===e.content.status?(this.busy=!1,this.last_execution={status:"none"},this.execution_count=null,this.outputs.splice(0,this.outputs.length),this.children.splice(0,this.children.length)):"error"===e.content.status&&(this.last_execution=e.content,this.outputs.push({...e.content,output_type:"error"}))})),t}return null}}class a extends l{constructor(e){super(),Object.keys(e).forEach((t=>{this[t]=e[t]})),void 0===this.id&&(this.id=(0,o.Z)())}execute(e){return null}}class u extends l{constructor(e){super(),this.events=[],Object.keys(e).forEach((t=>{this[t]=e[t]})),void 0===this.id&&(this.id=(0,o.Z)())}execute(e){this.events.splice(0,this.events.length),this.children.splice(0,this.children.length);const t=async t=>{const s=t.header.msg_type,n=t.content;if("status"===s)this.status=n.execution_state;else if("llm_thought"===s){if(""===n.thought)return;this.events.push({type:"thought",content:n.thought})}else if("llm_response"===s&&"response_text"===n.name)this.events.push({type:"response",content:n.text});else if("code_cell"===s){const t=e.notebook,s=new r({cell_type:"code",source:n.code,metadata:{parent_cell:this.id},outputs:[]}),o=t.cells.findIndex((e=>e.id===this.id));o>=0?e.notebook.cells.splice(o+1,0,s):t.addCell(s)}else if("add_child_codecell"===s){const t=n.autoexecute,s=new r({cell_type:"code",source:n.code,metadata:{parent_cell:this.id},outputs:[],busy:!0});s.last_execution={status:"pending",checkpoint_index:n.checkpoint_index},this.events.push({type:"code_cell",content:{parent_id:this.id,cell_id:s.id,metadata:{}}}),this.children.push(s);const o=this.children[this.children.length-1];if(t&&n.execute_request_msg){const t=n.execute_request_msg;new i.Fp(t,!0,!0,e.kernel,o)}}else if("update_child_codecell"==s){const e=n.id,s=this.children.find((t=>t.id===e));if(void 0===s||null===s)throw console.log("Can't find cell"),Error("Cell to be updated not found ");s.execution_count=n.execution_count;let o={status:n.execution_status};if("error"===n.execution_status){const e={ename:t.content.ename,evalue:t.content.evalue,traceback:t.content.traceback};s.outputs.push({output_type:"error",...e}),o={...o,...e}}else"ok"===o.status&&(o={...o,checkpoint_index:n.checkpoint_index},s.outputs.push({output_type:"execute_result",data:{"text/plain":n.execution_return}}));s.last_execution=o}},s=async e=>{n.isInputRequestMsg(e)&&(this.events.push({type:"user_question",content:e.content.prompt}),this.status="awaiting_input",this._current_input_request_message=e)},o=async e=>{if("ok"===e.content.status)this.last_execution={status:"ok"};else if("error"===e.content.status){const t={ename:e.content.ename,evalue:e.content.evalue,traceback:e.content.traceback};this.last_execution={status:"error",...t},this.events.push({type:"error",content:{...e.content}})}else"abort"===e.content.status&&(this.last_execution={status:"abort"},this.events.push({type:"abort",content:"Request aborted"}))},l=e.sendBeakerMessage("llm_request",{request:this.source});return l.onIOPub=t,l.onStdin=s,l.onReply=o,l}respond(e,t){"awaiting_input"===this.status&&(this.events.push({type:"user_answer",content:e}),t.kernel.sendInputReply({value:e,status:"ok"},this._current_input_request_message.header),this.status="busy",this._current_input_request_message=void 0)}toMarkdownCell(){const e=[`# ${this.source}\n`];this.events.forEach((t=>{"thought"===t.type?e.push(`> Thought: ${t.content}\n> `):"response"===t.type?e.push(`**${t.content}**`):"user_question"===t.type?e.push(`*Beaker asks:* ${t.content}\n`):"user_answer"===t.type&&e.push(`*The user responds:* ${t.content}\n`)}));const t=e.join("\n"),s={...this.metadata,beaker_cell_type:"query",prompt:this.source,events:this.events};return new a({cell_type:"markdown",id:this.id,source:t,metadata:s})}fromIPynb(e){if("query"!==this.metadata.beaker_cell_type)throw TypeError("Cell is trying to be parsed as a query cell, but doesn't have the required metadata.");this.source=e.metadata.prompt,this.events=e.metadata.events}toIPynb(){const e=this.children?.map((e=>(e.metadata.beaker_child_of=this?.id,e.toIPynb())));return[this.toMarkdownCell().toIPynb(),...e]}}class h{constructor(){this.content={nbformat:4,nbformat_minor:5,cells:[],metadata:{kernelspec:{display_name:"Beaker Kernel",name:"beaker",language:"beaker"},language_info:this.subkernelInfo}},this.cells=new Proxy(this.content.cells,{})}toJSON(){return this.content.metadata.language_info=this.subkernelInfo,{...this.content}}fromJSON(e){Object.keys(e).forEach((t=>{this.content[t]=e[t]}))}loadFromIPynb(e){this.content.nbformat=e.nbformat,this.content.nbformat_minor=e.nbformat_minor;const t=e.cells.map((e=>"raw"===e.cell_type?new c(e):"code"===e.cell_type?new r(e):"query"===e.metadata.beaker_cell_type?new u({cell_type:"query",id:e.id,source:e.metadata.prompt,events:e.metadata.events,metadata:e.metadata}):"markdown"===e.cell_type?new a(e):void 0));let s={};t.forEach((e=>{s[e.id]=e}));let n=0;while(n<t.length){const e=t[n];"undefined"!==typeof e.metadata.beaker_child_of?s[e.metadata.beaker_child_of].children.push(t.splice(n,1)[0]):n++}this.cells.splice(0,this.cells.length,...t),this.content.metadata=e.metadata}toIPynb(){return this.content.metadata.language_info=this.subkernelInfo,{nbformat:this.content.nbformat,nbformat_minor:this.content.nbformat_minor,cells:this.content.cells.flatMap((e=>e.toIPynb())),metadata:this.content.metadata}}addCell(e){this.cells.push(e)}insertCell(e,t){this.cells.splice(t,0,e)}removeCell(e){this.cells.splice(e,1)}cutCell(e){const t=this.cells.splice(e,1);return t.length>0?t[0]:null}moveCell(e,t){e!==t&&this.insertCell(this.cutCell(e),t)}setSubkernelInfo(e){this.subkernelInfo={name:e.subkernel,display_name:e.language}}}},50852:function(e,t,s){"use strict";s.d(t,{Z:function(){return f}});var n=s(73396),o=s(44870),i=s(87139),l=s(31608),c=s(63618);const r={class:"status-bar"},a=(0,n._)("div",{class:"logo"},[(0,n._)("h4",null,[(0,n.Uk)(" Beaker "),(0,n._)("span",{class:"longer-title"},"Development Interface")])],-1),u={href:"https://jataware.github.io/beaker-kernel",rel:"noopener",target:"_blank"},h={href:"https://github.com/jataware/beaker-kernel",rel:"noopener",target:"_blank"};var d=(0,n.aZ)({__name:"BeakerHeader",props:["kernel"],emits:["selectKernel"],setup(e,{emit:t}){const s=t,{theme:d,toggleDarkMode:p}=(0,n.f3)("theme"),f=(0,n.f3)("beakerSession");function b(){s("selectKernel")}const _=(0,n.Fl)((()=>"pi pi-"+("dark"===d.mode?"sun":"moon"))),k={unknown:"Unknown",starting:"Starting",idle:"Ready",busy:"Busy",terminating:"Terminating",restarting:"Restarting",autorestarting:"Autorestarting",dead:"Dead",connected:"Connected",connecting:"Connecting"},m={connected:"green-300",idle:"green-400",connecting:"green-200",busy:"orange-400"},g=(0,n.Fl)((()=>k[f.status]||"unknown")),y=(0,n.Fl)((()=>m[f.status]||"grey-200"));return(e,t)=>((0,n.wg)(),(0,n.j4)((0,o.SU)(l.Z),{class:"toolbar"},{start:(0,n.w5)((()=>[(0,n._)("div",r,[(0,n._)("i",{class:"pi pi-circle-fill",style:(0,i.j5)(`font-size: inherit; color: var(--${y.value});`)},null,4),(0,n.Uk)(" "+(0,i.zw)(g.value),1)]),(0,n.Wm)((0,o.SU)(c.Z),{outlined:"",size:"small",icon:"pi pi-angle-down",iconPos:"right",class:"connection-button",onClick:b,label:(0,o.SU)(f).activeContext?.slug,loading:!(0,o.SU)(f).activeContext?.slug},null,8,["label","loading"])])),center:(0,n.w5)((()=>[a])),end:(0,n.w5)((()=>[(0,n._)("nav",null,[(0,n.Wm)((0,o.SU)(c.Z),{text:"",onClick:(0,o.SU)(p),style:{margin:"0",color:"var(--gray-500)"},icon:_.value},null,8,["onClick","icon"]),(0,n._)("a",u,[(0,n.Wm)((0,o.SU)(c.Z),{text:"",style:{margin:"0",color:"var(--gray-500)"},"aria-label":"Beaker Documentation",icon:"pi pi-book"})]),(0,n._)("a",h,[(0,n.Wm)((0,o.SU)(c.Z),{text:"",style:{margin:"0",color:"var(--gray-500)"},"aria-label":"Github Repository Link Icon",icon:"pi pi-github"})])])])),_:1}))}});const p=d;var f=p},86755:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var n=s(73396);const o={class:"beaker-notebook"};function i(e,t,s,i,l,c){return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.WI)(e.$slots,"default")])}var l=s(44870),c=s(20295);const r=(0,n.aZ)({props:["cellMap"],setup(e){const t=(0,n.f3)("session"),s=(0,n.f3)("beakerSession"),o=(0,l.iH)(t.notebook),i=(0,l.iH)(null);(0,n.JJ)("cell-component-mapping",e.cellMap);const c=(0,n.Fl)((()=>t?.notebook?.cells?.length||0));return{session:t,beakerSession:s,notebook:o,selectedCellId:i,cellCount:c}},methods:{selectCell(e){let t;return t="string"===typeof e?e:e.id,this.selectedCellId!==t&&(this.selectedCellId=t),(0,n.Y3)((()=>{this.scrollCellIntoView(this.selectedCell())})),this.selectedCellId},scrollCellIntoView(e){const t=e?.$?.vnode?.el;if(!t)return;const s=t.closest(".beaker-cell")??t;(0,c.Z)(s,{scrollMode:"if-needed",block:"nearest",inline:"nearest"})},selectedCell(){return this.beakerSession.findNotebookCellById(this.selectedCellId)},selectNextCell(e,t=!1){void 0===e&&(e=this.selectedCell().cell);let s=this.notebook.cells.indexOf(e);if(s>=0){if(s<this.cellCount-1)return this.selectCell(this.notebook.cells[s+1],t)}else for(const n of this.notebook.cells)if(n.children){const s=n.children.indexOf(e);if(-1===s)continue;return s<=n.children.length-1?this.selectNextCell(n):this.selectCell(n.children[s+1],t)}return null},selectPrevCell(e,t=!1){let s=this.notebook.cells.indexOf(this.selectedCell().cell);if(s>=0)s>0&&this.selectCell(this.notebook.cells[s-1],t);else for(const n of this.notebook.cells)console.log(n);return null},insertCellBefore(e,t,s=!1){void 0===e&&(e=this.selectedCell()),void 0===t&&(t="code");const o=void 0===e?this.notebook.cells.length-1:this.notebook.cells.findIndex((t=>t===e.cell)),i=this.session.addCodeCell("");return this.notebook.moveCell(this.notebook.cells.length-1,o),(0,n.Y3)((()=>this.selectCell(i,s))),i},insertCellAfter(e,t,s=!1){void 0===e&&(e=this.selectedCell()),void 0===t&&(t="code");let o=void 0===e?this.notebook.cells.length-1:this.notebook.cells.findIndex((t=>t===e.cell));const i=e?.cell?.metadata?.beaker_child_of;-1===o&&i&&(o=this.notebook.cells.findIndex((e=>e.id===i)));const l=this.session.addCodeCell("");return this.notebook.moveCell(this.notebook.cells.length-1,o+1),(0,n.Y3)((()=>this.selectCell(l,s))),l},removeCell(e){void 0===e&&(e=this.selectedCell());const t=this.notebook.cells.findIndex((t=>t===e.cell));return this.selectNextCell()||this.selectPrevCell(),this.notebook.cutCell(t)},convertCellType(e,t){const s=this.notebook.cells.indexOf(e);if(-1===s)return void console.warn("attempted to convert cell not found in parent cell in place; cell not found");if(!Object.keys(this.cellMap).includes(t))return void console.warn("invalid cell type provided for conversion target");const n=new this.cellMap[t].modelClass({...e});n.cell_type=t,this.notebook.cells.splice(s,1,n)}},computed:{},beforeMount(){if((0,n.JJ)("notebook",this),0===this.cellCount){this.session.addCodeCell("")}},mounted(){this.selectedCell()||this.selectCell(this.notebook.cells[0].id)}});var a=r,u=s(40089);const h=(0,u.Z)(a,[["render",i]]);var d=h},39748:function(e,t,s){"use strict";s.d(t,{ZP:function(){return f}});var n=s(73396);const o={class:"beaker-session-container"};function i(e,t,s,i,l,c){return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.WI)(e.$slots,"default")])}var l=s(44870),c=s(3507),r=s(22487);const a=e=>{const t=e?.component;if(void 0!==t)return(0,l.qj)({...t.proxy,...t.exposed,$:t})},u=(0,n.aZ)({props:{connectionSettings:Object,sessionName:String,sessionId:String,defaultKernel:String,renderers:Object},emits:["iopub-msg","unhandled-msg","any-msg","session-status-changed","context-changed"],setup(e,{emit:t}){const s=(0,l.iH)("unknown"),n=(0,l.iH)({}),o=(0,l.iH)(),i=new c.F1({settings:e.connectionSettings,name:e.sessionName,sessionId:e.sessionId,kernelName:e.defaultKernel,rendererOptions:{renderers:e.renderers||[]}});i.sessionReady.then((()=>{i.session.iopubMessage.connect(((e,n)=>{if(t("iopub-msg",n),r.isStatusMsg(n)){const e=n?.content?.execution_state||"connecting";s.value=e,t("session-status-changed",e)}})),i.session.session.anyMessage.connect(((e,{msg:s,direction:n})=>{t("any-msg",s,n)})),i.session.unhandledMessage.connect(((e,s)=>{t("unhandled-msg",s)}))}));const a=(0,l.qj)(i);return{activeContext:o,session:a,status:s,cellRegistry:n}},methods:{findNotebookCell(e){for(const t of this.cellRegistry)if(e(t))return a(t)},findNotebookCellById(e){const t=this.cellRegistry[e];if(void 0!==t)return a(t)},async fetchContextInfo(){const e=await this.session.activeContext();this.activeContext=e,this.$emit("context-changed",this.activeContext)},setContext(e){const t=(0,n.f3)("show_toast");this.activeContext={};const s=this.session.sendBeakerMessage("context_setup_request",e);return s.done.then((e=>{if("error"!==e?.content?.status)"abort"!==e?.content?.status?this.fetchContextInfo():t({title:"Context Setup Aborted",severity:"warning",detail:e?.content?.evalue,life:6e3});else{let s=e?.content?.evalue;if(s){const e=/\.$/.test(s);e||(s+=".")}t({title:"Context Setup Failed",severity:"error",detail:`${s} Please try again or contact us.`,life:0})}})),s}},beforeMount(){(0,n.JJ)("beakerSession",(0,l.qj)(this)),(0,n.JJ)("session",this.session)},mounted(){this.fetchContextInfo()}});var h=u,d=s(40089);const p=(0,d.Z)(h,[["render",i]]);var f=p},93548:function(){},45742:function(){},79336:function(){},45159:function(){},49481:function(){}}]);
//# sourceMappingURL=chunk-common.86421084.js.map
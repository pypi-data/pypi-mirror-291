!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("cytoscape-layers")):"function"==typeof define&&define.amd?define(["exports","cytoscape-layers"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CytoscapeBubbleSets={},t.CytoscapeLayers)}(this,(function(t,e){"use strict";function i(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function s(t,e,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(t,i):n?n.value=i:e.set(t,i),i}function n(t,e,i,s,n,r){const h=i-t,o=s-e;let a=n-t,c=r-e,u=a*h+c*o,l=0;u<=0?l=0:(a=h-a,c=o-c,u=a*h+c*o,l=u<=0?0:u*u/(h*h+o*o));const f=a*a+c*c-l;return f<0?0:f}function r(t,e,i,s){return(t-i)*(t-i)+(e-s)*(e-s)}function h(t,e,i,s,n){return r(t,e,i,s)<n*n}class o{constructor(t,e,i,s){this.x1=t,this.y1=e,this.x2=i,this.y2=s}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new o(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2)return!1;if(e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2)return!1;if(t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;return t<=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1)}distSquare(t,e){return n(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,i){if(this.x1<this.x2){if(t<this.x1-i||t>this.x2+i)return!1}else if(t<this.x2-i||t>this.x1+i)return!1;if(this.y1<this.y2){if(e<this.y1-i||e>this.y2+i)return!1}else if(e<this.y2-i||e>this.y1+i)return!1;return!0}}var a,c;!function(t){t[t.POINT=1]="POINT",t[t.PARALLEL=2]="PARALLEL",t[t.COINCIDENT=3]="COINCIDENT",t[t.NONE=4]="NONE"}(a||(a={}));class u{constructor(t,e=0,i=0){this.state=t,this.x=e,this.y=i}}function l(t,e){const i=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),s=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),n=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(n){const e=i/n,r=s/n;return 0<=e&&e<=1&&0<=r&&r<=1?new u(a.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new u(a.NONE)}return new u(0===i||0===s?a.COINCIDENT:a.PARALLEL)}function f(t,e){const i=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),s=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),n=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(n){const t=i/n,e=s/n;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function x(t,e,i){const s=new Set;return t.width<=0?(s.add(c.LEFT),s.add(c.RIGHT)):e<t.x?s.add(c.LEFT):e>t.x+t.width&&s.add(c.RIGHT),t.height<=0?(s.add(c.TOP),s.add(c.BOTTOM)):i<t.y?s.add(c.TOP):i>t.y+t.height&&s.add(c.BOTTOM),s}function y(t,e){let i=e.x1,s=e.y1;const n=e.x2,r=e.y2,h=Array.from(x(t,n,r));if(0===h.length)return!0;let o=x(t,i,s);for(;0!==o.size;){for(const t of h)if(o.has(t))return!1;if(o.has(c.RIGHT)||o.has(c.LEFT)){let e=t.x;o.has(c.RIGHT)&&(e+=t.width),s+=(e-i)*(r-s)/(n-i),i=e}else{let e=t.y;o.has(c.BOTTOM)&&(e+=t.height),i+=(e-s)*(n-i)/(r-s),s=e}o=x(t,i,s)}return!0}function d(t,e){let i=Number.POSITIVE_INFINITY,s=0;function n(t,n,r,h){let a=f(e,new o(t,n,r,h));a=Math.abs(a-.5),a>=0&&a<=1&&(s++,a<i&&(i=a))}return n(t.x,t.y,t.x2,t.y),n(t.x,t.y,t.x,t.y2),s>1?i:(n(t.x,t.y2,t.x2,t.y2),s>1?i:(n(t.x2,t.y,t.x2,t.y2),0===s?-1:i))}function p(t,e){let i=0;const s=l(t,new o(e.x,e.y,e.x2,e.y));i+=s.state===a.POINT?1:0;const n=l(t,new o(e.x,e.y,e.x,e.y2));i+=n.state===a.POINT?1:0;const r=l(t,new o(e.x,e.y2,e.x2,e.y2));i+=r.state===a.POINT?1:0;const h=l(t,new o(e.x2,e.y,e.x2,e.y2));return i+=h.state===a.POINT?1:0,{top:s,left:n,bottom:r,right:h,count:i}}!function(t){t[t.LEFT=0]="LEFT",t[t.TOP=1]="TOP",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM=3]="BOTTOM"}(c||(c={}));class g{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new g(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new g(this.x,this.y,this.width,this.height)}add(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x2,t.x+t.width),n=Math.max(this.y2,t.y+t.height);this.x=e,this.y=i,this.width=s-e,this.height=n-i}addPoint(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x2,t.x),n=Math.max(this.y2,t.y);this.x=e,this.y=i,this.width=s-e,this.height=n-i}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0||t.width<=0||t.height<=0)&&(t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2)}distSquare(t,e){if(this.containsPt(t,e))return 0;const i=x(this,t,e);return i.has(c.TOP)?i.has(c.LEFT)?r(t,e,this.x,this.y):i.has(c.RIGHT)?r(t,e,this.x2,this.y):(this.y-e)*(this.y-e):i.has(c.BOTTOM)?i.has(c.LEFT)?r(t,e,this.x,this.y2):i.has(c.RIGHT)?r(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):i.has(c.LEFT)?(this.x-t)*(this.x-t):i.has(c.RIGHT)?(t-this.x2)*(t-this.x2):0}}class w{constructor(t,e,i){this.cx=t,this.cy=e,this.radius=i}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new w(t.cx,t.cy,t.radius)}containsPt(t,e){return r(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){const i=r(this.cx,this.cy,t,e);if(i<this.radius*this.radius)return 0;const s=Math.sqrt(i)-this.radius;return s*s}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class m{constructor(t,e=0,i=0,s=0,n=0,r=10,h=10,o=new Float32Array(Math.max(0,r*h)).fill(0)){this.pixelGroup=t,this.i=e,this.j=i,this.pixelX=s,this.pixelY=n,this.width=r,this.height=h,this.area=o}createSub(t,e){return new m(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new m(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new m(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){const e=this.scaleX(t.x),i=this.scaleY(t.y),s=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),n=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup));return new g(e,i,s-e,n-i)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){const i=Math.ceil(e/this.pixelGroup),s=this.boundX(t.x-i),n=this.boundY(t.y-i),r=this.boundX(t.x2+i),h=this.boundY(t.y2+i);return new g(s,n,r-s,h-n)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=i)}set(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=i)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;const i=this.width,s=t.width,n=Math.max(0,t.i),r=Math.max(0,t.j),h=Math.min(t.i+t.width,i),o=Math.min(t.j+t.height,this.height);if(!(o<=0||h<=0||n>=i||o>=this.height))for(let a=r;a<o;a++){const r=(a-t.j)*s,o=a*i;for(let i=n;i<h;i++){const s=t.area[i-t.i+r];0!==s&&(this.area[i+o]+=e*s)}}}fill(t){this.area.fill(t)}fillArea(t,e){const i=t.x+t.y*this.width;for(let s=0;s<t.height;s++){const n=i+s*this.width;this.area.fill(e,n,n+t.width)}}fillHorizontalLine(t,e,i,s){const n=t+e*this.width;this.area.fill(s,n,n+i)}fillVerticalLine(t,e,i,s){const n=t+e*this.width;for(let t=0;t<i;t++)this.area[n+t*this.width]=s}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){const i=e*this.width;for(let e=0;e<this.width;e++){t+=this.area[i+e].toFixed(1).padStart(6),t+=" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);const i=this.area.reduce(((t,e)=>Math.min(t,e)),Number.POSITIVE_INFINITY),s=this.area.reduce(((t,e)=>Math.max(t,e)),Number.NEGATIVE_INFINITY),n=t=>(t-i)/(s-i);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++){const s=this.area[e+i*this.width];t.fillStyle=`rgba(0, 0, 0, ${n(s)})`,t.fillRect(e,i,1,1)}t.restore()}drawThreshold(t,e,i=!0){if(!(this.width<=0||this.height<=0)){t.save(),i&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let i=0;i<this.width;i++)for(let s=0;s<this.height;s++){const n=this.area[i+s*this.width];t.fillStyle=n>e?"black":"white",t.fillRect(i,s,1,1)}t.restore()}}}function b(t,e,i){return v(Object.assign(function(t){const e=Math.min(t.x1,t.x2),i=Math.max(t.x1,t.x2),s=Math.min(t.y1,t.y2),n=Math.max(t.y1,t.y2);return{x:e,y:s,x2:i,y2:n,width:i-e,height:n-s}}(t),{distSquare:(e,i)=>n(t.x1,t.y1,t.x2,t.y2,e,i)}),e,i)}function v(t,e,i){const s=function(t,e){const i=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(i):i(t)}(t,i),n=e.scale(s),r=e.createSub(n,s);return function(t,e,i,s){const n=i*i;for(let r=0;r<t.height;r++)for(let h=0;h<t.width;h++){const o=s(e.invertScaleX(t.i+h),e.invertScaleY(t.j+r));if(0!==o){if(o<n){const e=i-Math.sqrt(o);t.set(h,r,e*e)}}else t.set(h,r,n)}}(r,e,i,((e,i)=>t.distSquare(e,i))),r}function M(t,e){return{x:t,y:e}}function T(t,e,i,s){if(0===t.length)return[];const n=function(t){if(t.length<2)return t;let e=0,i=0;return t.forEach((t=>{e+=t.cx,i+=t.cy})),e/=t.length,i/=t.length,t.map((t=>{const s=e-t.cx,n=i-t.cy;return[t,s*s+n*n]})).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}(t);return n.map(((t,h)=>{const a=n.slice(0,h);return function(t,e,i,s,n){const h=M(e.cx,e.cy),a=function(t,e,i){let s=Number.POSITIVE_INFINITY;return e.reduce(((e,n)=>{const h=r(t.x,t.y,n.cx,n.cy);if(h>s)return e;const a=new o(t.x,t.y,n.cx,n.cy),c=function(t,e){return t.reduce(((t,i)=>y(i,e)&&function(t,e){function i(t,i,s,n){let r=f(e,new o(t,i,s,n));return r=Math.abs(r-.5),r>=0&&r<=1?1:0}let s=i(t.x,t.y,t.x2,t.y);return s+=i(t.x,t.y,t.x,t.y2),s>1||(s+=i(t.x,t.y2,t.x2,t.y2),s>1||(s+=i(t.x2,t.y,t.x2,t.y2),s>0))}(i,e)?t+1:t),0)}(i,a);return h*(c+1)*(c+1)<s&&(e=n,s=h*(c+1)*(c+1)),e}),null)}(h,i,t);if(null==a)return[];const c=new o(h.x,h.y,a.cx,a.cy);return function(t,e){const i=[];for(;t.length>0;){const s=t.pop();if(0===t.length){i.push(s);break}const n=t.pop(),r=new o(s.x1,s.y1,n.x2,n.y2);E(e,r)?(i.push(s),t.push(n)):t.push(r)}return i}(function(t,e,i,s){const n=[],r=[];r.push(t);let h=!0;for(let t=0;t<i&&h;t++)for(h=!1;!h&&r.length>0;){const t=r.pop(),i=E(e,t),a=i?p(t,i):null;if(!i||!a||2!==a.count){h||n.push(t);continue}let c=s,u=O(i,c,a,!0),l=I(u,r)||I(u,n),f=N(u,e);for(;!l&&f&&c>=1;)c/=1.5,u=O(i,c,a,!0),l=I(u,r)||I(u,n),f=N(u,e);if(!u||l||f||(r.push(new o(t.x1,t.y1,u.x,u.y)),r.push(new o(u.x,u.y,t.x2,t.y2)),h=!0),h)continue;c=s,u=O(i,c,a,!1);let x=I(u,r)||I(u,n);for(f=N(u,e);!x&&f&&c>=1;)c/=1.5,u=O(i,c,a,!1),x=I(u,r)||I(u,n),f=N(u,e);u&&!x&&(r.push(new o(t.x1,t.y1,u.x,u.y)),r.push(new o(u.x,u.y,t.x2,t.y2)),h=!0),h||n.push(t)}for(;r.length>0;)n.push(r.pop());return n}(c,t,s,n),t)}(e,t,a,i,s)})).flat()}function N(t,e){return e.some((e=>e.containsPt(t.x,t.y)))}function I(t,e){return e.some((e=>!!h(e.x1,e.y1,t.x,t.y,.001)||!!h(e.x2,e.y2,t.x,t.y,.001)))}function E(t,e){let i=Number.POSITIVE_INFINITY,s=null;for(const n of t){if(!y(n,e))continue;const t=d(n,e);t>=0&&t<i&&(s=n,i=t)}return s}function O(t,e,i,s){const n=i.top,r=i.left,h=i.bottom,o=i.right;if(s){if(r.state===a.POINT){if(n.state===a.POINT)return M(t.x-e,t.y-e);if(h.state===a.POINT)return M(t.x-e,t.y2+e);const i=t.width*t.height;return t.width*(.5*(r.y-t.y+(o.y-t.y)))<.5*i?r.y>o.y?M(t.x-e,t.y-e):M(t.x2+e,t.y-e):r.y<o.y?M(t.x-e,t.y2+e):M(t.x2+e,t.y2+e)}if(o.state===a.POINT){if(n.state===a.POINT)return M(t.x2+e,t.y-e);if(h.state===a.POINT)return M(t.x2+e,t.y2+e)}const i=t.height*t.width;return t.height*(.5*(n.x-t.x+(o.x-t.x)))<.5*i?n.x>h.x?M(t.x-e,t.y-e):M(t.x-e,t.y2+e):n.x<h.x?M(t.x2+e,t.y-e):M(t.x2+e,t.y2+e)}if(r.state===a.POINT){if(n.state===a.POINT)return M(t.x2+e,t.y2+e);if(h.state===a.POINT)return M(t.x2+e,t.y-e);const i=t.height*t.width;return t.width*(.5*(r.y-t.y+(o.y-t.y)))<.5*i?r.y>o.y?M(t.x2+e,t.y2+e):M(t.x-e,t.y2+e):r.y<o.y?M(t.x2+e,t.y-e):M(t.x-e,t.y-e)}if(o.state===a.POINT){if(n.state===a.POINT)return M(t.x-e,t.y2+e);if(h.state===a.POINT)return M(t.x-e,t.y-e)}const c=t.height*t.width;return t.height*(.5*(n.x-t.x+(o.x-t.x)))<.5*c?n.x>h.x?M(t.x2+e,t.y2+e):M(t.x2+e,t.y-e):n.x<h.x?M(t.x-e,t.y2+e):M(t.x-e,t.y-e)}function P(t,e,i,s){if(!(t.closed?i<t.length:i<t.length-1))return!1;const r=t.get(e),h=t.get(i+1);for(let o=e+1;o<=i;o++){const e=t.get(o);if(n(r.x,r.y,h.x,h.y,e.x,e.y)>s)return!1}return!0}function S(t,e){switch(t){case-2:return(((3-e)*e-3)*e+1)/6;case-1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw new Error("unknown error")}}class R{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){const e=t,i=this.points.length;return t<0?this.closed?this.get(t+i):this.points[0]:t>=i?this.closed?this.get(t-i):this.points[i-1]:this.points[e]}get length(){return this.points.length}toString(t=1/0){const e=this.points;if(0===e.length)return"";const i="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;const e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t);let s="M";for(const t of e)s+=`${i(t.x)},${i(t.y)} L`;return s=s.slice(0,-1),this.closed&&(s+=" Z"),s}draw(t){const e=this.points;if(0!==e.length){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(const i of e)t.lineTo(i.x,i.y);this.closed&&t.closePath()}}sample(t){return function(t=8){return e=>{let i=t,s=e.length;if(i>1)for(s=Math.floor(e.length/i);s<3&&i>1;)i-=1,s=Math.floor(e.length/i);const n=[];for(let t=0,r=0;r<s;r++,t+=i)n.push(e.get(t));return new R(n)}}(t)(this)}simplify(t){return function(t=0){return e=>{if(t<0||e.length<3)return e;const i=[];let s=0;const n=t*t;for(;s<e.length;){let t=s+1;for(;P(e,s,t,n);)t++;i.push(e.get(s)),s=t}return new R(i)}}(t)(this)}bSplines(t){return function(t=6){function e(t,e,i){let s=0,n=0;for(let r=-2;r<=1;r++){const h=t.get(e+r),o=S(r,i);s+=o*h.x,n+=o*h.y}return{x:s,y:n}}return i=>{if(i.length<3)return i;const s=[],n=i.closed,r=i.length+3-1+(n?0:2);s.push(e(i,2-(n?0:2),0));for(let h=2-(n?0:2);h<r;h++)for(let n=1;n<=t;n++)s.push(e(i,h,n/t));return new R(s)}}(t)(this)}apply(t){return t(this)}containsElements(t){const e=function(t){if(0===t.length)return null;const e=t[0],i=new g(e.x,e.y,0,0);for(const e of t)i.addPoint(e);return i}(this.points);return!!e&&t.every((t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy)))}withinArea(t,e){if(0===this.length)return!1;let i=0;const s=this.points[0],n=new o(s.x,s.y,s.x,s.y);for(let s=1;s<this.points.length;s++){const r=this.points[s];n.x1=n.x2,n.y1=n.y2,n.x2=r.x,n.y2=r.y,n.cuts(t,e)&&i++}return n.x1=n.x2,n.y1=n.y2,n.x2=s.x,n.y2=s.y,n.cuts(t,e)&&i++,i%2==1}}class G{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;const e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new R(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}function L(t,e){const i=2*(Math.floor(t.width)+Math.floor(t.height)),s=new G(i);function n(i,s,n,r){const h=t.get(i,s);return Number.isNaN(h)?Number.NaN:h>e?n+r:n}function r(t,e){let i=0;return i=n(t,e,i,1),i=n(t+1,e,i,2),i=n(t,e+1,i,4),i=n(t+1,e+1,i,8),Number.isNaN(i)?-1:i}let h=1;function o(e,i){let n=e,o=i,a=t.invertScaleX(n),c=t.invertScaleY(o);for(let e=0;e<t.width*t.height;e++){const e={x:a,y:c};if(s.contains(e)){if(s.isFirst(e))return!0}else s.add(e);const i=r(n,o);switch(i){case-1:return!0;case 0:case 3:case 2:case 7:h=2;break;case 12:case 14:case 4:h=3;break;case 6:h=0===h?3:2;break;case 1:case 13:case 5:h=0;break;case 9:h=2===h?0:1;break;case 10:case 8:case 11:h=1;break;default:return console.warn("Marching squares invalid state: "+i),!0}switch(h){case 0:o--,c-=t.pixelGroup;break;case 1:o++,c+=t.pixelGroup;break;case 3:n--,a-=t.pixelGroup;break;case 2:n++,a+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+i),!0}}return!0}for(let i=0;i<t.width;i++)for(let n=0;n<t.height;n++){if(t.get(i,n)<=e)continue;const h=r(i,n);if(!(h<0||15===h)&&o(i,n))return s.path()}return null}const k={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};var $;!function(t){t[t.MEMBERS=0]="MEMBERS",t[t.NON_MEMBERS=1]="NON_MEMBERS",t[t.EDGES=2]="EDGES"}($||($={}));var F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Y="Expected a function",j=/^\s+|\s+$/g,A=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,X=/^0o[0-7]+$/i,q=parseInt,C="object"==typeof F&&F&&F.Object===Object&&F,W="object"==typeof self&&self&&self.Object===Object&&self,H=C||W||Function("return this")(),_=Object.prototype.toString,V=Math.max,D=Math.min,z=function(){return H.Date.now()};function Z(t,e,i){var s,n,r,h,o,a,c=0,u=!1,l=!1,f=!0;if("function"!=typeof t)throw new TypeError(Y);function x(e){var i=s,r=n;return s=n=void 0,c=e,h=t.apply(r,i)}function y(t){return c=t,o=setTimeout(p,e),u?x(t):h}function d(t){var i=t-a;return void 0===a||i>=e||i<0||l&&t-c>=r}function p(){var t=z();if(d(t))return g(t);o=setTimeout(p,function(t){var i=e-(t-a);return l?D(i,r-(t-c)):i}(t))}function g(t){return o=void 0,f&&s?x(t):(s=n=void 0,h)}function w(){var t=z(),i=d(t);if(s=arguments,n=this,a=t,i){if(void 0===o)return y(a);if(l)return o=setTimeout(p,e),x(a)}return void 0===o&&(o=setTimeout(p,e)),h}return e=K(e)||0,J(i)&&(u=!!i.leading,r=(l="maxWait"in i)?V(K(i.maxWait)||0,e):r,f="trailing"in i?!!i.trailing:f),w.cancel=function(){void 0!==o&&clearTimeout(o),c=0,s=a=n=o=void 0},w.flush=function(){return void 0===o?h:g(z())},w}function J(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function K(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==_.call(t)}(t))return NaN;if(J(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=J(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(j,"");var i=B.test(t);return i||X.test(t)?q(t.slice(2),i?2:8):A.test(t)?NaN:+t}var Q,U,tt,et,it,st,nt,rt,ht=function(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new TypeError(Y);return J(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),Z(t,e,{leading:s,maxWait:e,trailing:n})};function ot(t){return Math.round(100*t)/100}const at="bubbleSets",ct=["ellipse","diamond","diamond","pentagon","diamond","hexagon","heptagon","octagon","star"],ut=new Set(ct.concat(ct.map((t=>`round-${t}`))));function lt(t){return`${ot(t.shape.width)}x${ot(t.shape.height)}x${t.isCircle}`}function ft(t){return`${ot(t.x1)}x${ot(t.y1)}x${ot(t.x2)}x${ot(t.y2)}`}function xt(t,e){return t?new w(e.x1+e.w/2,e.y1+e.h/2,Math.max(e.w,e.h)/2):new g(e.x1,e.y1,e.w,e.h)}class yt{constructor(t,e,n,r,h,a={}){this.node=e,this.nodes=n,this.edges=r,this.avoidNodes=h,Q.set(this,{x:0,y:0,width:0,height:0}),U.set(this,new m(4,0,0,0,0,0,0)),tt.set(this,void 0),et.set(this,new Map),it.set(this,void 0),st.set(this,void 0),nt.set(this,void 0),rt.set(this,void 0),this.update=(t=!1)=>{const e=this.nodes.union(this.edges).boundingBox(i(this,tt,"f"));let n=!1;const r=Math.max(i(this,tt,"f").edgeR1,i(this,tt,"f").nodeR1)+i(this,tt,"f").morphBuffer,h={x:e.x1-r,y:e.y1-r,width:e.w+2*r,height:e.h+2*r};t||i(this,Q,"f").x!==h.x||i(this,Q,"f").y!==h.y?(n=!0,s(this,U,m.fromPixelRegion(h,i(this,tt,"f").pixelGroup),"f")):i(this,Q,"f").width===h.width&&i(this,Q,"f").height===h.height||s(this,U,m.fromPixelRegion(h,i(this,tt,"f").pixelGroup),"f"),s(this,Q,h,"f");const a=i(this,U,"f"),c=new Map;n||this.nodes.forEach((t=>{var e;const i=null!==(e=t.scratch(at))&&void 0!==e?e:null;i&&i.area&&c.set(lt(i),i.area)}));let u=!1;const l=t=>{var e;const s=t.boundingBox(i(this,tt,"f"));let r=null!==(e=t.scratch(at))&&void 0!==e?e:null;const h=(o=t.style("shape"),ut.has(o));var o;if(r&&!n&&r.area&&r.isCircle===h&&r.shape.width===s.w&&r.shape.height===s.h)r.shape.x===s.x1&&r.shape.y===s.y1||(u=!0,r.shape=xt(h,s),r.area=i(this,U,"f").copy(r.area,{x:s.x1-i(this,tt,"f").nodeR1,y:s.y1-i(this,tt,"f").nodeR1}));else{u=!0,r={isCircle:h,shape:xt(h,s)};const e=lt(r),n=c.get(e);null!=n?r.area=i(this,U,"f").copy(n,{x:s.x1-i(this,tt,"f").nodeR1,y:s.y1-i(this,tt,"f").nodeR1}):(r.area=r.isCircle?v(r.shape,a,i(this,tt,"f").nodeR1):function(t,e,i){const s=e.scale(t),n=e.addPadding(s,i),r=e.createSub(n,{x:t.x-i,y:t.y-i}),h=s.x-n.x,o=s.y-n.y,a=n.x2-s.x2,c=n.y2-s.y2,u=n.width-h-a,l=n.height-o-c,f=i*i;r.fillArea({x:h,y:o,width:u+1,height:l+1},f);const x=[0],y=Math.max(o,h,a,c);{const n=e.invertScaleX(s.x+s.width/2);for(let r=1;r<y;r++){const h=e.invertScaleY(s.y-r),o=t.distSquare(n,h);if(!(o<f))break;{const t=i-Math.sqrt(o);x.push(t*t)}}}const d=[],p=Math.max(h,a),g=Math.max(o,a);for(let n=1;n<p;n++){const r=e.invertScaleX(s.x-n),h=[];for(let n=1;n<g;n++){const o=e.invertScaleY(s.y-n),a=t.distSquare(r,o);if(a<f){const t=i-Math.sqrt(a);h.push(t*t)}else h.push(0)}d.push(h)}for(let t=1;t<Math.min(o,x.length);t++){const e=x[t];r.fillHorizontalLine(h,o-t,u+1,e)}for(let t=1;t<Math.min(c,x.length);t++){const e=x[t];r.fillHorizontalLine(h,o+l+t,u+1,e)}for(let t=1;t<Math.min(h,x.length);t++){const e=x[t];r.fillVerticalLine(h-t,o,l+1,e)}for(let t=1;t<Math.min(c,x.length);t++){const e=x[t];r.fillVerticalLine(h+u+t,o,l+1,e)}for(let t=1;t<h;t++){const e=d[t-1],i=h-t;for(let t=1;t<o;t++)r.set(i,o-t,e[t-1]);for(let t=1;t<c;t++)r.set(i,o+l+t,e[t-1])}for(let t=1;t<a;t++){const e=d[t-1],i=h+u+t;for(let t=1;t<o;t++)r.set(i,o-t,e[t-1]);for(let t=1;t<c;t++)r.set(i,o+l+t,e[t-1])}return r}(r.shape,a,i(this,tt,"f").nodeR1),c.set(e,r.area)),t.scratch(at,r)}return r},f=this.nodes.map(l),x=this.avoidNodes.map(l),y=new Map;n||(i(this,et,"f").forEach(((t,e)=>y.set(e,t))),this.edges.forEach((t=>{var e;const i=null!==(e=t.scratch(at))&&void 0!==e?e:null;i&&i.lines&&i.lines.forEach(((t,e)=>{const s=i.areas[e];s&&c.set(ft(t),s)}))})));const d=t=>{const e=ft(t),s=y.get(e);if(null!=s)return s;const n=b(t,i(this,U,"f"),i(this,tt,"f").edgeR1);return y.set(e,n),n},p=[];this.edges.forEach((t=>{var e,i;const s=(null!==(e=t.segmentPoints())&&void 0!==e?e:[t.sourceEndpoint(),t.targetEndpoint()]).map((t=>({...t})));if(0===s.length)return;const r=s.slice(1).map(((t,e)=>{const i=s[e];return o.from({x1:i.x,y1:i.y,x2:t.x,y2:t.y})}));let h=null!==(i=t.scratch(at))&&void 0!==i?i:null;var a,c;h&&!n&&(a=h.lines,c=r,a.length===c.length&&a.every(((t,e)=>ft(t)===ft(c[e]))))||(h={lines:r,areas:r.map(d)},t.scratch(at,h)),p.push(...h.areas)}));const g=f.map((t=>t.shape));if(i(this,tt,"f").virtualEdges)if(u){const t=x.map((t=>t.shape)),e=T(g,t,i(this,tt,"f").maxRoutingIterations,i(this,tt,"f").morphBuffer);i(this,et,"f").clear(),e.forEach((t=>{const e=d(t),s=ft(t);i(this,et,"f").set(s,e),p.push(e)}))}else i(this,et,"f").forEach((t=>p.push(t)));const w=f.filter((t=>null!=t.area)).map((t=>t.area)),M=x.filter((t=>null!=t.area)).map((t=>t.area)),N=function(t,e,i,s,n,r={}){const h=Object.assign({},k,r);let o=h.threshold,a=h.memberInfluenceFactor,c=h.edgeInfluenceFactor,u=h.nonMemberInfluenceFactor;const l=(h.nodeR0-h.nodeR1)*(h.nodeR0-h.nodeR1),f=(h.edgeR0-h.edgeR1)*(h.edgeR0-h.edgeR1);for(let r=0;r<h.maxMarchingIterations;r++){if(t.clear(),0!==a){const i=a/l;for(const s of e)t.incArea(s,i)}if(0!==c){const e=c/f;for(const s of i)t.incArea(s,e)}if(0!==u){const e=u/l;for(const i of s)t.incArea(i,e)}const x=L(t,o);if(x&&n(x))return x;if(o*=.95,r<=.5*h.maxMarchingIterations)a*=1.2,c*=1.2;else{if(!(0!==u&&s.length>0))break;u*=.8}}return new R([])}(a,w,p,M,(t=>t.containsElements(g)),i(this,tt,"f"));this.node.setAttribute("d",N.sample(8).simplify(0).bSplines().simplify(0).toString(2))},s(this,rt,t,"f"),s(this,tt,{...k,style:{stroke:"black",fill:"black",fillOpacity:"0.25"},className:"",throttle:100,virtualEdges:!1,interactive:!1,includeLabels:!1,includeMainLabels:!1,includeOverlays:!1,includeSourceLabels:!1,includeTargetLabels:!1,...a},"f"),Object.assign(this.node.style,i(this,tt,"f").style),i(this,tt,"f").className&&this.node.classList.add(i(this,tt,"f").className),i(this,tt,"f").interactive&&this.node.addEventListener("dblclick",(()=>{this.nodes.select()})),s(this,it,ht((()=>{this.update()}),i(this,tt,"f").throttle),"f"),s(this,st,(t=>{t.target.on("add",i(this,st,"f")),t.target.on("remove",i(this,nt,"f")),i(this,it,"f").call(this)}),"f"),s(this,nt,(t=>{t.target.off("add",void 0,i(this,st,"f")),t.target.off("remove",void 0,i(this,nt,"f")),i(this,it,"f").call(this)}),"f"),n.on("position",i(this,it,"f")),n.on("add",i(this,st,"f")),n.on("remove",i(this,nt,"f")),h.on("position",i(this,it,"f")),h.on("add",i(this,st,"f")),h.on("remove",i(this,nt,"f")),r.on("move position",i(this,it,"f")),r.on("add",i(this,st,"f")),r.on("remove",i(this,nt,"f"))}remove(){for(const t of[this.nodes,this.edges,this.avoidNodes])t.off("move position",void 0,i(this,it,"f")),t.off("add",void 0,i(this,st,"f")),t.off("remove",void 0,i(this,nt,"f")),t.forEach((t=>{t.scratch(at,{})}));return this.node.remove(),i(this,rt,"f").remove(this)}}var dt,pt,gt,wt;Q=new WeakMap,U=new WeakMap,tt=new WeakMap,et=new WeakMap,it=new WeakMap,st=new WeakMap,nt=new WeakMap,rt=new WeakMap;class mt{constructor(t,n={}){var r;dt.set(this,[]),pt.set(this,{remove:t=>{const e=i(this,dt,"f").indexOf(t);return!(e<0)&&(i(this,dt,"f").splice(e,1),!0)}}),gt.set(this,void 0),wt.set(this,void 0),s(this,gt,t,"f"),s(this,wt,n,"f"),this.layer=null!==(r=n.layer)&&void 0!==r?r:e.layers(t).nodeLayer.insertBefore("svg")}destroy(){for(const t of i(this,dt,"f"))t.remove();this.layer.remove()}addPath(t,e=i(this,gt,"f").collection(),s=i(this,gt,"f").collection(),n={}){const r=this.layer.node.ownerDocument.createElementNS("http://www.w3.org/2000/svg","path");this.layer.node.appendChild(r);const h=new yt(i(this,pt,"f"),r,t,null!=e?e:i(this,gt,"f").collection(),null!=s?s:i(this,gt,"f").collection(),{...i(this,wt,"f"),...n});return i(this,dt,"f").push(h),h.update(),h}getPaths(){return i(this,dt,"f").slice()}removePath(t){return!(i(this,dt,"f").indexOf(t)<0)&&t.remove()}update(t=!1){i(this,dt,"f").forEach((e=>e.update(t)))}}function bt(t={}){return new mt(this,t)}function vt(t){t("core","bubbleSets",bt)}dt=new WeakMap,pt=new WeakMap,gt=new WeakMap,wt=new WeakMap,"function"==typeof window.cytoscape&&vt(window.cytoscape),t.BubbleSetPath=yt,t.BubbleSetsPlugin=mt,t.bubbleSets=bt,t.default=vt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map

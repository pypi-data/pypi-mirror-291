"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8366],{32103:(t,e,o)=>{o.d(e,{Kv:()=>i,T4:()=>s,Ul:()=>c,Z6:()=>l,ZU:()=>u}),o(67294);var n=o(68924),a=o(11965);const r=new n.FilterXSS({whiteList:{...(0,n.getDefaultWhiteList)(),span:["style","class","title"],div:["style","class"],a:["style","class","href","title","target"],img:["style","class","src","alt","title","width","height"],video:["autoplay","controls","loop","preload","src","height","width","muted"]},stripIgnoreTag:!0,css:!1});function l(t){return r.process(t)}function i(t){return Array.from((new DOMParser).parseFromString(t,"text/html").body.childNodes).some((({nodeType:t})=>1===t))}function s(t){return i(t)?l(t):t}function c(t){return i(t)?(0,a.tZ)("span",{className:"safe-html-wrapper",dangerouslySetInnerHTML:{__html:l(t)}}):t}function u(t){return t.replace(/<[^>]*>/g,"")}},34634:(t,e,o)=>{o.d(e,{F:()=>g});var n=o(18446),a=o.n(n),r=o(67294),l=o(90530),i=o(10025),s=o(85716),c=o(51995),u=o(32103),p=o(11965);const d=c.iK.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.gridUnit}px;\n    margin: ${2*t.gridUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function f(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:a}=e,r="string"==typeof a?(0,u.Ul)(a):a;return(0,p.tZ)(d,{top:n,left:o},r)}const h=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const[o,n]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(t.viewport),g=(0,s.D)(t.viewport);(0,r.useImperativeHandle)(e,(()=>({setTooltip:n})),[]);const m=(0,r.useCallback)((()=>{if(c&&Date.now()-c>250){const e=t.setControlValue;e&&e("viewport",d),u(null)}}),[c,t.setControlValue,d]);(0,r.useEffect)((()=>{const t=setInterval(m,250);return clearInterval(t)}),[m]),(0,r.useEffect)((()=>{a()(t.viewport,g)||h(t.viewport)}),[g,t.viewport]);const y=(0,r.useCallback)((({viewState:t})=>{h(t),u(Date.now())}),[]),b=(0,r.useCallback)((()=>t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers),[t.layers]),{children:v=null,height:w,width:x}=t;return(0,p.tZ)(r.Fragment,null,(0,p.tZ)("div",{style:{position:"relative",width:x,height:w}},(0,p.tZ)(i.Z,{controller:!0,width:x,height:w,layers:b(),viewState:d,glOptions:{preserveDrawingBuffer:!0},onViewStateChange:y},(0,p.tZ)(l.Z3,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})),v),(0,p.tZ)(f,{tooltip:o}))}))),g=(0,c.iK)(h)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},51805:(t,e,o)=>{o.d(e,{Z:()=>a}),o(67294);var n=o(11965);const a=({label:t,value:e})=>(0,n.tZ)("div",null,t,(0,n.tZ)("strong",null,e))},70325:(t,e,o)=>{o.d(e,{Z:()=>u});var n=o(67294),a=o(51995),r=o(67190),l=o(11965);const i=a.iK.div`
  ${({theme:t})=>`\n    font-size: ${t.typography.sizes.s}px;\n    position: absolute;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: 0 0 ${t.gridUnit}px ${t.colors.grayscale.light2};\n    margin: ${6*t.gridUnit}px;\n    padding: ${3*t.gridUnit}px ${5*t.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        color: ${t.colors.grayscale.base};\n        text-decoration: none;\n\n        & span {\n          margin-right: ${3*t.gridUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:n={},toggleCategory:a=(()=>{}),showSingleCategory:c=(()=>{})})=>{const u=o=>{if(!t||e)return o;const n=parseFloat(o);return(0,r.uf)(t,n)};if(0===Object.keys(n).length||null===o)return null;const p=Object.entries(n).map((([e,o])=>{const n={color:`rgba(${o.color.join(", ")})`},r=o.enabled?"◼":"◻";return(0,l.tZ)("li",{key:e},(0,l.tZ)("a",{href:"#",onClick:()=>a(e),onDoubleClick:()=>c(e)},(0,l.tZ)("span",{style:n},r)," ",(e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return u(t[0])+s+u(t[1])}return u(e)})(e)))})),d={position:"absolute",["t"===(null==o?void 0:o.charAt(0))?"top":"bottom"]:"0px",["r"===(null==o?void 0:o.charAt(1))?"right":"left"]:"10px"};return(0,l.tZ)(i,{className:"dupa",style:d},(0,l.tZ)("ul",null,p))},u=(0,n.memo)(c)},89691:(t,e,o)=>{o.d(e,{B:()=>v,G:()=>b});var n=o(18446),a=o.n(n),r=o(67294),l=o(85716),i=o(34634),s=o(28062),c=o(70325),u=o(89503),p=o(63241),d=o(40461),f=o(11965);const{getScale:h}=s;function g(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},n=[o.r,o.g,o.b,255*o.a],a=h(t.color_scheme),r={};return e.forEach((e=>{if(null!=e.cat_color&&!r.hasOwnProperty(e.cat_color)){let l;l=t.dimension?(0,u.hexToRGB)(a(e.cat_color,t.sliceId),255*o.a):n,r[e.cat_color]={color:l,enabled:!0}}})),r}const m=t=>{const e=(0,r.useRef)(null),o=(0,r.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,d.Z)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[n,a]=(0,r.useState)(g(t.formData,t.payload.data.features||[])),[l,s]=(0,r.useState)(t.payload.form_data),[m,y]=(0,r.useState)(o());(0,r.useEffect)((()=>{if(t.payload.form_data!==l){const e=t.payload.data.features||[],n=g(t.formData,e);y(o()),s(t.payload.form_data),a(n)}}),[o,t,l]);const b=(0,r.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),v=(0,r.useCallback)(((t,e)=>{const o=e.color_picker||{r:0,g:0,b:0,a:1},n=h(e.color_scheme);return t.map((t=>{let a;return e.dimension?(a=(0,u.hexToRGB)(n(t.cat_color,e.sliceId),255*o.a),{...t,color:a}):t}))}),[]),w=(0,r.useCallback)((()=>{const{getLayer:e,payload:o,formData:a,onAddFilter:r}=t;let l=o.data.features?[...o.data.features]:[];return l=v(l,a),a.js_data_mutator&&(l=(0,p.Z)(a.js_data_mutator)(l)),a.dimension&&(l=l.filter((t=>{var e;return null==(e=n[t.cat_color])?void 0:e.enabled}))),[e(a,{...o,data:{...o.data,features:l}},r,b,t.datasource)]}),[v,n,t,b]),x=(0,r.useCallback)((t=>{const e=n[t],o={...n,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),a(o)}),[n]),Z=(0,r.useCallback)((t=>{const e={...n};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,a(e)}),[n]);return(0,f.tZ)("div",{style:{position:"relative"}},(0,f.tZ)(i.F,{ref:e,viewport:m,layers:w(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,f.tZ)(c.Z,{forceCategorical:!0,categories:n,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:Z,toggleCategory:x}))},y=(0,r.memo)(m);function b(t,e){return(0,r.memo)((o=>{const n=(0,r.useRef)(),s=(0,l.D)(o.formData),c=(0,l.D)(o.payload),[u,p]=(0,r.useState)((()=>{const{width:t,height:n,formData:a}=o;return a.autozoom?(0,d.Z)(o.viewport,{width:t,height:n,points:e(o.payload.data.features)}):o.viewport})()),h=(0,r.useCallback)((t=>{const{current:e}=n;e&&(null==e||e.setTooltip(t))}),[]),g=(0,r.useCallback)((e=>{const{formData:o,payload:n,onAddFilter:a}=e;return t(o,n,a,h)}),[h]),[m,y]=(0,r.useState)(g(o));(0,r.useEffect)((()=>{const t={...s,viewport:null},e={...o.formData,viewport:null};a()(t,e)&&c===o.payload||y(g(o))}),[g,s,c,o]);const{formData:b,payload:v,setControlValue:w,height:x,width:Z}=o;return(0,f.tZ)(i.F,{ref:n,mapboxApiAccessToken:v.data.mapboxApiKey,viewport:u,layers:[m],mapStyle:b.mapbox_style,setControlValue:w,width:Z,height:x,onViewportChange:p})}))}function v(t,e){return function(o){const{datasource:n,formData:a,height:r,payload:l,setControlValue:i,viewport:s,width:c}=o;return(0,f.tZ)(y,{datasource:n,formData:a,mapboxApiKey:l.data.mapboxApiKey,setControlValue:i,viewport:s,getLayer:t,payload:l,getPoints:e,width:c,height:r})}}},58371:(t,e,o)=>{o.d(e,{N:()=>r,Z:()=>i});var n=o(4065),a=o(63241);function r(t,e,o,n){const r=t;let l,i,s=o;return r.js_tooltip&&(s=(0,a.Z)(r.js_tooltip)),s&&(l=t=>(t.picked?e({content:s(t),x:t.x,y:t.y}):e(null),!0)),r.js_onclick_href?i=t=>{const e=(0,a.Z)(r.js_onclick_href)(t);return window.open(e),!0}:r.table_filter&&void 0!==n&&(i=t=>(n(t.object[r.line_column]),!0)),{onClick:i,onHover:l,pickable:Boolean(l)}}const l={p1:.01,p5:.05,p95:.95,p99:.99};function i(t="sum",e=null){if("count"===t)return t=>t.length;let o;return o=t in l?(o,a)=>{let r;return r=e?o.sort(((t,o)=>n.ascending(e(t),e(o)))):o.sort(n.ascending),n.quantile(r,l[t],a)}:n[t],e?t=>o(t.map((t=>e(t)))):t=>o(t)}},89503:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>a});var n=o(50667);function a(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:a,b:r}=(0,n.B8)(t);return[o,a,r,e]}},40461:(t,e,o)=>{o.d(e,{Z:()=>s});var n=o(17013),a=o(4065);const r=[-90,90],l=[-180,180];function i([t,e],[o,n],a=.25){return t<e?[t,e]:[Math.max(o,t-a),Math.min(n,e+a)]}function s(t,{points:e,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d=20}){const{bearing:f,pitch:h}=t,g=function(t){const e=i((0,a.extent)(t,(t=>t[1])),r),o=i((0,a.extent)(t,(t=>t[0])),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Xg)({bounds:g,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d}),bearing:f,pitch:h}}catch(t){console.error("Could not fit viewport",t)}return t}},63241:(t,e,o)=>{o.d(e,{Z:()=>c});var n=o(55140),a=o.n(n),r=o(59050),l=o(4065),i=o(89503);const s={console,_:r.ZP,colors:i,d3array:l};function c(t,e,o){const n={},r=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[r]={};const l=`${r}=${t}`,i={...s,...e};Object.keys(i).forEach((t=>{n[t]=i[t]}));try{return a().runInNewContext(l,n,o),n[r]}catch(t){return()=>t}}}}]);
//# sourceMappingURL=eaacb96fdf98ad2fe9e1.chunk.js.map